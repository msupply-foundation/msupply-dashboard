"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6031],{"./public/app/plugins/datasource/prometheus/components/monaco-query-field/MonacoQueryField.tsx":(t,e,i)=>{i.r(e),i.d(e,{default:()=>vt});var s=i("./node_modules/react/index.js"),r=i("./packages/grafana-ui/src/index.ts");const n=function(t){var e=(0,s.useRef)(t);return e.current=t,e};var a={id:"promql",extensions:[".promql"],aliases:["Prometheus","prometheus","prom","Prom","promql","Promql","promQL","PromQL"],mimetypes:[],loader:function(){return Promise.all([i.e(5412),i.e(1401)]).then(i.bind(i,"./node_modules/monaco-promql/promql/promql.js"))}};const h=1024;let o=0;const l=new WeakMap;class u{constructor({deserialize:t}={}){this.id=o++,this.deserialize=t||(()=>{throw new Error("This node type doesn't define a deserialize function")})}static string(){return new u({deserialize:t=>t})}static number(){return new u({deserialize:Number})}static flag(){return new u({deserialize:()=>!0})}set(t,e){return t[this.id]=e,t}add(t){return"function"!=typeof t&&(t=c.match(t)),e=>{let i=t(e);return void 0===i?null:[this,i]}}}u.closedBy=new u({deserialize:t=>t.split(" ")}),u.openedBy=new u({deserialize:t=>t.split(" ")}),u.group=new u({deserialize:t=>t.split(" ")});const f=Object.create(null);class c{constructor(t,e,i,s=0){this.name=t,this.props=e,this.id=i,this.flags=s}static define(t){let e=t.props&&t.props.length?Object.create(null):f,i=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(null==t.name?8:0),s=new c(t.name||"",e,t.id,i);if(t.props)for(let i of t.props)Array.isArray(i)||(i=i(s)),i&&i[0].set(e,i[1]);return s}prop(t){return this.props[t.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(t){if("string"==typeof t){if(this.name==t)return!0;let e=this.prop(u.group);return!!e&&e.indexOf(t)>-1}return this.id==t}static match(t){let e=Object.create(null);for(let i in t)for(let s of i.split(" "))e[s]=t[i];return t=>{for(let i=t.prop(u.group),s=-1;s<(i?i.length:0);s++){let r=e[s<0?t.name:i[s]];if(r)return r}}}}c.none=new c("",Object.create(null),0,8);class O{constructor(t){this.types=t;for(let e=0;e<t.length;e++)if(t[e].id!=e)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...t){let e=[];for(let i of this.types){let s=null;for(let e of t){let t=e(i);t&&(s||(s=Object.assign({},i.props)),t[0].set(s,t[1]))}e.push(s?new c(i.name,s,i.id,i.flags):i)}return new O(e)}}class p{constructor(t,e,i,s){this.type=t,this.children=e,this.positions=i,this.length=s}toString(){let t=this.children.map((t=>t.toString())).join();return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(t,e=0){let i=null!=t&&l.get(this)||this.topNode,s=new b(i);return null!=t&&(s.moveTo(t,e),l.set(this,s._tree)),s}fullCursor(){return new b(this.topNode,!0)}get topNode(){return new g(this,0,0,null)}resolve(t,e=0){return this.cursor(t,e).node}iterate(t){let{enter:e,leave:i,from:s=0,to:r=this.length}=t;for(let t=this.cursor();;){let n=!1;if(t.from<=r&&t.to>=s&&(t.type.isAnonymous||!1!==e(t.type,t.from,t.to))){if(t.firstChild())continue;t.type.isAnonymous||(n=!0)}for(;n&&i&&i(t.type,t.from,t.to),n=t.type.isAnonymous,!t.nextSibling();){if(!t.parent())return;n=!0}}}balance(t=h){return this.children.length<=y?this:k(this.type,c.none,this.children,this.positions,0,this.children.length,0,t,this.length,0)}static build(t){return function(t){var e;let{buffer:i,nodeSet:s,topID:r=0,maxBufferLength:n=h,reused:a=[],minRepeatType:o=s.types.length}=t,l=Array.isArray(i)?new v(i,i.length):i,u=s.types,f=0;function O(t,e,i,r,h){let{id:m,start:P,end:b,size:$}=l,v=P-t;if($<0)return-1==$?(i.push(a[m]),r.push(v)):f=m,void l.next();let S,X,_=u[m];if(b-P<=n&&(X=g(l.pos-e,h))){let e=new Uint16Array(X.size-X.skip),i=l.pos-X.size,r=e.length;for(;l.pos>i;)r=x(X.start,e,r,h);S=new Q(e,b-X.start,s,h<0?c.none:u[h]),v=X.start-t}else{let t=l.pos-$;l.next();let e=[],i=[],s=m>=o?m:-1;for(;l.pos>t;)l.id==s?l.next():O(P,t,e,i,s);e.reverse(),i.reverse(),S=s>-1&&e.length>y?k(_,_,e,i,0,e.length,0,n,b-P,f):d(new p(_,e,i,b-P),f)}i.push(S),r.push(v)}function g(t,e){let i=l.fork(),s=0,r=0,a=0,h=i.end-n,u={size:0,start:0,skip:0};t:for(let n=i.pos-t;i.pos>n;){if(i.id==e){u.size=s,u.start=r,u.skip=a,a+=4,s+=4,i.next();continue}let t=i.size,l=i.pos-t;if(t<0||l<n||i.start<h)break;let f=i.id>=o?4:0,c=i.start;for(i.next();i.pos>l;){if(i.size<0)break t;i.id>=o&&(f+=4),i.next()}r=c,s+=t,a+=f}return(e<0||s==t)&&(u.size=s,u.start=r,u.skip=a),u.size>4?u:void 0}function x(t,e,i,s){let{id:r,start:n,end:a,size:h}=l;if(l.next(),r==s)return i;let u=i;if(h>4){let r=l.pos-(h-4);for(;l.pos>r;)i=x(t,e,i,s)}return r<o&&(e[--i]=u,e[--i]=a-t,e[--i]=n-t,e[--i]=r),i}let m=[],P=[];for(;l.pos>0;)O(t.start||0,0,m,P,-1);let b=null!==(e=t.length)&&void 0!==e?e:m.length?P[0]+m[0].length:0;return new p(u[r],m.reverse(),P.reverse(),b)}(t)}}function d(t,e){return e&&(t.contextHash=e),t}p.empty=new p(c.none,[],[],0);class Q{constructor(t,e,i,s=c.none){this.buffer=t,this.length=e,this.set=i,this.type=s}toString(){let t=[];for(let e=0;e<this.buffer.length;)t.push(this.childString(e)),e=this.buffer[e+3];return t.join(",")}childString(t){let e=this.buffer[t],i=this.buffer[t+3],s=this.set.types[e],r=s.name;if(/\W/.test(r)&&!s.isError&&(r=JSON.stringify(r)),i==(t+=4))return r;let n=[];for(;t<i;)n.push(this.childString(t)),t=this.buffer[t+3];return r+"("+n.join(",")+")"}findChild(t,e,i,s){let{buffer:r}=this,n=-1;for(let a=t;a!=e;a=r[a+3])if(-1e8!=s){let t=r[a+1],e=r[a+2];if(i>0){if(e>s&&(n=a),e>s)break}else if(t<s&&(n=a),e>=s)break}else if(n=a,i>0)break;return n}}class g{constructor(t,e,i,s){this.node=t,this.from=e,this.index=i,this._parent=s}get type(){return this.node.type}get name(){return this.node.type.name}get to(){return this.from+this.node.length}nextChild(t,e,i,s=!1){for(let r=this;;){for(let{children:n,positions:a}=r.node,h=e>0?n.length:-1;t!=h;t+=e){let h=n[t],o=a[t]+r.from;if(-1e8==i||!(e<0?o>=i:o+h.length<=i))if(h instanceof Q){let s=h.findChild(0,h.buffer.length,e,-1e8==i?-1e8:i-o);if(s>-1)return new P(new m(r,h,t,o),null,s)}else if(s||!h.type.isAnonymous||$(h)){let n=new g(h,o,t,r);return s||!n.type.isAnonymous?n:n.nextChild(e<0?h.children.length-1:0,e,i)}}if(s||!r.type.isAnonymous)return null;if(t=r.index+e,r=r._parent,!r)return null}}get firstChild(){return this.nextChild(0,1,-1e8)}get lastChild(){return this.nextChild(this.node.children.length-1,-1,-1e8)}childAfter(t){return this.nextChild(0,1,t)}childBefore(t){return this.nextChild(this.node.children.length-1,-1,t)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent?this._parent.nextChild(this.index+1,1,-1):null}get prevSibling(){return this._parent?this._parent.nextChild(this.index-1,-1,-1):null}get cursor(){return new b(this)}resolve(t,e=0){return this.cursor.moveTo(t,e).node}getChild(t,e=null,i=null){let s=x(this,t,e,i);return s.length?s[0]:null}getChildren(t,e=null,i=null){return x(this,t,e,i)}toString(){return this.node.toString()}}function x(t,e,i,s){let r=t.cursor,n=[];if(!r.firstChild())return n;if(null!=i)for(;!r.type.is(i);)if(!r.nextSibling())return n;for(;;){if(null!=s&&r.type.is(s))return n;if(r.type.is(e)&&n.push(r.node),!r.nextSibling())return null==s?n:[]}}class m{constructor(t,e,i,s){this.parent=t,this.buffer=e,this.index=i,this.start=s}}class P{constructor(t,e,i){this.context=t,this._parent=e,this.index=i,this.type=t.buffer.set.types[t.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(t,e){let{buffer:i}=this.context,s=i.findChild(this.index+4,i.buffer[this.index+3],t,-1e8==e?-1e8:e-this.context.start);return s<0?null:new P(this.context,this,s)}get firstChild(){return this.child(1,-1e8)}get lastChild(){return this.child(-1,-1e8)}childAfter(t){return this.child(1,t)}childBefore(t){return this.child(-1,t)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,-1)}get nextSibling(){let{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new P(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new P(this.context,this._parent,t.findChild(e,this.index,-1,-1e8))}get cursor(){return new b(this)}resolve(t,e=0){return this.cursor.moveTo(t,e).node}toString(){return this.context.buffer.childString(this.index)}getChild(t,e=null,i=null){let s=x(this,t,e,i);return s.length?s[0]:null}getChildren(t,e=null,i=null){return x(this,t,e,i)}}class b{constructor(t,e=!1){if(this.full=e,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,t instanceof g)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let e=t._parent;e;e=e._parent)this.stack.unshift(e.index);this.bufferNode=t,this.yieldBuf(t.index)}}get name(){return this.type.name}yieldNode(t){return!!t&&(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0)}yieldBuf(t,e){this.index=t;let{start:i,buffer:s}=this.buffer;return this.type=e||s.set.types[s.buffer[t]],this.from=i+s.buffer[t+1],this.to=i+s.buffer[t+2],!0}yield(t){return!!t&&(t instanceof g?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enter(t,e){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree.node.children.length-1:0,t,e,this.full));let{buffer:i}=this.buffer,s=i.findChild(this.index+4,i.buffer[this.index+3],t,-1e8==e?-1e8:e-this.buffer.start);return!(s<0)&&(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enter(1,-1e8)}lastChild(){return this.enter(-1,-1e8)}childAfter(t){return this.enter(1,t)}childBefore(t){return this.enter(-1,t)}parent(){if(!this.buffer)return this.yieldNode(this.full?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=this.full?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree._parent.nextChild(this._tree.index+t,t,-1e8,this.full));let{buffer:e}=this.buffer,i=this.stack.length-1;if(t<0){let t=i<0?0:this.stack[i]+4;if(this.index!=t)return this.yieldBuf(e.findChild(t,this.index,-1,-1e8))}else{let t=e.buffer[this.index+3];if(t<(i<0?e.buffer.length:e.buffer[this.stack[i]+3]))return this.yieldBuf(t)}return i<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,-1e8,this.full))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let e,i,{buffer:s}=this;if(s){if(t>0){if(this.index<s.buffer.buffer.length)return!1}else for(let t=0;t<this.index;t++)if(s.buffer.buffer[t+3]<this.index)return!1;({index:e,parent:i}=s)}else({index:e,_parent:i}=this._tree);for(;i;({index:e,_parent:i}=i))for(let s=e+t,r=t<0?-1:i.node.children.length;s!=r;s+=t){let t=i.node.children[s];if(this.full||!t.type.isAnonymous||t instanceof Q||$(t))return!1}return!0}move(t){if(this.enter(t,-1e8))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(){return this.move(1)}prev(){return this.move(-1)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))&&this.parent(););for(;e<0?this.childBefore(t):this.childAfter(t);)if(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t)){this.parent();break}return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,e=null,i=0;if(t&&t.context==this.buffer)t:for(let s=this.index,r=this.stack.length;r>=0;){for(let n=t;n;n=n._parent)if(n.index==s){if(s==this.index)return n;e=n,i=r+1;break t}s=this.stack[--r]}for(let t=i;t<this.stack.length;t++)e=new P(this.buffer,e,this.stack[t]);return this.bufferNode=new P(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree.node}}function $(t){return t.children.some((t=>!t.type.isAnonymous||t instanceof Q||$(t)))}class v{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new v(this.buffer,this.index)}}const y=8;function k(t,e,i,s,r,n,a,h,o,l){let u=[],f=[];if(o<=h)for(let t=r;t<n;t++)u.push(i[t]),f.push(s[t]-a);else{let t=Math.max(h,Math.ceil(1.5*o/y));for(let o=r;o<n;){let r=o,O=s[o];for(o++;o<n;o++){if(s[o]+i[o].length-O>t)break}if(o==r+1){let s=i[r];if(s instanceof p&&s.type==e&&s.length>t<<1){for(let t=0;t<s.children.length;t++)u.push(s.children[t]),f.push(s.positions[t]+O-a);continue}u.push(s)}else if(o==r+1)u.push(i[r]);else{let t=k(e,e,i,s,r,o,O,h,s[o-1]+i[o-1].length-O,l);e==c.none||S(t.children,e)||(t=d(new p(c.none,t.children,t.positions,t.length),l)),u.push(t)}f.push(O-a)}}return d(new p(t,u,f,o),l)}function S(t,e){for(let i of t)if(i.type==e)return!0;return!1}function X(t){return new _(t)}class _{constructor(t,e=t.length){this.string=t,this.length=e}get(t){return t<0||t>=this.length?-1:this.string.charCodeAt(t)}lineAfter(t){if(t<0)return"";let e=this.string.indexOf("\n",t);return this.string.slice(t,e<0?this.length:Math.min(e,this.length))}read(t,e){return this.string.slice(t,Math.min(this.length,e))}clip(t){return new _(this.string,t)}}class E{constructor(t,e,i,s,r,n,a,h,o,l){this.p=t,this.stack=e,this.state=i,this.reducePos=s,this.pos=r,this.score=n,this.buffer=a,this.bufferBase=h,this.curContext=o,this.parent=l}toString(){return`[${this.stack.filter(((t,e)=>e%3==0)).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(t,e,i=0){let s=t.parser.context;return new E(t,[],e,i,i,0,[],0,s?new R(s,s.start):null,null)}get context(){return this.curContext?this.curContext.context:null}pushState(t,e){this.stack.push(this.state,e,this.bufferBase+this.buffer.length),this.state=t}reduce(t){let e=t>>19,i=65535&t,{parser:s}=this.p,r=s.dynamicPrecedence(i);if(r&&(this.score+=r),0==e)return i<s.minRepeatTerm&&this.storeNode(i,this.reducePos,this.reducePos,4,!0),this.pushState(s.getGoto(this.state,i,!0),this.reducePos),void this.reduceContext(i);let n=this.stack.length-3*(e-1)-(262144&t?6:0),a=this.stack[n-2],h=this.stack[n-1],o=this.bufferBase+this.buffer.length-h;if(i<s.minRepeatTerm||131072&t){let t=s.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(i,a,t,o+4,!0)}if(262144&t)this.state=this.stack[n];else{let t=this.stack[n-3];this.state=s.getGoto(t,i,!0)}for(;this.stack.length>n;)this.stack.pop();this.reduceContext(i)}storeNode(t,e,i,s=4,r=!1){if(0==t){let t=this,s=this.buffer.length;if(0==s&&t.parent&&(s=t.bufferBase-t.parent.bufferBase,t=t.parent),s>0&&0==t.buffer[s-4]&&t.buffer[s-1]>-1){if(e==i)return;if(t.buffer[s-2]>=e)return void(t.buffer[s-2]=i)}}if(r&&this.pos!=i){let r=this.buffer.length;if(r>0&&0!=this.buffer[r-4])for(;r>0&&this.buffer[r-2]>i;)this.buffer[r]=this.buffer[r-4],this.buffer[r+1]=this.buffer[r-3],this.buffer[r+2]=this.buffer[r-2],this.buffer[r+3]=this.buffer[r-1],r-=4,s>4&&(s-=4);this.buffer[r]=t,this.buffer[r+1]=e,this.buffer[r+2]=i,this.buffer[r+3]=s}else this.buffer.push(t,e,i,s)}shift(t,e,i){if(131072&t)this.pushState(65535&t,this.pos);else if(0==(262144&t)){let s=this.pos,r=t,{parser:n}=this.p;(i>this.pos||e<=n.maxNode)&&(this.pos=i,n.stateFlag(r,1)||(this.reducePos=i)),this.pushState(r,s),e<=n.maxNode&&this.buffer.push(e,s,i,4),this.shiftContext(e)}else e<=this.p.parser.maxNode&&this.buffer.push(e,this.pos,i,4),this.pos=i}apply(t,e,i){65536&t?this.reduce(t):this.shift(t,e,i)}useNode(t,e){let i=this.p.reused.length-1;(i<0||this.p.reused[i]!=t)&&(this.p.reused.push(t),i++);let s=this.pos;this.reducePos=this.pos=s+t.length,this.pushState(e,s),this.buffer.push(i,s,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,t,this.p.input,this))}split(){let t=this,e=t.buffer.length;for(;e>0&&t.buffer[e-2]>t.reducePos;)e-=4;let i=t.buffer.slice(e),s=t.bufferBase+e;for(;t&&s==t.bufferBase;)t=t.parent;return new E(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,i,s,this.curContext,t)}recoverByDelete(t,e){let i=t<=this.p.parser.maxNode;i&&this.storeNode(t,this.pos,e),this.storeNode(0,this.pos,e,i?8:4),this.pos=this.reducePos=e,this.score-=200}canShift(t){for(let e=new w(this);;){let i=this.p.parser.stateSlot(e.top,4)||this.p.parser.hasAction(e.top,t);if(0==(65536&i))return!0;if(0==i)return!1;e.reduce(i)}}get ruleStart(){for(let t=this.state,e=this.stack.length;;){let i=this.p.parser.stateSlot(t,5);if(!(65536&i))return 0;if(e-=3*(i>>19),(65535&i)<this.p.parser.minRepeatTerm)return this.stack[e+1];t=this.stack[e]}}startOf(t,e){let i=this.state,s=this.stack.length,{parser:r}=this.p;for(;;){let n=r.stateSlot(i,5),a=n>>19,h=65535&n;if(t.indexOf(h)>-1){let t=s-3*(n>>19),i=this.stack[t+1];if(null==e||e>i)return i}if(0==s)return null;0==a?(s-=3,i=this.stack[s]):(s-=3*(a-1),i=r.getGoto(this.stack[s-3],h,!0))}}recoverByInsert(t){if(this.stack.length>=300)return[];let e=this.p.parser.nextStates(this.state);if(e.length>8||this.stack.length>=120){let i=[];for(let s,r=0;r<e.length;r+=2)(s=e[r+1])!=this.state&&this.p.parser.hasAction(s,t)&&i.push(e[r],s);if(this.stack.length<120)for(let t=0;i.length<8&&t<e.length;t+=2){let s=e[t+1];i.some(((t,e)=>1&e&&t==s))||i.push(e[t],s)}e=i}let i=[];for(let t=0;t<e.length&&i.length<4;t+=2){let s=e[t+1];if(s==this.state)continue;let r=this.split();r.storeNode(0,r.pos,r.pos,4,!0),r.pushState(s,this.pos),r.shiftContext(e[t]),r.score-=200,i.push(r)}return i}forceReduce(){let t=this.p.parser.stateSlot(this.state,5);return 0!=(65536&t)&&(this.p.parser.validAction(this.state,t)||(this.storeNode(0,this.reducePos,this.reducePos,4,!0),this.score-=100),this.reduce(t),!0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2)&&this.forceReduce(););return this}get deadEnd(){if(3!=this.stack.length)return!1;let{parser:t}=this.p;return 65535==t.data[t.stateSlot(this.state,1)]&&!t.stateSlot(this.state,4)}restart(){this.state=this.stack[0],this.stack.length=0}sameState(t){if(this.state!=t.state||this.stack.length!=t.stack.length)return!1;for(let e=0;e<this.stack.length;e+=3)if(this.stack[e]!=t.stack[e])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(t){return this.p.parser.dialect.flags[t]}shiftContext(t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,t,this.p.input,this))}reduceContext(t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,t,this.p.input,this))}emitContext(){let t=this.curContext;if(!t.tracker.strict)return;let e=this.buffer.length-1;(e<0||-2!=this.buffer[e])&&this.buffer.push(t.hash,this.reducePos,this.reducePos,-2)}updateContext(t){if(t!=this.curContext.context){let e=new R(this.curContext.tracker,t);e.hash!=this.curContext.hash&&this.emitContext(),this.curContext=e}}}class R{constructor(t,e){this.tracker=t,this.context=e,this.hash=t.hash(e)}}var C;!function(t){t[t.Token=200]="Token",t[t.Reduce=100]="Reduce",t[t.MaxNext=4]="MaxNext",t[t.MaxInsertStackDepth=300]="MaxInsertStackDepth",t[t.DampenInsertStackDepth=120]="DampenInsertStackDepth"}(C||(C={}));class w{constructor(t){this.stack=t,this.top=t.state,this.rest=t.stack,this.offset=this.rest.length}reduce(t){let e=65535&t,i=t>>19;0==i?(this.rest==this.stack.stack&&(this.rest=this.rest.slice()),this.rest.push(this.top,0,0),this.offset+=3):this.offset-=3*(i-1);let s=this.stack.p.parser.getGoto(this.rest[this.offset-3],e,!0);this.top=s}}class N{constructor(t,e,i){this.stack=t,this.pos=e,this.index=i,this.buffer=t.buffer,0==this.index&&this.maybeNext()}static create(t){return new N(t,t.bufferBase+t.buffer.length,t.buffer.length)}maybeNext(){let t=this.stack.parent;null!=t&&(this.index=this.stack.bufferBase-t.bufferBase,this.stack=t,this.buffer=t.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,0==this.index&&this.maybeNext()}fork(){return new N(this.stack,this.pos,this.index)}}class T{constructor(){this.start=-1,this.value=-1,this.end=-1}accept(t,e){this.value=t,this.end=e}}class L{constructor(t,e){this.data=t,this.id=e}token(t,e,i){!function(t,e,i,s,r){let n=0,a=1<<r,h=s.p.parser.dialect;t:for(let r=i.start;0!=(a&t[n]);){let o=t[n+1];for(let e=n+3;e<o;e+=2)if((t[e+1]&a)>0){let n=t[e];if(h.allows(n)&&(-1==i.value||i.value==n||s.p.parser.overrides(n,i.value))){i.accept(n,r);break}}let l=e.get(r++);for(let e=0,i=t[n+2];e<i;){let s=e+i>>1,r=o+s+(s<<1),a=t[r],h=t[r+1];if(l<a)i=s;else{if(!(l>=h)){n=t[r+2];continue t}e=s+1}}break}}(this.data,t,e,i,this.id)}}L.prototype.contextual=L.prototype.fallback=L.prototype.extend=!1;function A(t,e=Uint16Array){if("string"!=typeof t)return t;let i=null;for(let s=0,r=0;s<t.length;){let n=0;for(;;){let e=t.charCodeAt(s++),i=!1;if(126==e){n=65535;break}e>=92&&e--,e>=34&&e--;let r=e-32;if(r>=46&&(r-=46,i=!0),n+=r,i)break;n*=46}i?i[r++]=n:i=new e(n)}return i}const D="undefined"!=typeof process&&/\bparse\b/.test(process.env.LOG);let q=null;function z(t,e,i){let s=t.cursor(e);for(;;)if(!(i<0?s.childBefore(e):s.childAfter(e)))for(;;){if((i<0?s.to<e:s.from>e)&&!s.type.isError)return i<0?Math.max(0,Math.min(s.to-1,e-5)):Math.min(t.length,Math.max(s.from+1,e+5));if(i<0?s.prevSibling():s.nextSibling())break;if(!s.parent())return i<0?0:t.length}}class Y{constructor(t){this.fragments=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let t=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(t){for(this.safeFrom=t.openStart?z(t.tree,t.from+t.offset,1)-t.offset:t.from,this.safeTo=t.openEnd?z(t.tree,t.to+t.offset,-1)-t.offset:t.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(t.tree),this.start.push(-t.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(t){if(t<this.nextStart)return null;for(;this.fragment&&this.safeTo<=t;)this.nextFragment();if(!this.fragment)return null;for(;;){let e=this.trees.length-1;if(e<0)return this.nextFragment(),null;let i=this.trees[e],s=this.index[e];if(s==i.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let r=i.children[s],n=this.start[e]+i.positions[s];if(n>t)return this.nextStart=n,null;if(n==t&&n+r.length<=this.safeTo)return n==t&&n>=this.safeFrom?r:null;r instanceof Q?(this.index[e]++,this.nextStart=n+r.length):(this.index[e]++,n+r.length>=t&&(this.trees.push(r),this.start.push(n),this.index.push(0)))}}}class M extends T{constructor(){super(...arguments),this.extended=-1,this.mask=0,this.context=0}clear(t){this.start=t,this.value=this.extended=-1}}const I=new T;class U{constructor(t){this.tokens=[],this.mainToken=I,this.actions=[],this.tokens=t.tokenizers.map((t=>new M))}getActions(t,e){let i=0,s=null,{parser:r}=t.p,{tokenizers:n}=r,a=r.stateSlot(t.state,3),h=t.curContext?t.curContext.hash:0;for(let r=0;r<n.length;r++){if(0==(1<<r&a))continue;let o=n[r],l=this.tokens[r];if((!s||o.fallback)&&((o.contextual||l.start!=t.pos||l.mask!=a||l.context!=h)&&(this.updateCachedToken(l,o,t,e),l.mask=a,l.context=h),0!=l.value)){let e=i;if(l.extended>-1&&(i=this.addActions(t,l.extended,l.end,i)),i=this.addActions(t,l.value,l.end,i),!o.extend&&(s=l,i>e))break}}for(;this.actions.length>i;)this.actions.pop();return s||(s=I,s.start=t.pos,t.pos==e.length?s.accept(t.p.parser.eofTerm,t.pos):s.accept(0,t.pos+1)),this.mainToken=s,this.actions}updateCachedToken(t,e,i,s){if(t.clear(i.pos),e.token(s,t,i),t.value>-1){let{parser:e}=i.p;for(let r=0;r<e.specialized.length;r++)if(e.specialized[r]==t.value){let n=e.specializers[r](s.read(t.start,t.end),i);if(n>=0&&i.p.parser.dialect.allows(n>>1)){0==(1&n)?t.value=n>>1:t.extended=n>>1;break}}}else i.pos==s.length?t.accept(i.p.parser.eofTerm,i.pos):t.accept(0,i.pos+1)}putAction(t,e,i,s){for(let e=0;e<s;e+=3)if(this.actions[e]==t)return s;return this.actions[s++]=t,this.actions[s++]=e,this.actions[s++]=i,s}addActions(t,e,i,s){let{state:r}=t,{parser:n}=t.p,{data:a}=n;for(let t=0;t<2;t++)for(let h=n.stateSlot(r,t?2:1);;h+=3){if(65535==a[h]){if(1!=a[h+1]){0==s&&2==a[h+1]&&(s=this.putAction(G(a,h+1),e,i,s));break}h=G(a,h+2)}a[h]==e&&(s=this.putAction(G(a,h+1),e,i,s))}return s}}var W;!function(t){t[t.Distance=5]="Distance",t[t.MaxRemainingPerStep=3]="MaxRemainingPerStep",t[t.MinBufferLengthPrune=200]="MinBufferLengthPrune",t[t.ForceReduceLimit=10]="ForceReduceLimit"}(W||(W={}));class V{constructor(t,e,i,s){this.parser=t,this.input=e,this.startPos=i,this.context=s,this.pos=0,this.recovering=0,this.nextStackID=9812,this.nested=null,this.nestEnd=0,this.nestWrap=null,this.reused=[],this.tokens=new U(t),this.topTerm=t.top[1],this.stacks=[E.start(this,t.top[0],this.startPos)];let r=null==s?void 0:s.fragments;this.fragments=r&&r.length?new Y(r):null}advance(){if(this.nested){let t=this.nested.advance();return this.pos=this.nested.pos,t&&(this.finishNested(this.stacks[0],t),this.nested=null),null}let t,e,i,s=this.stacks,r=this.pos,n=this.stacks=[];for(let a=0;a<s.length;a++){let h,o=s[a];for(;;){if(o.pos>r)n.push(o);else if(h=this.checkNest(o))(!i||i.stack.score<o.score)&&(i=h);else{if(this.advanceStack(o,n,s))continue;{t||(t=[],e=[]),t.push(o);let i=this.tokens.mainToken;e.push(i.value,i.end)}}break}}if(i)return this.startNested(i),null;if(!n.length){let e=t&&function(t){let e=null;for(let i of t)i.pos==i.p.input.length&&i.p.parser.stateFlag(i.state,2)&&(!e||e.score<i.score)&&(e=i);return e}(t);if(e)return this.stackToTree(e);if(this.parser.strict)throw D&&t&&console.log("Stuck with token "+this.parser.getName(this.tokens.mainToken.value)),new SyntaxError("No parse at "+r);this.recovering||(this.recovering=5)}if(this.recovering&&t){let i=this.runRecovery(t,e,n);if(i)return this.stackToTree(i.forceAll())}if(this.recovering){let t=1==this.recovering?1:3*this.recovering;if(n.length>t)for(n.sort(((t,e)=>e.score-t.score));n.length>t;)n.pop();n.some((t=>t.reducePos>r))&&this.recovering--}else if(n.length>1)t:for(let t=0;t<n.length-1;t++){let e=n[t];for(let i=t+1;i<n.length;i++){let s=n[i];if(e.sameState(s)||e.buffer.length>200&&s.buffer.length>200){if(!((e.score-s.score||e.buffer.length-s.buffer.length)>0)){n.splice(t--,1);continue t}n.splice(i--,1)}}}this.pos=n[0].pos;for(let t=1;t<n.length;t++)n[t].pos<this.pos&&(this.pos=n[t].pos);return null}advanceStack(t,e,i){let s=t.pos,{input:r,parser:n}=this,a=D?this.stackID(t)+" -> ":"";if(this.fragments){let e=t.curContext&&t.curContext.tracker.strict,i=e?t.curContext.hash:0;for(let r=this.fragments.nodeAt(s);r;){let s=this.parser.nodeSet.types[r.type.id]==r.type?n.getGoto(t.state,r.type.id):-1;if(s>-1&&r.length&&(!e||(r.contextHash||0)==i))return t.useNode(r,s),D&&console.log(a+this.stackID(t)+` (via reuse of ${n.getName(r.type.id)})`),!0;if(!(r instanceof p)||0==r.children.length||r.positions[0]>0)break;let h=r.children[0];if(!(h instanceof p))break;r=h}}let h=n.stateSlot(t.state,4);if(h>0)return t.reduce(h),D&&console.log(a+this.stackID(t)+` (via always-reduce ${n.getName(65535&h)})`),!0;let o=this.tokens.getActions(t,r);for(let r=0;r<o.length;){let h=o[r++],l=o[r++],u=o[r++],f=r==o.length||!i,c=f?t:t.split();if(c.apply(h,l,u),D&&console.log(a+this.stackID(c)+` (via ${0==(65536&h)?"shift":`reduce of ${n.getName(65535&h)}`} for ${n.getName(l)} @ ${s}${c==t?"":", split"})`),f)return!0;c.pos>s?e.push(c):i.push(c)}return!1}advanceFully(t,e){let i=t.pos;for(;;){let s=this.checkNest(t);if(s)return s;if(!this.advanceStack(t,null,null))return!1;if(t.pos>i)return B(t,e),!0}}runRecovery(t,e,i){let s,r=null,n=!1;for(let a=0;a<t.length;a++){let h=t[a],o=e[a<<1],l=e[1+(a<<1)],u=D?this.stackID(h)+" -> ":"";if(h.deadEnd){if(n)continue;n=!0,h.restart(),D&&console.log(u+this.stackID(h)+" (restarted)");let t=this.advanceFully(h,i);if(t){!0!==t&&(s=t);continue}}let f=h.split(),c=u;for(let t=0;f.forceReduce()&&t<10;t++){D&&console.log(c+this.stackID(f)+" (via force-reduce)");let t=this.advanceFully(f,i);if(t){!0!==t&&(s=t);break}D&&(c=this.stackID(f)+" -> ")}for(let t of h.recoverByInsert(o))D&&console.log(u+this.stackID(t)+" (via recover-insert)"),this.advanceFully(t,i);this.input.length>h.pos?(l==h.pos&&(l++,o=0),h.recoverByDelete(o,l),D&&console.log(u+this.stackID(h)+` (via recover-delete ${this.parser.getName(o)})`),B(h,i)):(!r||r.score<h.score)&&(r=h)}if(r)return r;if(s)for(let t of this.stacks)if(t.score>s.stack.score){s=void 0;break}return s&&this.startNested(s),null}forceFinish(){let t=this.stacks[0].split();return this.nested&&this.finishNested(t,this.nested.forceFinish()),this.stackToTree(t.forceAll())}stackToTree(t,e=t.pos){return this.parser.context&&t.emitContext(),p.build({buffer:N.create(t),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.startPos,length:e-this.startPos,minRepeatType:this.parser.minRepeatTerm})}checkNest(t){let e=this.parser.findNested(t.state);if(!e)return null;let i=e.value;return"function"==typeof i&&(i=i(this.input,t)),i?{stack:t,info:e,spec:i}:null}startNested(t){let{stack:e,info:i,spec:s}=t;this.stacks=[e],this.nestEnd=this.scanForNestEnd(e,i.end,s.filterEnd),this.nestWrap="number"==typeof s.wrapType?this.parser.nodeSet.types[s.wrapType]:s.wrapType||null,s.startParse?this.nested=s.startParse(this.input.clip(this.nestEnd),e.pos,this.context):this.finishNested(e)}scanForNestEnd(t,e,i){for(let s=t.pos;s<this.input.length;s++)if(I.start=s,I.value=-1,e.token(this.input,I,t),I.value>-1&&(!i||i(this.input.read(s,I.end))))return s;return this.input.length}finishNested(t,e){this.nestWrap?e=new p(this.nestWrap,e?[e]:[],e?[0]:[],this.nestEnd-t.pos):e||(e=new p(c.none,[],[],this.nestEnd-t.pos));let i=this.parser.findNested(t.state);t.useNode(e,this.parser.getGoto(t.state,i.placeholder,!0)),D&&console.log(this.stackID(t)+" (via unnest)")}stackID(t){let e=(q||(q=new WeakMap)).get(t);return e||q.set(t,e=String.fromCodePoint(this.nextStackID++)),e+t}}function B(t,e){for(let i=0;i<e.length;i++){let s=e[i];if(s.pos==t.pos&&s.sameState(t))return void(e[i].score<t.score&&(e[i]=t))}e.push(t)}class j{constructor(t,e,i){this.source=t,this.flags=e,this.disabled=i}allows(t){return!this.disabled||0==this.disabled[t]}}class F{constructor(t){if(this.bufferLength=h,this.strict=!1,this.cachedDialect=null,13!=t.version)throw new RangeError(`Parser version (${t.version}) doesn't match runtime version (13)`);let e=A(t.tokenData),i=t.nodeNames.split(" ");this.minRepeatTerm=i.length,this.context=t.context;for(let e=0;e<t.repeatNodeCount;e++)i.push("");let s=[];for(let t=0;t<i.length;t++)s.push([]);function r(t,e,i){s[t].push([e,e.deserialize(String(i))])}if(t.nodeProps)for(let e of t.nodeProps){let t=e[0];for(let i=1;i<e.length;){let s=e[i++];if(s>=0)r(s,t,e[i++]);else{let n=e[i+-s];for(let a=-s;a>0;a--)r(e[i++],t,n);i++}}}if(this.specialized=new Uint16Array(t.specialized?t.specialized.length:0),this.specializers=[],t.specialized)for(let e=0;e<t.specialized.length;e++)this.specialized[e]=t.specialized[e].term,this.specializers[e]=t.specialized[e].get;this.states=A(t.states,Uint32Array),this.data=A(t.stateData),this.goto=A(t.goto);let n=Object.keys(t.topRules).map((e=>t.topRules[e][1]));this.nodeSet=new O(i.map(((e,i)=>c.define({name:i>=this.minRepeatTerm?void 0:e,id:i,props:s[i],top:n.indexOf(i)>-1,error:0==i,skipped:t.skippedNodes&&t.skippedNodes.indexOf(i)>-1})))),this.maxTerm=t.maxTerm,this.tokenizers=t.tokenizers.map((t=>"number"==typeof t?new L(e,t):t)),this.topRules=t.topRules,this.nested=(t.nested||[]).map((([t,e,i,s])=>({name:t,value:e,end:new L(A(i),0),placeholder:s}))),this.dialects=t.dialects||{},this.dynamicPrecedences=t.dynamicPrecedences||null,this.tokenPrecTable=t.tokenPrec,this.termNames=t.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}parse(t,e=0,i={}){"string"==typeof t&&(t=X(t));let s=new V(this,t,e,i);for(;;){let t=s.advance();if(t)return t}}startParse(t,e=0,i={}){return"string"==typeof t&&(t=X(t)),new V(this,t,e,i)}getGoto(t,e,i=!1){let s=this.goto;if(e>=s[0])return-1;for(let r=s[e+1];;){let e=s[r++],n=1&e,a=s[r++];if(n&&i)return a;for(let i=r+(e>>1);r<i;r++)if(s[r]==t)return a;if(n)return-1}}hasAction(t,e){let i=this.data;for(let s=0;s<2;s++)for(let r,n=this.stateSlot(t,s?2:1);;n+=3){if(65535==(r=i[n])){if(1!=i[n+1]){if(2==i[n+1])return G(i,n+2);break}r=i[n=G(i,n+2)]}if(r==e||0==r)return G(i,n+1)}return 0}stateSlot(t,e){return this.states[6*t+e]}stateFlag(t,e){return(this.stateSlot(t,0)&e)>0}findNested(t){let e=this.stateSlot(t,0);return 4&e?this.nested[e>>10]:null}validAction(t,e){if(e==this.stateSlot(t,4))return!0;for(let i=this.stateSlot(t,1);;i+=3){if(65535==this.data[i]){if(1!=this.data[i+1])return!1;i=G(this.data,i+2)}if(e==G(this.data,i+1))return!0}}nextStates(t){let e=[];for(let i=this.stateSlot(t,1);;i+=3){if(65535==this.data[i]){if(1!=this.data[i+1])break;i=G(this.data,i+2)}if(0==(1&this.data[i+2])){let t=this.data[i+1];e.some(((e,i)=>1&i&&e==t))||e.push(this.data[i],t)}}return e}overrides(t,e){let i=Z(this.data,this.tokenPrecTable,e);return i<0||Z(this.data,this.tokenPrecTable,t)<i}configure(t){let e=Object.assign(Object.create(F.prototype),this);if(t.props&&(e.nodeSet=this.nodeSet.extend(...t.props)),t.top){let i=this.topRules[t.top];if(!i)throw new RangeError(`Invalid top rule name ${t.top}`);e.top=i}return t.tokenizers&&(e.tokenizers=this.tokenizers.map((e=>{let i=t.tokenizers.find((t=>t.from==e));return i?i.to:e}))),t.dialect&&(e.dialect=this.parseDialect(t.dialect)),t.nested&&(e.nested=this.nested.map((e=>Object.prototype.hasOwnProperty.call(t.nested,e.name)?{name:e.name,value:t.nested[e.name],end:e.end,placeholder:e.placeholder}:e))),null!=t.strict&&(e.strict=t.strict),null!=t.bufferLength&&(e.bufferLength=t.bufferLength),e}getName(t){return this.termNames?this.termNames[t]:String(t<=this.maxNode&&this.nodeSet.types[t].name||t)}get eofTerm(){return this.maxNode+1}get hasNested(){return this.nested.length>0}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(t){let e=this.dynamicPrecedences;return null==e?0:e[t]||0}parseDialect(t){if(this.cachedDialect&&this.cachedDialect.source==t)return this.cachedDialect;let e=Object.keys(this.dialects),i=e.map((()=>!1));if(t)for(let s of t.split(" ")){let t=e.indexOf(s);t>=0&&(i[t]=!0)}let s=null;for(let t=0;t<e.length;t++)if(!i[t])for(let i,r=this.dialects[e[t]];65535!=(i=this.data[r++]);)(s||(s=new Uint8Array(this.maxTerm+1)))[i]=1;return this.cachedDialect=new j(t,i,s)}static deserialize(t){return new F(t)}}function G(t,e){return t[e]|t[e+1]<<16}function Z(t,e,i){for(let s,r=e;65535!=(s=t[r]);r++)if(s==i)return r-e;return-1}const K={inf:130,nan:131,bool:1,ignoring:2,on:3,group_left:4,group_right:5,offset:6},H={avg:7,bottomk:8,count:9,count_values:10,group:11,max:12,min:13,quantile:14,stddev:15,stdvar:16,sum:17,topk:18,by:19,without:20,and:21,or:22,unless:23,start:24,end:25},J={__proto__:null,absent_over_time:275,absent:277,abs:279,avg_over_time:281,ceil:283,changes:285,clamp:287,clamp_max:289,clamp_min:291,count_over_time:293,days_in_month:295,day_of_month:297,day_of_week:299,delta:301,deriv:303,exp:305,floor:307,histogram_quantile:309,holt_winters:311,hour:313,idelta:315,increase:317,irate:319,label_replace:321,label_join:323,last_over_time:325,ln:327,log10:329,log2:331,max_over_time:333,min_over_time:335,minute:337,month:339,predict_linear:341,present_over_time:343,quantile_over_time:345,rate:347,resets:349,round:351,scalar:353,sgn:355,sort:357,sort_desc:359,sqrt:361,stddev_over_time:363,stdvar_over_time:365,sum_over_time:367,timestamp:369,time:371,vector:373,year:375},tt=F.deserialize({version:13,states:"4^OYQPOOO%|QPOOOOQO'#Cz'#CzO&RQPO'#CyQ&^QQOOOOQO'#Dd'#DdO&XQPO'#DcOOQO'#Em'#EmO'hQPO'#EsOYQPO'#EoOYQPO'#ErOOQO'#Eu'#EuO,eQSO'#EvO,mQQO'#EtOOQO'#Et'#EtOOQO'#Cx'#CxOOQO'#De'#DeOOQO'#Dg'#DgOOQO'#Dh'#DhOOQO'#Di'#DiOOQO'#Dj'#DjOOQO'#Dk'#DkOOQO'#Dl'#DlOOQO'#Dm'#DmOOQO'#Dn'#DnOOQO'#Do'#DoOOQO'#Dp'#DpOOQO'#Dq'#DqOOQO'#Dr'#DrOOQO'#Ds'#DsOOQO'#Dt'#DtOOQO'#Du'#DuOOQO'#Dv'#DvOOQO'#Dw'#DwOOQO'#Dx'#DxOOQO'#Dy'#DyOOQO'#Dz'#DzOOQO'#D{'#D{OOQO'#D|'#D|OOQO'#D}'#D}OOQO'#EO'#EOOOQO'#EP'#EPOOQO'#EQ'#EQOOQO'#ER'#EROOQO'#ES'#ESOOQO'#ET'#ETOOQO'#EU'#EUOOQO'#EV'#EVOOQO'#EW'#EWOOQO'#EX'#EXOOQO'#EY'#EYOOQO'#EZ'#EZOOQO'#E['#E[OOQO'#E]'#E]OOQO'#E^'#E^OOQO'#E_'#E_OOQO'#E`'#E`OOQO'#Ea'#EaOOQO'#Eb'#EbOOQO'#Ec'#EcOOQO'#Ed'#EdOOQO'#Ee'#EeOOQO'#Ef'#EfOOQO'#Eg'#EgOOQO'#Eh'#EhOOQO'#Ei'#EiOOQO'#Ej'#EjQOQPOOO.TQPO'#C{O.YQPO'#DQO&XQPO,59eO.aQQO,59eO/zQPO,59nO/zQPO,59nO/zQPO,59nO/zQPO,59nO/zQPO,59nO4wQQO,5;VO4|QQO,5;YO5UQPO,5;iOOQO,59},59}OOQO,5;X,5;XO5mQQO,5;ZO5tQQO,5;^O7XQPO'#ExO7gQPO,5;bOOQO'#Ew'#EwOOQO,5;b,5;bOOQO,5;`,5;`O7oQSO'#C|OOQO,59g,59gO7wQPO,59lO8PQQO'#DROOQO,59l,59lOOQO1G/P1G/PO.TQPO'#DVO<}QPO'#DUO=XQPO'#DUOYQPO1G/YOYQPO1G/YOYQPO1G/YOYQPO1G/YOYQPO1G/YO=cQSO1G0qOOQO1G0t1G0tO=kQQO1G0tO=pQPO'#EmOOQO'#FP'#FPOOQO1G1T1G1TO={QPO1G1TOOQO1G0u1G0uOOQO'#Ey'#EyO>QQPO,5;dO>VQSO1G0|OOQO1G0|1G0|OOQO'#DO'#DOO>_QPO,59hOOQO'#C}'#C}OOQO,59h,59hOYQPO,59mOOQO1G/W1G/WOOQO,59q,59qOCWQPO,59pOC_QPO,59pODvQQO7+$tOETQQO7+$tOFcQQO7+$tOFyQQO7+$tOH_QQO7+$tOOQO7+&]7+&]OHxQQO7+&cOOQO7+&`7+&`OIQQPO7+&oOOQO1G1O1G1OOOQO1G0}1G0}OOQO7+&h7+&hOIVQSO1G/SOOQO1G/S1G/SOI_QQO1G/XOOQO1G/[1G/[OIiQPO1G/[OOQO<<I}<<I}ON]QPO<<I}OOQO<<JZ<<JZOOQO1G/T1G/TOOQO7+$n7+$nOOQO7+$v7+$vOOQOAN?iAN?i",stateData:"Nb~O#yOSjOS~OVQOWQOXQOYQOZQO[QO]QO^QO_QO`QOaQObQO!YZO#d_O#vVO#wVO#zXO#}`O$OaO$PbO$QcO$RdO$SeO$TfO$UgO$VhO$WiO$XjO$YkO$ZlO$[mO$]nO$^oO$_pO$`qO$arO$bsO$ctO$duO$evO$fwO$gxO$hyO$izO$j{O$k|O$l}O$m!OO$n!PO$o!QO$p!RO$q!SO$r!TO$s!UO$t!VO$u!WO$v!XO$w!YO$x!ZO$y![O$z!]O${!^O$|!_O$}!`O%O!aO%P!bO%Q!cO%R!dO%UWO%VWO%WVO%Y[O~O!YZO~Oc!fOd!fO#z!gO~OU!pOe!mOf!nOg!mOw!jOz!jO{!jO|!jO}!kO!O!kO!P!lO!Q!lO!R!lO!S!lO!T!lO!U!lO#r!qO%S!oO~O#v!sO#w!sO%W!sOV#gXW#gXX#gXY#gXZ#gX[#gX]#gX^#gX_#gX`#gXa#gXb#gX!Y#gX#d#gX#v#gX#w#gX#z#gX#}#gX$O#gX$P#gX$Q#gX$R#gX$S#gX$T#gX$U#gX$V#gX$W#gX$X#gX$Y#gX$Z#gX$[#gX$]#gX$^#gX$_#gX$`#gX$a#gX$b#gX$c#gX$d#gX$e#gX$f#gX$g#gX$h#gX$i#gX$j#gX$k#gX$l#gX$m#gX$n#gX$o#gX$p#gX$q#gX$r#gX$s#gX$t#gX$u#gX$v#gX$w#gX$x#gX$y#gX$z#gX${#gX$|#gX$}#gX%O#gX%P#gX%Q#gX%R#gX%U#gX%V#gX%W#gX%Y#gX~Os!vO%Z!yO~O%Y[OU#hXe#hXf#hXg#hXw#hXz#hX{#hX|#hX}#hX!O#hX!P#hX!Q#hX!R#hX!S#hX!T#hX!U#hX#r#hX#u#hX%S#hX#|#hX#{#hX~O#z!{O~O#|#PO~PYOc!fOd!fOUmaemafmagmawmazma{ma|ma}ma!Oma!Pma!Qma!Rma!Sma!Tma!Uma#rma#uma%Sma#|ma#{ma~OP#TOQ#ROR#ROVxPWxPXxPYxPZxP[xP]xP^xP_xP`xPaxPbxP!YxP#dxP#vxP#wxP#zxP#}xP$OxP$PxP$QxP$RxP$SxP$TxP$UxP$VxP$WxP$XxP$YxP$ZxP$[xP$]xP$^xP$_xP$`xP$axP$bxP$cxP$dxP$exP$fxP$gxP$hxP$ixP$jxP$kxP$lxP$mxP$nxP$oxP$pxP$qxP$rxP$sxP$txP$uxP$vxP$wxP$xxP$yxP$zxP${xP$|xP$}xP%OxP%PxP%QxP%RxP%UxP%VxP%WxP%YxP~O#`#ZO~O!O#]O#`#[O~Oh#_Oi#_O#vVO#wVO%U#^O%V#^O%WVO~O#|#bO~P&^Ow!jOU#fae#faf#fag#faz#fa{#fa|#fa}#fa!O#fa!P#fa!Q#fa!R#fa!S#fa!T#fa!U#fa#r#fa#u#fa%S#fa#|#fa#{#fa~O!U#cO#n#cO#o#cO#p#cO~O#{#eO%Z#fO~Os#gO#|#jO~O#{#kO#|#lO~O#{uX#|uX~P&^OVxXWxXXxXYxXZxX[xX]xX^xX_xX`xXaxXbxX!YxX#dxX#vxX#wxX#zxX#}xX$OxX$PxX$QxX$RxX$SxX$TxX$UxX$VxX$WxX$XxX$YxX$ZxX$[xX$]xX$^xX$_xX$`xX$axX$bxX$cxX$dxX$exX$fxX$gxX$hxX$ixX$jxX$kxX$lxX$mxX$nxX$oxX$pxX$qxX$rxX$sxX$txX$uxX$vxX$wxX$xxX$yxX$zxX${xX$|xX$}xX%OxX%PxX%QxX%RxX%UxX%VxX%WxX%YxX~OS#nOT#nO~P8ZOQ#ROR#RO~P8ZO%T#uO%X#vO~O#`#wO~O#v!sO#w!sO%W!sO~O#z#xO~O#d#yO~Os!vO%Z#{O~O#{#|O#|#}O~OVxaWxaXxaYxaZxa[xa]xa^xa_xa`xaaxabxa!Yxa#dxa#vxa#wxa#}xa$Oxa$Pxa$Qxa$Rxa$Sxa$Txa$Uxa$Vxa$Wxa$Xxa$Yxa$Zxa$[xa$]xa$^xa$_xa$`xa$axa$bxa$cxa$dxa$exa$fxa$gxa$hxa$ixa$jxa$kxa$lxa$mxa$nxa$oxa$pxa$qxa$rxa$sxa$txa$uxa$vxa$wxa$xxa$yxa$zxa${xa$|xa$}xa%Oxa%Pxa%Qxa%Rxa%Uxa%Vxa%Wxa%Yxa~O#z!{O~P>gOS$QOT$QO#zxa~P>gOw!jOUvqevqfvqgvq}vq!Ovq!Pvq!Qvq!Rvq!Svq!Tvq!Uvq#rvq#uvq%Svq#|vq#{vq~Ozvq{vq|vq~PClOz!jO{!jO|!jO~PClOw!jOz!jO{!jO|!jO}!kO!O!kOUvqevqfvqgvq#rvq#uvq%Svq#|vq#{vq~O!Pvq!Qvq!Rvq!Svq!Tvq!Uvq~PEbO!P!lO!Q!lO!R!lO!S!lO!T!lO!U!lO~PEbOe!mOg!mOw!jOz!jO{!jO|!jO}!kO!O!kO!P!lO!Q!lO!R!lO!S!lO!T!lO!U!lO~OUvqfvq#rvq#uvq%Svq#|vq#{vq~PGaO#`$SO%T$RO~O#|$TO~Os#gO#|$VO~O#{ui#|ui~P&^O#z!{OVxiWxiXxiYxiZxi[xi]xi^xi_xi`xiaxibxi!Yxi#dxi#vxi#wxi#}xi$Oxi$Pxi$Qxi$Rxi$Sxi$Txi$Uxi$Vxi$Wxi$Xxi$Yxi$Zxi$[xi$]xi$^xi$_xi$`xi$axi$bxi$cxi$dxi$exi$fxi$gxi$hxi$ixi$jxi$kxi$lxi$mxi$nxi$oxi$pxi$qxi$rxi$sxi$txi$uxi$vxi$wxi$xxi$yxi$zxi${xi$|xi$}xi%Oxi%Pxi%Qxi%Rxi%Uxi%Vxi%Wxi%Yxi~O%T$XO~O",goto:"(e#tPPPPPPPPPPPPPPPPPPPPPPPPPPPP#u$e$q$}%T%a%dP%j%s$eP%v&VPPPPPPPPPPP$e&a&mP&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m$eP&y$e$eP$e$e'Y$e'f'u(U(X(_PPP$eP(bQSOQ!tXQ!uYQ#O!gQ#p#UQ#q#VQ#r#WQ#s#XQ#t#YR$O#ke_OXY!g#U#V#W#X#Y#keROXY!g#U#V#W#X#Y#kQ!hRR#Q!iQ!|!fQ#m#RQ$P#nR$W$QR#h!{Q#i!{R$U#|Q!iRQ!rUR#Q!hR!}!gQ#U!jQ#V!kQ#W!lQ#X!mR#Y!nY#S!j!k!l!m!nR#o#TeUOXY!g#U#V#W#X#Y#keTOXY!g#U#V#W#X#Y#kd_OXY!g#U#V#W#X#Y#kR#`!qeYOXY!g#U#V#W#X#Y#kd]OXY!g#U#V#W#X#Y#kR!ePd^OXY!g#U#V#W#X#Y#kR!z]R!w[Q!x[R#z#eR#d!vR#a!q",nodeNames:"⚠ Bool Ignoring On GroupLeft GroupRight Offset Avg Bottomk Count CountValues Group Max Min Quantile Stddev Stdvar Sum Topk By Without And Or Unless Start End LineComment PromQL Expr AggregateExpr AggregateOp AggregateModifier GroupingLabels GroupingLabelList GroupingLabel LabelName FunctionCallBody FunctionCallArgs BinaryExpr Pow BinModifiers OnOrIgnoring Mul Div Mod Add Sub Eql Gte Gtr Lte Lss Neq FunctionCall FunctionIdentifier AbsentOverTime Identifier Absent Abs AvgOverTime Ceil Changes Clamp ClampMax ClampMin CountOverTime DaysInMonth DayOfMonth DayOfWeek Delta Deriv Exp Floor HistogramQuantile HoltWinters Hour Idelta Increase Irate LabelReplace LabelJoin LastOverTime Ln Log10 Log2 MaxOverTime MinOverTime Minute Month PredictLinear PresentOverTime QuantileOverTime Rate Resets Round Scalar Sgn Sort SortDesc Sqrt StddevOverTime StdvarOverTime SumOverTime Timestamp Time Vector Year MatrixSelector Duration NumberLiteral OffsetExpr ParenExpr StringLiteral SubqueryExpr UnaryExpr UnaryOp VectorSelector MetricIdentifier LabelMatchers LabelMatchList LabelMatcher MatchOp EqlSingle EqlRegex NeqRegex StepInvariantExpr At AtModifierPreprocessors MetricName",maxTerm:195,skippedNodes:[0,26],repeatNodeCount:0,tokenData:"! j~RwX^#lpq#lqr$ars$tst%huv%swx%xxy&gyz&lz{&q{|&v|}&}}!O'S!O!P'Z!P!Q(Z!Q!R(`!R![)f![!]LZ!^!_MV!_!`Md!`!aMy!b!cNW!c!}N]!}#ONs#P#QNx#Q#RN}#R#SN]#S#T! S#T#oN]#o#p! `#q#r! e#y#z#l$f$g#l#BY#BZ#l$IS$I_#l$I|$JO#l$JT$JU#l$KV$KW#l&FU&FV#l~#qY#y~X^#lpq#l#y#z#l$f$g#l#BY#BZ#l$IS$I_#l$I|$JO#l$JT$JU#l$KV$KW#l&FU&FV#l~$dQ!_!`$j#r#s$o~$oO!U~~$tO#p~~$yU#d~OY$tZr$trs%]s#O$t#O#P%b#P~$t~%bO#d~~%ePO~$t~%mQj~OY%hZ~%h~%xO|~~%}U#d~OY%xZw%xwx%]x#O%x#O#P&a#P~%x~&dPO~%x~&lO#z~~&qO#|~~&vOz~R&}O%VP}Q~'SO#{~R'ZO%UP!OQP'^P!Q!['aP'fR%WP!Q!['a!g!h'o#X#Y'oP'rR{|'{}!O'{!Q![(RP(OP!Q![(RP(WP%WP!Q![(R~(`O{~R(eZ%WP!O!P)W!Q![)f!g!h'o#W#X*Z#X#Y'o#[#].i#a#b0l#g#h1r#k#l2Z#l#mKo#m#n:pP)]R%WP!Q![)W!g!h'o#X#Y'oR)kY%WP!O!P)W!Q![)f!g!h'o#W#X*Z#X#Y'o#[#].i#a#b0l#g#h1r#k#l2Z#m#n:pQ*`P#`Q!Q![*cQ*fS!Q![*c#[#]*r#a#b,z#g#h.QQ*wP#`Q!Q![*zQ*}R!Q![*z#a#b+W#g#h,cQ+]Q#`Q!Q![+c#g#h+uQ+fR!Q![+c#a#b+o#g#h+zQ+rP#g#h+uQ+zO#`QQ,PP#`Q!Q![,SQ,VQ!Q![,S#a#b,]Q,`P#g#h+uQ,hP#`Q!Q![,kQ,nQ!Q![,k#a#b,tQ,wP#g#h+uQ-PQ#`Q!Q![-V#g#h+uQ-YR!Q![-V#a#b-c#g#h-iQ-fP#g#h+uQ-nP#`Q!Q![-qQ-tQ!Q![-q#a#b-zQ-}P#g#h+uQ.VP#`Q!Q![.YQ.]Q!Q![.Y#a#b.cQ.fP#g#h+uQ.nP#`Q!Q![.qQ.tR!Q![.q#a#b.}#g#h0TQ/SQ#`Q!Q![/Y#g#h+uQ/]R!Q![/Y#a#b/f#g#h/lQ/iP#g#h+uQ/qP#`Q!Q![/tQ/wQ!Q![/t#a#b/}Q0QP#g#h+uQ0YP#`Q!Q![0]Q0`Q!Q![0]#a#b0fQ0iP#g#h+uQ0qQ#`Q!Q![0w#g#h+uQ0zR!Q![0w#a#b1T#g#h1ZQ1WP#g#h+uQ1`P#`Q!Q![1cQ1fQ!Q![1c#a#b1lQ1oP#g#h+uQ1wP#`Q!Q![1zQ1}Q!Q![1z#a#b2TQ2WP#g#h+uQ2`P#`Q!Q![2cQ2fT!Q![2c#W#X2u#[#]7O#a#b9R#g#h:XQ2zP#`Q!Q![2}Q3QS!Q![2}#[#]3^#a#b5a#g#h6gQ3cP#`Q!Q![3fQ3iR!Q![3f#a#b3r#g#h4xQ3wQ#`Q!Q![3}#g#h+uQ4QR!Q![3}#a#b4Z#g#h4aQ4^P#g#h+uQ4fP#`Q!Q![4iQ4lQ!Q![4i#a#b4rQ4uP#g#h+uQ4}P#`Q!Q![5QQ5TQ!Q![5Q#a#b5ZQ5^P#g#h+uQ5fQ#`Q!Q![5l#g#h+uQ5oR!Q![5l#a#b5x#g#h6OQ5{P#g#h+uQ6TP#`Q!Q![6WQ6ZQ!Q![6W#a#b6aQ6dP#g#h+uQ6lP#`Q!Q![6oQ6rQ!Q![6o#a#b6xQ6{P#g#h+uQ7TP#`Q!Q![7WQ7ZR!Q![7W#a#b7d#g#h8jQ7iQ#`Q!Q![7o#g#h+uQ7rR!Q![7o#a#b7{#g#h8RQ8OP#g#h+uQ8WP#`Q!Q![8ZQ8^Q!Q![8Z#a#b8dQ8gP#g#h+uQ8oP#`Q!Q![8rQ8uQ!Q![8r#a#b8{Q9OP#g#h+uQ9WQ#`Q!Q![9^#g#h+uQ9aR!Q![9^#a#b9j#g#h9pQ9mP#g#h+uQ9uP#`Q!Q![9xQ9{Q!Q![9x#a#b:RQ:UP#g#h+uQ:^P#`Q!Q![:aQ:dQ!Q![:a#a#b:jQ:mP#g#h+uQ:uP#`Q!Q![:xQ:{U!Q![:x#W#X;_#[#]?h#a#bAk#g#hBq#k#lCYQ;dP#`Q!Q![;gQ;jS!Q![;g#[#];v#a#b=y#g#h?PQ;{P#`Q!Q![<OQ<RR!Q![<O#a#b<[#g#h=bQ<aQ#`Q!Q![<g#g#h+uQ<jR!Q![<g#a#b<s#g#h<yQ<vP#g#h+uQ=OP#`Q!Q![=RQ=UQ!Q![=R#a#b=[Q=_P#g#h+uQ=gP#`Q!Q![=jQ=mQ!Q![=j#a#b=sQ=vP#g#h+uQ>OQ#`Q!Q![>U#g#h+uQ>XR!Q![>U#a#b>b#g#h>hQ>eP#g#h+uQ>mP#`Q!Q![>pQ>sQ!Q![>p#a#b>yQ>|P#g#h+uQ?UP#`Q!Q![?XQ?[Q!Q![?X#a#b?bQ?eP#g#h+uQ?mP#`Q!Q![?pQ?sR!Q![?p#a#b?|#g#hASQ@RQ#`Q!Q![@X#g#h+uQ@[R!Q![@X#a#b@e#g#h@kQ@hP#g#h+uQ@pP#`Q!Q![@sQ@vQ!Q![@s#a#b@|QAPP#g#h+uQAXP#`Q!Q![A[QA_Q!Q![A[#a#bAeQAhP#g#h+uQApQ#`Q!Q![Av#g#h+uQAyR!Q![Av#a#bBS#g#hBYQBVP#g#h+uQB_P#`Q!Q![BbQBeQ!Q![Bb#a#bBkQBnP#g#h+uQBvP#`Q!Q![ByQB|Q!Q![By#a#bCSQCVP#g#h+uQC_P#`Q!Q![CbQCeT!Q![Cb#W#XCt#[#]G}#a#bJQ#g#hKWQCyP#`Q!Q![C|QDPS!Q![C|#[#]D]#a#bF`#g#hGfQDbP#`Q!Q![DeQDhR!Q![De#a#bDq#g#hEwQDvQ#`Q!Q![D|#g#h+uQEPR!Q![D|#a#bEY#g#hE`QE]P#g#h+uQEeP#`Q!Q![EhQEkQ!Q![Eh#a#bEqQEtP#g#h+uQE|P#`Q!Q![FPQFSQ!Q![FP#a#bFYQF]P#g#h+uQFeQ#`Q!Q![Fk#g#h+uQFnR!Q![Fk#a#bFw#g#hF}QFzP#g#h+uQGSP#`Q!Q![GVQGYQ!Q![GV#a#bG`QGcP#g#h+uQGkP#`Q!Q![GnQGqQ!Q![Gn#a#bGwQGzP#g#h+uQHSP#`Q!Q![HVQHYR!Q![HV#a#bHc#g#hIiQHhQ#`Q!Q![Hn#g#h+uQHqR!Q![Hn#a#bHz#g#hIQQH}P#g#h+uQIVP#`Q!Q![IYQI]Q!Q![IY#a#bIcQIfP#g#h+uQInP#`Q!Q![IqQItQ!Q![Iq#a#bIzQI}P#g#h+uQJVQ#`Q!Q![J]#g#h+uQJ`R!Q![J]#a#bJi#g#hJoQJlP#g#h+uQJtP#`Q!Q![JwQJzQ!Q![Jw#a#bKQQKTP#g#h+uQK]P#`Q!Q![K`QKcQ!Q![K`#a#bKiQKlP#g#h+uPKrR!Q![K{!c!iK{#T#ZK{PLQR%WP!Q![K{!c!iK{#T#ZK{VLbT%XS!YR!Q![Lq![!]Lq!c!}Lq#R#SLq#T#oLqRLvT!YR!Q![Lq![!]Lq!c!}Lq#R#SLq#T#oLq~M[P!T~!_!`M_~MdO!S~~MiQ#nP!_!`Mo#r#sMtQMtO!PQ~MyO#o~~NOP!R~!_!`NR~NWO!Q~~N]O#r~VNdT!YRsS!Q![N]![!]Lq!c!}N]#R#SN]#T#oN]~NxO%S~~N}O%T~~! SOw~~! VRO#S! S#S#T%]#T~! S~! eO%Y~~! jO%Z~",tokenizers:[0,1,2],topRules:{PromQL:[0,27],MetricName:[1,128]},specialized:[{term:56,get:(t,e)=>((t,e)=>K[t.toLowerCase()]||-1)(t)<<1},{term:56,get:(t,e)=>((t,e)=>H[t.toLowerCase()]||-1)(t)<<1|1},{term:56,get:t=>J[t]||-1}],tokenPrec:0});class et extends Error{constructor(t){super("should never happen")}}function it(t,e){switch(e){case"parent":return t.parent;case"firstChild":return t.firstChild;case"lastChild":return t.lastChild;default:throw new et(e)}}function st(t,e){let i=t;for(const[t,s]of e){if(i=it(i,t),null===i)return null;if(i.type.name!==s)return null}return i}function rt(t,e){return e.slice(t.from,t.to)}function nt(t,e){return t.every(((t,i)=>t===e[i]))}const at=[{path:["LabelMatchers","VectorSelector"],fun:function(t,e,i){const s=st(t,[["parent","VectorSelector"],["firstChild","MetricIdentifier"],["firstChild","Identifier"]]),r=ot(t,e);if(null===s)return{type:"LABEL_NAMES_FOR_SELECTOR",otherLabels:r};return{type:"LABEL_NAMES_FOR_SELECTOR",metricName:rt(s,e),otherLabels:r}}},{path:["PromQL"],fun:function(t,e,i){return{type:"FUNCTIONS_AND_ALL_METRIC_NAMES"}}},{path:["FunctionCallBody"],fun:function(t,e,i){return{type:"ALL_METRIC_NAMES"}}},{path:["⚠","LabelMatcher"],fun:function(t,e,i){const s=st(t,[["parent","LabelMatcher"]]);if(null===s)return null;const r=st(s,[["firstChild","LabelName"]]);if(null===r)return null;const n=rt(r,e),a=st(s,[["parent","LabelMatchList"]]);if(null===a)return null;let h=a,o=null;for(;null===o;){const t=h.parent;if(null===t)return null;const{name:e}=t.type;switch(e){case"LabelMatchList":h=t;continue;case"LabelMatchers":o=t;continue;default:return null}}const l=ot(o,e),u=st(o,[["parent","VectorSelector"],["firstChild","MetricIdentifier"],["firstChild","Identifier"]]);if(null===u)return{type:"LABEL_VALUES",labelName:n,otherLabels:l};return{type:"LABEL_VALUES",metricName:rt(u,e),labelName:n,otherLabels:l}}},{path:["⚠","MatrixSelector"],fun:function(t,e,i){return{type:"ALL_DURATIONS"}}},{path:["GroupingLabels"],fun:function(t,e,i){const s=st(t,[["parent","AggregateModifier"],["parent","AggregateExpr"]]);if(null===s)return null;const r=s.getChild("FunctionCallBody");if(null===r)return null;const n=lt(r,"MetricIdentifier");if(null===n)return null;const a=st(n,[["firstChild","Identifier"]]);if(null===a)return null;return{type:"LABEL_NAMES_FOR_BY",metricName:rt(a,e),otherLabels:[]}}}];function ht(t,e){if("LabelMatcher"!==t.type.name)return null;const i=st(t,[["firstChild","LabelName"]]);if(null===i)return null;const s=st(t,[["lastChild","StringLiteral"]]);if(null===s)return null;return{name:rt(i,e),value:function(t){if(t.startsWith('"')&&t.endsWith('"')){if(-1!==t.indexOf("\\"))throw new Error("FIXME: escape-sequences not supported in label-values");return t.slice(1,t.length-1)}throw new Error("FIXME: invalid string literal")}(rt(s,e))}}function ot(t,e){if("LabelMatchers"!==t.type.name)return[];let i=st(t,[["firstChild","LabelMatchList"]]);const s=[];for(;null!==i;){const t=st(i,[["lastChild","LabelMatcher"]]);if(null===t)return[];const r=ht(t,e);null!==r&&s.push(r),i=st(i,[["firstChild","LabelMatchList"]])}return s.reverse(),s}function lt(t,e){if(t.type.name===e)return t;const i=function(t){let e=t.firstChild;const i=[];for(;null!==e;)i.push(e),e=e.nextSibling;return i}(t);for(const t of i){const i=lt(t,e);if(null!==i)return i}return null}async function ut(t){return(await t.getAllMetricNames()).map((t=>({type:"METRIC_NAME",label:t.name,insertText:t.name,detail:`${t.name} : ${t.type}`,documentation:t.help})))}const ft=i("./public/app/plugins/datasource/prometheus/promql.ts").r8.map((t=>{var e;return{type:"FUNCTION",label:t.label,insertText:null!==(e=t.insertText)&&void 0!==e?e:"",detail:t.detail,documentation:t.documentation}})),ct=["$__interval","$__range","$__rate_interval","1m","5m","10m","30m","1h","1d"].map((t=>({type:"DURATION",label:t,insertText:t})));function Ot(t,e){const i=[...e];void 0!==t&&i.push({name:"__name__",value:t});return`{${i.map((t=>`${t.name}="${t.value}"`)).join(",")}}`}async function pt(t,e,i,s,r){const n=Ot(t,s),a=await r.getSeries(n),h=Object.keys(a),o=new Set(s.map((t=>t.name)));return h.filter((t=>!o.has(t))).map((t=>({type:"LABEL_NAME",label:t,insertText:`${t}${e}`,triggerOnInsert:i})))}async function dt(t,e){switch(t.type){case"ALL_DURATIONS":return ct;case"ALL_METRIC_NAMES":return ut(e);case"FUNCTIONS_AND_ALL_METRIC_NAMES":{const t=await ut(e);return[...ft,...t]}case"HISTORY_AND_FUNCTIONS_AND_ALL_METRIC_NAMES":{const t=await ut(e);return[...await async function(t){return(await t.getHistory()).slice(0,10).map((t=>({type:"HISTORY",label:t,insertText:t})))}(e),...ft,...t]}case"LABEL_NAMES_FOR_SELECTOR":return async function(t,e,i){return pt(t,"=",!0,e,i)}(t.metricName,t.otherLabels,e);case"LABEL_NAMES_FOR_BY":return async function(t,e,i){return pt(t,"",!1,e,i)}(t.metricName,t.otherLabels,e);case"LABEL_VALUES":return async function(t,e,i,s){var r;const n=Ot(t,i);return(null!==(r=(await s.getSeries(n))[e])&&void 0!==r?r:[]).map((t=>({type:"LABEL_VALUE",label:t,insertText:`"${t}"`})))}(t.metricName,t.labelName,t.otherLabels,e);default:throw new et(t)}}function Qt(t,e){switch(t){case"DURATION":return e.languages.CompletionItemKind.Unit;case"FUNCTION":return e.languages.CompletionItemKind.Variable;case"HISTORY":return e.languages.CompletionItemKind.Snippet;case"LABEL_NAME":return e.languages.CompletionItemKind.Enum;case"LABEL_VALUE":return e.languages.CompletionItemKind.EnumMember;case"METRIC_NAME":return e.languages.CompletionItemKind.Constructor;default:throw new et(t)}}function gt(t,e){return{triggerCharacters:["{",",","[","(","="],provideCompletionItems:(i,s)=>{const r=i.getWordAtPosition(s),n=null!=r?t.Range.lift({startLineNumber:s.lineNumber,endLineNumber:s.lineNumber,startColumn:r.startColumn,endColumn:r.endColumn}):t.Range.fromPositions(s),a={column:s.column,lineNumber:s.lineNumber},h=i.getOffsetAt(a),o=function(t,e){if(""===t)return{type:"HISTORY_AND_FUNCTIONS_AND_ALL_METRIC_NAMES"};const i=tt.parse(t),s=function(t,e){const i=t.cursor(e);for(;;){if(i.from===e&&i.to===e){const{node:t}=i;if(t.type.isError)return t}if(!i.next())break}return null}(i,e),r=null!=s?s.cursor:i.cursor(e),n=r.node,a=[r.name];for(;r.parent();)a.push(r.name);for(let i of at)if(nt(i.path,a))return i.fun(n,t,e);return null}(i.getValue(),h);return(null!=o?dt(o,e):Promise.resolve([])).then((e=>{const i=e.length.toString().length;return{suggestions:e.map(((e,s)=>({kind:Qt(e.type,t),label:e.label,insertText:e.insertText,detail:e.detail,documentation:e.documentation,sortText:s.toString().padStart(i,"0"),range:n,command:e.triggerOnInsert?{id:"editor.action.triggerSuggest",title:""}:void 0})))}}))}}}var xt=i("./node_modules/react/jsx-runtime.js");const mt={lineNumbers:"off",minimap:{enabled:!1},lineDecorationsWidth:0,wordWrap:"off",overviewRulerLanes:0,overviewRulerBorder:!1,folding:!1,scrollBeyondLastLine:!1,renderLineHighlight:"none",fontSize:14,suggestFontSize:12,fixedOverflowWidgets:!0},Pt=a.id;let bt=!1;function $t(t){if(!1===bt){bt=!0;const{aliases:e,extensions:i,mimetypes:s,loader:r}=a;t.languages.register({id:Pt,aliases:e,extensions:i,mimetypes:s}),r().then((e=>{t.languages.setMonarchTokensProvider(Pt,e.language),t.languages.setLanguageConfiguration(Pt,e.languageConfiguration)}))}}const vt=t=>{const e=(0,s.useRef)(null),{languageProvider:i,history:a,onChange:h,initialValue:o}=t,l=n(i),u=n(a),f=(0,s.useRef)(null);return(0,s.useEffect)((()=>()=>{var t;null===(t=f.current)||void 0===t||t.call(f)}),[]),(0,xt.jsx)("div",{ref:e,style:{marginBottom:"4px"},children:(0,xt.jsx)(r.CodeEditor,{onBlur:h,monacoOptions:mt,language:"promql",value:o,onBeforeEditorMount:$t,onEditorDidMount:(i,s)=>{const r=gt(s,{getSeries:t=>l.current.getSeries(t),getHistory:()=>Promise.resolve(u.current.map((t=>t.query.expr)).filter((t=>void 0!==t))),getAllMetricNames:()=>{const{metrics:t,metricsMetadata:e}=l.current,i=t.map((t=>{var i,s,r;const n=null==e||null===(i=e[t])||void 0===i?void 0:i[0];return{name:t,help:null!==(s=null==n?void 0:n.help)&&void 0!==s?s:"",type:null!==(r=null==n?void 0:n.type)&&void 0!==r?r:""}}));return Promise.resolve(i)}}),n=Object.assign({},r,{provideCompletionItems:(t,e,s,n)=>{var a;return(null===(a=i.getModel())||void 0===a?void 0:a.id)!==t.id?{suggestions:[]}:r.provideCompletionItems(t,e,s,n)}}),{dispose:a}=s.languages.registerCompletionItemProvider(Pt,n);f.current=a;const h=()=>{const t=e.current;if(null!==t){const e=i.getContentHeight();t.style.height=`${e}px`,t.style.width="100%";const s=t.clientWidth;i.layout({width:s,height:e})}};i.onDidContentSizeChange(h),h(),i.addCommand(s.KeyMod.Shift|s.KeyCode.Enter,(()=>{const e=i.getValue();t.onChange(e),t.onRunQuery()}))}})})}}}]);
//# sourceMappingURL=prom-query-field.0e7ce18a6cf0f8775a65.js.map