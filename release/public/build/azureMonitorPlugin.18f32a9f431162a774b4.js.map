{"version":3,"sources":["webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/time_grain_converter.ts","webpack:///./public/app/features/explore/slate-plugins/prism/index.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/editor/typeahead.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/editor/query_field.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/editor/kusto/kusto.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/editor/KustoQueryField.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/editor/editor_component.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/query_ctrl.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/azure_monitor/url_builder.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/azure_monitor/response_parser.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/azure_monitor/supported_namespaces.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/azure_monitor/azure_monitor_datasource.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/app_insights/response_parser.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/log_analytics/querystring_builder.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/app_insights/app_insights_datasource.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/azure_log_analytics/response_parser.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/datasource.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/azure_log_analytics/azure_log_analytics_datasource.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/AzureCredentialsForm.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/MonitorConfig.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/AnalyticsConfig.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/InsightsConfig.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/ConfigEditor.tsx","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/annotations_query_ctrl.ts","webpack:///./public/app/plugins/datasource/grafana-azure-monitor-datasource/module.tsx"],"names":["TimeGrainConverter","createISO8601Duration","timeGrain","timeGrainUnit","lodash_default","a","includes","toUpperCase","createISO8601DurationFromInterval","interval","slice","length","unit","indexOf","toMinutes","findClosestTimeGrain","allowedTimeGrains","timeGrains","filter","o","closest","intervalMs","kbn","interval_to_ms","i","createTimeGrainFromISO8601Duration","duration","offset","substring","value","timeUnitToText","text","createKbnUnitFromISO8601Duration","timeUnitToKbn","TOKEN_MARK","PrismPlugin","_a","definition","language","prism_default","languages","renderDecoration","props","editor","next","children","decoration","type","className","data","get","react_default","createElement","decorateNode","node","texts","getTexts","toArray","tstring","map","t","join","grammar","tokens","tokenize","decorations","startText","shift","endText","startOffset","endOffset","start","processToken","token","acc","types","alias","content","newlines","split","end","available","remaining","range","createDecoration","anchor","key","focus","push","_b","Object","tslib_es6","_c","done","tokens_1","tokens_1_1","typeahead_TypeaheadItem","_super","TypeaheadItem","_this","apply","this","arguments","getRef","el","prototype","componentDidUpdate","prevProps","isSelected","offsetParent","container","offsetTop","scrollTop","offsetHeight","scrollIntoView","render","hint","label","onClickItem","ref","onClick","PureComponent","typeahead_TypeaheadGroup","TypeaheadGroup","items","selected","item","display","typeahead","Typeahead","groupedItems","menuRef","selectedItems","g","flattenSuggestions","s","reduce","concat","getInitialValue","query","slate_es","create","document","lines","line","nodes","query_field_Portal","Portal","call","index","prefix","classList","add","body","appendChild","componentWillUnmount","removeChild","react_dom_default","createPortal","Component","query_field","QueryField","context","keybindingSrv","onChange","changed","state","setState","requestAnimationFrame","onTypeahead","onChangeQuery","request","url","fetch","onQueryChange","slate_plain_serializer_es","serialize","onKeyDown","event","typeaheadIndex","suggestions","keyboardEvent","menuEl","preventDefault","stopPropagation","resetTypeahead","ctrlKey","flattenedSuggestions","suggestion","Math","abs","applyTypeahead","max","change","callback","typeaheadPrefix","typeaheadContext","handleBlur","onBlur","resetTimer","setTimeout","restoreEscapeKeyBinding","handleFocus","onFocus","removeEscapeKeyBinding","updateMenu","menu","window","getSelection","anchorNode","parentElement","rect","getBoundingClientRect","scrollX","scrollY","screenHeight","innerHeight","menuLeft_1","left","menuTop_1","top","height","menuHeight_1","style","opacity","maxHeight","removeAttribute","renderMenu","portalPrefix","selectedIndex","selectedKeys","prismDefinition","prismLanguage","plugins","braces","clear","runner","handler","onPressEnter","newline","labelKeys","labelValues","initialQuery","componentDidMount","clearTimeout","unbind","setupGlobal","slate_react_es","autoCorrect","placeholder","spellCheck","operatorTokens","functionTokens","KEYWORDS","grafanaMacros","tokenizer","comment","pattern","lookbehind","greedy","function-context","inside","RegExp","builtin","f","string","keyword","boolean","number","operator","punctuation","variable","argument","kusto","TYPEAHEAD_DELAY","defaultSchema","Databases","Default","cleanText","replace","trim","wrapText","KustoQueryField","force","selection","wrapperNode","isBlurred","getRangeAt","textContent","prefix_1","substr","modelOffset","anchorOffset","modelPrefix","anchorText","suggestionGroups","wrapperClasses","contains","getColumnSuggestions","match","getFunctionSuggestions","getTableSuggestions","db","getDBFromDatabaseFunction","console","log","normalizeQuery","schema","fetchSchema","getInitialSuggestions","getKeywordSuggestions","str","exec","getLastWord","results_1","toLowerCase","filteredSuggestions","group","skipFilter","c","prefixMatch","typeaheadText","suggestionText","nextChar","src","getNextCharacter","backward","deleteBackwards","suffixLength","forward","deleteBackward","deleteForward","insertText","moveForward","debounce_default","Tables","Name","table","getTableFromContext","tableSchema","OrderedColumns","Type","normalizedQuery","getSchema","sent","defaultSchemaTemplate","castSchema","editor_component_Editor","Editor","edited","execute","variables","editor_KustoQueryField","templateVariables","defaultProps","react","core_module","directive","reactDirective","watchDepth","query_ctrl_AzureMonitorQueryCtrl","AzureMonitorQueryCtrl","$scope","$injector","templateSrv","defaultDropdownValue","defaults","queryType","resourceGroup","metricDefinition","resourceName","metricNamespace","metricName","dimensionFilter","aggOptions","resultFormat","datasource","azureLogAnalyticsDatasource","defaultOrFirstWorkspace","rawQuery","rawQueryString","dimension","timeColumn","valueColumn","getWorkspaces","target","subscription","then","list","workspaces","azureLogAnalytics","workspace","catch","handleQueryCtrlError","bind","getAzureLogAnalyticsSchema","onLogAnalyticsQueryChange","nextQuery","onLogAnalyticsQueryExecute","panelCtrl","refresh","onAppInsightsQueryChange","appInsights","onAppInsightsQueryExecute","getAppInsightsQuerySchema","appInsightsDatasource","getQuerySchema","defaultsDeep","migrateTimeGrains","migrateToFromTimes","migrateToDefaultNamespace","migrateApplicationInsightsKeys","events","on","dataReceived","onDataReceived","dataError","onDataError","resultFormats","getSubscriptions","$inject","dataList","lastQueryError","undefined","lastQuery","anySeriesFromQuery","find","refId","meta","err","error","innererror","message","azureMonitor","time_grain_converter","onMetricNameChange","timeGrainCount","allowedTimeGrainsMs","convertTimeGrainsToMs","mappings","xaxis","yaxis","spliton","groupBy","groupByOptions","old","panel","scopedVars","onQueryTypeChange","azureMonitorDatasource","isConfigured","subs","subscriptions","logAnalyticsSubscriptionId","subscriptionId","onSubscriptionChange","aggregation","dimensions","getResourceGroups","getMetricDefinitions","getResourceNames","getMetricNamespaces","getMetricNames","onResourceGroupChange","onMetricDefinitionChange","onResourceNameChange","onMetricNamespacesChange","getMetricMetadata","metadata","supportedAggTypes","primaryAggType","supportedTimeGrains","Promise","resolve","forEach","tg","generateAutoUnits","getBuiltInIntervalValue","getAzureMonitorAutoInterval","getApplicationInsightAutoInterval","name","configurable","getAppInsightsAutoInterval","getAppInsightsMetricNames","getAppInsightsColumns","onAppInsightsColumnChange","onAppInsightsMetricNameChange","getAppInsightsMetricMetadata","aggData","supportedGroupBy","getAppInsightsGroupBySegments","option","resetAppInsightsGroupBy","toggleEditorMode","updateTimeGrainType","timeGrainType","updateAppInsightsTimeGrain","templateUrl","sdk","UrlBuilder","buildAzureMonitorGetMetricNamespacesUrl","baseUrl","apiVersion","rn","service","lastIndexOf","buildAzureMonitorGetMetricNamesUrl","encodeURIComponent","ResponseParser","parseResponseValues","result","textFieldName","valueFieldName","parseResourceNames","parseMetadata","defaultAggTypes","metricData","primaryAggregationType","supportedAggregationTypes","parseTimeGrains","metricAvailabilities","parseDimensions","avail","isDimensionRequired","localizedValue","parseSubscriptions","SupportedNamespaces","cloudName","supportedMetricNamespaces","AzureMonitorDatasource","instanceSettings","backendSrv","apiPreviewVersion","id","jsonData","supported_namespaces","options","targets","hide","toString","datasourceId","format","queries","datasourceRequest","from","valueOf","to","results","queryRes","series","timeSerie","datapoints","points","grafana_data_src","annotationQuery","metricFindQuery","resourceGroupsQueryWithSub","toVariable","metricDefinitionsQuery","metricDefinitionsQueryWithSub","resourceNamesQuery","resourceNamesQueryWithSub","metricNamespaceQuery","metricNamespaceQueryWithSub","metricNamesQuery","metricNamesQueryWithSub","metric","route","doRequest","response_parser","shouldHardcodeBlobStorage","startsWith","url_builder","testDatasource","isValidConfigField","tenantId","status","clientId","response","title","statusText","code","field","maxRetries","parseQueryResult","columns","raw","yaxises","Columns","rows","Rows","parseRawQueryResultRow","parseQueryResultRow","columnsForDropdown","column","ColumnName","xaxisColumn","findIndex","yaxisesSplit","yaxisColumns","splitonColumn","convertTimestamp","row","yaxisColumn","yaxisName","bucket","findOrCreateBucket","epoch","dateTimeToEpoch","isSingleValue","getMetricFieldKey","aggField","getKeyForAggregationField","hasSegmentsField","segments","j","getTargetName","dataTarget","segment","segmentName","segmentValue","prop","isObject","g1","g2","obj","keys","without","dataObj","intersection","dateTimeValue","parseMetricNames","metrics","toTextValueList","Error","defaultAggregation","supportedAggregations","all","parseGroupBys","parseQuerySchema","columnTable","columnName","columnType","values","app_insights_datasource","AppInsightsDatasource","version","logAnalyticsColumns","applicationId","appInsightsAppId","createRawQueryRequest","segmentColumn","createMetricsRequest","columnNames","n","doQueries","appInsightsGroupByQuery","getGroupBys","method","app_insights_response_parser","LogAnalyticsQuerystringBuilder","defaultTimeField","generate","queryString","macroRegexp","p1","p2","getMultiContains","escape","getTimeFilter","getFrom","getUntil","uriString","startOf","toISOString","rangeRaw","Date","now","until","timeFieldArg","timeField","inputs","firstCommaIndex","templateVar","v","tables","parseTimeSeriesResult","parseTableResult","timeIndex","metricIndex","valueIndex","col","parseToVariables","queryResult","flattenDeep","transformToAnnotations","textIndex","tagsIndex","annotation","time","floor","tags","parseSchemaResult","createSchemaDatabaseWithTables","createSchemaTables","Functions","createSchemaFunctions","e_1","e_2","_d","_e","_f","convertToKustoColumn","e_3","functions","func","Body","DocString","displayName","Folder","category","FunctionKind","InputParameters","azure_log_analytics_datasource","AzureLogAnalyticsDatasource","azureLogAnalyticsSameAs","logAnalyticsDefaultWorkspace","setWorkspaceUrl","azureCloud","azureMonitorUrl","workspaceListUrl","val","properties","customerId","promises","generated","querystring_builder","interpolateVariable","maxDataPoints","azure_log_analytics_response_parser","getDefaultOrFirstWorkspace","buildQuery","querystring","multi","includeAll","reject","validationError","isValidConfig","ws","config","getErrorMessage","logAnalyticsTenantId","logAnalyticsClientId","Datasource","$q","azure_monitor_datasource","azureMonitorOptions","appInsightsOptions","azureLogAnalyticsOptions","amPromise","aiPromise","alaPromise","cloneDeep","flatten","aiResult","amResult","alaResult","upperFirst","getAzureLogAnalyticsWorkspaces","AzureCredentialsForm","selectedAzureCloud","selectedSubscription","clientSecret","clientSecretConfigured","getDerivedStateFromProps","nextProps","prevState","azureCloudOptions","subscriptionOptions","onAzureCloudChange","onSubscriptionSelectChange","onTenantIdChange","onClientIdChange","onClientSecretChange","onResetClientSecret","onLoadSubscriptions","Fragment","tooltip","defaultValue","disabled","variant","size","hasRequiredFields","MonitorConfig","onAzureCloudSelect","onDatasourceUpdate","editorJsonData","editorSecureJsonData","secureJsonFields","onSubscriptionSelect","datasourceConfig","azureClouds","AzureCredentialsForm_AzureCredentialsForm","AnalyticsConfig","onLogAnalyticsTenantIdChange","onLogAnalyticsClientIdChange","onLogAnalyticsClientSecretChange","logAnalyticsClientSecret","onLogAnalyticsResetClientSecret","onLogAnalyticsSubscriptionSelect","logAnalyticsSubscription","onWorkspaceSelectChange","onAzureLogAnalyticsSameAsChange","logAnalyticsSubscriptions","logAnalyticsWorkspaces","addtlAttrs","checked","onLoadWorkspaces","hasWorkspaceRequiredFields","backend_srv","__webpack_require__","InsightsConfig","onAppInsightsAppIdChange","onAppInsightsApiKeyChange","appInsightsApiKey","onAppInsightsResetApiKey","m","l","k","secureJsonData","hasOwnProperty","onOptionsChange","logAnalyticsHasNecessaryCredentials","put","updateDatasource","sameAs","ConfigEditor","keyFill","template_srv","init","MonitorConfig_MonitorConfig","onConfigUpdate","AnalyticsConfig_AnalyticsConfig","InsightsConfig_InsightsConfig","initDropdowns","bustCache","defineProperty","AzureMonitorAnnotationsQueryCtrl","enumerable","d","__webpack_exports__","module_plugin"],"mappings":"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CA,uCACA,mCACA,iCACA,+BACA,oCACA,4BACA,yCACA,wCACA,6BACA,yCACA,sCACA,gCACA,8BACA,+BACA,uCACA,gCACA,4BACA,2BACA,2CACA,4BACA,iDACA,gDACA,wDACA,sCACA,kCACA,6BACA,sCACA,mCACA,wCACA,2CACA,yCACA,kDACA,gCACA,2CACA,uDACA,+BACA,yDACA,2CACA,wCACA,6BACA,kCACA,kCACA,kCACA,qCACA,iCACA,oCACA,iDACA,iDACA,kDACA,kDACA,4CACA,uDACA,uEACA,8DACA,0CACA,4BACA,sBACA,4BACA,mDACD,iEAEC,CACA,qCACA,kCACA,gCACA,wBACA,2CACA,mDACA,uCACA,oCACA,4CACA,yCACA,+BACA,oCACA,4BACA,yCACA,6BACA,yCACA,sCACA,gCACA,8BACA,uCACA,4BACA,4BACA,sCACA,kCACA,6BACA,sCACA,mCACA,wCACA,2CACA,yCACA,kDACA,gCACA,2CACA,uDACA,+BACA,yDACA,2CACA,wCACA,6BACA,kCACA,kCACA,qCACA,iCACA,oCACA,iDACA,iDACA,kDACA,kDACA,4BACA,sBACA,4BACA,mDACD,qEAEC,CACA,qCACA,gCACA,wBACA,2CACA,mDACA,oCACA,4CACA,+BACA,oCACA,4BACA,yCACA,gCACA,8BACA,uCACA,4BACA,sCACA,kCACA,6BACA,sCACA,mCACA,wCACA,2CACA,yCACA,kDACA,gCACA,2CACA,uDACA,+BACA,yDACA,2CACA,wCACA,6BACA,kCACA,kCACA,qCACA,iCACA,oCACA,iDACA,iDACA,kDACA,kDACA,0CACA,4BACA,sBACA,4BACA,mDACD,mEAEC,CACA,qCACA,gCACA,wBACA,2CACA,mDACA,uCACA,oCACA,4CACA,yCACA,+BACA,oCACA,4BACA,yCACA,gCACA,uCACA,4BACA,4BACA,sCACA,kCACA,6BACA,sCACA,mCACA,wCACA,2CACA,yCACA,kDACA,gCACA,2CACA,uDACA,+BACA,yDACA,wCACA,6BACA,kCACA,kCACA,qCACA,iCACA,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","file":"azureMonitorPlugin.18f32a9f431162a774b4.js","sourcesContent":["import _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\n\nexport default class TimeGrainConverter {\n  static createISO8601Duration(timeGrain: string | number, timeGrainUnit: any) {\n    const timeIntervals = ['hour', 'minute', 'h', 'm'];\n    if (_.includes(timeIntervals, timeGrainUnit)) {\n      return `PT${timeGrain}${timeGrainUnit[0].toUpperCase()}`;\n    }\n\n    return `P${timeGrain}${timeGrainUnit[0].toUpperCase()}`;\n  }\n\n  static createISO8601DurationFromInterval(interval: string) {\n    const timeGrain = +interval.slice(0, interval.length - 1);\n    const unit = interval[interval.length - 1];\n\n    if (interval.indexOf('ms') > -1) {\n      return TimeGrainConverter.createISO8601Duration(1, 'm');\n    }\n\n    if (interval[interval.length - 1] === 's') {\n      let toMinutes = (timeGrain * 60) % 60;\n\n      if (toMinutes < 1) {\n        toMinutes = 1;\n      }\n\n      return TimeGrainConverter.createISO8601Duration(toMinutes, 'm');\n    }\n\n    return TimeGrainConverter.createISO8601Duration(timeGrain, unit);\n  }\n\n  static findClosestTimeGrain(interval: any, allowedTimeGrains: string[]) {\n    const timeGrains = _.filter(allowedTimeGrains, o => o !== 'auto');\n\n    let closest = timeGrains[0];\n    const intervalMs = kbn.interval_to_ms(interval);\n\n    for (let i = 0; i < timeGrains.length; i++) {\n      // abs (num - val) < abs (num - curr):\n      if (intervalMs > kbn.interval_to_ms(timeGrains[i])) {\n        if (i + 1 < timeGrains.length) {\n          closest = timeGrains[i + 1];\n        } else {\n          closest = timeGrains[i];\n        }\n      }\n    }\n\n    return closest;\n  }\n\n  static createTimeGrainFromISO8601Duration(duration: string) {\n    let offset = 1;\n    if (duration.substring(0, 2) === 'PT') {\n      offset = 2;\n    }\n\n    const value = duration.substring(offset, duration.length - 1);\n    const unit = duration.substring(duration.length - 1);\n\n    return value + ' ' + TimeGrainConverter.timeUnitToText(+value, unit);\n  }\n\n  static timeUnitToText(value: number, unit: string) {\n    let text = '';\n\n    if (unit === 'S') {\n      text = 'second';\n    }\n    if (unit === 'M') {\n      text = 'minute';\n    }\n    if (unit === 'H') {\n      text = 'hour';\n    }\n    if (unit === 'D') {\n      text = 'day';\n    }\n\n    if (value > 1) {\n      return text + 's';\n    }\n\n    return text;\n  }\n\n  static createKbnUnitFromISO8601Duration(duration: string) {\n    if (duration === 'auto') {\n      return 'auto';\n    }\n\n    let offset = 1;\n    if (duration.substring(0, 2) === 'PT') {\n      offset = 2;\n    }\n\n    const value = duration.substring(offset, duration.length - 1);\n    const unit = duration.substring(duration.length - 1);\n\n    return value + TimeGrainConverter.timeUnitToKbn(+value, unit);\n  }\n\n  static timeUnitToKbn(value: number, unit: string) {\n    if (unit === 'S') {\n      return 's';\n    }\n    if (unit === 'M') {\n      return 'm';\n    }\n    if (unit === 'H') {\n      return 'h';\n    }\n    if (unit === 'D') {\n      return 'd';\n    }\n\n    return '';\n  }\n}\n","import React from 'react';\nimport Prism from 'prismjs';\nimport { Decoration } from 'slate';\nimport { Editor } from '@grafana/slate-react';\n\nconst TOKEN_MARK = 'prism-token';\n\nexport function setPrismTokens(language: string, field: string | number, values: any, alias = 'variable') {\n  Prism.languages[language][field] = {\n    alias,\n    pattern: new RegExp(`(?:^|\\\\s)(${values.join('|')})(?:$|\\\\s)`),\n  };\n}\n\n/**\n * Code-highlighting plugin based on Prism and\n * https://github.com/ianstormtaylor/slate/blob/master/examples/code-highlighting/index.js\n *\n * (Adapted to handle nested grammar definitions.)\n */\n\nexport default function PrismPlugin({ definition, language }: { definition: any; language: string }) {\n  if (definition) {\n    // Don't override exising modified definitions\n    Prism.languages[language] = Prism.languages[language] || definition;\n  }\n\n  return {\n    /**\n     * Render a Slate mark with appropiate CSS class names\n     *\n     * @param {Object} props\n     * @return {Element}\n     */\n\n    renderDecoration(props: any, editor: Editor, next: () => any): JSX.Element {\n      const { children, decoration } = props;\n      // Only apply spans to marks identified by this plugin\n      if (decoration.type !== TOKEN_MARK) {\n        return next();\n      }\n      const className = `token ${decoration.data.get('types')}`;\n      return <span className={className}>{children}</span>;\n    },\n\n    /**\n     * Decorate code blocks with Prism.js highlighting.\n     *\n     * @param {Node} node\n     * @return {Array}\n     */\n\n    decorateNode(node: any, editor: Editor, next: () => any): any[] {\n      if (node.type !== 'paragraph') {\n        return [];\n      }\n\n      const texts = node.getTexts().toArray();\n      const tstring = texts.map((t: { text: any }) => t.text).join('\\n');\n      const grammar = Prism.languages[language];\n      const tokens = Prism.tokenize(tstring, grammar);\n      const decorations: Decoration[] = [];\n      let startText = texts.shift();\n      let endText = startText;\n      let startOffset = 0;\n      let endOffset = 0;\n      let start = 0;\n\n      function processToken(token: any, acc?: string) {\n        // Accumulate token types down the tree\n        const types = `${acc || ''} ${token.type || ''} ${token.alias || ''}`;\n\n        // Add mark for token node\n        if (typeof token === 'string' || typeof token.content === 'string') {\n          startText = endText;\n          startOffset = endOffset;\n\n          const content = typeof token === 'string' ? token : token.content;\n          const newlines = content.split('\\n').length - 1;\n          const length = content.length - newlines;\n          const end = start + length;\n\n          let available = startText.text.length - startOffset;\n          let remaining = length;\n\n          endOffset = startOffset + remaining;\n\n          while (available < remaining) {\n            endText = texts.shift();\n            remaining = length - available;\n            available = endText.text.length;\n            endOffset = remaining;\n          }\n\n          // Inject marks from up the tree (acc) as well\n          if (typeof token !== 'string' || acc) {\n            const range = node.createDecoration({\n              anchor: {\n                key: startText.key,\n                offset: startOffset,\n              },\n              focus: {\n                key: endText.key,\n                offset: endOffset,\n              },\n              type: TOKEN_MARK,\n              data: { types },\n            });\n\n            decorations.push(range);\n          }\n\n          start = end;\n        } else if (token.content && token.content.length) {\n          // Tokens can be nested\n          for (const subToken of token.content) {\n            processToken(subToken, types);\n          }\n        }\n      }\n\n      // Process top-level tokens\n      for (const token of tokens) {\n        processToken(token);\n      }\n\n      return decorations;\n    },\n  };\n}\n","import React from 'react';\n\nfunction scrollIntoView(el: any) {\n  if (!el || !el.offsetParent) {\n    return;\n  }\n  const container = el.offsetParent;\n  if (el.offsetTop > container.scrollTop + container.offsetHeight || el.offsetTop < container.scrollTop) {\n    container.scrollTop = el.offsetTop - container.offsetTop;\n  }\n}\n\nclass TypeaheadItem extends React.PureComponent<any, any> {\n  el: any;\n  componentDidUpdate(prevProps: any) {\n    if (this.props.isSelected && !prevProps.isSelected) {\n      scrollIntoView(this.el);\n    }\n  }\n\n  getRef = (el: any) => {\n    this.el = el;\n  };\n\n  render() {\n    const { hint, isSelected, label, onClickItem } = this.props;\n    const className = isSelected ? 'typeahead-item typeahead-item__selected' : 'typeahead-item';\n    const onClick = () => onClickItem(label);\n    return (\n      <li ref={this.getRef} className={className} onClick={onClick}>\n        {label}\n        {hint && isSelected ? <div className=\"typeahead-item-hint\">{hint}</div> : null}\n      </li>\n    );\n  }\n}\n\nclass TypeaheadGroup extends React.PureComponent<any, any> {\n  render() {\n    const { items, label, selected, onClickItem } = this.props;\n    return (\n      <li className=\"typeahead-group\">\n        <div className=\"typeahead-group__title\">{label}</div>\n        <ul className=\"typeahead-group__list\">\n          {items.map((item: any) => {\n            const text = typeof item === 'object' ? item.text : item;\n            const label = typeof item === 'object' ? item.display || item.text : item;\n            return (\n              <TypeaheadItem\n                key={text}\n                onClickItem={onClickItem}\n                isSelected={selected.indexOf(text) > -1}\n                hint={item.hint}\n                label={label}\n              />\n            );\n          })}\n        </ul>\n      </li>\n    );\n  }\n}\n\nclass Typeahead extends React.PureComponent<any, any> {\n  render() {\n    const { groupedItems, menuRef, selectedItems, onClickItem } = this.props;\n    return (\n      <ul className=\"typeahead\" ref={menuRef}>\n        {groupedItems.map((g: any) => (\n          <TypeaheadGroup key={g.label} onClickItem={onClickItem} selected={selectedItems} {...g} />\n        ))}\n      </ul>\n    );\n  }\n}\n\nexport default Typeahead;\n","import PluginPrism from 'app/features/explore/slate-plugins/prism';\nimport BracesPlugin from 'app/features/explore/slate-plugins/braces';\nimport ClearPlugin from 'app/features/explore/slate-plugins/clear';\nimport NewlinePlugin from 'app/features/explore/slate-plugins/newline';\nimport RunnerPlugin from 'app/features/explore/slate-plugins/runner';\n\nimport Typeahead from './typeahead';\nimport { getKeybindingSrv, KeybindingSrv } from 'app/core/services/keybindingSrv';\n\nimport { Block, Document, Text, Value, Editor as CoreEditor } from 'slate';\nimport { Editor } from '@grafana/slate-react';\nimport Plain from 'slate-plain-serializer';\nimport ReactDOM from 'react-dom';\nimport React from 'react';\nimport _ from 'lodash';\n\nfunction flattenSuggestions(s: any) {\n  return s ? s.reduce((acc: any, g: any) => acc.concat(g.items), []) : [];\n}\n\nexport const makeFragment = (text: string) => {\n  const lines = text.split('\\n').map((line: any) =>\n    Block.create({\n      type: 'paragraph',\n      nodes: [Text.create(line)],\n    } as any)\n  );\n\n  const fragment = Document.create({\n    nodes: lines,\n  });\n  return fragment;\n};\n\nexport const getInitialValue = (query: string) => Value.create({ document: makeFragment(query) });\n\nclass Portal extends React.Component<any, any> {\n  node: any;\n\n  constructor(props: any) {\n    super(props);\n    const { index = 0, prefix = 'query' } = props;\n    this.node = document.createElement('div');\n    this.node.classList.add(`slate-typeahead`, `slate-typeahead-${prefix}-${index}`);\n    document.body.appendChild(this.node);\n  }\n\n  componentWillUnmount() {\n    document.body.removeChild(this.node);\n  }\n\n  render() {\n    return ReactDOM.createPortal(this.props.children, this.node);\n  }\n}\n\nclass QueryField extends React.Component<any, any> {\n  menuEl: any;\n  plugins: any;\n  resetTimer: any;\n  keybindingSrv: KeybindingSrv = getKeybindingSrv();\n\n  constructor(props: any, context: any) {\n    super(props, context);\n\n    const { prismDefinition = {}, prismLanguage = 'kusto' } = props;\n\n    this.plugins = [\n      BracesPlugin(),\n      ClearPlugin(),\n      RunnerPlugin({ handler: props.onPressEnter }),\n      NewlinePlugin(),\n      PluginPrism({ definition: prismDefinition, language: prismLanguage }),\n    ];\n\n    this.state = {\n      labelKeys: {},\n      labelValues: {},\n      suggestions: [],\n      typeaheadIndex: 0,\n      typeaheadPrefix: '',\n      value: getInitialValue(props.initialQuery || ''),\n    };\n  }\n\n  componentDidMount() {\n    this.updateMenu();\n  }\n\n  componentWillUnmount() {\n    this.restoreEscapeKeyBinding();\n    clearTimeout(this.resetTimer);\n  }\n\n  componentDidUpdate() {\n    this.updateMenu();\n  }\n\n  onChange = ({ value }: { value: Value }) => {\n    const changed = value.document !== this.state.value.document;\n    this.setState({ value }, () => {\n      if (changed) {\n        // call typeahead only if query changed\n        requestAnimationFrame(() => this.onTypeahead());\n        this.onChangeQuery();\n      }\n    });\n  };\n\n  request = (url?: string) => {\n    if (this.props.request) {\n      return this.props.request(url);\n    }\n    return fetch(url);\n  };\n\n  onChangeQuery = () => {\n    // Send text change to parent\n    const { onQueryChange } = this.props;\n    if (onQueryChange) {\n      onQueryChange(Plain.serialize(this.state.value));\n    }\n  };\n\n  onKeyDown = (event: Event, editor: CoreEditor, next: Function) => {\n    const { typeaheadIndex, suggestions } = this.state;\n    const keyboardEvent = event as KeyboardEvent;\n\n    switch (keyboardEvent.key) {\n      case 'Escape': {\n        if (this.menuEl) {\n          keyboardEvent.preventDefault();\n          keyboardEvent.stopPropagation();\n          this.resetTypeahead();\n          return true;\n        }\n        break;\n      }\n\n      case ' ': {\n        if (keyboardEvent.ctrlKey) {\n          keyboardEvent.preventDefault();\n          this.onTypeahead(true);\n          return true;\n        }\n        break;\n      }\n\n      case 'Tab':\n      case 'Enter': {\n        if (this.menuEl) {\n          // Dont blur input\n          keyboardEvent.preventDefault();\n          if (!suggestions || !suggestions.length) {\n            return next();\n          }\n\n          // Get the currently selected suggestion\n          const flattenedSuggestions = flattenSuggestions(suggestions);\n          const selected = Math.abs(typeaheadIndex);\n          const selectedIndex = selected % flattenedSuggestions.length || 0;\n          const suggestion = flattenedSuggestions[selectedIndex];\n\n          return this.applyTypeahead(editor, suggestion);\n        }\n        break;\n      }\n\n      case 'ArrowDown': {\n        if (this.menuEl) {\n          // Select next suggestion\n          keyboardEvent.preventDefault();\n          this.setState({ typeaheadIndex: typeaheadIndex + 1 });\n        }\n        break;\n      }\n\n      case 'ArrowUp': {\n        if (this.menuEl) {\n          // Select previous suggestion\n          keyboardEvent.preventDefault();\n          this.setState({ typeaheadIndex: Math.max(0, typeaheadIndex - 1) });\n        }\n        break;\n      }\n\n      default: {\n        // console.log('default key', event.key, event.which, event.charCode, event.locale, data.key);\n        break;\n      }\n    }\n    return next();\n  };\n\n  onTypeahead = (change = false, item?: any): boolean | void => {\n    return change;\n  };\n\n  applyTypeahead = (\n    editor?: CoreEditor,\n    suggestion?: { text: any; type: string; deleteBackwards: any }\n  ): { value: Value } => {\n    return { value: new Value() };\n  };\n\n  resetTypeahead = (callback?: () => void) => {\n    this.setState(\n      {\n        suggestions: [],\n        typeaheadIndex: 0,\n        typeaheadPrefix: '',\n        typeaheadContext: null,\n      },\n      callback\n    );\n  };\n\n  handleBlur = () => {\n    const { onBlur } = this.props;\n    // If we dont wait here, menu clicks wont work because the menu\n    // will be gone.\n    this.resetTimer = setTimeout(this.resetTypeahead, 100);\n    if (onBlur) {\n      onBlur();\n    }\n    this.restoreEscapeKeyBinding();\n  };\n\n  handleFocus = () => {\n    const { onFocus } = this.props;\n    if (onFocus) {\n      onFocus();\n    }\n    // Don't go back to dashboard if Escape pressed inside the editor.\n    this.removeEscapeKeyBinding();\n  };\n\n  removeEscapeKeyBinding() {\n    this.keybindingSrv.unbind('esc', 'keydown');\n  }\n\n  restoreEscapeKeyBinding() {\n    this.keybindingSrv.setupGlobal();\n  }\n\n  onClickItem = (item: any) => {\n    const { suggestions } = this.state;\n    if (!suggestions || suggestions.length === 0) {\n      return;\n    }\n\n    // Manually triggering change\n    const change = this.applyTypeahead();\n    this.onChange(change);\n  };\n\n  updateMenu = () => {\n    const { suggestions } = this.state;\n    const menu = this.menuEl;\n    const selection = window.getSelection();\n    const node = selection.anchorNode;\n\n    // No menu, nothing to do\n    if (!menu) {\n      return;\n    }\n\n    // No suggestions or blur, remove menu\n    const hasSuggesstions = suggestions && suggestions.length > 0;\n    if (!hasSuggesstions) {\n      menu.removeAttribute('style');\n      return;\n    }\n\n    // Align menu overlay to editor node\n    if (node && node.parentElement) {\n      // Read from DOM\n      const rect = node.parentElement.getBoundingClientRect();\n      const scrollX = window.scrollX;\n      const scrollY = window.scrollY;\n      const screenHeight = window.innerHeight;\n\n      const menuLeft = rect.left + scrollX - 2;\n      const menuTop = rect.top + scrollY + rect.height + 4;\n      const menuHeight = screenHeight - menuTop - 10;\n\n      // Write DOM\n      requestAnimationFrame(() => {\n        menu.style.opacity = 1;\n        menu.style.top = `${menuTop}px`;\n        menu.style.left = `${menuLeft}px`;\n        menu.style.maxHeight = `${menuHeight}px`;\n      });\n    }\n  };\n\n  menuRef = (el: any) => {\n    this.menuEl = el;\n  };\n\n  renderMenu = () => {\n    const { portalPrefix } = this.props;\n    const { suggestions } = this.state;\n    const hasSuggesstions = suggestions && suggestions.length > 0;\n    if (!hasSuggesstions) {\n      return null;\n    }\n\n    // Guard selectedIndex to be within the length of the suggestions\n    let selectedIndex = Math.max(this.state.typeaheadIndex, 0);\n    const flattenedSuggestions = flattenSuggestions(suggestions);\n    selectedIndex = selectedIndex % flattenedSuggestions.length || 0;\n    const selectedKeys = (flattenedSuggestions.length > 0 ? [flattenedSuggestions[selectedIndex]] : []).map(i =>\n      typeof i === 'object' ? i.text : i\n    );\n\n    // Create typeahead in DOM root so we can later position it absolutely\n    return (\n      <Portal prefix={portalPrefix}>\n        <Typeahead\n          menuRef={this.menuRef}\n          selectedItems={selectedKeys}\n          onClickItem={this.onClickItem}\n          groupedItems={suggestions}\n        />\n      </Portal>\n    );\n  };\n\n  render() {\n    return (\n      <div className=\"slate-query-field\">\n        {this.renderMenu()}\n        <Editor\n          autoCorrect={false}\n          onBlur={this.handleBlur}\n          onKeyDown={this.onKeyDown}\n          onChange={this.onChange}\n          onFocus={this.handleFocus}\n          placeholder={this.props.placeholder}\n          plugins={this.plugins}\n          spellCheck={false}\n          value={this.state.value}\n        />\n      </div>\n    );\n  }\n}\n\nexport default QueryField;\n","/* tslint:disable:max-line-length */\nexport const operatorTokens = [\n  { text: '!between', hint: 'Matches the input that is outside the inclusive range.' },\n  { text: 'as', hint: \"Binds a name to the operator's input tabular expression.\" },\n  { text: 'between', hint: 'Matches the input that is inside the inclusive range.' },\n  {\n    text: 'consume',\n    hint:\n      'The `consume` operator consumes the tabular data stream handed to it. It is\\r\\nmostly used for triggering the query side-effect without actually returning\\r\\nthe results back to the caller.',\n  },\n  { text: 'count', hint: 'Returns the number of records in the input record set.' },\n  { text: 'datatable', hint: 'Returns a table whose schema and values are defined in the query itself.' },\n  {\n    text: 'distinct',\n    hint: 'Produces a table with the distinct combination of the provided columns of the input table.',\n  },\n  { text: 'evaluate', hint: 'Invokes a service-side query extension (plugin).' },\n  { text: 'extend', hint: 'Create calculated columns and append them to the result set.' },\n  {\n    text: 'externaldata',\n    hint:\n      'Returns a table whose schema is defined in the query itself, and whose data is read from an external raw file.',\n  },\n  {\n    text: 'facet',\n    hint:\n      'Returns a set of tables, one for each specified column.\\r\\nEach table specifies the list of values taken by its column.\\r\\nAn additional table can be created by using the `with` clause.',\n  },\n  { text: 'find', hint: 'Finds rows that match a predicate across a set of tables.' },\n  { text: 'fork', hint: 'Runs multiple consumer operators in parallel.' },\n  { text: 'getschema', hint: 'Produce a table that represents a tabular schema of the input.' },\n  { text: 'in', hint: 'Filters a recordset based on the provided set of values.' },\n  { text: 'invoke', hint: 'Invokes lambda that receives the source of `invoke` as tabular parameter argument.' },\n  {\n    text: 'join',\n    hint:\n      'Merge the rows of two tables to form a new table by matching values of the specified column(s) from each table.',\n  },\n  { text: 'limit', hint: 'Return up to the specified number of rows.' },\n  { text: 'make-series', hint: 'Create series of specified aggregated values along specified axis.' },\n  { text: 'mvexpand', hint: 'Expands multi-value array or property bag.' },\n  { text: 'order', hint: 'Sort the rows of the input table into order by one or more columns.' },\n  { text: 'parse', hint: 'Evaluates a string expression and parses its value into one or more calculated columns.' },\n  {\n    text: 'print',\n    hint:\n      'Evaluates one or more scalar expressions and inserts the results (as a single-row table with as many columns as there are expressions) into the output.',\n  },\n  { text: 'project', hint: 'Select the columns to include, rename or drop, and insert new computed columns.' },\n  { text: 'project-away', hint: 'Select what  columns to exclude from the input.' },\n  { text: 'project-rename', hint: 'Renames columns in the result output.' },\n  { text: 'range', hint: 'Generates a single-column table of values.' },\n  { text: 'reduce', hint: 'Groups a set of strings together based on values similarity.' },\n  { text: 'render', hint: 'Instructs the user agent to render the results of the query in a particular way.' },\n  { text: 'sample', hint: 'Returns up to the specified number of random rows from the input table.' },\n  {\n    text: 'sample-distinct',\n    hint:\n      'Returns a single column that contains up to the specified number of distinct values of the requested column.',\n  },\n  { text: 'search', hint: 'The search operator provides a multi-table/multi-column search experience.' },\n  { text: 'serialize', hint: 'Marks that order of the input row set is safe for window functions usage.' },\n  { text: 'sort', hint: 'Sort the rows of the input table into order by one or more columns.' },\n  { text: 'summarize', hint: 'Produces a table that aggregates the content of the input table.' },\n  { text: 'take', hint: 'Return up to the specified number of rows.' },\n  { text: 'top', hint: 'Returns the first *N* records sorted by the specified columns.' },\n  {\n    text: 'top-hitters',\n    hint: 'Returns an approximation of the first *N* results (assuming skewed distribution of the input).',\n  },\n  {\n    text: 'top-nested',\n    hint: 'Produces hierarchical top results, where each level is a drill-down based on previous level values.',\n  },\n  { text: 'union', hint: 'Takes two or more tables and returns the rows of all of them.' },\n  { text: 'where', hint: 'Filters a table to the subset of rows that satisfy a predicate.' },\n];\n\nexport const functionTokens = [\n  { text: 'abs', hint: 'Calculates the absolute value of the input.' },\n  {\n    text: 'acos',\n    hint:\n      'Returns the angle whose cosine is the specified number (the inverse operation of [`cos()`](cosfunction.md)) .',\n  },\n  { text: 'ago', hint: 'Subtracts the given timespan from the current UTC clock time.' },\n  { text: 'any', hint: 'Returns random non-empty value from the specified expression values.' },\n  {\n    text: 'arg_max',\n    hint:\n      'Finds a row in the group that maximizes *ExprToMaximize*, and returns the value of *ExprToReturn* (or `*` to return the entire row).',\n  },\n  {\n    text: 'arg_min',\n    hint:\n      'Finds a row in the group that minimizes *ExprToMinimize*, and returns the value of *ExprToReturn* (or `*` to return the entire row).',\n  },\n  {\n    text: 'argmax',\n    hint:\n      'Finds a row in the group that maximizes *ExprToMaximize*, and returns the value of *ExprToReturn* (or `*` to return the entire row).',\n  },\n  {\n    text: 'argmin',\n    hint:\n      'Finds a row in the group that minimizes *ExprToMinimize*, and returns the value of *ExprToReturn* (or `*` to return the entire row).',\n  },\n  { text: 'array_concat', hint: 'Concatenates a number of dynamic arrays to a single array.' },\n  { text: 'array_length', hint: 'Calculates the number of elements in a dynamic array.' },\n  { text: 'array_slice', hint: 'Extracts a slice of a dynamic array.' },\n  {\n    text: 'array_split',\n    hint:\n      'Splits an array to multiple arrays according to the split indices and packs the generated array in a dynamic array.',\n  },\n  {\n    text: 'asin',\n    hint: 'Returns the angle whose sine is the specified number (the inverse operation of [`sin()`](sinfunction.md)) .',\n  },\n  {\n    text: 'assert',\n    hint: 'Checks for a condition; if the condition is false, outputs error messages and fails the query.',\n  },\n  {\n    text: 'atan',\n    hint:\n      'Returns the angle whose tangent is the specified number (the inverse operation of [`tan()`](tanfunction.md)) .',\n  },\n  {\n    text: 'atan2',\n    hint:\n      'Calculates the angle, in radians, between the positive x-axis and the ray from the origin to the point (y, x).',\n  },\n  { text: 'avg', hint: 'Calculates the average of *Expr* across the group.' },\n  {\n    text: 'avgif',\n    hint:\n      'Calculates the [average](avg-aggfunction.md) of *Expr* across the group for which *Predicate* evaluates to `true`.',\n  },\n  { text: 'bag_keys', hint: 'Enumerates all the root keys in a dynamic property-bag object.' },\n  { text: 'base64_decodestring', hint: 'Decodes a base64 string to a UTF-8 string' },\n  { text: 'base64_encodestring', hint: 'Encodes a string as base64 string' },\n  { text: 'beta_cdf', hint: 'Returns the standard cumulative beta distribution function.' },\n  { text: 'beta_inv', hint: 'Returns the inverse of the beta cumulative probability beta density function.' },\n  { text: 'beta_pdf', hint: 'Returns the probability density beta function.' },\n  { text: 'bin', hint: 'Rounds values down to an integer multiple of a given bin size.' },\n  {\n    text: 'bin_at',\n    hint:\n      \"Rounds values down to a fixed-size 'bin', with control over the bin's starting point.\\r\\n(See also [`bin function`](./binfunction.md).)\",\n  },\n  {\n    text: 'bin_auto',\n    hint:\n      \"Rounds values down to a fixed-size 'bin', with control over the bin size and starting point provided by a query property.\",\n  },\n  { text: 'binary_and', hint: 'Returns a result of the bitwise `and` operation between two values.' },\n  { text: 'binary_not', hint: 'Returns a bitwise negation of the input value.' },\n  { text: 'binary_or', hint: 'Returns a result of the bitwise `or` operation of the two values.' },\n  { text: 'binary_shift_left', hint: 'Returns binary shift left operation on a pair of numbers.' },\n  { text: 'binary_shift_right', hint: 'Returns binary shift right operation on a pair of numbers.' },\n  { text: 'binary_xor', hint: 'Returns a result of the bitwise `xor` operation of the two values.' },\n  { text: 'buildschema', hint: 'Returns the minimal schema that admits all values of *DynamicExpr*.' },\n  {\n    text: 'case',\n    hint: 'Evaluates a list of predicates and returns the first result expression whose predicate is satisfied.',\n  },\n  {\n    text: 'ceiling',\n    hint: 'Calculates the smallest integer greater than, or equal to, the specified numeric expression.',\n  },\n  { text: 'cluster', hint: 'Changes the reference of the query to a remote cluster.' },\n  {\n    text: 'coalesce',\n    hint: 'Evaluates a list of expressions and returns the first non-null (or non-empty for string) expression.',\n  },\n  { text: 'cos', hint: 'Returns the cosine function.' },\n  { text: 'cot', hint: 'Calculates the trigonometric cotangent of the specified angle, in radians.' },\n  {\n    text: 'count',\n    hint:\n      'Returns a count of the records per summarization group (or in total if summarization is done without grouping).',\n  },\n  { text: 'countif', hint: 'Returns a count of rows for which *Predicate* evaluates to `true`.' },\n  {\n    text: 'countof',\n    hint: 'Counts occurrences of a substring in a string. Plain string matches may overlap; regex matches do not.',\n  },\n  { text: 'current_principal', hint: 'Returns the current principal running this query.' },\n  {\n    text: 'cursor_after',\n    hint: 'A predicate over the records of a table to compare their ingestion time\\r\\nagainst a database cursor.',\n  },\n  {\n    text: 'cursor_before_or_at',\n    hint: 'A predicate over the records of a table to compare their ingestion time\\r\\nagainst a database cursor.',\n  },\n  { text: 'database', hint: 'Changes the reference of the query to a specific database within the cluster scope.' },\n  {\n    text: 'datetime_add',\n    hint:\n      'Calculates a new [datetime](./scalar-data-types/datetime.md) from a specified datepart multiplied by a specified amount, added to a specified [datetime](./scalar-data-types/datetime.md).',\n  },\n  {\n    text: 'datetime_diff',\n    hint: 'Calculates calendarian difference between two [datetime](./scalar-data-types/datetime.md) values.',\n  },\n  { text: 'datetime_part', hint: 'Extracts the requested date part as an integer value.' },\n  { text: 'dayofmonth', hint: 'Returns the integer number representing the day number of the given month' },\n  { text: 'dayofweek', hint: 'Returns the integer number of days since the preceding Sunday, as a `timespan`.' },\n  { text: 'dayofyear', hint: 'Returns the integer number represents the day number of the given year.' },\n  { text: 'dcount', hint: 'Returns an estimate of the number of distinct values of *Expr* in the group.' },\n  {\n    text: 'dcount_hll',\n    hint:\n      'Calculates the dcount from hll results (which was generated by [hll](hll-aggfunction.md) or [hll_merge](hll-merge-aggfunction.md)).',\n  },\n  {\n    text: 'dcountif',\n    hint:\n      'Returns an estimate of the number of distinct values of *Expr* of rows for which *Predicate* evaluates to `true`.',\n  },\n  {\n    text: 'degrees',\n    hint:\n      'Converts angle value in radians into value in degrees, using formula `degrees = (180 / PI ) * angle_in_radians`',\n  },\n  { text: 'distance', hint: 'Returns the distance between two points in meters.' },\n  { text: 'endofday', hint: 'Returns the end of the day containing the date, shifted by an offset, if provided.' },\n  { text: 'endofmonth', hint: 'Returns the end of the month containing the date, shifted by an offset, if provided.' },\n  { text: 'endofweek', hint: 'Returns the end of the week containing the date, shifted by an offset, if provided.' },\n  { text: 'endofyear', hint: 'Returns the end of the year containing the date, shifted by an offset, if provided.' },\n  {\n    text: 'estimate_data_size',\n    hint: 'Returns an estimated data size of the selected columns of the tabular expression.',\n  },\n  { text: 'exp', hint: 'The base-e exponential function of x, which is e raised to the power x: e^x.' },\n  {\n    text: 'exp10',\n    hint: 'The base-10 exponential function of x, which is 10 raised to the power x: 10^x.  \\r\\n**Syntax**',\n  },\n  { text: 'exp2', hint: 'The base-2 exponential function of x, which is 2 raised to the power x: 2^x.' },\n  {\n    text: 'extent_id',\n    hint: 'Returns a unique identifier that identifies the data shard (\"extent\") that the current record resides in.',\n  },\n  {\n    text: 'extent_tags',\n    hint:\n      'Returns a dynamic array with the [tags](../management/extents-overview.md#extent-tagging) of the data shard (\"extent\") that the current record resides in.',\n  },\n  { text: 'extract', hint: 'Get a match for a [regular expression](./re2.md) from a text string.' },\n  { text: 'extract_all', hint: 'Get all matches for a [regular expression](./re2.md) from a text string.' },\n  { text: 'extractjson', hint: 'Get a specified element out of a JSON text using a path expression.' },\n  { text: 'floor', hint: 'An alias for [`bin()`](binfunction.md).' },\n  { text: 'format_datetime', hint: 'Formats a datetime parameter based on the format pattern parameter.' },\n  { text: 'format_timespan', hint: 'Formats a timespan parameter based on the format pattern parameter.' },\n  { text: 'gamma', hint: 'Computes [gamma function](https://en.wikipedia.org/wiki/Gamma_function)' },\n  { text: 'getmonth', hint: 'Get the month number (1-12) from a datetime.' },\n  { text: 'gettype', hint: 'Returns the runtime type of its single argument.' },\n  { text: 'getyear', hint: 'Returns the year part of the `datetime` argument.' },\n  { text: 'hash', hint: 'Returns a hash value for the input value.' },\n  { text: 'hash_sha256', hint: 'Returns a sha256 hash value for the input value.' },\n  { text: 'hll', hint: 'Calculates the Intermediate results of [dcount](dcount-aggfunction.md) across the group.' },\n  {\n    text: 'hll_merge',\n    hint: 'Merges hll results (scalar version of the aggregate version [`hll_merge()`](hll-merge-aggfunction.md)).',\n  },\n  { text: 'hourofday', hint: 'Returns the integer number representing the hour number of the given date' },\n  {\n    text: 'iff',\n    hint:\n      'Evaluates the first argument (the predicate), and returns the value of either the second or third arguments, depending on whether the predicate evaluated to `true` (second) or `false` (third).',\n  },\n  {\n    text: 'iif',\n    hint:\n      'Evaluates the first argument (the predicate), and returns the value of either the second or third arguments, depending on whether the predicate evaluated to `true` (second) or `false` (third).',\n  },\n  {\n    text: 'indexof',\n    hint: 'Function reports the zero-based index of the first occurrence of a specified string within input string.',\n  },\n  { text: 'ingestion_time', hint: \"Retrieves the record's `$IngestionTime` hidden `datetime` column, or null.\" },\n  {\n    text: 'iscolumnexists',\n    hint:\n      'Returns a boolean value indicating if the given string argument exists in the schema produced by the preceding tabular operator.',\n  },\n  { text: 'isempty', hint: 'Returns `true` if the argument is an empty string or is null.' },\n  { text: 'isfinite', hint: 'Returns whether input is a finite value (is neither infinite nor NaN).' },\n  { text: 'isinf', hint: 'Returns whether input is an infinite (positive or negative) value.' },\n  { text: 'isnan', hint: 'Returns whether input is Not-a-Number (NaN) value.' },\n  { text: 'isnotempty', hint: 'Returns `true` if the argument is not an empty string nor it is a null.' },\n  { text: 'isnotnull', hint: 'Returns `true` if the argument is not null.' },\n  {\n    text: 'isnull',\n    hint:\n      'Evaluates its sole argument and returns a `bool` value indicating if the argument evaluates to a null value.',\n  },\n  { text: 'log', hint: 'Returns the natural logarithm function.' },\n  { text: 'log10', hint: 'Returns the common (base-10) logarithm function.' },\n  { text: 'log2', hint: 'Returns the base-2 logarithm function.' },\n  {\n    text: 'loggamma',\n    hint: 'Computes log of absolute value of the [gamma function](https://en.wikipedia.org/wiki/Gamma_function)',\n  },\n  {\n    text: 'make_datetime',\n    hint: 'Creates a [datetime](./scalar-data-types/datetime.md) scalar value from the specified date and time.',\n  },\n  {\n    text: 'make_dictionary',\n    hint: 'Returns a `dynamic` (JSON) property-bag (dictionary) of all the values of *Expr* in the group.',\n  },\n  { text: 'make_string', hint: 'Returns the string generated by the Unicode characters.' },\n  {\n    text: 'make_timespan',\n    hint: 'Creates a [timespan](./scalar-data-types/timespan.md) scalar value from the specified time period.',\n  },\n  { text: 'makelist', hint: 'Returns a `dynamic` (JSON) array of all the values of *Expr* in the group.' },\n  {\n    text: 'makeset',\n    hint: 'Returns a `dynamic` (JSON) array of the set of distinct values that *Expr* takes in the group.',\n  },\n  {\n    text: 'materialize',\n    hint:\n      'Allows caching a sub-query result during the time of query execution in a way that other subqueries can reference the partial result.',\n  },\n  { text: 'max', hint: 'Returns the maximum value across the group.' },\n  { text: 'max_of', hint: 'Returns the maximum value of several evaluated numeric expressions.' },\n  {\n    text: 'merge_tdigests',\n    hint:\n      'Merges tdigest results (scalar version of the aggregate version [`merge_tdigests()`](merge-tdigests-aggfunction.md)).',\n  },\n  { text: 'min', hint: 'Returns the minimum value agross the group.' },\n  { text: 'min_of', hint: 'Returns the minimum value of several evaluated numeric expressions.' },\n  { text: 'monthofyear', hint: 'Returns the integer number represents the month number of the given year.' },\n  {\n    text: 'next',\n    hint:\n      'Returns the value of a column in a row that it at some offset following the\\r\\ncurrent row in a [serialized row set](./windowsfunctions.md#serialized-row-set).',\n  },\n  { text: 'not', hint: 'Reverses the value of its `bool` argument.' },\n  {\n    text: 'now',\n    hint:\n      'Returns the current UTC clock time, optionally offset by a given timespan.\\r\\nThis function can be used multiple times in a statement and the clock time being referenced will be the same for all instances.',\n  },\n  { text: 'pack', hint: 'Creates a `dynamic` object (property bag) from a list of names and values.' },\n  {\n    text: 'pack_all',\n    hint: 'Creates a `dynamic` object (property bag) from all the columns of the tabular expression.',\n  },\n  { text: 'pack_array', hint: 'Packs all input values into a dynamic array.' },\n  { text: 'parse_ipv4', hint: 'Converts input to integer (signed 64-bit) number representation.' },\n  {\n    text: 'parse_json',\n    hint:\n      'Interprets a `string` as a [JSON value](https://json.org/)) and returns the value as [`dynamic`](./scalar-data-types/dynamic.md). \\r\\nIt is superior to using [extractjson() function](./extractjsonfunction.md)\\r\\nwhen you need to extract more than one element of a JSON compound object.',\n  },\n  {\n    text: 'parse_path',\n    hint:\n      'Parses a file path `string` and returns a [`dynamic`](./scalar-data-types/dynamic.md) object that contains the following parts of the path: \\r\\nScheme, RootPath, DirectoryPath, DirectoryName, FileName, Extension, AlternateDataStreamName.\\r\\nIn addition to the simple paths with both types of slashes, supports paths with schemas (e.g. \"file://...\"), shared paths (e.g. \"\\\\\\\\shareddrive\\\\users...\"), long paths (e.g \"\\\\\\\\?\\\\C:...\"\"), alternate data streams (e.g. \"file1.exe:file2.exe\")',\n  },\n  {\n    text: 'parse_url',\n    hint:\n      'Parses an absolute URL `string` and returns a [`dynamic`](./scalar-data-types/dynamic.md) object contains all parts of the URL (Scheme, Host, Port, Path, Username, Password, Query Parameters, Fragment).',\n  },\n  {\n    text: 'parse_urlquery',\n    hint:\n      'Parses a url query `string` and returns a [`dynamic`](./scalar-data-types/dynamic.md) object contains the Query parameters.',\n  },\n  {\n    text: 'parse_user_agent',\n    hint:\n      \"Interprets a user-agent string, which identifies the user's browser and provides certain system details to servers hosting the websites the user visits. The result is returned as [`dynamic`](./scalar-data-types/dynamic.md).\",\n  },\n  { text: 'parse_version', hint: 'Converts input string representation of version to a comparable decimal number.' },\n  {\n    text: 'parse_xml',\n    hint:\n      'Interprets a `string` as a XML value, converts the value to a [JSON value](https://json.org/) and returns the value as  [`dynamic`](./scalar-data-types/dynamic.md).',\n  },\n  {\n    text: 'percentile',\n    hint:\n      'Returns an estimate for the specified [nearest-rank percentile](#nearest-rank-percentile) of the population defined by *Expr*. \\r\\nThe accuracy depends on the density of population in the region of the percentile.',\n  },\n  {\n    text: 'percentile_tdigest',\n    hint:\n      'Calculates the percentile result from tdigest results (which was generated by [tdigest](tdigest-aggfunction.md) or [merge-tdigests](merge-tdigests-aggfunction.md))',\n  },\n  {\n    text: 'percentrank_tdigest',\n    hint:\n      \"Calculates the approximate rank of the value in a set where rank is expressed as percentage of set's size. \\r\\nThis function can be viewed as the inverse of the percentile.\",\n  },\n  { text: 'pi', hint: 'Returns the constant value of Pi ().' },\n  { text: 'point', hint: 'Returns a dynamic array representation of a point.' },\n  { text: 'pow', hint: 'Returns a result of raising to power' },\n  {\n    text: 'prev',\n    hint:\n      'Returns the value of a column in a row that it at some offset prior to the\\r\\ncurrent row in a [serialized row set](./windowsfunctions.md#serialized-row-set).',\n  },\n  {\n    text: 'radians',\n    hint:\n      'Converts angle value in degrees into value in radians, using formula `radians = (PI / 180 ) * angle_in_degrees`',\n  },\n  { text: 'rand', hint: 'Returns a random number.' },\n  { text: 'range', hint: 'Generates a dynamic array holding a series of equally-spaced values.' },\n  { text: 'repeat', hint: 'Generates a dynamic array holding a series of equal values.' },\n  { text: 'replace', hint: 'Replace all regex matches with another string.' },\n  { text: 'reverse', hint: 'Function makes reverse of input string.' },\n  { text: 'round', hint: 'Returns the rounded source to the specified precision.' },\n  {\n    text: 'row_cumsum',\n    hint:\n      'Calculates the cumulative sum of a column in a [serialized row set](./windowsfunctions.md#serialized-row-set).',\n  },\n  {\n    text: 'row_number',\n    hint:\n      \"Returns the current row's index in a [serialized row set](./windowsfunctions.md#serialized-row-set).\\r\\nThe row index starts by default at `1` for the first row, and is incremented by `1` for each additional row.\\r\\nOptionally, the row index can start at a different value than `1`.\\r\\nAdditionally, the row index may be reset according to some provided predicate.\",\n  },\n  { text: 'series_add', hint: 'Calculates the element-wise addition of two numeric series inputs.' },\n  { text: 'series_decompose', hint: 'Applies a decomposition transformation on a series.' },\n  {\n    text: 'series_decompose_anomalies',\n    hint:\n      'Anomaly Detection based on series decomposition (refer to [series_decompose()](series-decomposefunction.md))',\n  },\n  { text: 'series_decompose_forecast', hint: 'Forecast based on series decomposition.' },\n  { text: 'series_divide', hint: 'Calculates the element-wise division of two numeric series inputs.' },\n  {\n    text: 'series_equals',\n    hint: 'Calculates the element-wise equals (`==`) logic operation of two numeric series inputs.',\n  },\n  { text: 'series_fill_backward', hint: 'Performs backward fill interpolation of missing values in a series.' },\n  { text: 'series_fill_const', hint: 'Replaces missing values in a series with a specified constant value.' },\n  { text: 'series_fill_forward', hint: 'Performs forward fill interpolation of missing values in a series.' },\n  { text: 'series_fill_linear', hint: 'Performs linear interpolation of missing values in a series.' },\n  { text: 'series_fir', hint: 'Applies a Finite Impulse Response filter on a series.' },\n  {\n    text: 'series_fit_2lines',\n    hint: 'Applies two segments linear regression on a series, returning multiple columns.',\n  },\n  {\n    text: 'series_fit_2lines_dynamic',\n    hint: 'Applies two segments linear regression on a series, returning dynamic object.',\n  },\n  { text: 'series_fit_line', hint: 'Applies linear regression on a series, returning multiple columns.' },\n  { text: 'series_fit_line_dynamic', hint: 'Applies linear regression on a series, returning dynamic object.' },\n  {\n    text: 'series_greater',\n    hint: 'Calculates the element-wise greater (`>`) logic operation of two numeric series inputs.',\n  },\n  {\n    text: 'series_greater_equals',\n    hint: 'Calculates the element-wise greater or equals (`>=`) logic operation of two numeric series inputs.',\n  },\n  { text: 'series_iir', hint: 'Applies a Infinite Impulse Response filter on a series.' },\n  { text: 'series_less', hint: 'Calculates the element-wise less (`<`) logic operation of two numeric series inputs.' },\n  {\n    text: 'series_less_equals',\n    hint: 'Calculates the element-wise less or equal (`<=`) logic operation of two numeric series inputs.',\n  },\n  { text: 'series_multiply', hint: 'Calculates the element-wise multiplication of two numeric series inputs.' },\n  {\n    text: 'series_not_equals',\n    hint: 'Calculates the element-wise not equals (`!=`) logic operation of two numeric series inputs.',\n  },\n  { text: 'series_outliers', hint: 'Scores anomaly points in a series.' },\n  { text: 'series_periods_detect', hint: 'Finds the most significant periods that exist in a time series.' },\n  {\n    text: 'series_periods_validate',\n    hint: 'Checks whether a time series contains periodic patterns of given lengths.',\n  },\n  {\n    text: 'series_seasonal',\n    hint: 'Calculates the seasonal component of a series according to the detected or given seasonal period.',\n  },\n  { text: 'series_stats', hint: 'Returns statistics for a series in multiple columns.' },\n  { text: 'series_stats_dynamic', hint: 'Returns statistics for a series in dynamic object.' },\n  { text: 'series_subtract', hint: 'Calculates the element-wise subtraction of two numeric series inputs.' },\n  { text: 'sign', hint: 'Sign of a numeric expression' },\n  { text: 'sin', hint: 'Returns the sine function.' },\n  {\n    text: 'split',\n    hint:\n      'Splits a given string according to a given delimiter and returns a string array with the contained substrings.',\n  },\n  { text: 'sqrt', hint: 'Returns the square root function.' },\n  { text: 'startofday', hint: 'Returns the start of the day containing the date, shifted by an offset, if provided.' },\n  {\n    text: 'startofmonth',\n    hint: 'Returns the start of the month containing the date, shifted by an offset, if provided.',\n  },\n  {\n    text: 'startofweek',\n    hint: 'Returns the start of the week containing the date, shifted by an offset, if provided.',\n  },\n  {\n    text: 'startofyear',\n    hint: 'Returns the start of the year containing the date, shifted by an offset, if provided.',\n  },\n  {\n    text: 'stdev',\n    hint:\n      'Calculates the standard deviation of *Expr* across the group, considering the group as a [sample](https://en.wikipedia.org/wiki/Sample_%28statistics%29).',\n  },\n  {\n    text: 'stdevif',\n    hint:\n      'Calculates the [stdev](stdev-aggfunction.md) of *Expr* across the group for which *Predicate* evaluates to `true`.',\n  },\n  {\n    text: 'stdevp',\n    hint:\n      'Calculates the standard deviation of *Expr* across the group, considering the group as a [population](https://en.wikipedia.org/wiki/Statistical_population).',\n  },\n  { text: 'strcat', hint: 'Concatenates between 1 and 64 arguments.' },\n  { text: 'strcat_array', hint: 'Creates a concatenated string of array values using specified delimiter.' },\n  {\n    text: 'strcat_delim',\n    hint: 'Concatenates between 2 and 64 arguments, with delimiter, provided as first argument.',\n  },\n  { text: 'strcmp', hint: 'Compares two strings.' },\n  { text: 'string_size', hint: 'Returns the size, in bytes, of the input string.' },\n  { text: 'strlen', hint: 'Returns the length, in characters, of the input string.' },\n  { text: 'strrep', hint: 'Repeats given [string](./scalar-data-types/string.md) provided amount of times.' },\n  {\n    text: 'substring',\n    hint: 'Extracts a substring from a source string starting from some index to the end of the string.',\n  },\n  { text: 'sum', hint: 'Calculates the sum of *Expr* across the group.' },\n  { text: 'sumif', hint: 'Returns a sum of *Expr* for which *Predicate* evaluates to `true`.' },\n  { text: 'table', hint: 'References specific table using an query-time evaluated string-expression.' },\n  { text: 'tan', hint: 'Returns the tangent function.' },\n  {\n    text: 'tdigest',\n    hint: 'Calculates the Intermediate results of [`percentiles()`](percentiles-aggfunction.md) across the group.',\n  },\n  {\n    text: 'tdigest_merge',\n    hint:\n      'Merges tdigest results (scalar version of the aggregate version [`tdigest_merge()`](tdigest-merge-aggfunction.md)).',\n  },\n  { text: 'tobool', hint: 'Converts input to boolean (signed 8-bit) representation.' },\n  { text: 'todatetime', hint: 'Converts input to [datetime](./scalar-data-types/datetime.md) scalar.' },\n  { text: 'todecimal', hint: 'Converts input to decimal number representation.' },\n  {\n    text: 'todouble',\n    hint: 'Converts the input to a value of type `real`. (`todouble()` and `toreal()` are synonyms.)',\n  },\n  {\n    text: 'todynamic',\n    hint:\n      'Interprets a `string` as a [JSON value](https://json.org/) and returns the value as [`dynamic`](./scalar-data-types/dynamic.md).',\n  },\n  { text: 'toguid', hint: 'Converts input to [`guid`](./scalar-data-types/guid.md) representation.' },\n  { text: 'tohex', hint: 'Converts input to a hexadecimal string.' },\n  { text: 'toint', hint: 'Converts input to integer (signed 32-bit) number representation.' },\n  { text: 'tolong', hint: 'Converts input to long (signed 64-bit) number representation.' },\n  { text: 'tolower', hint: 'Converts input string to lower case.' },\n  { text: 'toscalar', hint: 'Returns a scalar constant value of the evaluated expression.' },\n  { text: 'tostring', hint: 'Converts input to a string representation.' },\n  { text: 'totimespan', hint: 'Converts input  to [timespan](./scalar-data-types/timespan.md) scalar.' },\n  { text: 'toupper', hint: 'Converts a string to upper case.' },\n  {\n    text: 'translate',\n    hint:\n      \"Replaces a set of characters ('searchList') with another set of characters ('replacementList') in a given a string.\\r\\nThe function searches for characters in the 'searchList' and replaces them with the corresponding characters in 'replacementList'\",\n  },\n  { text: 'treepath', hint: 'Enumerates all the path expressions that identify leaves in a dynamic object.' },\n  { text: 'trim', hint: 'Removes all leading and trailing matches of the specified regular expression.' },\n  { text: 'trim_end', hint: 'Removes trailing match of the specified regular expression.' },\n  { text: 'trim_start', hint: 'Removes leading match of the specified regular expression.' },\n  { text: 'url_decode', hint: 'The function converts encoded URL into a to regular URL representation.' },\n  {\n    text: 'url_encode',\n    hint: 'The function converts characters of the input URL into a format that can be transmitted over the Internet.',\n  },\n  {\n    text: 'variance',\n    hint:\n      'Calculates the variance of *Expr* across the group, considering the group as a [sample](https://en.wikipedia.org/wiki/Sample_%28statistics%29).',\n  },\n  {\n    text: 'varianceif',\n    hint:\n      'Calculates the [variance](variance-aggfunction.md) of *Expr* across the group for which *Predicate* evaluates to `true`.',\n  },\n  {\n    text: 'variancep',\n    hint:\n      'Calculates the variance of *Expr* across the group, considering the group as a [population](https://en.wikipedia.org/wiki/Statistical_population).',\n  },\n  { text: 'weekofyear', hint: 'Returns the integer number represents the week number.' },\n  {\n    text: 'welch_test',\n    hint: 'Computes the p_value of the [Welch-test function](https://en.wikipedia.org/wiki/Welch%27s_t-test)',\n  },\n  {\n    text: 'zip',\n    hint:\n      'The `zip` function accepts any number of `dynamic` arrays, and returns an\\r\\narray whose elements are each an array holding the elements of the input\\r\\narrays of the same index.',\n  },\n];\n\nexport const KEYWORDS = [\n  'by',\n  'on',\n  'contains',\n  'notcontains',\n  'containscs',\n  'notcontainscs',\n  'startswith',\n  'has',\n  'matches',\n  'regex',\n  'true',\n  'false',\n  'and',\n  'or',\n  'typeof',\n  'int',\n  'string',\n  'date',\n  'datetime',\n  'time',\n  'long',\n  'real',\n  'boolean',\n  'bool',\n];\n\nexport const grafanaMacros = [\n  {\n    text: '$__timeFilter',\n    display: '$__timeFilter()',\n    hint: 'Macro that uses the selected timerange in Grafana to filter the query.',\n  },\n  {\n    text: '$__timeTo',\n    display: '$__timeTo()',\n    hint: 'Returns the From datetime from the Grafana picker. Example: datetime(2018-06-05T20:09:58.907Z).',\n  },\n  {\n    text: '$__timeFrom',\n    display: '$__timeFrom()',\n    hint: 'Returns the From datetime from the Grafana picker. Example: datetime(2018-06-05T18:09:58.907Z).',\n  },\n  {\n    text: '$__escapeMulti',\n    display: '$__escapeMulti()',\n    hint: 'Macro to escape multi-value template variables that contain illegal characters.',\n  },\n  { text: '$__contains', display: '$__contains()', hint: 'Macro for multi-value template variables.' },\n];\n\n// Kusto operators\n// export const OPERATORS = ['+', '-', '*', '/', '>', '<', '==', '<>', '<=', '>=', '~', '!~'];\n\nexport const DURATION = ['SECONDS', 'MINUTES', 'HOURS', 'DAYS', 'WEEKS', 'MONTHS', 'YEARS'];\n\nconst tokenizer = {\n  comment: {\n    pattern: /(^|[^\\\\:])\\/\\/.*/,\n    lookbehind: true,\n    greedy: true,\n  },\n  'function-context': {\n    pattern: /[a-z0-9_]+\\([^)]*\\)?/i,\n    inside: {},\n  },\n  duration: {\n    pattern: new RegExp(`${DURATION.join('?|')}?`, 'i'),\n    alias: 'number',\n  },\n  builtin: new RegExp(`\\\\b(?:${functionTokens.map(f => f.text).join('|')})(?=\\\\s*\\\\()`, 'i'),\n  string: {\n    pattern: /([\"'])(?:\\\\(?:\\r\\n|[\\s\\S])|(?!\\1)[^\\\\\\r\\n])*\\1/,\n    greedy: true,\n  },\n  keyword: new RegExp(`\\\\b(?:${KEYWORDS.join('|')}|${operatorTokens.map(f => f.text).join('|')}|\\\\*)\\\\b`, 'i'),\n  boolean: /\\b(?:true|false)\\b/,\n  number: /\\b0x[\\da-f]+\\b|(?:\\b\\d+\\.?\\d*|\\B\\.\\d+)(?:e[+-]?\\d+)?/i,\n  operator: /-|\\+|\\*|\\/|>|<|==|<=?|>=?|<>|!~|~|=|\\|/,\n  punctuation: /[{};(),.:]/,\n  variable: /(\\[\\[(.+?)\\]\\])|(\\$(.+?))\\b/,\n};\n\ntokenizer['function-context'].inside = {\n  argument: {\n    pattern: /[a-z0-9_]+(?=:)/i,\n    alias: 'symbol',\n  },\n  duration: tokenizer.duration,\n  number: tokenizer.number,\n  builtin: tokenizer.builtin,\n  string: tokenizer.string,\n  variable: tokenizer.variable,\n};\n\n// console.log(tokenizer.builtin);\n\nexport default tokenizer;\n\n// function escapeRegExp(str: string): string {\n//   return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n// }\n","import _ from 'lodash';\nimport Plain from 'slate-plain-serializer';\n\nimport QueryField from './query_field';\nimport debounce from 'lodash/debounce';\nimport { DOMUtil } from '@grafana/ui';\nimport { Editor as CoreEditor } from 'slate';\n\nimport { KEYWORDS, functionTokens, operatorTokens, grafanaMacros } from './kusto/kusto';\n// import '../sass/editor.base.scss';\n\nconst TYPEAHEAD_DELAY = 100;\n\ninterface Suggestion {\n  text: string;\n  deleteBackwards?: number;\n  type?: string;\n}\n\ninterface SuggestionGroup {\n  label: string;\n  items: Suggestion[];\n  prefixMatch?: boolean;\n  skipFilter?: boolean;\n}\n\ninterface KustoSchema {\n  Databases: {\n    Default?: KustoDBSchema;\n  };\n  Plugins?: any[];\n}\n\ninterface KustoDBSchema {\n  Name?: string;\n  Functions?: any;\n  Tables?: any;\n}\n\nconst defaultSchema: any = () => ({\n  Databases: {\n    Default: {},\n  },\n});\n\nconst cleanText = (s: string) => s.replace(/[{}[\\]=\"(),!~+\\-*/^%]/g, '').trim();\nconst wrapText = (text: string) => ({ text });\n\nexport default class KustoQueryField extends QueryField {\n  fields: any;\n  events: any;\n  schema: KustoSchema;\n\n  constructor(props: any, context: any) {\n    super(props, context);\n    this.schema = defaultSchema();\n\n    this.onTypeahead = debounce(this.onTypeahead, TYPEAHEAD_DELAY);\n  }\n\n  componentDidMount() {\n    super.componentDidMount();\n    this.fetchSchema();\n  }\n\n  onTypeahead = (force = false) => {\n    const selection = window.getSelection();\n    if (selection.anchorNode) {\n      const wrapperNode = selection.anchorNode.parentElement;\n      if (wrapperNode === null) {\n        return;\n      }\n      const editorNode = wrapperNode.closest('.slate-query-field');\n      if (!editorNode || this.state.value.isBlurred) {\n        // Not inside this editor\n        return;\n      }\n\n      // DOM ranges\n      const range = selection.getRangeAt(0);\n      const text = selection.anchorNode.textContent;\n      if (text === null) {\n        return;\n      }\n      const offset = range.startOffset;\n      let prefix = cleanText(text.substr(0, offset));\n\n      // Model ranges\n      const modelOffset = this.state.value.anchorOffset;\n      const modelPrefix = this.state.value.anchorText.text.slice(0, modelOffset);\n\n      // Determine candidates by context\n      let suggestionGroups: SuggestionGroup[] = [];\n      const wrapperClasses = wrapperNode.classList;\n      let typeaheadContext: string | null = null;\n\n      // Built-in functions\n      if (wrapperClasses.contains('function-context')) {\n        typeaheadContext = 'context-function';\n        suggestionGroups = this.getColumnSuggestions();\n\n        // where\n      } else if (modelPrefix.match(/(where\\s(\\w+\\b)?$)/i)) {\n        typeaheadContext = 'context-where';\n        suggestionGroups = this.getColumnSuggestions();\n\n        // summarize by\n      } else if (modelPrefix.match(/(summarize\\s(\\w+\\b)?$)/i)) {\n        typeaheadContext = 'context-summarize';\n        suggestionGroups = this.getFunctionSuggestions();\n      } else if (modelPrefix.match(/(summarize\\s(.+\\s)?by\\s+([^,\\s]+,\\s*)*([^,\\s]+\\b)?$)/i)) {\n        typeaheadContext = 'context-summarize-by';\n        suggestionGroups = this.getColumnSuggestions();\n\n        // order by, top X by, ... by ...\n      } else if (modelPrefix.match(/(by\\s+([^,\\s]+,\\s*)*([^,\\s]+\\b)?$)/i)) {\n        typeaheadContext = 'context-by';\n        suggestionGroups = this.getColumnSuggestions();\n\n        // join\n      } else if (modelPrefix.match(/(on\\s(.+\\b)?$)/i)) {\n        typeaheadContext = 'context-join-on';\n        suggestionGroups = this.getColumnSuggestions();\n      } else if (modelPrefix.match(/(join\\s+(\\(\\s+)?(\\w+\\b)?$)/i)) {\n        typeaheadContext = 'context-join';\n        suggestionGroups = this.getTableSuggestions();\n\n        // distinct\n      } else if (modelPrefix.match(/(distinct\\s(.+\\b)?$)/i)) {\n        typeaheadContext = 'context-distinct';\n        suggestionGroups = this.getColumnSuggestions();\n\n        // database()\n      } else if (modelPrefix.match(/(database\\(\\\"(\\w+)\\\"\\)\\.(.+\\b)?$)/i)) {\n        typeaheadContext = 'context-database-table';\n        const db = this.getDBFromDatabaseFunction(modelPrefix);\n        console.log(db);\n        suggestionGroups = this.getTableSuggestions(db);\n        prefix = prefix.replace('.', '');\n\n        // new\n      } else if (normalizeQuery(Plain.serialize(this.state.value)).match(/^\\s*\\w*$/i)) {\n        typeaheadContext = 'context-new';\n        if (this.schema) {\n          suggestionGroups = this.getInitialSuggestions();\n        } else {\n          this.fetchSchema();\n          setTimeout(this.onTypeahead, 0);\n          return;\n        }\n\n        // built-in\n      } else if (prefix && !wrapperClasses.contains('argument') && !force) {\n        // Use only last typed word as a prefix for searching\n        if (modelPrefix.match(/\\s$/i)) {\n          prefix = '';\n          return;\n        }\n        prefix = getLastWord(prefix);\n        typeaheadContext = 'context-builtin';\n        suggestionGroups = this.getKeywordSuggestions();\n      } else if (force === true) {\n        typeaheadContext = 'context-builtin-forced';\n        if (modelPrefix.match(/\\s$/i)) {\n          prefix = '';\n        }\n        suggestionGroups = this.getKeywordSuggestions();\n      }\n\n      let results = 0;\n      prefix = prefix.toLowerCase();\n      const filteredSuggestions = suggestionGroups\n        .map(group => {\n          if (group.items && prefix && !group.skipFilter) {\n            group.items = group.items.filter(c => c.text.length >= prefix.length);\n            if (group.prefixMatch) {\n              group.items = group.items.filter(c => c.text.toLowerCase().indexOf(prefix) === 0);\n            } else {\n              group.items = group.items.filter(c => c.text.toLowerCase().indexOf(prefix) > -1);\n            }\n          }\n          results += group.items.length;\n          return group;\n        })\n        .filter(group => group.items.length > 0);\n\n      // console.log('onTypeahead', selection.anchorNode, wrapperClasses, text, offset, prefix, typeaheadContext);\n      // console.log('onTypeahead', prefix, typeaheadContext, force);\n\n      this.setState({\n        typeaheadPrefix: prefix,\n        typeaheadContext,\n        typeaheadText: text,\n        suggestions: results > 0 ? filteredSuggestions : [],\n      });\n    }\n  };\n\n  applyTypeahead = (editor: CoreEditor, suggestion: { text: any; type: string; deleteBackwards: any }): CoreEditor => {\n    const { typeaheadPrefix, typeaheadContext, typeaheadText } = this.state;\n    let suggestionText = suggestion.text || suggestion;\n    const move = 0;\n\n    // Modify suggestion based on context\n\n    const nextChar = DOMUtil.getNextCharacter();\n    if (suggestion.type === 'function') {\n      if (!nextChar || nextChar !== '(') {\n        suggestionText += '(';\n      }\n    } else if (typeaheadContext === 'context-function') {\n      if (!nextChar || nextChar !== ')') {\n        suggestionText += ')';\n      }\n    } else {\n      if (!nextChar || nextChar !== ' ') {\n        suggestionText += ' ';\n      }\n    }\n\n    // Remove the current, incomplete text and replace it with the selected suggestion\n    const backward = suggestion.deleteBackwards || typeaheadPrefix.length;\n    const text = cleanText(typeaheadText);\n    const suffixLength = text.length - typeaheadPrefix.length;\n    const offset = typeaheadText.indexOf(typeaheadPrefix);\n    const midWord = typeaheadPrefix && ((suffixLength > 0 && offset > -1) || suggestionText === typeaheadText);\n    const forward = midWord ? suffixLength + offset : 0;\n\n    this.resetTypeahead(() =>\n      editor\n        .deleteBackward(backward)\n        .deleteForward(forward)\n        .insertText(suggestionText)\n        .moveForward(move)\n        .focus()\n    );\n\n    return editor;\n  };\n\n  // private _getFieldsSuggestions(): SuggestionGroup[] {\n  //   return [\n  //     {\n  //       prefixMatch: true,\n  //       label: 'Fields',\n  //       items: this.fields.map(wrapText)\n  //     },\n  //     {\n  //       prefixMatch: true,\n  //       label: 'Variables',\n  //       items: this.props.templateVariables.map(wrapText)\n  //     }\n  //   ];\n  // }\n\n  // private _getAfterFromSuggestions(): SuggestionGroup[] {\n  //   return [\n  //     {\n  //       skipFilter: true,\n  //       label: 'Events',\n  //       items: this.events.map(wrapText)\n  //     },\n  //     {\n  //       prefixMatch: true,\n  //       label: 'Variables',\n  //       items: this.props.templateVariables\n  //         .map(wrapText)\n  //         .map(suggestion => {\n  //           suggestion.deleteBackwards = 0;\n  //           return suggestion;\n  //         })\n  //     }\n  //   ];\n  // }\n\n  // private _getAfterSelectSuggestions(): SuggestionGroup[] {\n  //   return [\n  //     {\n  //       prefixMatch: true,\n  //       label: 'Fields',\n  //       items: this.fields.map(wrapText)\n  //     },\n  //     {\n  //       prefixMatch: true,\n  //       label: 'Functions',\n  //       items: FUNCTIONS.map((s: any) => { s.type = 'function'; return s; })\n  //     },\n  //     {\n  //       prefixMatch: true,\n  //       label: 'Variables',\n  //       items: this.props.templateVariables.map(wrapText)\n  //     }\n  //   ];\n  // }\n\n  private getInitialSuggestions(): SuggestionGroup[] {\n    return this.getTableSuggestions();\n  }\n\n  private getKeywordSuggestions(): SuggestionGroup[] {\n    return [\n      {\n        prefixMatch: true,\n        label: 'Keywords',\n        items: KEYWORDS.map(wrapText),\n      },\n      {\n        prefixMatch: true,\n        label: 'Operators',\n        items: operatorTokens,\n      },\n      {\n        prefixMatch: true,\n        label: 'Functions',\n        items: functionTokens.map((s: any) => {\n          s.type = 'function';\n          return s;\n        }),\n      },\n      {\n        prefixMatch: true,\n        label: 'Macros',\n        items: grafanaMacros.map((s: any) => {\n          s.type = 'function';\n          return s;\n        }),\n      },\n      {\n        prefixMatch: true,\n        label: 'Tables',\n        items: _.map(this.schema.Databases.Default.Tables, (t: any) => ({ text: t.Name })),\n      },\n    ];\n  }\n\n  private getFunctionSuggestions(): SuggestionGroup[] {\n    return [\n      {\n        prefixMatch: true,\n        label: 'Functions',\n        items: functionTokens.map((s: any) => {\n          s.type = 'function';\n          return s;\n        }),\n      },\n      {\n        prefixMatch: true,\n        label: 'Macros',\n        items: grafanaMacros.map((s: any) => {\n          s.type = 'function';\n          return s;\n        }),\n      },\n    ];\n  }\n\n  getTableSuggestions(db = 'Default'): SuggestionGroup[] {\n    // @ts-ignore\n    if (this.schema.Databases[db]) {\n      return [\n        {\n          prefixMatch: true,\n          label: 'Tables',\n          // @ts-ignore\n          items: _.map(this.schema.Databases[db].Tables, (t: any) => ({ text: t.Name })),\n        },\n      ];\n    } else {\n      return [];\n    }\n  }\n\n  private getColumnSuggestions(): SuggestionGroup[] {\n    const table = this.getTableFromContext();\n    if (table) {\n      const tableSchema = this.schema.Databases.Default.Tables[table];\n      if (tableSchema) {\n        return [\n          {\n            prefixMatch: true,\n            label: 'Fields',\n            items: _.map(tableSchema.OrderedColumns, (f: any) => ({\n              text: f.Name,\n              hint: f.Type,\n            })),\n          },\n        ];\n      }\n    }\n    return [];\n  }\n\n  private getTableFromContext() {\n    const query = Plain.serialize(this.state.value);\n    const tablePattern = /^\\s*(\\w+)\\s*|/g;\n    const normalizedQuery = normalizeQuery(query);\n    const match = tablePattern.exec(normalizedQuery);\n    if (match && match.length > 1 && match[0] && match[1]) {\n      return match[1];\n    } else {\n      return null;\n    }\n  }\n\n  private getDBFromDatabaseFunction(prefix: string) {\n    const databasePattern = /database\\(\\\"(\\w+)\\\"\\)/gi;\n    const match = databasePattern.exec(prefix);\n    if (match && match.length > 1 && match[0] && match[1]) {\n      return match[1];\n    } else {\n      return null;\n    }\n  }\n\n  private async fetchSchema() {\n    let schema = await this.props.getSchema();\n    if (schema) {\n      if (schema.Type === 'AppInsights') {\n        schema = castSchema(schema);\n      }\n      this.schema = schema;\n    } else {\n      this.schema = defaultSchema();\n    }\n  }\n}\n\n/**\n * Cast schema from App Insights to default Kusto schema\n */\nfunction castSchema(schema: any) {\n  const defaultSchemaTemplate = defaultSchema();\n  defaultSchemaTemplate.Databases.Default = schema;\n  return defaultSchemaTemplate;\n}\n\nfunction normalizeQuery(query: string): string {\n  const commentPattern = /\\/\\/.*$/gm;\n  let normalizedQuery = query.replace(commentPattern, '');\n  normalizedQuery = normalizedQuery.replace('\\n', ' ');\n  return normalizedQuery;\n}\n\nfunction getLastWord(str: string): string {\n  const lastWordPattern = /(?:.*\\s)?([^\\s]+\\s*)$/gi;\n  const match = lastWordPattern.exec(str);\n  if (match && match.length > 1) {\n    return match[1];\n  }\n  return '';\n}\n","import KustoQueryField from './KustoQueryField';\nimport Kusto from './kusto/kusto';\n\nimport React, { Component } from 'react';\nimport coreModule from 'app/core/core_module';\n\ninterface EditorProps {\n  index: number;\n  placeholder?: string;\n  change: (value: string, index: number) => void;\n  variables: () => string[] | string[];\n  getSchema?: () => Promise<any>;\n  execute?: () => void;\n  query?: string;\n}\n\nclass Editor extends Component<EditorProps, any> {\n  static defaultProps = {\n    placeholder: 'Enter a query',\n  };\n\n  constructor(props: EditorProps) {\n    super(props);\n    this.state = {\n      edited: false,\n      query: props.query || '',\n    };\n  }\n\n  onChangeQuery = (value: any) => {\n    const { index, change } = this.props;\n    const { query } = this.state;\n    const edited = query !== value;\n    this.setState({ edited, query: value });\n    if (change) {\n      change(value, index);\n    }\n  };\n\n  onPressEnter = () => {\n    const { execute } = this.props;\n    if (execute) {\n      execute();\n    }\n  };\n\n  render() {\n    const { variables, getSchema, placeholder } = this.props;\n    const { edited, query } = this.state;\n\n    return (\n      <div className=\"gf-form-input\" style={{ height: 'auto' }}>\n        <KustoQueryField\n          initialQuery={edited ? null : query}\n          onPressEnter={this.onPressEnter}\n          onQueryChange={this.onChangeQuery}\n          prismLanguage=\"kusto\"\n          prismDefinition={Kusto}\n          placeholder={placeholder}\n          templateVariables={variables}\n          getSchema={getSchema}\n        />\n      </div>\n    );\n  }\n}\n\ncoreModule.directive('kustoEditor', [\n  'reactDirective',\n  reactDirective => {\n    return reactDirective(Editor, [\n      'change',\n      'database',\n      'execute',\n      'query',\n      'variables',\n      'placeholder',\n      ['getSchema', { watchDepth: 'reference' }],\n    ]);\n  },\n]);\n","import _ from 'lodash';\nimport { QueryCtrl } from 'app/plugins/sdk';\n// import './css/query_editor.css';\nimport TimegrainConverter from './time_grain_converter';\nimport './editor/editor_component';\nimport kbn from 'app/core/utils/kbn';\n\nimport { TemplateSrv } from 'app/features/templating/template_srv';\nimport { auto, IPromise } from 'angular';\nimport { DataFrame } from '@grafana/data';\nimport { PanelEvents } from '@grafana/ui';\n\nexport interface ResultFormat {\n  text: string;\n  value: string;\n}\n\nexport class AzureMonitorQueryCtrl extends QueryCtrl {\n  static templateUrl = 'partials/query.editor.html';\n\n  defaultDropdownValue = 'select';\n\n  target: {\n    refId: string;\n    queryType: string;\n    subscription: string;\n    azureMonitor: {\n      resourceGroup: string;\n      resourceName: string;\n      metricDefinition: string;\n      metricNamespace: string;\n      metricName: string;\n      dimensionFilter: string;\n      timeGrain: string;\n      timeGrainUnit: string;\n      allowedTimeGrainsMs: number[];\n      dimensions: any[];\n      dimension: any;\n      top: string;\n      aggregation: string;\n      aggOptions: string[];\n      timeGrains: Array<{ text: string; value: string }>;\n    };\n    azureLogAnalytics: {\n      query: string;\n      resultFormat: string;\n      workspace: string;\n    };\n    appInsights: {\n      rawQuery: boolean;\n      // metric style query when rawQuery == false\n      metricName: string;\n      dimension: any;\n      dimensionFilter: string;\n      dimensions: string[];\n\n      aggOptions: string[];\n      aggregation: string;\n\n      timeGrainType: string;\n      timeGrainCount: string;\n      timeGrainUnit: string;\n      timeGrain: string;\n      timeGrains: Array<{ text: string; value: string }>;\n      allowedTimeGrainsMs: number[];\n\n      // query style query when rawQuery == true\n      rawQueryString: string;\n      timeColumn: string;\n      valueColumn: string;\n      segmentColumn: string;\n    };\n  };\n\n  defaults = {\n    queryType: 'Azure Monitor',\n    azureMonitor: {\n      resourceGroup: this.defaultDropdownValue,\n      metricDefinition: this.defaultDropdownValue,\n      resourceName: this.defaultDropdownValue,\n      metricNamespace: this.defaultDropdownValue,\n      metricName: this.defaultDropdownValue,\n      dimensionFilter: '*',\n      timeGrain: 'auto',\n      top: '10',\n      aggOptions: [] as string[],\n      timeGrains: [] as string[],\n    },\n    azureLogAnalytics: {\n      query: [\n        '//change this example to create your own time series query',\n        '<table name>                                                              ' +\n          '//the table to query (e.g. Usage, Heartbeat, Perf)',\n        '| where $__timeFilter(TimeGenerated)                                      ' +\n          '//this is a macro used to show the full charts time range, choose the datetime column here',\n        '| summarize count() by <group by column>, bin(TimeGenerated, $__interval) ' +\n          '//change group by column to a column in your table, such as Computer. ' +\n          'The $__interval macro is used to auto-select the time grain. Can also use 1h, 5m etc.',\n        '| order by TimeGenerated asc',\n      ].join('\\n'),\n      resultFormat: 'time_series',\n      workspace:\n        this.datasource && this.datasource.azureLogAnalyticsDatasource\n          ? this.datasource.azureLogAnalyticsDatasource.defaultOrFirstWorkspace\n          : '',\n    },\n    appInsights: {\n      metricName: this.defaultDropdownValue,\n      rawQuery: false,\n      rawQueryString: '',\n      dimension: 'none',\n      timeGrain: 'auto',\n      timeColumn: 'timestamp',\n      valueColumn: '',\n    },\n  };\n\n  resultFormats: ResultFormat[];\n  workspaces: any[];\n  showHelp: boolean;\n  showLastQuery: boolean;\n  lastQuery: string;\n  lastQueryError?: string;\n  subscriptions: Array<{ text: string; value: string }>;\n\n  /** @ngInject */\n  constructor($scope: any, $injector: auto.IInjectorService, private templateSrv: TemplateSrv) {\n    super($scope, $injector);\n\n    _.defaultsDeep(this.target, this.defaults);\n\n    this.migrateTimeGrains();\n\n    this.migrateToFromTimes();\n\n    this.migrateToDefaultNamespace();\n\n    this.migrateApplicationInsightsKeys();\n\n    this.panelCtrl.events.on(PanelEvents.dataReceived, this.onDataReceived.bind(this), $scope);\n    this.panelCtrl.events.on(PanelEvents.dataError, this.onDataError.bind(this), $scope);\n    this.resultFormats = [{ text: 'Time series', value: 'time_series' }, { text: 'Table', value: 'table' }];\n    this.getSubscriptions();\n    if (this.target.queryType === 'Azure Log Analytics') {\n      this.getWorkspaces();\n    }\n  }\n\n  onDataReceived(dataList: DataFrame[]) {\n    this.lastQueryError = undefined;\n    this.lastQuery = '';\n\n    const anySeriesFromQuery: any = _.find(dataList, { refId: this.target.refId });\n    if (anySeriesFromQuery && anySeriesFromQuery.meta) {\n      this.lastQuery = anySeriesFromQuery.meta.query;\n    }\n  }\n\n  onDataError(err: any) {\n    this.handleQueryCtrlError(err);\n  }\n\n  handleQueryCtrlError(err: any) {\n    if (err.query && err.query.refId && err.query.refId !== this.target.refId) {\n      return;\n    }\n\n    if (err.error && err.error.data && err.error.data.error && err.error.data.error.innererror) {\n      if (err.error.data.error.innererror.innererror) {\n        this.lastQueryError = err.error.data.error.innererror.innererror.message;\n      } else {\n        this.lastQueryError = err.error.data.error.innererror.message;\n      }\n    } else if (err.error && err.error.data && err.error.data.error) {\n      this.lastQueryError = err.error.data.error.message;\n    } else if (err.error && err.error.data) {\n      this.lastQueryError = err.error.data.message;\n    } else if (err.data && err.data.error) {\n      this.lastQueryError = err.data.error.message;\n    } else if (err.data && err.data.message) {\n      this.lastQueryError = err.data.message;\n    } else {\n      this.lastQueryError = err;\n    }\n  }\n\n  migrateTimeGrains() {\n    if (this.target.azureMonitor.timeGrainUnit) {\n      if (this.target.azureMonitor.timeGrain !== 'auto') {\n        this.target.azureMonitor.timeGrain = TimegrainConverter.createISO8601Duration(\n          this.target.azureMonitor.timeGrain,\n          this.target.azureMonitor.timeGrainUnit\n        );\n      }\n\n      delete this.target.azureMonitor.timeGrainUnit;\n      this.onMetricNameChange();\n    }\n\n    if (this.target.appInsights.timeGrainUnit) {\n      if (this.target.appInsights.timeGrain !== 'auto') {\n        if (this.target.appInsights.timeGrainCount) {\n          this.target.appInsights.timeGrain = TimegrainConverter.createISO8601Duration(\n            this.target.appInsights.timeGrainCount,\n            this.target.appInsights.timeGrainUnit\n          );\n        } else {\n          this.target.appInsights.timeGrainCount = this.target.appInsights.timeGrain;\n          this.target.appInsights.timeGrain = TimegrainConverter.createISO8601Duration(\n            this.target.appInsights.timeGrain,\n            this.target.appInsights.timeGrainUnit\n          );\n        }\n      }\n    }\n\n    if (\n      this.target.azureMonitor.timeGrains &&\n      this.target.azureMonitor.timeGrains.length > 0 &&\n      (!this.target.azureMonitor.allowedTimeGrainsMs || this.target.azureMonitor.allowedTimeGrainsMs.length === 0)\n    ) {\n      this.target.azureMonitor.allowedTimeGrainsMs = this.convertTimeGrainsToMs(this.target.azureMonitor.timeGrains);\n    }\n\n    if (\n      this.target.appInsights.timeGrains &&\n      this.target.appInsights.timeGrains.length > 0 &&\n      (!this.target.appInsights.allowedTimeGrainsMs || this.target.appInsights.allowedTimeGrainsMs.length === 0)\n    ) {\n      this.target.appInsights.allowedTimeGrainsMs = this.convertTimeGrainsToMs(this.target.appInsights.timeGrains);\n    }\n  }\n\n  migrateToFromTimes() {\n    this.target.azureLogAnalytics.query = this.target.azureLogAnalytics.query.replace(/\\$__from\\s/gi, '$__timeFrom() ');\n    this.target.azureLogAnalytics.query = this.target.azureLogAnalytics.query.replace(/\\$__to\\s/gi, '$__timeTo() ');\n  }\n\n  async migrateToDefaultNamespace() {\n    if (\n      this.target.azureMonitor.metricNamespace &&\n      this.target.azureMonitor.metricNamespace !== this.defaultDropdownValue &&\n      this.target.azureMonitor.metricDefinition\n    ) {\n      return;\n    }\n\n    this.target.azureMonitor.metricNamespace = this.target.azureMonitor.metricDefinition;\n  }\n\n  migrateApplicationInsightsKeys(): void {\n    const appInsights = this.target.appInsights as any;\n\n    // Migrate old app insights data keys to match other datasources\n    const mappings = {\n      xaxis: 'timeColumn',\n      yaxis: 'valueColumn',\n      spliton: 'segmentColumn',\n      groupBy: 'dimension',\n      groupByOptions: 'dimensions',\n      filter: 'dimensionFilter',\n    } as { [old: string]: string };\n\n    for (const old in mappings) {\n      if (appInsights[old]) {\n        appInsights[mappings[old]] = appInsights[old];\n        delete appInsights[old];\n      }\n    }\n  }\n\n  replace(variable: string) {\n    return this.templateSrv.replace(variable, this.panelCtrl.panel.scopedVars);\n  }\n\n  onQueryTypeChange() {\n    if (this.target.queryType === 'Azure Log Analytics') {\n      return this.getWorkspaces();\n    }\n  }\n\n  getSubscriptions() {\n    if (!this.datasource.azureMonitorDatasource.isConfigured()) {\n      return;\n    }\n\n    return this.datasource.azureMonitorDatasource.getSubscriptions().then((subs: any) => {\n      this.subscriptions = subs;\n      if (!this.target.subscription && this.target.queryType === 'Azure Monitor') {\n        this.target.subscription = this.datasource.azureMonitorDatasource.subscriptionId;\n      } else if (!this.target.subscription && this.target.queryType === 'Azure Log Analytics') {\n        this.target.subscription = this.datasource.azureLogAnalyticsDatasource.logAnalyticsSubscriptionId;\n      }\n\n      if (!this.target.subscription && this.subscriptions.length > 0) {\n        this.target.subscription = this.subscriptions[0].value;\n      }\n\n      return this.subscriptions;\n    });\n  }\n\n  onSubscriptionChange() {\n    if (this.target.queryType === 'Azure Log Analytics') {\n      return this.getWorkspaces();\n    }\n\n    if (this.target.queryType === 'Azure Monitor') {\n      this.target.azureMonitor.resourceGroup = this.defaultDropdownValue;\n      this.target.azureMonitor.metricDefinition = this.defaultDropdownValue;\n      this.target.azureMonitor.resourceName = this.defaultDropdownValue;\n      this.target.azureMonitor.metricName = this.defaultDropdownValue;\n      this.target.azureMonitor.aggregation = '';\n      this.target.azureMonitor.timeGrains = [];\n      this.target.azureMonitor.timeGrain = '';\n      this.target.azureMonitor.dimensions = [];\n      this.target.azureMonitor.dimension = '';\n    }\n  }\n\n  /* Azure Monitor Section */\n  getResourceGroups(query: any) {\n    if (this.target.queryType !== 'Azure Monitor' || !this.datasource.azureMonitorDatasource.isConfigured()) {\n      return;\n    }\n\n    return this.datasource\n      .getResourceGroups(\n        this.replace(this.target.subscription || this.datasource.azureMonitorDatasource.subscriptionId)\n      )\n      .catch(this.handleQueryCtrlError.bind(this));\n  }\n\n  getMetricDefinitions(query: any) {\n    if (\n      this.target.queryType !== 'Azure Monitor' ||\n      !this.target.azureMonitor.resourceGroup ||\n      this.target.azureMonitor.resourceGroup === this.defaultDropdownValue\n    ) {\n      return;\n    }\n    return this.datasource\n      .getMetricDefinitions(\n        this.replace(this.target.subscription || this.datasource.azureMonitorDatasource.subscriptionId),\n        this.replace(this.target.azureMonitor.resourceGroup)\n      )\n      .catch(this.handleQueryCtrlError.bind(this));\n  }\n\n  getResourceNames(query: any) {\n    if (\n      this.target.queryType !== 'Azure Monitor' ||\n      !this.target.azureMonitor.resourceGroup ||\n      this.target.azureMonitor.resourceGroup === this.defaultDropdownValue ||\n      !this.target.azureMonitor.metricDefinition ||\n      this.target.azureMonitor.metricDefinition === this.defaultDropdownValue\n    ) {\n      return;\n    }\n\n    return this.datasource\n      .getResourceNames(\n        this.replace(this.target.subscription || this.datasource.azureMonitorDatasource.subscriptionId),\n        this.replace(this.target.azureMonitor.resourceGroup),\n        this.replace(this.target.azureMonitor.metricDefinition)\n      )\n      .catch(this.handleQueryCtrlError.bind(this));\n  }\n\n  getMetricNamespaces() {\n    if (\n      this.target.queryType !== 'Azure Monitor' ||\n      !this.target.azureMonitor.resourceGroup ||\n      this.target.azureMonitor.resourceGroup === this.defaultDropdownValue ||\n      !this.target.azureMonitor.metricDefinition ||\n      this.target.azureMonitor.metricDefinition === this.defaultDropdownValue ||\n      !this.target.azureMonitor.resourceName ||\n      this.target.azureMonitor.resourceName === this.defaultDropdownValue\n    ) {\n      return;\n    }\n\n    return this.datasource\n      .getMetricNamespaces(\n        this.replace(this.target.subscription || this.datasource.azureMonitorDatasource.subscriptionId),\n        this.replace(this.target.azureMonitor.resourceGroup),\n        this.replace(this.target.azureMonitor.metricDefinition),\n        this.replace(this.target.azureMonitor.resourceName)\n      )\n      .catch(this.handleQueryCtrlError.bind(this));\n  }\n\n  getMetricNames() {\n    if (\n      this.target.queryType !== 'Azure Monitor' ||\n      !this.target.azureMonitor.resourceGroup ||\n      this.target.azureMonitor.resourceGroup === this.defaultDropdownValue ||\n      !this.target.azureMonitor.metricDefinition ||\n      this.target.azureMonitor.metricDefinition === this.defaultDropdownValue ||\n      !this.target.azureMonitor.resourceName ||\n      this.target.azureMonitor.resourceName === this.defaultDropdownValue ||\n      !this.target.azureMonitor.metricNamespace ||\n      this.target.azureMonitor.metricNamespace === this.defaultDropdownValue\n    ) {\n      return;\n    }\n\n    return this.datasource\n      .getMetricNames(\n        this.replace(this.target.subscription || this.datasource.azureMonitorDatasource.subscriptionId),\n        this.replace(this.target.azureMonitor.resourceGroup),\n        this.replace(this.target.azureMonitor.metricDefinition),\n        this.replace(this.target.azureMonitor.resourceName),\n        this.replace(this.target.azureMonitor.metricNamespace)\n      )\n      .catch(this.handleQueryCtrlError.bind(this));\n  }\n\n  onResourceGroupChange() {\n    this.target.azureMonitor.metricDefinition = this.defaultDropdownValue;\n    this.target.azureMonitor.resourceName = this.defaultDropdownValue;\n    this.target.azureMonitor.metricNamespace = this.defaultDropdownValue;\n    this.target.azureMonitor.metricName = this.defaultDropdownValue;\n    this.target.azureMonitor.aggregation = '';\n    this.target.azureMonitor.timeGrains = [];\n    this.target.azureMonitor.timeGrain = '';\n    this.target.azureMonitor.dimensions = [];\n    this.target.azureMonitor.dimension = '';\n    this.refresh();\n  }\n\n  onMetricDefinitionChange() {\n    this.target.azureMonitor.resourceName = this.defaultDropdownValue;\n    this.target.azureMonitor.metricNamespace = this.defaultDropdownValue;\n    this.target.azureMonitor.metricName = this.defaultDropdownValue;\n    this.target.azureMonitor.aggregation = '';\n    this.target.azureMonitor.timeGrains = [];\n    this.target.azureMonitor.timeGrain = '';\n    this.target.azureMonitor.dimensions = [];\n    this.target.azureMonitor.dimension = '';\n  }\n\n  onResourceNameChange() {\n    this.target.azureMonitor.metricNamespace = this.defaultDropdownValue;\n    this.target.azureMonitor.metricName = this.defaultDropdownValue;\n    this.target.azureMonitor.aggregation = '';\n    this.target.azureMonitor.timeGrains = [];\n    this.target.azureMonitor.timeGrain = '';\n    this.target.azureMonitor.dimensions = [];\n    this.target.azureMonitor.dimension = '';\n    this.refresh();\n  }\n\n  onMetricNamespacesChange() {\n    this.target.azureMonitor.metricName = this.defaultDropdownValue;\n    this.target.azureMonitor.dimensions = [];\n    this.target.azureMonitor.dimension = '';\n  }\n\n  onMetricNameChange(): IPromise<void> {\n    if (!this.target.azureMonitor.metricName || this.target.azureMonitor.metricName === this.defaultDropdownValue) {\n      return Promise.resolve();\n    }\n\n    return this.datasource\n      .getMetricMetadata(\n        this.replace(this.target.subscription),\n        this.replace(this.target.azureMonitor.resourceGroup),\n        this.replace(this.target.azureMonitor.metricDefinition),\n        this.replace(this.target.azureMonitor.resourceName),\n        this.replace(this.target.azureMonitor.metricNamespace),\n        this.replace(this.target.azureMonitor.metricName)\n      )\n      .then((metadata: any) => {\n        this.target.azureMonitor.aggOptions = metadata.supportedAggTypes || [metadata.primaryAggType];\n        this.target.azureMonitor.aggregation = metadata.primaryAggType;\n        this.target.azureMonitor.timeGrains = [{ text: 'auto', value: 'auto' }].concat(metadata.supportedTimeGrains);\n        this.target.azureMonitor.timeGrain = 'auto';\n\n        this.target.azureMonitor.allowedTimeGrainsMs = this.convertTimeGrainsToMs(metadata.supportedTimeGrains || []);\n\n        this.target.azureMonitor.dimensions = metadata.dimensions;\n        if (metadata.dimensions.length > 0) {\n          this.target.azureMonitor.dimension = metadata.dimensions[0].value;\n        }\n\n        return this.refresh();\n      })\n      .catch(this.handleQueryCtrlError.bind(this));\n  }\n\n  convertTimeGrainsToMs(timeGrains: Array<{ text: string; value: string }>) {\n    const allowedTimeGrainsMs: number[] = [];\n    timeGrains.forEach((tg: any) => {\n      if (tg.value !== 'auto') {\n        allowedTimeGrainsMs.push(kbn.interval_to_ms(TimegrainConverter.createKbnUnitFromISO8601Duration(tg.value)));\n      }\n    });\n    return allowedTimeGrainsMs;\n  }\n\n  generateAutoUnits(timeGrain: string, timeGrains: Array<{ value: string }>) {\n    if (timeGrain === 'auto') {\n      return TimegrainConverter.findClosestTimeGrain(\n        this.templateSrv.getBuiltInIntervalValue(),\n        _.map(timeGrains, o => TimegrainConverter.createKbnUnitFromISO8601Duration(o.value)) || [\n          '1m',\n          '5m',\n          '15m',\n          '30m',\n          '1h',\n          '6h',\n          '12h',\n          '1d',\n        ]\n      );\n    }\n\n    return '';\n  }\n\n  getAzureMonitorAutoInterval() {\n    return this.generateAutoUnits(this.target.azureMonitor.timeGrain, this.target.azureMonitor.timeGrains);\n  }\n\n  getApplicationInsightAutoInterval() {\n    return this.generateAutoUnits(this.target.appInsights.timeGrain, this.target.appInsights.timeGrains);\n  }\n\n  /* Azure Log Analytics */\n\n  getWorkspaces = () => {\n    return this.datasource.azureLogAnalyticsDatasource\n      .getWorkspaces(this.target.subscription)\n      .then((list: any[]) => {\n        this.workspaces = list;\n        if (list.length > 0 && !this.target.azureLogAnalytics.workspace) {\n          this.target.azureLogAnalytics.workspace = list[0].value;\n        }\n      })\n      .catch(this.handleQueryCtrlError.bind(this));\n  };\n\n  getAzureLogAnalyticsSchema = () => {\n    return this.getWorkspaces()\n      .then(() => {\n        return this.datasource.azureLogAnalyticsDatasource.getSchema(this.target.azureLogAnalytics.workspace);\n      })\n      .catch(this.handleQueryCtrlError.bind(this));\n  };\n\n  onLogAnalyticsQueryChange = (nextQuery: string) => {\n    this.target.azureLogAnalytics.query = nextQuery;\n  };\n\n  onLogAnalyticsQueryExecute = () => {\n    this.panelCtrl.refresh();\n  };\n\n  get templateVariables() {\n    return this.templateSrv.variables.map(t => '$' + t.name);\n  }\n\n  /* Application Insights Section */\n\n  getAppInsightsAutoInterval() {\n    const interval = this.templateSrv.getBuiltInIntervalValue();\n    if (interval[interval.length - 1] === 's') {\n      return '1m';\n    }\n    return interval;\n  }\n\n  getAppInsightsMetricNames() {\n    if (!this.datasource.appInsightsDatasource.isConfigured()) {\n      return;\n    }\n\n    return this.datasource.getAppInsightsMetricNames().catch(this.handleQueryCtrlError.bind(this));\n  }\n\n  getAppInsightsColumns() {\n    return this.datasource.getAppInsightsColumns(this.target.refId);\n  }\n\n  onAppInsightsColumnChange() {\n    return this.refresh();\n  }\n\n  onAppInsightsMetricNameChange() {\n    if (!this.target.appInsights.metricName || this.target.appInsights.metricName === this.defaultDropdownValue) {\n      return;\n    }\n\n    return this.datasource\n      .getAppInsightsMetricMetadata(this.replace(this.target.appInsights.metricName))\n      .then((aggData: { supportedAggTypes: string[]; supportedGroupBy: string[]; primaryAggType: string }) => {\n        this.target.appInsights.aggOptions = aggData.supportedAggTypes;\n        this.target.appInsights.dimensions = aggData.supportedGroupBy;\n        this.target.appInsights.aggregation = aggData.primaryAggType;\n        return this.refresh();\n      })\n      .catch(this.handleQueryCtrlError.bind(this));\n  }\n\n  onAppInsightsQueryChange = (nextQuery: string) => {\n    this.target.appInsights.rawQueryString = nextQuery;\n  };\n\n  onAppInsightsQueryExecute = () => {\n    return this.refresh();\n  };\n\n  getAppInsightsQuerySchema = () => {\n    return this.datasource.appInsightsDatasource.getQuerySchema().catch(this.handleQueryCtrlError.bind(this));\n  };\n\n  getAppInsightsGroupBySegments(query: any) {\n    return _.map(this.target.appInsights.dimensions, (option: string) => {\n      return { text: option, value: option };\n    });\n  }\n\n  resetAppInsightsGroupBy() {\n    this.target.appInsights.dimension = 'none';\n    this.refresh();\n  }\n\n  toggleEditorMode() {\n    this.target.appInsights.rawQuery = !this.target.appInsights.rawQuery;\n  }\n\n  updateTimeGrainType() {\n    if (this.target.appInsights.timeGrainType === 'specific') {\n      this.target.appInsights.timeGrainCount = '1';\n      this.target.appInsights.timeGrainUnit = 'minute';\n      this.target.appInsights.timeGrain = TimegrainConverter.createISO8601Duration(\n        this.target.appInsights.timeGrainCount,\n        this.target.appInsights.timeGrainUnit\n      );\n    } else {\n      this.target.appInsights.timeGrainCount = '';\n      this.target.appInsights.timeGrainUnit = '';\n    }\n  }\n\n  updateAppInsightsTimeGrain() {\n    if (this.target.appInsights.timeGrainUnit && this.target.appInsights.timeGrainCount) {\n      this.target.appInsights.timeGrain = TimegrainConverter.createISO8601Duration(\n        this.target.appInsights.timeGrainCount,\n        this.target.appInsights.timeGrainUnit\n      );\n    }\n    this.refresh();\n  }\n}\n","export default class UrlBuilder {\n  static buildAzureMonitorGetMetricNamespacesUrl(\n    baseUrl: string,\n    subscriptionId: string,\n    resourceGroup: string,\n    metricDefinition: string,\n    resourceName: string,\n    apiVersion: string\n  ) {\n    if ((metricDefinition.match(/\\//g) || []).length > 1) {\n      const rn = resourceName.split('/');\n      const service = metricDefinition.substring(metricDefinition.lastIndexOf('/') + 1);\n      const md = metricDefinition.substring(0, metricDefinition.lastIndexOf('/'));\n      return (\n        `${baseUrl}/${subscriptionId}/resourceGroups/${resourceGroup}/providers/${md}/${rn[0]}/${service}/${rn[1]}` +\n        `/providers/microsoft.insights/metricNamespaces?api-version=${apiVersion}`\n      );\n    }\n\n    return (\n      `${baseUrl}/${subscriptionId}/resourceGroups/${resourceGroup}/providers/${metricDefinition}/${resourceName}` +\n      `/providers/microsoft.insights/metricNamespaces?api-version=${apiVersion}`\n    );\n  }\n\n  static buildAzureMonitorGetMetricNamesUrl(\n    baseUrl: string,\n    subscriptionId: string,\n    resourceGroup: string,\n    metricDefinition: string,\n    resourceName: string,\n    metricNamespace: string,\n    apiVersion: string\n  ) {\n    if ((metricDefinition.match(/\\//g) || []).length > 1) {\n      const rn = resourceName.split('/');\n      const service = metricDefinition.substring(metricDefinition.lastIndexOf('/') + 1);\n      const md = metricDefinition.substring(0, metricDefinition.lastIndexOf('/'));\n      return (\n        `${baseUrl}/${subscriptionId}/resourceGroups/${resourceGroup}/providers/${md}/${rn[0]}/${service}/${rn[1]}` +\n        `/providers/microsoft.insights/metricdefinitions?api-version=${apiVersion}&metricnamespace=${encodeURIComponent(\n          metricNamespace\n        )}`\n      );\n    }\n\n    return (\n      `${baseUrl}/${subscriptionId}/resourceGroups/${resourceGroup}/providers/${metricDefinition}/${resourceName}` +\n      `/providers/microsoft.insights/metricdefinitions?api-version=${apiVersion}&metricnamespace=${encodeURIComponent(\n        metricNamespace\n      )}`\n    );\n  }\n}\n","import _ from 'lodash';\nimport TimeGrainConverter from '../time_grain_converter';\nexport default class ResponseParser {\n  static parseResponseValues(\n    result: any,\n    textFieldName: string,\n    valueFieldName: string\n  ): Array<{ text: string; value: string }> {\n    const list: Array<{ text: string; value: string }> = [];\n\n    if (!result) {\n      return list;\n    }\n\n    for (let i = 0; i < result.data.value.length; i++) {\n      if (!_.find(list, ['value', _.get(result.data.value[i], valueFieldName)])) {\n        const value = _.get(result.data.value[i], valueFieldName);\n        const text = _.get(result.data.value[i], textFieldName, value);\n\n        list.push({\n          text: text,\n          value: value,\n        });\n      }\n    }\n    return list;\n  }\n\n  static parseResourceNames(result: any, metricDefinition: string): Array<{ text: string; value: string }> {\n    const list: Array<{ text: string; value: string }> = [];\n\n    if (!result) {\n      return list;\n    }\n\n    for (let i = 0; i < result.data.value.length; i++) {\n      if (result.data.value[i].type === metricDefinition) {\n        list.push({\n          text: result.data.value[i].name,\n          value: result.data.value[i].name,\n        });\n      }\n    }\n\n    return list;\n  }\n\n  static parseMetadata(result: any, metricName: string) {\n    const defaultAggTypes = ['None', 'Average', 'Minimum', 'Maximum', 'Total', 'Count'];\n\n    if (!result) {\n      return {\n        primaryAggType: '',\n        supportedAggTypes: defaultAggTypes,\n        supportedTimeGrains: [],\n        dimensions: [],\n      };\n    }\n\n    const metricData: any = _.find(result.data.value, o => {\n      return _.get(o, 'name.value') === metricName;\n    });\n\n    return {\n      primaryAggType: metricData.primaryAggregationType,\n      supportedAggTypes: metricData.supportedAggregationTypes || defaultAggTypes,\n      supportedTimeGrains: ResponseParser.parseTimeGrains(metricData.metricAvailabilities || []),\n      dimensions: ResponseParser.parseDimensions(metricData),\n    };\n  }\n\n  static parseTimeGrains(metricAvailabilities: any[]): Array<{ text: string; value: string }> {\n    const timeGrains: any[] = [];\n    if (!metricAvailabilities) {\n      return timeGrains;\n    }\n\n    metricAvailabilities.forEach(avail => {\n      if (avail.timeGrain) {\n        timeGrains.push({\n          text: TimeGrainConverter.createTimeGrainFromISO8601Duration(avail.timeGrain),\n          value: avail.timeGrain,\n        });\n      }\n    });\n    return timeGrains;\n  }\n\n  static parseDimensions(metricData: any): Array<{ text: string; value: string }> {\n    const dimensions: Array<{ text: string; value: string }> = [];\n    if (!metricData.dimensions || metricData.dimensions.length === 0) {\n      return dimensions;\n    }\n\n    if (!metricData.isDimensionRequired) {\n      dimensions.push({ text: 'None', value: 'None' });\n    }\n\n    for (let i = 0; i < metricData.dimensions.length; i++) {\n      const text = metricData.dimensions[i].localizedValue;\n      const value = metricData.dimensions[i].value;\n\n      dimensions.push({\n        text: !text ? value : text,\n        value: value,\n      });\n    }\n    return dimensions;\n  }\n\n  static parseSubscriptions(result: any): Array<{ text: string; value: string }> {\n    const list: Array<{ text: string; value: string }> = [];\n\n    if (!result) {\n      return list;\n    }\n\n    const valueFieldName = 'subscriptionId';\n    const textFieldName = 'displayName';\n    for (let i = 0; i < result.data.value.length; i++) {\n      if (!_.find(list, ['value', _.get(result.data.value[i], valueFieldName)])) {\n        list.push({\n          text: `${_.get(result.data.value[i], textFieldName)} - ${_.get(result.data.value[i], valueFieldName)}`,\n          value: _.get(result.data.value[i], valueFieldName),\n        });\n      }\n    }\n\n    return list;\n  }\n}\n","export default class SupportedNamespaces {\n  supportedMetricNamespaces: any = {\n    azuremonitor: [\n      'Microsoft.AnalysisServices/servers',\n      'Microsoft.ApiManagement/service',\n      'Microsoft.Automation/automationAccounts',\n      'Microsoft.Batch/batchAccounts',\n      'Microsoft.Cache/redis',\n      'Microsoft.ClassicCompute/virtualMachines',\n      'Microsoft.ClassicCompute/domainNames/slots/roles',\n      'Microsoft.CognitiveServices/accounts',\n      'Microsoft.Compute/virtualMachines',\n      'Microsoft.Compute/virtualMachineScaleSets',\n      'Microsoft.ContainerInstance/containerGroups',\n      'Microsoft.ContainerRegistry/registries',\n      'Microsoft.ContainerService/managedClusters',\n      'Microsoft.CustomerInsights/hubs',\n      'Microsoft.DataBoxEdge/dataBoxEdgeDevices',\n      'Microsoft.DataFactory/datafactories',\n      'Microsoft.DataFactory/factories',\n      'Microsoft.DataLakeAnalytics/accounts',\n      'Microsoft.DataLakeStore/accounts',\n      'Microsoft.DBforMariaDB/servers',\n      'Microsoft.DBforMySQL/servers',\n      'Microsoft.DBforPostgreSQL/servers',\n      'Microsoft.Devices/IotHubs',\n      'Microsoft.Devices/provisioningServices',\n      'Microsoft.DocumentDB/databaseAccounts',\n      'Microsoft.EventGrid/topics',\n      'Microsoft.EventGrid/eventSubscriptions',\n      'Microsoft.EventGrid/extensionTopics',\n      'Microsoft.EventHub/namespaces',\n      'Microsoft.EventHub/clusters',\n      'Microsoft.HDInsight/clusters',\n      'Microsoft.Insights/AutoscaleSettings',\n      'Microsoft.Insights/components',\n      'Microsoft.KeyVault/vaults',\n      'Microsoft.Kusto/clusters',\n      'Microsoft.LocationBasedServices/accounts',\n      'Microsoft.Logic/workflows',\n      'Microsoft.Logic/integrationServiceEnvironments',\n      'Microsoft.NetApp/netAppAccounts/capacityPools',\n      'Microsoft.NetApp/netAppAccounts/capacityPools/Volumes',\n      'Microsoft.Network/networkInterfaces',\n      'Microsoft.Network/loadBalancers',\n      'Microsoft.Network/dnsZones',\n      'Microsoft.Network/publicIPAddresses',\n      'Microsoft.Network/azureFirewalls',\n      'Microsoft.Network/applicationGateways',\n      'Microsoft.Network/virtualNetworkGateways',\n      'Microsoft.Network/expressRouteCircuits',\n      'Microsoft.Network/expressRouteCircuits/Peerings',\n      'Microsoft.Network/connections',\n      'Microsoft.Network/trafficManagerProfiles',\n      'Microsoft.Network/networkWatchers/connectionMonitors',\n      'Microsoft.Network/frontdoors',\n      'Microsoft.NotificationHubs/namespaces/notificationHubs',\n      'Microsoft.OperationalInsights/workspaces',\n      'Microsoft.PowerBIDedicated/capacities',\n      'Microsoft.Relay/namespaces',\n      'Microsoft.Search/searchServices',\n      'Microsoft.ServiceBus/namespaces',\n      'Microsoft.Sql/servers/databases',\n      'Microsoft.Sql/servers/elasticPools',\n      'Microsoft.Sql/managedInstances',\n      'Microsoft.Storage/storageAccounts',\n      'Microsoft.Storage/storageAccounts/blobServices',\n      'Microsoft.Storage/storageAccounts/fileServices',\n      'Microsoft.Storage/storageAccounts/queueServices',\n      'Microsoft.Storage/storageAccounts/tableServices',\n      'Microsoft.StorageSync/storageSyncServices',\n      'Microsoft.StorageSync/storageSyncServices/syncGroups',\n      'Microsoft.StorageSync/storageSyncServices/syncGroups/serverEndpoints',\n      'Microsoft.StorageSync/storageSyncServices/registeredServers',\n      'Microsoft.StreamAnalytics/streamingJobs',\n      'Microsoft.Web/serverfarms',\n      'Microsoft.Web/sites',\n      'Microsoft.Web/sites/slots',\n      'Microsoft.Web/hostingEnvironments/multiRolePools',\n      'Microsoft.Web/hostingEnvironments/workerPools',\n    ],\n    govazuremonitor: [\n      'Microsoft.AnalysisServices/servers',\n      'Microsoft.ApiManagement/service',\n      'Microsoft.Batch/batchAccounts',\n      'Microsoft.Cache/redis',\n      'Microsoft.ClassicCompute/virtualMachines',\n      'Microsoft.ClassicCompute/domainNames/slots/roles',\n      'Microsoft.CognitiveServices/accounts',\n      'Microsoft.Compute/virtualMachines',\n      'Microsoft.Compute/virtualMachineScaleSets',\n      'Microsoft.ContainerRegistry/registries',\n      'Microsoft.DBforMySQL/servers',\n      'Microsoft.DBforPostgreSQL/servers',\n      'Microsoft.Devices/IotHubs',\n      'Microsoft.Devices/provisioningServices',\n      'Microsoft.EventGrid/topics',\n      'Microsoft.EventGrid/eventSubscriptions',\n      'Microsoft.EventGrid/extensionTopics',\n      'Microsoft.EventHub/namespaces',\n      'Microsoft.EventHub/clusters',\n      'Microsoft.Insights/AutoscaleSettings',\n      'Microsoft.KeyVault/vaults',\n      'Microsoft.Logic/workflows',\n      'Microsoft.Network/networkInterfaces',\n      'Microsoft.Network/loadBalancers',\n      'Microsoft.Network/dnsZones',\n      'Microsoft.Network/publicIPAddresses',\n      'Microsoft.Network/azureFirewalls',\n      'Microsoft.Network/applicationGateways',\n      'Microsoft.Network/virtualNetworkGateways',\n      'Microsoft.Network/expressRouteCircuits',\n      'Microsoft.Network/expressRouteCircuits/Peerings',\n      'Microsoft.Network/connections',\n      'Microsoft.Network/trafficManagerProfiles',\n      'Microsoft.Network/networkWatchers/connectionMonitors',\n      'Microsoft.Network/frontdoors',\n      'Microsoft.NotificationHubs/namespaces/notificationHubs',\n      'Microsoft.OperationalInsights/workspaces',\n      'Microsoft.PowerBIDedicated/capacities',\n      'Microsoft.Relay/namespaces',\n      'Microsoft.ServiceBus/namespaces',\n      'Microsoft.Sql/servers/databases',\n      'Microsoft.Sql/servers/elasticPools',\n      'Microsoft.Sql/managedInstances',\n      'Microsoft.Storage/storageAccounts',\n      'Microsoft.Storage/storageAccounts/blobServices',\n      'Microsoft.Storage/storageAccounts/fileServices',\n      'Microsoft.Storage/storageAccounts/queueServices',\n      'Microsoft.Storage/storageAccounts/tableServices',\n      'Microsoft.Web/serverfarms',\n      'Microsoft.Web/sites',\n      'Microsoft.Web/sites/slots',\n      'Microsoft.Web/hostingEnvironments/multiRolePools',\n      'Microsoft.Web/hostingEnvironments/workerPools',\n    ],\n    germanyazuremonitor: [\n      'Microsoft.AnalysisServices/servers',\n      'Microsoft.Batch/batchAccounts',\n      'Microsoft.Cache/redis',\n      'Microsoft.ClassicCompute/virtualMachines',\n      'Microsoft.ClassicCompute/domainNames/slots/roles',\n      'Microsoft.Compute/virtualMachines',\n      'Microsoft.Compute/virtualMachineScaleSets',\n      'Microsoft.DBforMySQL/servers',\n      'Microsoft.DBforPostgreSQL/servers',\n      'Microsoft.Devices/IotHubs',\n      'Microsoft.Devices/provisioningServices',\n      'Microsoft.EventHub/namespaces',\n      'Microsoft.EventHub/clusters',\n      'Microsoft.Insights/AutoscaleSettings',\n      'Microsoft.KeyVault/vaults',\n      'Microsoft.Network/networkInterfaces',\n      'Microsoft.Network/loadBalancers',\n      'Microsoft.Network/dnsZones',\n      'Microsoft.Network/publicIPAddresses',\n      'Microsoft.Network/azureFirewalls',\n      'Microsoft.Network/applicationGateways',\n      'Microsoft.Network/virtualNetworkGateways',\n      'Microsoft.Network/expressRouteCircuits',\n      'Microsoft.Network/expressRouteCircuits/Peerings',\n      'Microsoft.Network/connections',\n      'Microsoft.Network/trafficManagerProfiles',\n      'Microsoft.Network/networkWatchers/connectionMonitors',\n      'Microsoft.Network/frontdoors',\n      'Microsoft.NotificationHubs/namespaces/notificationHubs',\n      'Microsoft.OperationalInsights/workspaces',\n      'Microsoft.PowerBIDedicated/capacities',\n      'Microsoft.Relay/namespaces',\n      'Microsoft.ServiceBus/namespaces',\n      'Microsoft.Sql/servers/databases',\n      'Microsoft.Sql/servers/elasticPools',\n      'Microsoft.Sql/managedInstances',\n      'Microsoft.Storage/storageAccounts',\n      'Microsoft.Storage/storageAccounts/blobServices',\n      'Microsoft.Storage/storageAccounts/fileServices',\n      'Microsoft.Storage/storageAccounts/queueServices',\n      'Microsoft.Storage/storageAccounts/tableServices',\n      'Microsoft.StreamAnalytics/streamingJobs',\n      'Microsoft.Web/serverfarms',\n      'Microsoft.Web/sites',\n      'Microsoft.Web/sites/slots',\n      'Microsoft.Web/hostingEnvironments/multiRolePools',\n      'Microsoft.Web/hostingEnvironments/workerPools',\n    ],\n    chinaazuremonitor: [\n      'Microsoft.AnalysisServices/servers',\n      'Microsoft.Batch/batchAccounts',\n      'Microsoft.Cache/redis',\n      'Microsoft.ClassicCompute/virtualMachines',\n      'Microsoft.ClassicCompute/domainNames/slots/roles',\n      'Microsoft.CognitiveServices/accounts',\n      'Microsoft.Compute/virtualMachines',\n      'Microsoft.Compute/virtualMachineScaleSets',\n      'Microsoft.ContainerRegistry/registries',\n      'Microsoft.DBforMySQL/servers',\n      'Microsoft.DBforPostgreSQL/servers',\n      'Microsoft.Devices/IotHubs',\n      'Microsoft.Devices/provisioningServices',\n      'Microsoft.EventHub/namespaces',\n      'Microsoft.Insights/AutoscaleSettings',\n      'Microsoft.KeyVault/vaults',\n      'Microsoft.Logic/workflows',\n      'Microsoft.Network/networkInterfaces',\n      'Microsoft.Network/loadBalancers',\n      'Microsoft.Network/dnsZones',\n      'Microsoft.Network/publicIPAddresses',\n      'Microsoft.Network/azureFirewalls',\n      'Microsoft.Network/applicationGateways',\n      'Microsoft.Network/virtualNetworkGateways',\n      'Microsoft.Network/expressRouteCircuits',\n      'Microsoft.Network/expressRouteCircuits/Peerings',\n      'Microsoft.Network/connections',\n      'Microsoft.Network/trafficManagerProfiles',\n      'Microsoft.Network/networkWatchers/connectionMonitors',\n      'Microsoft.Network/frontdoors',\n      'Microsoft.NotificationHubs/namespaces/notificationHubs',\n      'Microsoft.PowerBIDedicated/capacities',\n      'Microsoft.Relay/namespaces',\n      'Microsoft.ServiceBus/namespaces',\n      'Microsoft.Sql/servers/databases',\n      'Microsoft.Sql/servers/elasticPools',\n      'Microsoft.Sql/managedInstances',\n      'Microsoft.Storage/storageAccounts',\n      'Microsoft.Storage/storageAccounts/blobServices',\n      'Microsoft.Storage/storageAccounts/fileServices',\n      'Microsoft.Storage/storageAccounts/queueServices',\n      'Microsoft.Storage/storageAccounts/tableServices',\n      'Microsoft.StreamAnalytics/streamingJobs',\n      'Microsoft.Web/serverfarms',\n      'Microsoft.Web/sites',\n      'Microsoft.Web/sites/slots',\n      'Microsoft.Web/hostingEnvironments/multiRolePools',\n      'Microsoft.Web/hostingEnvironments/workerPools',\n    ],\n  };\n\n  constructor(private cloudName: string) {}\n\n  get(): string[] {\n    return this.supportedMetricNamespaces[this.cloudName];\n  }\n}\n","import _ from 'lodash';\nimport UrlBuilder from './url_builder';\nimport ResponseParser from './response_parser';\nimport SupportedNamespaces from './supported_namespaces';\nimport TimegrainConverter from '../time_grain_converter';\nimport {\n  AzureMonitorQuery,\n  AzureDataSourceJsonData,\n  AzureMonitorMetricDefinitionsResponse,\n  AzureMonitorResourceGroupsResponse,\n} from '../types';\nimport { DataQueryRequest, DataQueryResponseData, DataSourceInstanceSettings } from '@grafana/ui';\n\nimport { TimeSeries, toDataFrame } from '@grafana/data';\nimport { BackendSrv } from 'app/core/services/backend_srv';\nimport { TemplateSrv } from 'app/features/templating/template_srv';\n\nexport default class AzureMonitorDatasource {\n  apiVersion = '2018-01-01';\n  apiPreviewVersion = '2017-12-01-preview';\n  id: number;\n  subscriptionId: string;\n  baseUrl: string;\n  resourceGroup: string;\n  resourceName: string;\n  url: string;\n  defaultDropdownValue = 'select';\n  cloudName: string;\n  supportedMetricNamespaces: string[] = [];\n\n  /** @ngInject */\n  constructor(\n    private instanceSettings: DataSourceInstanceSettings<AzureDataSourceJsonData>,\n    private backendSrv: BackendSrv,\n    private templateSrv: TemplateSrv\n  ) {\n    this.id = instanceSettings.id;\n    this.subscriptionId = instanceSettings.jsonData.subscriptionId;\n    this.cloudName = instanceSettings.jsonData.cloudName || 'azuremonitor';\n    this.baseUrl = `/${this.cloudName}/subscriptions`;\n    this.url = instanceSettings.url;\n\n    this.supportedMetricNamespaces = new SupportedNamespaces(this.cloudName).get();\n  }\n\n  isConfigured(): boolean {\n    return !!this.subscriptionId && this.subscriptionId.length > 0;\n  }\n\n  async query(options: DataQueryRequest<AzureMonitorQuery>): Promise<DataQueryResponseData[]> {\n    const queries = _.filter(options.targets, item => {\n      return (\n        item.hide !== true &&\n        item.azureMonitor.resourceGroup &&\n        item.azureMonitor.resourceGroup !== this.defaultDropdownValue &&\n        item.azureMonitor.resourceName &&\n        item.azureMonitor.resourceName !== this.defaultDropdownValue &&\n        item.azureMonitor.metricDefinition &&\n        item.azureMonitor.metricDefinition !== this.defaultDropdownValue &&\n        item.azureMonitor.metricName &&\n        item.azureMonitor.metricName !== this.defaultDropdownValue\n      );\n    }).map(target => {\n      const item = target.azureMonitor;\n\n      // fix for timeGrainUnit which is a deprecated/removed field name\n      if (item.timeGrainUnit && item.timeGrain !== 'auto') {\n        item.timeGrain = TimegrainConverter.createISO8601Duration(item.timeGrain, item.timeGrainUnit);\n      }\n\n      const subscriptionId = this.templateSrv.replace(target.subscription || this.subscriptionId, options.scopedVars);\n      const resourceGroup = this.templateSrv.replace(item.resourceGroup, options.scopedVars);\n      const resourceName = this.templateSrv.replace(item.resourceName, options.scopedVars);\n      const metricNamespace = this.templateSrv.replace(item.metricNamespace, options.scopedVars);\n      const metricDefinition = this.templateSrv.replace(item.metricDefinition, options.scopedVars);\n      const timeGrain = this.templateSrv.replace((item.timeGrain || '').toString(), options.scopedVars);\n      const aggregation = this.templateSrv.replace(item.aggregation, options.scopedVars);\n      const top = this.templateSrv.replace(item.top || '', options.scopedVars);\n\n      return {\n        refId: target.refId,\n        intervalMs: options.intervalMs,\n        datasourceId: this.id,\n        subscription: subscriptionId,\n        queryType: 'Azure Monitor',\n        type: 'timeSeriesQuery',\n        raw: false,\n        azureMonitor: {\n          resourceGroup: resourceGroup,\n          resourceName: resourceName,\n          metricDefinition: metricDefinition,\n          timeGrain: timeGrain,\n          allowedTimeGrainsMs: item.allowedTimeGrainsMs,\n          metricName: this.templateSrv.replace(item.metricName, options.scopedVars),\n          metricNamespace:\n            metricNamespace && metricNamespace !== this.defaultDropdownValue ? metricNamespace : metricDefinition,\n          aggregation: aggregation,\n          dimension: this.templateSrv.replace(item.dimension, options.scopedVars),\n          top: top || '10',\n          dimensionFilter: this.templateSrv.replace(item.dimensionFilter, options.scopedVars),\n          alias: item.alias,\n          format: target.format,\n        },\n      };\n    });\n\n    if (!queries || queries.length === 0) {\n      return Promise.resolve([]);\n    }\n\n    const { data } = await this.backendSrv.datasourceRequest({\n      url: '/api/tsdb/query',\n      method: 'POST',\n      data: {\n        from: options.range.from.valueOf().toString(),\n        to: options.range.to.valueOf().toString(),\n        queries,\n      },\n    });\n\n    const result: DataQueryResponseData[] = [];\n    if (data.results) {\n      Object['values'](data.results).forEach((queryRes: any) => {\n        if (!queryRes.series) {\n          return;\n        }\n        queryRes.series.forEach((series: any) => {\n          const timeSerie: TimeSeries = {\n            target: series.name,\n            datapoints: series.points,\n            refId: queryRes.refId,\n            meta: queryRes.meta,\n          };\n          result.push(toDataFrame(timeSerie));\n        });\n      });\n      return result;\n    }\n\n    return Promise.resolve([]);\n  }\n\n  annotationQuery(options: any) {}\n\n  metricFindQuery(query: string) {\n    const subscriptionsQuery = query.match(/^Subscriptions\\(\\)/i);\n    if (subscriptionsQuery) {\n      return this.getSubscriptions();\n    }\n\n    const resourceGroupsQuery = query.match(/^ResourceGroups\\(\\)/i);\n    if (resourceGroupsQuery) {\n      return this.getResourceGroups(this.subscriptionId);\n    }\n\n    const resourceGroupsQueryWithSub = query.match(/^ResourceGroups\\(([^\\)]+?)(,\\s?([^,]+?))?\\)/i);\n    if (resourceGroupsQueryWithSub) {\n      return this.getResourceGroups(this.toVariable(resourceGroupsQueryWithSub[1]));\n    }\n\n    const metricDefinitionsQuery = query.match(/^Namespaces\\(([^\\)]+?)(,\\s?([^,]+?))?\\)/i);\n    if (metricDefinitionsQuery) {\n      if (!metricDefinitionsQuery[3]) {\n        return this.getMetricDefinitions(this.subscriptionId, this.toVariable(metricDefinitionsQuery[1]));\n      }\n    }\n\n    const metricDefinitionsQueryWithSub = query.match(/^Namespaces\\(([^,]+?),\\s?([^,]+?)\\)/i);\n    if (metricDefinitionsQueryWithSub) {\n      return this.getMetricDefinitions(\n        this.toVariable(metricDefinitionsQueryWithSub[1]),\n        this.toVariable(metricDefinitionsQueryWithSub[2])\n      );\n    }\n\n    const resourceNamesQuery = query.match(/^ResourceNames\\(([^,]+?),\\s?([^,]+?)\\)/i);\n    if (resourceNamesQuery) {\n      const resourceGroup = this.toVariable(resourceNamesQuery[1]);\n      const metricDefinition = this.toVariable(resourceNamesQuery[2]);\n      return this.getResourceNames(this.subscriptionId, resourceGroup, metricDefinition);\n    }\n\n    const resourceNamesQueryWithSub = query.match(/^ResourceNames\\(([^,]+?),\\s?([^,]+?),\\s?(.+?)\\)/i);\n    if (resourceNamesQueryWithSub) {\n      const subscription = this.toVariable(resourceNamesQueryWithSub[1]);\n      const resourceGroup = this.toVariable(resourceNamesQueryWithSub[2]);\n      const metricDefinition = this.toVariable(resourceNamesQueryWithSub[3]);\n      return this.getResourceNames(subscription, resourceGroup, metricDefinition);\n    }\n\n    const metricNamespaceQuery = query.match(/^MetricNamespace\\(([^,]+?),\\s?([^,]+?),\\s?([^,]+?)\\)/i);\n    if (metricNamespaceQuery) {\n      const resourceGroup = this.toVariable(metricNamespaceQuery[1]);\n      const metricDefinition = this.toVariable(metricNamespaceQuery[2]);\n      const resourceName = this.toVariable(metricNamespaceQuery[3]);\n      return this.getMetricNamespaces(this.subscriptionId, resourceGroup, metricDefinition, resourceName);\n    }\n\n    const metricNamespaceQueryWithSub = query.match(\n      /^metricnamespace\\(([^,]+?),\\s?([^,]+?),\\s?([^,]+?),\\s?([^,]+?)\\)/i\n    );\n    if (metricNamespaceQueryWithSub) {\n      const subscription = this.toVariable(metricNamespaceQueryWithSub[1]);\n      const resourceGroup = this.toVariable(metricNamespaceQueryWithSub[2]);\n      const metricDefinition = this.toVariable(metricNamespaceQueryWithSub[3]);\n      const resourceName = this.toVariable(metricNamespaceQueryWithSub[4]);\n      return this.getMetricNamespaces(subscription, resourceGroup, metricDefinition, resourceName);\n    }\n\n    const metricNamesQuery = query.match(/^MetricNames\\(([^,]+?),\\s?([^,]+?),\\s?([^,]+?),\\s?([^,]+?)\\)/i);\n    if (metricNamesQuery) {\n      if (metricNamesQuery[3].indexOf(',') === -1) {\n        const resourceGroup = this.toVariable(metricNamesQuery[1]);\n        const metricDefinition = this.toVariable(metricNamesQuery[2]);\n        const resourceName = this.toVariable(metricNamesQuery[3]);\n        const metricNamespace = this.toVariable(metricNamesQuery[4]);\n        return this.getMetricNames(this.subscriptionId, resourceGroup, metricDefinition, resourceName, metricNamespace);\n      }\n    }\n\n    const metricNamesQueryWithSub = query.match(\n      /^MetricNames\\(([^,]+?),\\s?([^,]+?),\\s?([^,]+?),\\s?([^,]+?),\\s?(.+?)\\)/i\n    );\n\n    if (metricNamesQueryWithSub) {\n      const subscription = this.toVariable(metricNamesQueryWithSub[1]);\n      const resourceGroup = this.toVariable(metricNamesQueryWithSub[2]);\n      const metricDefinition = this.toVariable(metricNamesQueryWithSub[3]);\n      const resourceName = this.toVariable(metricNamesQueryWithSub[4]);\n      const metricNamespace = this.toVariable(metricNamesQueryWithSub[5]);\n      return this.getMetricNames(subscription, resourceGroup, metricDefinition, resourceName, metricNamespace);\n    }\n\n    return undefined;\n  }\n\n  toVariable(metric: string) {\n    return this.templateSrv.replace((metric || '').trim());\n  }\n\n  getSubscriptions(route?: string) {\n    const url = `/${route || this.cloudName}/subscriptions?api-version=2019-03-01`;\n    return this.doRequest(url).then((result: any) => {\n      return ResponseParser.parseSubscriptions(result);\n    });\n  }\n\n  getResourceGroups(subscriptionId: string) {\n    const url = `${this.baseUrl}/${subscriptionId}/resourceGroups?api-version=${this.apiVersion}`;\n    return this.doRequest(url).then((result: AzureMonitorResourceGroupsResponse) => {\n      return ResponseParser.parseResponseValues(result, 'name', 'name');\n    });\n  }\n\n  getMetricDefinitions(subscriptionId: string, resourceGroup: string) {\n    const url = `${this.baseUrl}/${subscriptionId}/resourceGroups/${resourceGroup}/resources?api-version=${\n      this.apiVersion\n    }`;\n    return this.doRequest(url)\n      .then((result: AzureMonitorMetricDefinitionsResponse) => {\n        return ResponseParser.parseResponseValues(result, 'type', 'type');\n      })\n      .then((result: any) => {\n        return _.filter(result, t => {\n          for (let i = 0; i < this.supportedMetricNamespaces.length; i++) {\n            if (t.value.toLowerCase() === this.supportedMetricNamespaces[i].toLowerCase()) {\n              return true;\n            }\n          }\n\n          return false;\n        });\n      })\n      .then((result: any) => {\n        let shouldHardcodeBlobStorage = false;\n        for (let i = 0; i < result.length; i++) {\n          if (result[i].value === 'Microsoft.Storage/storageAccounts') {\n            shouldHardcodeBlobStorage = true;\n            break;\n          }\n        }\n\n        if (shouldHardcodeBlobStorage) {\n          result.push({\n            text: 'Microsoft.Storage/storageAccounts/blobServices',\n            value: 'Microsoft.Storage/storageAccounts/blobServices',\n          });\n          result.push({\n            text: 'Microsoft.Storage/storageAccounts/fileServices',\n            value: 'Microsoft.Storage/storageAccounts/fileServices',\n          });\n          result.push({\n            text: 'Microsoft.Storage/storageAccounts/tableServices',\n            value: 'Microsoft.Storage/storageAccounts/tableServices',\n          });\n          result.push({\n            text: 'Microsoft.Storage/storageAccounts/queueServices',\n            value: 'Microsoft.Storage/storageAccounts/queueServices',\n          });\n        }\n\n        return result;\n      });\n  }\n\n  getResourceNames(subscriptionId: string, resourceGroup: string, metricDefinition: string) {\n    const url = `${this.baseUrl}/${subscriptionId}/resourceGroups/${resourceGroup}/resources?api-version=${\n      this.apiVersion\n    }`;\n\n    return this.doRequest(url).then((result: any) => {\n      if (!_.startsWith(metricDefinition, 'Microsoft.Storage/storageAccounts/')) {\n        return ResponseParser.parseResourceNames(result, metricDefinition);\n      }\n\n      const list = ResponseParser.parseResourceNames(result, 'Microsoft.Storage/storageAccounts');\n      for (let i = 0; i < list.length; i++) {\n        list[i].text += '/default';\n        list[i].value += '/default';\n      }\n\n      return list;\n    });\n  }\n\n  getMetricNamespaces(subscriptionId: string, resourceGroup: string, metricDefinition: string, resourceName: string) {\n    const url = UrlBuilder.buildAzureMonitorGetMetricNamespacesUrl(\n      this.baseUrl,\n      subscriptionId,\n      resourceGroup,\n      metricDefinition,\n      resourceName,\n      this.apiPreviewVersion\n    );\n\n    return this.doRequest(url).then((result: any) => {\n      return ResponseParser.parseResponseValues(result, 'name', 'properties.metricNamespaceName');\n    });\n  }\n\n  getMetricNames(\n    subscriptionId: string,\n    resourceGroup: string,\n    metricDefinition: string,\n    resourceName: string,\n    metricNamespace: string\n  ) {\n    const url = UrlBuilder.buildAzureMonitorGetMetricNamesUrl(\n      this.baseUrl,\n      subscriptionId,\n      resourceGroup,\n      metricDefinition,\n      resourceName,\n      metricNamespace,\n      this.apiVersion\n    );\n\n    return this.doRequest(url).then((result: any) => {\n      return ResponseParser.parseResponseValues(result, 'name.localizedValue', 'name.value');\n    });\n  }\n\n  getMetricMetadata(\n    subscriptionId: string,\n    resourceGroup: string,\n    metricDefinition: string,\n    resourceName: string,\n    metricNamespace: string,\n    metricName: string\n  ) {\n    const url = UrlBuilder.buildAzureMonitorGetMetricNamesUrl(\n      this.baseUrl,\n      subscriptionId,\n      resourceGroup,\n      metricDefinition,\n      resourceName,\n      metricNamespace,\n      this.apiVersion\n    );\n\n    return this.doRequest(url).then((result: any) => {\n      return ResponseParser.parseMetadata(result, metricName);\n    });\n  }\n\n  testDatasource() {\n    if (!this.isValidConfigField(this.instanceSettings.jsonData.tenantId)) {\n      return {\n        status: 'error',\n        message: 'The Tenant Id field is required.',\n      };\n    }\n\n    if (!this.isValidConfigField(this.instanceSettings.jsonData.clientId)) {\n      return {\n        status: 'error',\n        message: 'The Client Id field is required.',\n      };\n    }\n\n    const url = `/${this.cloudName}/subscriptions?api-version=2019-03-01`;\n    return this.doRequest(url)\n      .then((response: any) => {\n        if (response.status === 200) {\n          return {\n            status: 'success',\n            message: 'Successfully queried the Azure Monitor service.',\n            title: 'Success',\n          };\n        }\n\n        return {\n          status: 'error',\n          message: 'Returned http status code ' + response.status,\n        };\n      })\n      .catch((error: any) => {\n        let message = 'Azure Monitor: ';\n        message += error.statusText ? error.statusText + ': ' : '';\n\n        if (error.data && error.data.error && error.data.error.code) {\n          message += error.data.error.code + '. ' + error.data.error.message;\n        } else if (error.data && error.data.error) {\n          message += error.data.error;\n        } else if (error.data) {\n          message += error.data;\n        } else {\n          message += 'Cannot connect to Azure Monitor REST API.';\n        }\n        return {\n          status: 'error',\n          message: message,\n        };\n      });\n  }\n\n  isValidConfigField(field: string) {\n    return field && field.length > 0;\n  }\n\n  doRequest(url: string, maxRetries = 1) {\n    return this.backendSrv\n      .datasourceRequest({\n        url: this.url + url,\n        method: 'GET',\n      })\n      .catch((error: any) => {\n        if (maxRetries > 0) {\n          return this.doRequest(url, maxRetries - 1);\n        }\n\n        throw error;\n      });\n  }\n}\n","import _ from 'lodash';\nimport { dateTime } from '@grafana/data';\n\nexport default class ResponseParser {\n  constructor(private results: any) {}\n\n  parseQueryResult() {\n    let data: any = [];\n    let columns: any = [];\n    for (let i = 0; i < this.results.length; i++) {\n      if (this.results[i].query.raw) {\n        const xaxis = this.results[i].query.xaxis;\n        const yaxises = this.results[i].query.yaxis;\n        const spliton = this.results[i].query.spliton;\n        columns = this.results[i].result.data.Tables[0].Columns;\n        const rows = this.results[i].result.data.Tables[0].Rows;\n        data = _.concat(\n          data,\n          this.parseRawQueryResultRow(this.results[i].query, columns, rows, xaxis, yaxises, spliton)\n        );\n      } else {\n        const value = this.results[i].result.data.value;\n        const alias = this.results[i].query.alias;\n        data = _.concat(data, this.parseQueryResultRow(this.results[i].query, value, alias));\n      }\n    }\n    return data;\n  }\n\n  parseRawQueryResultRow(query: any, columns: any, rows: any, xaxis: string, yaxises: string, spliton: string) {\n    const data: any[] = [];\n    const columnsForDropdown = _.map(columns, column => ({ text: column.ColumnName, value: column.ColumnName }));\n\n    const xaxisColumn = columns.findIndex((column: any) => column.ColumnName === xaxis);\n    const yaxisesSplit = yaxises.split(',');\n    const yaxisColumns: any = {};\n    _.forEach(yaxisesSplit, yaxis => {\n      yaxisColumns[yaxis] = columns.findIndex((column: any) => column.ColumnName === yaxis);\n    });\n    const splitonColumn = columns.findIndex((column: any) => column.ColumnName === spliton);\n    const convertTimestamp = xaxis === 'timestamp';\n\n    _.forEach(rows, row => {\n      _.forEach(yaxisColumns, (yaxisColumn, yaxisName) => {\n        const bucket =\n          splitonColumn === -1\n            ? ResponseParser.findOrCreateBucket(data, yaxisName)\n            : ResponseParser.findOrCreateBucket(data, row[splitonColumn]);\n        const epoch = convertTimestamp ? ResponseParser.dateTimeToEpoch(row[xaxisColumn]) : row[xaxisColumn];\n        bucket.datapoints.push([row[yaxisColumn], epoch]);\n        bucket.refId = query.refId;\n        bucket.query = query.query;\n        bucket.columnsForDropdown = columnsForDropdown;\n      });\n    });\n\n    return data;\n  }\n\n  parseQueryResultRow(query: any, value: any, alias: string) {\n    const data: any[] = [];\n\n    if (ResponseParser.isSingleValue(value)) {\n      const metricName = ResponseParser.getMetricFieldKey(value);\n      const aggField = ResponseParser.getKeyForAggregationField(value[metricName]);\n      const epoch = ResponseParser.dateTimeToEpoch(value.end);\n      data.push({\n        target: metricName,\n        datapoints: [[value[metricName][aggField], epoch]],\n        refId: query.refId,\n        query: query.query,\n      });\n      return data;\n    }\n\n    const groupedBy = ResponseParser.hasSegmentsField(value.segments[0]);\n    if (!groupedBy) {\n      const metricName = ResponseParser.getMetricFieldKey(value.segments[0]);\n      const dataTarget = ResponseParser.findOrCreateBucket(data, metricName);\n\n      for (let i = 0; i < value.segments.length; i++) {\n        const epoch = ResponseParser.dateTimeToEpoch(value.segments[i].end);\n        const aggField: string = ResponseParser.getKeyForAggregationField(value.segments[i][metricName]);\n\n        dataTarget.datapoints.push([value.segments[i][metricName][aggField], epoch]);\n      }\n      dataTarget.refId = query.refId;\n      dataTarget.query = query.query;\n    } else {\n      for (let i = 0; i < value.segments.length; i++) {\n        const epoch = ResponseParser.dateTimeToEpoch(value.segments[i].end);\n\n        for (let j = 0; j < value.segments[i].segments.length; j++) {\n          const metricName = ResponseParser.getMetricFieldKey(value.segments[i].segments[j]);\n          const aggField = ResponseParser.getKeyForAggregationField(value.segments[i].segments[j][metricName]);\n          const target = this.getTargetName(value.segments[i].segments[j], alias);\n\n          const bucket = ResponseParser.findOrCreateBucket(data, target);\n          bucket.datapoints.push([value.segments[i].segments[j][metricName][aggField], epoch]);\n          bucket.refId = query.refId;\n          bucket.meta = {\n            query: query.query,\n          };\n        }\n      }\n    }\n\n    return data;\n  }\n\n  getTargetName(segment: { [x: string]: string }, alias: string) {\n    let metric = '';\n    let segmentName = '';\n    let segmentValue = '';\n    for (const prop in segment) {\n      if (_.isObject(segment[prop])) {\n        metric = prop;\n      } else {\n        segmentName = prop;\n        segmentValue = segment[prop];\n      }\n    }\n\n    if (alias) {\n      const regex = /\\{\\{([\\s\\S]+?)\\}\\}/g;\n      return alias.replace(regex, (match, g1, g2) => {\n        const group = g1 || g2;\n\n        if (group === 'metric') {\n          return metric;\n        } else if (group === 'groupbyname') {\n          return segmentName;\n        } else if (group === 'groupbyvalue') {\n          return segmentValue;\n        }\n\n        return match;\n      });\n    }\n\n    return metric + `{${segmentName}=\"${segmentValue}\"}`;\n  }\n\n  static isSingleValue(value: any) {\n    return !ResponseParser.hasSegmentsField(value);\n  }\n\n  static findOrCreateBucket(data: any[], target: string) {\n    let dataTarget: any = _.find(data, ['target', target]);\n    if (!dataTarget) {\n      dataTarget = { target: target, datapoints: [] };\n      data.push(dataTarget);\n    }\n\n    return dataTarget;\n  }\n\n  static hasSegmentsField(obj: any) {\n    const keys = _.keys(obj);\n    return _.indexOf(keys, 'segments') > -1;\n  }\n\n  static getMetricFieldKey(segment: { [x: string]: any }) {\n    const keys = _.keys(segment);\n\n    return _.filter(_.without(keys, 'start', 'end'), key => {\n      return _.isObject(segment[key]);\n    })[0];\n  }\n\n  static getKeyForAggregationField(dataObj: any): string {\n    const keys = _.keys(dataObj);\n    return _.intersection(keys, ['sum', 'avg', 'min', 'max', 'count', 'unique'])[0];\n  }\n\n  static dateTimeToEpoch(dateTimeValue: any) {\n    return dateTime(dateTimeValue).valueOf();\n  }\n\n  static parseMetricNames(result: { data: { metrics: any } }) {\n    const keys = _.keys(result.data.metrics);\n\n    return ResponseParser.toTextValueList(keys);\n  }\n\n  parseMetadata(metricName: string) {\n    const metric = this.results.data.metrics[metricName];\n\n    if (!metric) {\n      throw Error('No data found for metric: ' + metricName);\n    }\n\n    return {\n      primaryAggType: metric.defaultAggregation,\n      supportedAggTypes: metric.supportedAggregations,\n      supportedGroupBy: metric.supportedGroupBy.all,\n    };\n  }\n\n  parseGroupBys() {\n    return ResponseParser.toTextValueList(this.results.supportedGroupBy);\n  }\n\n  parseQuerySchema() {\n    const result: any = {\n      Type: 'AppInsights',\n      Tables: {},\n    };\n    if (this.results && this.results.data && this.results.data.Tables) {\n      for (let i = 0; i < this.results.data.Tables[0].Rows.length; i++) {\n        const column = this.results.data.Tables[0].Rows[i];\n        const columnTable = column[0];\n        const columnName = column[1];\n        const columnType = column[2];\n        if (result.Tables[columnTable]) {\n          result.Tables[columnTable].OrderedColumns.push({ Name: columnName, Type: columnType });\n        } else {\n          result.Tables[columnTable] = {\n            Name: columnTable,\n            OrderedColumns: [{ Name: columnName, Type: columnType }],\n          };\n        }\n      }\n    }\n    return result;\n  }\n\n  static toTextValueList(values: any) {\n    const list: any[] = [];\n    for (let i = 0; i < values.length; i++) {\n      list.push({\n        text: values[i],\n        value: values[i],\n      });\n    }\n    return list;\n  }\n}\n","import { dateTime } from '@grafana/data';\n\nexport default class LogAnalyticsQuerystringBuilder {\n  constructor(public rawQueryString: string, public options: any, public defaultTimeField: any) {}\n\n  generate() {\n    let queryString = this.rawQueryString;\n    const macroRegexp = /\\$__([_a-zA-Z0-9]+)\\(([^\\)]*)\\)/gi;\n    queryString = queryString.replace(macroRegexp, (match, p1, p2) => {\n      if (p1 === 'contains') {\n        return this.getMultiContains(p2);\n      }\n\n      return match;\n    });\n\n    queryString = queryString.replace(/\\$__escapeMulti\\(('[^]*')\\)/gi, (match, p1) => this.escape(p1));\n\n    if (this.options) {\n      queryString = queryString.replace(macroRegexp, (match, p1, p2) => {\n        if (p1 === 'timeFilter') {\n          return this.getTimeFilter(p2, this.options);\n        }\n        if (p1 === 'timeFrom') {\n          return this.getFrom(this.options);\n        }\n        if (p1 === 'timeTo') {\n          return this.getUntil(this.options);\n        }\n\n        return match;\n      });\n      queryString = queryString.replace(/\\$__interval/gi, this.options.interval);\n    }\n    const rawQuery = queryString;\n    queryString = encodeURIComponent(queryString);\n    const uriString = `query=${queryString}`;\n\n    return { uriString, rawQuery };\n  }\n\n  getFrom(options: any) {\n    const from = options.range.from;\n    return `datetime(${dateTime(from)\n      .startOf('minute')\n      .toISOString()})`;\n  }\n\n  getUntil(options: any) {\n    if (options.rangeRaw.to === 'now') {\n      const now = Date.now();\n      return `datetime(${dateTime(now)\n        .startOf('minute')\n        .toISOString()})`;\n    } else {\n      const until = options.range.to;\n      return `datetime(${dateTime(until)\n        .startOf('minute')\n        .toISOString()})`;\n    }\n  }\n\n  getTimeFilter(timeFieldArg: any, options: any) {\n    const timeField = timeFieldArg || this.defaultTimeField;\n    if (options.rangeRaw.to === 'now') {\n      return `${timeField} >= ${this.getFrom(options)}`;\n    } else {\n      return `${timeField}  >= ${this.getFrom(options)} and ${timeField} <= ${this.getUntil(options)}`;\n    }\n  }\n\n  getMultiContains(inputs: string) {\n    const firstCommaIndex = inputs.indexOf(',');\n    const field = inputs.substring(0, firstCommaIndex);\n    const templateVar = inputs.substring(inputs.indexOf(',') + 1);\n\n    if (templateVar && templateVar.toLowerCase().trim() === 'all') {\n      return '1 == 1';\n    }\n\n    return `${field.trim()} in (${templateVar.trim()})`;\n  }\n\n  escape(inputs: string) {\n    return inputs\n      .substring(1, inputs.length - 1)\n      .split(`','`)\n      .map(v => `@'${v}'`)\n      .join(', ');\n  }\n}\n","import { TimeSeries, toDataFrame } from '@grafana/data';\nimport { DataQueryRequest, DataQueryResponseData, DataSourceInstanceSettings } from '@grafana/ui';\nimport { BackendSrv } from 'app/core/services/backend_srv';\nimport { TemplateSrv } from 'app/features/templating/template_srv';\nimport _ from 'lodash';\n\nimport TimegrainConverter from '../time_grain_converter';\nimport { AzureDataSourceJsonData, AzureMonitorQuery } from '../types';\nimport ResponseParser from './response_parser';\n\nexport interface LogAnalyticsColumn {\n  text: string;\n  value: string;\n}\nexport default class AppInsightsDatasource {\n  id: number;\n  url: string;\n  baseUrl: string;\n  version = 'beta';\n  applicationId: string;\n  logAnalyticsColumns: { [key: string]: LogAnalyticsColumn[] } = {};\n\n  /** @ngInject */\n  constructor(\n    instanceSettings: DataSourceInstanceSettings<AzureDataSourceJsonData>,\n    private backendSrv: BackendSrv,\n    private templateSrv: TemplateSrv\n  ) {\n    this.id = instanceSettings.id;\n    this.applicationId = instanceSettings.jsonData.appInsightsAppId;\n    this.baseUrl = `/appinsights/${this.version}/apps/${this.applicationId}`;\n    this.url = instanceSettings.url;\n  }\n\n  isConfigured(): boolean {\n    return !!this.applicationId && this.applicationId.length > 0;\n  }\n\n  createRawQueryRequest(item: any, options: DataQueryRequest<AzureMonitorQuery>, target: AzureMonitorQuery) {\n    if (item.xaxis && !item.timeColumn) {\n      item.timeColumn = item.xaxis;\n    }\n\n    if (item.yaxis && !item.valueColumn) {\n      item.valueColumn = item.yaxis;\n    }\n\n    if (item.spliton && !item.segmentColumn) {\n      item.segmentColumn = item.spliton;\n    }\n\n    return {\n      type: 'timeSeriesQuery',\n      raw: false,\n      appInsights: {\n        rawQuery: true,\n        rawQueryString: this.templateSrv.replace(item.rawQueryString, options.scopedVars),\n        timeColumn: item.timeColumn,\n        valueColumn: item.valueColumn,\n        segmentColumn: item.segmentColumn,\n      },\n    };\n  }\n\n  createMetricsRequest(item: any, options: DataQueryRequest<AzureMonitorQuery>, target: AzureMonitorQuery) {\n    // fix for timeGrainUnit which is a deprecated/removed field name\n    if (item.timeGrainCount) {\n      item.timeGrain = TimegrainConverter.createISO8601Duration(item.timeGrainCount, item.timeGrainUnit);\n    } else if (item.timeGrainUnit && item.timeGrain !== 'auto') {\n      item.timeGrain = TimegrainConverter.createISO8601Duration(item.timeGrain, item.timeGrainUnit);\n    }\n\n    // migration for non-standard names\n    if (item.groupBy && !item.dimension) {\n      item.dimension = item.groupBy;\n    }\n\n    if (item.filter && !item.dimensionFilter) {\n      item.dimensionFilter = item.filter;\n    }\n\n    return {\n      type: 'timeSeriesQuery',\n      raw: false,\n      appInsights: {\n        rawQuery: false,\n        timeGrain: this.templateSrv.replace((item.timeGrain || '').toString(), options.scopedVars),\n        allowedTimeGrainsMs: item.allowedTimeGrainsMs,\n        metricName: this.templateSrv.replace(item.metricName, options.scopedVars),\n        aggregation: this.templateSrv.replace(item.aggregation, options.scopedVars),\n        dimension: this.templateSrv.replace(item.dimension, options.scopedVars),\n        dimensionFilter: this.templateSrv.replace(item.dimensionFilter, options.scopedVars),\n        alias: item.alias,\n        format: target.format,\n      },\n    };\n  }\n\n  async query(options: DataQueryRequest<AzureMonitorQuery>): Promise<DataQueryResponseData[]> {\n    const queries = _.filter(options.targets, item => {\n      return item.hide !== true;\n    }).map((target: AzureMonitorQuery) => {\n      const item = target.appInsights;\n      let query: any;\n      if (item.rawQuery) {\n        query = this.createRawQueryRequest(item, options, target);\n      } else {\n        query = this.createMetricsRequest(item, options, target);\n      }\n      query.refId = target.refId;\n      query.intervalMs = options.intervalMs;\n      query.datasourceId = this.id;\n      query.queryType = 'Application Insights';\n      return query;\n    });\n\n    if (!queries || queries.length === 0) {\n      // @ts-ignore\n      return;\n    }\n\n    const { data } = await this.backendSrv.datasourceRequest({\n      url: '/api/tsdb/query',\n      method: 'POST',\n      data: {\n        from: options.range.from.valueOf().toString(),\n        to: options.range.to.valueOf().toString(),\n        queries,\n      },\n    });\n\n    const result: DataQueryResponseData[] = [];\n    if (data.results) {\n      Object.values(data.results).forEach((queryRes: any) => {\n        if (queryRes.meta && queryRes.meta.columns) {\n          const columnNames = queryRes.meta.columns as string[];\n          this.logAnalyticsColumns[queryRes.refId] = _.map(columnNames, n => ({ text: n, value: n }));\n        }\n\n        if (!queryRes.series) {\n          return;\n        }\n\n        queryRes.series.forEach((series: any) => {\n          const timeSerie: TimeSeries = {\n            target: series.name,\n            datapoints: series.points,\n            refId: queryRes.refId,\n            meta: queryRes.meta,\n          };\n          result.push(toDataFrame(timeSerie));\n        });\n      });\n      return result;\n    }\n\n    return Promise.resolve([]);\n  }\n\n  doQueries(queries: any) {\n    return _.map(queries, query => {\n      return this.doRequest(query.url)\n        .then((result: any) => {\n          return {\n            result: result,\n            query: query,\n          };\n        })\n        .catch((err: any) => {\n          throw {\n            error: err,\n            query: query,\n          };\n        });\n    });\n  }\n\n  annotationQuery(options: any) {}\n\n  metricFindQuery(query: string) {\n    const appInsightsMetricNameQuery = query.match(/^AppInsightsMetricNames\\(\\)/i);\n    if (appInsightsMetricNameQuery) {\n      return this.getMetricNames();\n    }\n\n    const appInsightsGroupByQuery = query.match(/^AppInsightsGroupBys\\(([^\\)]+?)(,\\s?([^,]+?))?\\)/i);\n    if (appInsightsGroupByQuery) {\n      const metricName = appInsightsGroupByQuery[1];\n      return this.getGroupBys(this.templateSrv.replace(metricName));\n    }\n\n    return undefined;\n  }\n\n  testDatasource() {\n    const url = `${this.baseUrl}/metrics/metadata`;\n    return this.doRequest(url)\n      .then((response: any) => {\n        if (response.status === 200) {\n          return {\n            status: 'success',\n            message: 'Successfully queried the Application Insights service.',\n            title: 'Success',\n          };\n        }\n\n        return {\n          status: 'error',\n          message: 'Returned http status code ' + response.status,\n        };\n      })\n      .catch((error: any) => {\n        let message = 'Application Insights: ';\n        message += error.statusText ? error.statusText + ': ' : '';\n\n        if (error.data && error.data.error && error.data.error.code === 'PathNotFoundError') {\n          message += 'Invalid Application Id for Application Insights service.';\n        } else if (error.data && error.data.error) {\n          message += error.data.error.code + '. ' + error.data.error.message;\n        } else {\n          message += 'Cannot connect to Application Insights REST API.';\n        }\n\n        return {\n          status: 'error',\n          message: message,\n        };\n      });\n  }\n\n  doRequest(url: any, maxRetries = 1) {\n    return this.backendSrv\n      .datasourceRequest({\n        url: this.url + url,\n        method: 'GET',\n      })\n      .catch((error: any) => {\n        if (maxRetries > 0) {\n          return this.doRequest(url, maxRetries - 1);\n        }\n\n        throw error;\n      });\n  }\n\n  getMetricNames() {\n    const url = `${this.baseUrl}/metrics/metadata`;\n    return this.doRequest(url).then(ResponseParser.parseMetricNames);\n  }\n\n  getMetricMetadata(metricName: string) {\n    const url = `${this.baseUrl}/metrics/metadata`;\n    return this.doRequest(url).then((result: any) => {\n      return new ResponseParser(result).parseMetadata(metricName);\n    });\n  }\n\n  getGroupBys(metricName: string) {\n    return this.getMetricMetadata(metricName).then((result: any) => {\n      return new ResponseParser(result).parseGroupBys();\n    });\n  }\n\n  getQuerySchema() {\n    const url = `${this.baseUrl}/query/schema`;\n    return this.doRequest(url).then((result: any) => {\n      const schema = new ResponseParser(result).parseQuerySchema();\n      // console.log(schema);\n      return schema;\n    });\n  }\n}\n","import _ from 'lodash';\nimport { dateTime } from '@grafana/data';\nimport {\n  AzureLogsVariable,\n  AzureLogsTableData,\n  KustoDatabase,\n  KustoFunction,\n  KustoTable,\n  KustoSchema,\n  KustoColumn,\n} from '../types';\nimport { TimeSeries, AnnotationEvent } from '@grafana/data';\n\nexport default class ResponseParser {\n  columns: string[];\n  constructor(private results: any) {}\n\n  parseQueryResult(): any {\n    let data: any[] = [];\n    let columns: any[] = [];\n    for (let i = 0; i < this.results.length; i++) {\n      if (this.results[i].result.data.tables.length === 0) {\n        continue;\n      }\n      columns = this.results[i].result.data.tables[0].columns;\n      const rows = this.results[i].result.data.tables[0].rows;\n\n      if (this.results[i].query.resultFormat === 'time_series') {\n        data = _.concat(data, this.parseTimeSeriesResult(this.results[i].query, columns, rows));\n      } else {\n        data = _.concat(data, this.parseTableResult(this.results[i].query, columns, rows));\n      }\n    }\n\n    return data;\n  }\n\n  parseTimeSeriesResult(query: { refId: string; query: any }, columns: any[], rows: any): TimeSeries[] {\n    const data: TimeSeries[] = [];\n    let timeIndex = -1;\n    let metricIndex = -1;\n    let valueIndex = -1;\n\n    for (let i = 0; i < columns.length; i++) {\n      if (timeIndex === -1 && columns[i].type === 'datetime') {\n        timeIndex = i;\n      }\n\n      if (metricIndex === -1 && columns[i].type === 'string') {\n        metricIndex = i;\n      }\n\n      if (valueIndex === -1 && ['int', 'long', 'real', 'double'].indexOf(columns[i].type) > -1) {\n        valueIndex = i;\n      }\n    }\n\n    if (timeIndex === -1) {\n      throw new Error('No datetime column found in the result. The Time Series format requires a time column.');\n    }\n\n    _.forEach(rows, row => {\n      const epoch = ResponseParser.dateTimeToEpoch(row[timeIndex]);\n      const metricName = metricIndex > -1 ? row[metricIndex] : columns[valueIndex].name;\n      const bucket = ResponseParser.findOrCreateBucket(data, metricName);\n      bucket.datapoints.push([row[valueIndex], epoch]);\n      bucket.refId = query.refId;\n      bucket.meta = {\n        query: query.query,\n      };\n    });\n\n    return data;\n  }\n\n  parseTableResult(query: { refId: string; query: string }, columns: any[], rows: any[]): AzureLogsTableData {\n    const tableResult: AzureLogsTableData = {\n      type: 'table',\n      columns: _.map(columns, col => {\n        return { text: col.name, type: col.type };\n      }),\n      rows: rows,\n      refId: query.refId,\n      meta: {\n        query: query.query,\n      },\n    };\n\n    return tableResult;\n  }\n\n  parseToVariables(): AzureLogsVariable[] {\n    const queryResult = this.parseQueryResult();\n\n    const variables: AzureLogsVariable[] = [];\n    _.forEach(queryResult, result => {\n      _.forEach(_.flattenDeep(result.rows), row => {\n        variables.push({\n          text: row,\n          value: row,\n        } as AzureLogsVariable);\n      });\n    });\n\n    return variables;\n  }\n\n  transformToAnnotations(options: any) {\n    const queryResult = this.parseQueryResult();\n\n    const list: AnnotationEvent[] = [];\n\n    _.forEach(queryResult, result => {\n      let timeIndex = -1;\n      let textIndex = -1;\n      let tagsIndex = -1;\n\n      for (let i = 0; i < result.columns.length; i++) {\n        if (timeIndex === -1 && result.columns[i].type === 'datetime') {\n          timeIndex = i;\n        }\n\n        if (textIndex === -1 && result.columns[i].text.toLowerCase() === 'text') {\n          textIndex = i;\n        }\n\n        if (tagsIndex === -1 && result.columns[i].text.toLowerCase() === 'tags') {\n          tagsIndex = i;\n        }\n      }\n\n      _.forEach(result.rows, row => {\n        list.push({\n          annotation: options.annotation,\n          time: Math.floor(ResponseParser.dateTimeToEpoch(row[timeIndex])),\n          text: row[textIndex] ? row[textIndex].toString() : '',\n          tags: row[tagsIndex] ? row[tagsIndex].trim().split(/\\s*,\\s*/) : [],\n        });\n      });\n    });\n\n    return list;\n  }\n\n  parseSchemaResult(): KustoSchema {\n    return {\n      Plugins: [\n        {\n          Name: 'pivot',\n        },\n      ],\n      Databases: this.createSchemaDatabaseWithTables(),\n    };\n  }\n\n  createSchemaDatabaseWithTables(): { [key: string]: KustoDatabase } {\n    const databases = {\n      Default: {\n        Name: 'Default',\n        Tables: this.createSchemaTables(),\n        Functions: this.createSchemaFunctions(),\n      },\n    };\n\n    return databases;\n  }\n\n  createSchemaTables(): { [key: string]: KustoTable } {\n    const tables: { [key: string]: KustoTable } = {};\n\n    for (const table of this.results.tables) {\n      tables[table.name] = {\n        Name: table.name,\n        OrderedColumns: [],\n      };\n      for (const col of table.columns) {\n        tables[table.name].OrderedColumns.push(this.convertToKustoColumn(col));\n      }\n    }\n\n    return tables;\n  }\n\n  convertToKustoColumn(col: any): KustoColumn {\n    return {\n      Name: col.name,\n      Type: col.type,\n    };\n  }\n\n  createSchemaFunctions(): { [key: string]: KustoFunction } {\n    const functions: { [key: string]: KustoFunction } = {};\n\n    for (const func of this.results.functions) {\n      functions[func.name] = {\n        Name: func.name,\n        Body: func.body,\n        DocString: func.displayName,\n        Folder: func.category,\n        FunctionKind: 'Unknown',\n        InputParameters: [],\n        OutputColumns: [],\n      };\n    }\n\n    return functions;\n  }\n\n  static findOrCreateBucket(data: TimeSeries[], target: any): TimeSeries {\n    let dataTarget: any = _.find(data, ['target', target]);\n    if (!dataTarget) {\n      dataTarget = { target: target, datapoints: [], refId: '', query: '' };\n      data.push(dataTarget);\n    }\n\n    return dataTarget;\n  }\n\n  static dateTimeToEpoch(dateTimeValue: any) {\n    return dateTime(dateTimeValue).valueOf();\n  }\n}\n","import _ from 'lodash';\nimport AzureMonitorDatasource from './azure_monitor/azure_monitor_datasource';\nimport AppInsightsDatasource from './app_insights/app_insights_datasource';\nimport AzureLogAnalyticsDatasource from './azure_log_analytics/azure_log_analytics_datasource';\nimport { AzureMonitorQuery, AzureDataSourceJsonData } from './types';\nimport { DataSourceApi, DataQueryRequest, DataSourceInstanceSettings } from '@grafana/ui';\nimport { BackendSrv } from 'app/core/services/backend_srv';\nimport { TemplateSrv } from 'app/features/templating/template_srv';\nimport { IQService } from 'angular';\n\nexport default class Datasource extends DataSourceApi<AzureMonitorQuery, AzureDataSourceJsonData> {\n  azureMonitorDatasource: AzureMonitorDatasource;\n  appInsightsDatasource: AppInsightsDatasource;\n  azureLogAnalyticsDatasource: AzureLogAnalyticsDatasource;\n\n  /** @ngInject */\n  constructor(\n    instanceSettings: DataSourceInstanceSettings<AzureDataSourceJsonData>,\n    private backendSrv: BackendSrv,\n    private templateSrv: TemplateSrv,\n    private $q: IQService\n  ) {\n    super(instanceSettings);\n    this.azureMonitorDatasource = new AzureMonitorDatasource(instanceSettings, this.backendSrv, this.templateSrv);\n    this.appInsightsDatasource = new AppInsightsDatasource(instanceSettings, this.backendSrv, this.templateSrv);\n\n    this.azureLogAnalyticsDatasource = new AzureLogAnalyticsDatasource(\n      instanceSettings,\n      this.backendSrv,\n      this.templateSrv\n    );\n  }\n\n  async query(options: DataQueryRequest<AzureMonitorQuery>) {\n    const promises: any[] = [];\n    const azureMonitorOptions = _.cloneDeep(options);\n    const appInsightsOptions = _.cloneDeep(options);\n    const azureLogAnalyticsOptions = _.cloneDeep(options);\n\n    azureMonitorOptions.targets = _.filter(azureMonitorOptions.targets, ['queryType', 'Azure Monitor']);\n    appInsightsOptions.targets = _.filter(appInsightsOptions.targets, ['queryType', 'Application Insights']);\n    azureLogAnalyticsOptions.targets = _.filter(azureLogAnalyticsOptions.targets, ['queryType', 'Azure Log Analytics']);\n\n    if (azureMonitorOptions.targets.length > 0) {\n      const amPromise = this.azureMonitorDatasource.query(azureMonitorOptions);\n      if (amPromise) {\n        promises.push(amPromise);\n      }\n    }\n\n    if (appInsightsOptions.targets.length > 0) {\n      const aiPromise = this.appInsightsDatasource.query(appInsightsOptions);\n      if (aiPromise) {\n        promises.push(aiPromise);\n      }\n    }\n\n    if (azureLogAnalyticsOptions.targets.length > 0) {\n      const alaPromise = this.azureLogAnalyticsDatasource.query(azureLogAnalyticsOptions);\n      if (alaPromise) {\n        promises.push(alaPromise);\n      }\n    }\n\n    if (promises.length === 0) {\n      return this.$q.when({ data: [] });\n    }\n\n    return Promise.all(promises).then(results => {\n      return { data: _.flatten(results) };\n    });\n  }\n\n  async annotationQuery(options: any) {\n    return this.azureLogAnalyticsDatasource.annotationQuery(options);\n  }\n\n  async metricFindQuery(query: string) {\n    if (!query) {\n      return Promise.resolve([]);\n    }\n\n    const aiResult = this.appInsightsDatasource.metricFindQuery(query);\n    if (aiResult) {\n      return aiResult;\n    }\n\n    const amResult = this.azureMonitorDatasource.metricFindQuery(query);\n    if (amResult) {\n      return amResult;\n    }\n\n    const alaResult = this.azureLogAnalyticsDatasource.metricFindQuery(query);\n    if (alaResult) {\n      return alaResult;\n    }\n\n    return Promise.resolve([]);\n  }\n\n  async testDatasource() {\n    const promises: any[] = [];\n\n    if (this.azureMonitorDatasource.isConfigured()) {\n      promises.push(this.azureMonitorDatasource.testDatasource());\n    }\n\n    if (this.appInsightsDatasource.isConfigured()) {\n      promises.push(this.appInsightsDatasource.testDatasource());\n    }\n\n    if (this.azureLogAnalyticsDatasource.isConfigured()) {\n      promises.push(this.azureLogAnalyticsDatasource.testDatasource());\n    }\n\n    if (promises.length === 0) {\n      return {\n        status: 'error',\n        message: `Nothing configured. At least one of the API's must be configured.`,\n        title: 'Error',\n      };\n    }\n\n    return Promise.all(promises).then(results => {\n      let status = 'success';\n      let message = '';\n\n      for (let i = 0; i < results.length; i++) {\n        if (results[i].status !== 'success') {\n          status = results[i].status;\n        }\n        message += `${i + 1}. ${results[i].message} `;\n      }\n\n      return {\n        status: status,\n        message: message,\n        title: _.upperFirst(status),\n      };\n    });\n  }\n\n  /* Azure Monitor REST API methods */\n  getResourceGroups(subscriptionId: string) {\n    return this.azureMonitorDatasource.getResourceGroups(subscriptionId);\n  }\n\n  getMetricDefinitions(subscriptionId: string, resourceGroup: string) {\n    return this.azureMonitorDatasource.getMetricDefinitions(subscriptionId, resourceGroup);\n  }\n\n  getResourceNames(subscriptionId: string, resourceGroup: string, metricDefinition: string) {\n    return this.azureMonitorDatasource.getResourceNames(subscriptionId, resourceGroup, metricDefinition);\n  }\n\n  getMetricNames(\n    subscriptionId: string,\n    resourceGroup: string,\n    metricDefinition: string,\n    resourceName: string,\n    metricNamespace: string\n  ) {\n    return this.azureMonitorDatasource.getMetricNames(\n      subscriptionId,\n      resourceGroup,\n      metricDefinition,\n      resourceName,\n      metricNamespace\n    );\n  }\n\n  getMetricNamespaces(subscriptionId: string, resourceGroup: string, metricDefinition: string, resourceName: string) {\n    return this.azureMonitorDatasource.getMetricNamespaces(\n      subscriptionId,\n      resourceGroup,\n      metricDefinition,\n      resourceName\n    );\n  }\n\n  getMetricMetadata(\n    subscriptionId: string,\n    resourceGroup: string,\n    metricDefinition: string,\n    resourceName: string,\n    metricNamespace: string,\n    metricName: string\n  ) {\n    return this.azureMonitorDatasource.getMetricMetadata(\n      subscriptionId,\n      resourceGroup,\n      metricDefinition,\n      resourceName,\n      metricNamespace,\n      metricName\n    );\n  }\n\n  /* Application Insights API method */\n  getAppInsightsMetricNames() {\n    return this.appInsightsDatasource.getMetricNames();\n  }\n\n  getAppInsightsMetricMetadata(metricName: string) {\n    return this.appInsightsDatasource.getMetricMetadata(metricName);\n  }\n\n  getAppInsightsColumns(refId: string | number) {\n    return this.appInsightsDatasource.logAnalyticsColumns[refId];\n  }\n\n  /*Azure Log Analytics */\n  getAzureLogAnalyticsWorkspaces(subscriptionId: string) {\n    return this.azureLogAnalyticsDatasource.getWorkspaces(subscriptionId);\n  }\n\n  getSubscriptions() {\n    return this.azureMonitorDatasource.getSubscriptions();\n  }\n}\n","import _ from 'lodash';\nimport LogAnalyticsQuerystringBuilder from '../log_analytics/querystring_builder';\nimport ResponseParser from './response_parser';\nimport { AzureMonitorQuery, AzureDataSourceJsonData } from '../types';\nimport { DataQueryRequest, DataSourceInstanceSettings } from '@grafana/ui';\nimport { BackendSrv } from 'app/core/services/backend_srv';\nimport { TemplateSrv } from 'app/features/templating/template_srv';\n\nexport default class AzureLogAnalyticsDatasource {\n  id: number;\n  url: string;\n  baseUrl: string;\n  applicationId: string;\n  azureMonitorUrl: string;\n  defaultOrFirstWorkspace: string;\n  subscriptionId: string;\n\n  /** @ngInject */\n  constructor(\n    private instanceSettings: DataSourceInstanceSettings<AzureDataSourceJsonData>,\n    private backendSrv: BackendSrv,\n    private templateSrv: TemplateSrv\n  ) {\n    this.id = instanceSettings.id;\n    this.baseUrl = this.instanceSettings.jsonData.azureLogAnalyticsSameAs\n      ? '/sameasloganalyticsazure'\n      : `/loganalyticsazure`;\n    this.url = instanceSettings.url;\n    this.defaultOrFirstWorkspace = this.instanceSettings.jsonData.logAnalyticsDefaultWorkspace;\n\n    this.setWorkspaceUrl();\n  }\n\n  isConfigured(): boolean {\n    return (\n      (!!this.instanceSettings.jsonData.logAnalyticsSubscriptionId &&\n        this.instanceSettings.jsonData.logAnalyticsSubscriptionId.length > 0) ||\n      !!this.instanceSettings.jsonData.azureLogAnalyticsSameAs\n    );\n  }\n\n  setWorkspaceUrl() {\n    if (!!this.instanceSettings.jsonData.subscriptionId || !!this.instanceSettings.jsonData.azureLogAnalyticsSameAs) {\n      this.subscriptionId = this.instanceSettings.jsonData.subscriptionId;\n      const azureCloud = this.instanceSettings.jsonData.cloudName || 'azuremonitor';\n      this.azureMonitorUrl = `/${azureCloud}/subscriptions`;\n    } else {\n      this.subscriptionId = this.instanceSettings.jsonData.logAnalyticsSubscriptionId;\n      this.azureMonitorUrl = `/workspacesloganalytics/subscriptions`;\n    }\n  }\n\n  getWorkspaces(subscription: string) {\n    const subscriptionId = this.templateSrv.replace(subscription || this.subscriptionId);\n\n    const workspaceListUrl =\n      this.azureMonitorUrl +\n      `/${subscriptionId}/providers/Microsoft.OperationalInsights/workspaces?api-version=2017-04-26-preview`;\n    return this.doRequest(workspaceListUrl).then((response: any) => {\n      return (\n        _.map(response.data.value, val => {\n          return { text: val.name, value: val.properties.customerId };\n        }) || []\n      );\n    });\n  }\n\n  getSchema(workspace: string) {\n    if (!workspace) {\n      return Promise.resolve();\n    }\n    const url = `${this.baseUrl}/${workspace}/metadata`;\n\n    return this.doRequest(url).then((response: any) => {\n      return new ResponseParser(response.data).parseSchemaResult();\n    });\n  }\n\n  async query(options: DataQueryRequest<AzureMonitorQuery>) {\n    const queries = _.filter(options.targets, item => {\n      return item.hide !== true;\n    }).map(target => {\n      const item = target.azureLogAnalytics;\n\n      const querystringBuilder = new LogAnalyticsQuerystringBuilder(\n        this.templateSrv.replace(item.query, options.scopedVars, this.interpolateVariable),\n        options,\n        'TimeGenerated'\n      );\n      const generated = querystringBuilder.generate();\n\n      const workspace = this.templateSrv.replace(item.workspace, options.scopedVars);\n\n      const url = `${this.baseUrl}/${workspace}/query?${generated.uriString}`;\n\n      return {\n        refId: target.refId,\n        intervalMs: options.intervalMs,\n        maxDataPoints: options.maxDataPoints,\n        datasourceId: this.id,\n        url: url,\n        query: generated.rawQuery,\n        format: target.format,\n        resultFormat: item.resultFormat,\n      };\n    });\n\n    if (!queries || queries.length === 0) {\n      return;\n    }\n\n    const promises = this.doQueries(queries);\n\n    return Promise.all(promises).then(results => {\n      return new ResponseParser(results).parseQueryResult();\n    });\n  }\n\n  metricFindQuery(query: string) {\n    return this.getDefaultOrFirstWorkspace().then((workspace: any) => {\n      const queries: any[] = this.buildQuery(query, null, workspace);\n\n      const promises = this.doQueries(queries);\n\n      return Promise.all(promises)\n        .then(results => {\n          return new ResponseParser(results).parseToVariables();\n        })\n        .catch(err => {\n          if (\n            err.error &&\n            err.error.data &&\n            err.error.data.error &&\n            err.error.data.error.innererror &&\n            err.error.data.error.innererror.innererror\n          ) {\n            throw { message: err.error.data.error.innererror.innererror.message };\n          } else if (err.error && err.error.data && err.error.data.error) {\n            throw { message: err.error.data.error.message };\n          }\n        });\n    });\n  }\n\n  private buildQuery(query: string, options: any, workspace: any) {\n    const querystringBuilder = new LogAnalyticsQuerystringBuilder(\n      this.templateSrv.replace(query, {}, this.interpolateVariable),\n      options,\n      'TimeGenerated'\n    );\n    const querystring = querystringBuilder.generate().uriString;\n    const url = `${this.baseUrl}/${workspace}/query?${querystring}`;\n    const queries: any[] = [];\n    queries.push({\n      datasourceId: this.id,\n      url: url,\n      resultFormat: 'table',\n    });\n    return queries;\n  }\n\n  interpolateVariable(value: string, variable: { multi: any; includeAll: any }) {\n    if (typeof value === 'string') {\n      if (variable.multi || variable.includeAll) {\n        return \"'\" + value + \"'\";\n      } else {\n        return value;\n      }\n    }\n\n    if (typeof value === 'number') {\n      return value;\n    }\n\n    const quotedValues = _.map(value, val => {\n      if (typeof value === 'number') {\n        return value;\n      }\n\n      return \"'\" + val + \"'\";\n    });\n    return quotedValues.join(',');\n  }\n\n  getDefaultOrFirstWorkspace() {\n    if (this.defaultOrFirstWorkspace) {\n      return Promise.resolve(this.defaultOrFirstWorkspace);\n    }\n\n    return this.getWorkspaces(this.subscriptionId).then((workspaces: any[]) => {\n      this.defaultOrFirstWorkspace = workspaces[0].value;\n      return this.defaultOrFirstWorkspace;\n    });\n  }\n\n  annotationQuery(options: any) {\n    if (!options.annotation.rawQuery) {\n      return Promise.reject({\n        message: 'Query missing in annotation definition',\n      });\n    }\n\n    const queries: any[] = this.buildQuery(options.annotation.rawQuery, options, options.annotation.workspace);\n\n    const promises = this.doQueries(queries);\n\n    return Promise.all(promises).then(results => {\n      const annotations = new ResponseParser(results).transformToAnnotations(options);\n      return annotations;\n    });\n  }\n\n  doQueries(queries: any[]) {\n    return _.map(queries, query => {\n      return this.doRequest(query.url)\n        .then((result: any) => {\n          return {\n            result: result,\n            query: query,\n          };\n        })\n        .catch((err: any) => {\n          throw {\n            error: err,\n            query: query,\n          };\n        });\n    });\n  }\n\n  doRequest(url: string, maxRetries = 1) {\n    return this.backendSrv\n      .datasourceRequest({\n        url: this.url + url,\n        method: 'GET',\n      })\n      .catch((error: any) => {\n        if (maxRetries > 0) {\n          return this.doRequest(url, maxRetries - 1);\n        }\n\n        throw error;\n      });\n  }\n\n  testDatasource() {\n    const validationError = this.isValidConfig();\n    if (validationError) {\n      return validationError;\n    }\n\n    return this.getDefaultOrFirstWorkspace()\n      .then((ws: any) => {\n        const url = `${this.baseUrl}/${ws}/metadata`;\n\n        return this.doRequest(url);\n      })\n      .then((response: any) => {\n        if (response.status === 200) {\n          return {\n            status: 'success',\n            message: 'Successfully queried the Azure Log Analytics service.',\n            title: 'Success',\n          };\n        }\n\n        return {\n          status: 'error',\n          message: 'Returned http status code ' + response.status,\n        };\n      })\n      .catch((error: any) => {\n        let message = 'Azure Log Analytics: ';\n        if (error.config && error.config.url && error.config.url.indexOf('workspacesloganalytics') > -1) {\n          message = 'Azure Log Analytics requires access to Azure Monitor but had the following error: ';\n        }\n\n        message = this.getErrorMessage(message, error);\n\n        return {\n          status: 'error',\n          message: message,\n        };\n      });\n  }\n\n  private getErrorMessage(message: string, error: any) {\n    message += error.statusText ? error.statusText + ': ' : '';\n    if (error.data && error.data.error && error.data.error.code) {\n      message += error.data.error.code + '. ' + error.data.error.message;\n    } else if (error.data && error.data.error) {\n      message += error.data.error;\n    } else if (error.data) {\n      message += error.data;\n    } else {\n      message += 'Cannot connect to Azure Log Analytics REST API.';\n    }\n    return message;\n  }\n\n  isValidConfig() {\n    if (this.instanceSettings.jsonData.azureLogAnalyticsSameAs) {\n      return undefined;\n    }\n\n    if (!this.isValidConfigField(this.instanceSettings.jsonData.logAnalyticsSubscriptionId)) {\n      return {\n        status: 'error',\n        message: 'The Subscription Id field is required.',\n      };\n    }\n\n    if (!this.isValidConfigField(this.instanceSettings.jsonData.logAnalyticsTenantId)) {\n      return {\n        status: 'error',\n        message: 'The Tenant Id field is required.',\n      };\n    }\n\n    if (!this.isValidConfigField(this.instanceSettings.jsonData.logAnalyticsClientId)) {\n      return {\n        status: 'error',\n        message: 'The Client Id field is required.',\n      };\n    }\n\n    return undefined;\n  }\n\n  isValidConfigField(field: string) {\n    return field && field.length > 0;\n  }\n}\n","import React, { ChangeEvent, PureComponent } from 'react';\nimport { SelectableValue } from '@grafana/data';\nimport { Input, FormLabel, Select, Button } from '@grafana/ui';\n\nexport interface Props {\n  selectedAzureCloud?: string;\n  selectedSubscription?: string;\n  azureCloudOptions?: SelectableValue[];\n  tenantId: string;\n  clientId: string;\n  clientSecret: string;\n  clientSecretConfigured: boolean;\n  subscriptionOptions?: SelectableValue[];\n  onAzureCloudChange?: (value: SelectableValue<string>) => void;\n  onSubscriptionSelectChange?: (value: SelectableValue<string>) => void;\n  onTenantIdChange: (tenantId: string) => void;\n  onClientIdChange: (clientId: string) => void;\n  onClientSecretChange: (clientSecret: string) => void;\n  onResetClientSecret: () => void;\n  onLoadSubscriptions?: () => void;\n}\n\nexport interface State {\n  selectedAzureCloud?: string;\n  selectedSubscription: string;\n  tenantId: string;\n  clientId: string;\n  clientSecret: string;\n  clientSecretConfigured: boolean;\n}\n\nexport class AzureCredentialsForm extends PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    const {\n      selectedAzureCloud,\n      selectedSubscription,\n      tenantId,\n      clientId,\n      clientSecret,\n      clientSecretConfigured,\n    } = this.props;\n\n    this.state = {\n      selectedAzureCloud,\n      selectedSubscription,\n      tenantId,\n      clientId,\n      clientSecret,\n      clientSecretConfigured,\n    };\n  }\n\n  static getDerivedStateFromProps(nextProps: Props, prevState: Props) {\n    const { selectedAzureCloud, tenantId, clientId, clientSecret, clientSecretConfigured } = nextProps;\n    return {\n      selectedAzureCloud,\n      tenantId,\n      clientId,\n      clientSecret,\n      clientSecretConfigured,\n    };\n  }\n\n  render() {\n    const {\n      azureCloudOptions,\n      subscriptionOptions,\n      onAzureCloudChange,\n      onSubscriptionSelectChange,\n      onTenantIdChange,\n      onClientIdChange,\n      onClientSecretChange,\n      onResetClientSecret,\n      onLoadSubscriptions,\n    } = this.props;\n    const {\n      selectedAzureCloud,\n      selectedSubscription,\n      tenantId,\n      clientId,\n      clientSecret,\n      clientSecretConfigured,\n    } = this.state;\n    const hasRequiredFields = tenantId && clientId && (clientSecret || clientSecretConfigured);\n    const hasSubscriptions = onLoadSubscriptions && subscriptionOptions;\n    return (\n      <>\n        <div className=\"gf-form-group\">\n          {azureCloudOptions && (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <FormLabel className=\"width-12\" tooltip=\"Choose an Azure Cloud.\">\n                  Azure Cloud\n                </FormLabel>\n                <Select\n                  className=\"width-15\"\n                  value={azureCloudOptions.find(azureCloud => azureCloud.value === selectedAzureCloud)}\n                  options={azureCloudOptions}\n                  defaultValue={selectedAzureCloud}\n                  onChange={onAzureCloudChange}\n                />\n              </div>\n            </div>\n          )}\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <FormLabel className=\"width-12\">Directory (tenant) ID</FormLabel>\n              <div className=\"width-15\">\n                <Input\n                  className=\"width-30\"\n                  placeholder=\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n                  value={tenantId}\n                  onChange={(event: ChangeEvent<HTMLInputElement>) => onTenantIdChange(event.target.value)}\n                />\n              </div>\n            </div>\n          </div>\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <FormLabel className=\"width-12\">Application (client) ID</FormLabel>\n              <div className=\"width-15\">\n                <Input\n                  className=\"width-30\"\n                  placeholder=\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n                  value={clientId}\n                  onChange={(event: ChangeEvent<HTMLInputElement>) => onClientIdChange(event.target.value)}\n                />\n              </div>\n            </div>\n          </div>\n          {clientSecretConfigured ? (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <FormLabel className=\"width-12\">Client Secret</FormLabel>\n                <Input className=\"width-25\" placeholder=\"configured\" disabled={true} />\n              </div>\n              <div className=\"gf-form\">\n                <div className=\"max-width-30 gf-form-inline\">\n                  <Button variant=\"secondary\" type=\"button\" onClick={onResetClientSecret}>\n                    reset\n                  </Button>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <FormLabel className=\"width-12\">Client Secret</FormLabel>\n                <div className=\"width-15\">\n                  <Input\n                    className=\"width-30\"\n                    placeholder=\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n                    value={clientSecret}\n                    onChange={(event: ChangeEvent<HTMLInputElement>) => onClientSecretChange(event.target.value)}\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n          {hasSubscriptions && (\n            <>\n              <div className=\"gf-form-inline\">\n                <div className=\"gf-form\">\n                  <FormLabel className=\"width-12\">Default Subscription</FormLabel>\n                  <div className=\"width-25\">\n                    <Select\n                      value={subscriptionOptions.find(subscription => subscription.value === selectedSubscription)}\n                      options={subscriptionOptions}\n                      defaultValue={selectedSubscription}\n                      onChange={onSubscriptionSelectChange}\n                    />\n                  </div>\n                </div>\n              </div>\n              <div className=\"gf-form-inline\">\n                <div className=\"gf-form\">\n                  <div className=\"max-width-30 gf-form-inline\">\n                    <Button\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      type=\"button\"\n                      onClick={onLoadSubscriptions}\n                      disabled={!hasRequiredFields}\n                    >\n                      Load Subscriptions\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            </>\n          )}\n        </div>\n      </>\n    );\n  }\n}\n\nexport default AzureCredentialsForm;\n","import React, { PureComponent } from 'react';\nimport { SelectableValue } from '@grafana/data';\nimport { AzureCredentialsForm } from './AzureCredentialsForm';\n\nexport interface Props {\n  datasourceConfig: any;\n  subscriptions: SelectableValue[];\n  onDatasourceUpdate: (config: any) => void;\n  onLoadSubscriptions: () => void;\n}\n\nexport interface State {\n  config: any;\n  azureClouds: SelectableValue[];\n  subscriptions: SelectableValue[];\n}\n\nexport class MonitorConfig extends PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    const { datasourceConfig } = this.props;\n\n    this.state = {\n      config: datasourceConfig,\n      azureClouds: [\n        { value: 'azuremonitor', label: 'Azure' },\n        { value: 'govazuremonitor', label: 'Azure US Government' },\n        { value: 'germanyazuremonitor', label: 'Azure Germany' },\n        { value: 'chinaazuremonitor', label: 'Azure China' },\n      ],\n      subscriptions: [],\n    };\n  }\n\n  static getDerivedStateFromProps(props: Props, state: State) {\n    return {\n      ...state,\n      config: props.datasourceConfig,\n      subscriptions: props.subscriptions,\n    };\n  }\n\n  onAzureCloudSelect = (cloudName: SelectableValue<string>) => {\n    this.props.onDatasourceUpdate({\n      ...this.state.config,\n      jsonData: {\n        ...this.state.config.jsonData,\n        cloudName,\n      },\n    });\n  };\n\n  onTenantIdChange = (tenantId: string) => {\n    this.props.onDatasourceUpdate({\n      ...this.state.config,\n      editorJsonData: {\n        ...this.state.config.editorJsonData,\n        tenantId,\n      },\n    });\n  };\n\n  onClientIdChange = (clientId: string) => {\n    this.props.onDatasourceUpdate({\n      ...this.state.config,\n      editorJsonData: {\n        ...this.state.config.editorJsonData,\n        clientId,\n      },\n    });\n  };\n\n  onClientSecretChange = (clientSecret: string) => {\n    this.props.onDatasourceUpdate({\n      ...this.state.config,\n      editorSecureJsonData: {\n        ...this.state.config.editorSecureJsonData,\n        clientSecret,\n      },\n    });\n  };\n\n  onResetClientSecret = () => {\n    this.props.onDatasourceUpdate({\n      ...this.state.config,\n      version: this.state.config.version + 1,\n      secureJsonFields: {\n        ...this.state.config.secureJsonFields,\n        clientSecret: false,\n      },\n    });\n  };\n\n  onSubscriptionSelect = (subscription: SelectableValue<string>) => {\n    this.props.onDatasourceUpdate({\n      ...this.state.config,\n      editorJsonData: {\n        ...this.state.config.editorJsonData,\n        subscriptionId: subscription.value,\n      },\n    });\n  };\n\n  render() {\n    const { azureClouds, config, subscriptions } = this.state;\n    return (\n      <>\n        <h3 className=\"page-heading\">Azure Monitor Details</h3>\n        <AzureCredentialsForm\n          selectedAzureCloud={config.jsonData.cloudName}\n          azureCloudOptions={azureClouds}\n          subscriptionOptions={subscriptions}\n          selectedSubscription={config.editorJsonData.subscriptionId}\n          tenantId={config.editorJsonData.tenantId}\n          clientId={config.editorJsonData.clientId}\n          clientSecret={config.editorSecureJsonData.clientSecret}\n          clientSecretConfigured={config.secureJsonFields.clientSecret}\n          onAzureCloudChange={this.onAzureCloudSelect}\n          onSubscriptionSelectChange={this.onSubscriptionSelect}\n          onTenantIdChange={this.onTenantIdChange}\n          onClientIdChange={this.onClientIdChange}\n          onClientSecretChange={this.onClientSecretChange}\n          onResetClientSecret={this.onResetClientSecret}\n          onLoadSubscriptions={this.props.onLoadSubscriptions}\n        />\n      </>\n    );\n  }\n}\n\nexport default MonitorConfig;\n","import React, { PureComponent } from 'react';\nimport { SelectableValue } from '@grafana/data';\nimport { AzureCredentialsForm } from './AzureCredentialsForm';\nimport { Switch, FormLabel, Select, Button } from '@grafana/ui';\n\nexport interface Props {\n  datasourceConfig: any;\n  logAnalyticsSubscriptions: SelectableValue[];\n  logAnalyticsWorkspaces: SelectableValue[];\n  onDatasourceUpdate: (config: any) => void;\n  onLoadSubscriptions: (type?: string) => void;\n  onLoadWorkspaces: (type?: string) => void;\n}\n\nexport interface State {\n  config: any;\n  logAnalyticsSubscriptions: SelectableValue[];\n  logAnalyticsWorkspaces: SelectableValue[];\n}\n\nexport class AnalyticsConfig extends PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    const { datasourceConfig } = this.props;\n\n    this.state = {\n      config: datasourceConfig,\n      logAnalyticsSubscriptions: [],\n      logAnalyticsWorkspaces: [],\n    };\n  }\n\n  static getDerivedStateFromProps(props: Props, state: State) {\n    return {\n      ...state,\n      config: props.datasourceConfig,\n      logAnalyticsSubscriptions: props.logAnalyticsSubscriptions,\n      logAnalyticsWorkspaces: props.logAnalyticsWorkspaces,\n    };\n  }\n\n  onLogAnalyticsTenantIdChange = (logAnalyticsTenantId: string) => {\n    this.props.onDatasourceUpdate({\n      ...this.state.config,\n      editorJsonData: {\n        ...this.state.config.editorJsonData,\n        logAnalyticsTenantId,\n      },\n    });\n  };\n\n  onLogAnalyticsClientIdChange = (logAnalyticsClientId: string) => {\n    this.props.onDatasourceUpdate({\n      ...this.state.config,\n      editorJsonData: {\n        ...this.state.config.editorJsonData,\n        logAnalyticsClientId,\n      },\n    });\n  };\n\n  onLogAnalyticsClientSecretChange = (logAnalyticsClientSecret: string) => {\n    this.props.onDatasourceUpdate({\n      ...this.state.config,\n      editorSecureJsonData: {\n        ...this.state.config.editorSecureJsonData,\n        logAnalyticsClientSecret,\n      },\n    });\n  };\n\n  onLogAnalyticsResetClientSecret = () => {\n    this.props.onDatasourceUpdate({\n      ...this.state.config,\n      version: this.state.config.version + 1,\n      secureJsonFields: { ...this.state.config.secureJsonFields, logAnalyticsClientSecret: false },\n    });\n  };\n\n  onLogAnalyticsSubscriptionSelect = (logAnalyticsSubscription: SelectableValue<string>) => {\n    this.props.onDatasourceUpdate({\n      ...this.state.config,\n      editorJsonData: {\n        ...this.state.config.editorJsonData,\n        logAnalyticsSubscriptionId: logAnalyticsSubscription.value,\n      },\n    });\n  };\n\n  onWorkspaceSelectChange = (logAnalyticsDefaultWorkspace: SelectableValue<string>) => {\n    this.props.onDatasourceUpdate({\n      ...this.state.config,\n      editorJsonData: {\n        ...this.state.config.editorJsonData,\n        logAnalyticsDefaultWorkspace: logAnalyticsDefaultWorkspace.value,\n      },\n    });\n  };\n\n  onAzureLogAnalyticsSameAsChange = (azureLogAnalyticsSameAs: boolean) => {\n    this.props.onDatasourceUpdate({\n      ...this.state.config,\n      jsonData: {\n        ...this.state.config.jsonData,\n        azureLogAnalyticsSameAs,\n      },\n    });\n  };\n\n  hasWorkspaceRequiredFields = () => {\n    const {\n      config: { editorJsonData, editorSecureJsonData, jsonData, secureJsonFields },\n    } = this.state;\n\n    if (jsonData.azureLogAnalyticsSameAs) {\n      return (\n        editorJsonData.tenantId &&\n        editorJsonData.clientId &&\n        editorJsonData.subscriptionId &&\n        (editorSecureJsonData.clientSecret || secureJsonFields.clientSecret)\n      );\n    }\n\n    return (\n      editorJsonData.logAnalyticsTenantId.length &&\n      editorJsonData.logAnalyticsClientId.length &&\n      editorJsonData.logAnalyticsSubscriptionId &&\n      (secureJsonFields.logAnalyticsClientSecret || editorSecureJsonData.logAnalyticsClientSecret)\n    );\n  };\n\n  render() {\n    const {\n      config: { editorJsonData, editorSecureJsonData, jsonData, secureJsonFields },\n      logAnalyticsSubscriptions,\n      logAnalyticsWorkspaces,\n    } = this.state;\n\n    const addtlAttrs = {\n      ...(jsonData.azureLogAnalyticsSameAs && {\n        tooltip: 'Workspaces are pulled from default subscription selected above.',\n      }),\n    };\n    return (\n      <>\n        <h3 className=\"page-heading\">Azure Log Analytics API Details</h3>\n        <Switch\n          label=\"Same details as Azure Monitor API\"\n          checked={jsonData.azureLogAnalyticsSameAs}\n          onChange={event => this.onAzureLogAnalyticsSameAsChange(!jsonData.azureLogAnalyticsSameAs)}\n          {...addtlAttrs}\n        />\n        {!jsonData.azureLogAnalyticsSameAs && (\n          <AzureCredentialsForm\n            subscriptionOptions={logAnalyticsSubscriptions}\n            selectedSubscription={editorJsonData.logAnalyticsSubscriptionId}\n            tenantId={editorJsonData.logAnalyticsTenantId}\n            clientId={editorJsonData.logAnalyticsClientId}\n            clientSecret={editorSecureJsonData.logAnalyticsClientSecret}\n            clientSecretConfigured={secureJsonFields.logAnalyticsClientSecret}\n            onSubscriptionSelectChange={this.onLogAnalyticsSubscriptionSelect}\n            onTenantIdChange={this.onLogAnalyticsTenantIdChange}\n            onClientIdChange={this.onLogAnalyticsClientIdChange}\n            onClientSecretChange={this.onLogAnalyticsClientSecretChange}\n            onResetClientSecret={this.onLogAnalyticsResetClientSecret}\n            onLoadSubscriptions={() => this.props.onLoadSubscriptions('workspacesloganalytics')}\n          />\n        )}\n        <div className=\"gf-form-group\">\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <FormLabel\n                className=\"width-12\"\n                tooltip=\"Choose the default/preferred Workspace for Azure Log Analytics queries.\"\n              >\n                Default Workspace\n              </FormLabel>\n              <div className=\"width-25\">\n                <Select\n                  value={logAnalyticsWorkspaces.find(\n                    workspace => workspace.value === editorJsonData.logAnalyticsDefaultWorkspace\n                  )}\n                  options={logAnalyticsWorkspaces}\n                  defaultValue={editorJsonData.logAnalyticsDefaultWorkspace}\n                  onChange={this.onWorkspaceSelectChange}\n                />\n              </div>\n            </div>\n          </div>\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <div className=\"max-width-30 gf-form-inline\">\n                <Button\n                  variant=\"secondary\"\n                  size=\"sm\"\n                  type=\"button\"\n                  onClick={() => this.props.onLoadWorkspaces()}\n                  disabled={!this.hasWorkspaceRequiredFields()}\n                >\n                  Load Workspaces\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </>\n    );\n  }\n}\n\nexport default AnalyticsConfig;\n","import React, { PureComponent } from 'react';\nimport { FormLabel, Button, Input } from '@grafana/ui';\n\nexport interface Props {\n  datasourceConfig: any;\n  onDatasourceUpdate: (config: any) => void;\n}\n\nexport interface State {\n  config: any;\n}\n\nexport class InsightsConfig extends PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    const { datasourceConfig } = this.props;\n\n    this.state = {\n      config: datasourceConfig,\n    };\n  }\n\n  static getDerivedStateFromProps(props: Props, state: State) {\n    return {\n      ...state,\n      config: props.datasourceConfig,\n    };\n  }\n\n  onAppInsightsAppIdChange = (appInsightsAppId: string) => {\n    this.props.onDatasourceUpdate({\n      ...this.state.config,\n      editorJsonData: {\n        ...this.state.config.editorJsonData,\n        appInsightsAppId,\n      },\n    });\n  };\n\n  onAppInsightsApiKeyChange = (appInsightsApiKey: string) => {\n    this.props.onDatasourceUpdate({\n      ...this.state.config,\n      editorSecureJsonData: {\n        ...this.state.config.editorSecureJsonData,\n        appInsightsApiKey,\n      },\n    });\n  };\n\n  onAppInsightsResetApiKey = () => {\n    this.props.onDatasourceUpdate({\n      ...this.state.config,\n      version: this.state.config.version + 1,\n      secureJsonFields: {\n        ...this.state.config.secureJsonFields,\n        appInsightsApiKey: false,\n      },\n    });\n  };\n\n  render() {\n    const { config } = this.state;\n    return (\n      <>\n        <h3 className=\"page-heading\">Application Insights Details</h3>\n        <div className=\"gf-form-group\">\n          {config.secureJsonFields.appInsightsApiKey ? (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <FormLabel className=\"width-12\">API Key</FormLabel>\n                <Input className=\"width-25\" placeholder=\"configured\" disabled={true} />\n              </div>\n              <div className=\"gf-form\">\n                <div className=\"max-width-30 gf-form-inline\">\n                  <Button variant=\"secondary\" type=\"button\" onClick={this.onAppInsightsResetApiKey}>\n                    reset\n                  </Button>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <FormLabel className=\"width-12\">API Key</FormLabel>\n                <div className=\"width-15\">\n                  <Input\n                    className=\"width-30\"\n                    placeholder=\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n                    value={config.editorSecureJsonData.appInsightsApiKey}\n                    onChange={event => this.onAppInsightsApiKeyChange(event.target.value)}\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <FormLabel className=\"width-12\">Application ID</FormLabel>\n              <div className=\"width-15\">\n                <Input\n                  className=\"width-30\"\n                  value={config.editorJsonData.appInsightsAppId}\n                  onChange={event => this.onAppInsightsAppIdChange(event.target.value)}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </>\n    );\n  }\n}\n\nexport default InsightsConfig;\n","import React, { PureComponent } from 'react';\nimport { SelectableValue } from '@grafana/data';\nimport { DataSourcePluginOptionsEditorProps } from '@grafana/ui';\nimport { MonitorConfig } from './components/MonitorConfig';\nimport { AnalyticsConfig } from './components/AnalyticsConfig';\nimport { TemplateSrv } from 'app/features/templating/template_srv';\nimport { getBackendSrv, BackendSrv } from 'app/core/services/backend_srv';\nimport AzureMonitorDatasource from './azure_monitor/azure_monitor_datasource';\nimport AzureLogAnalyticsDatasource from './azure_log_analytics/azure_log_analytics_datasource';\nimport { InsightsConfig } from './components/InsightsConfig';\n\nexport type Props = DataSourcePluginOptionsEditorProps<any>;\n\nexport interface State {\n  config: any;\n  subscriptions: SelectableValue[];\n  logAnalyticsSubscriptions: SelectableValue[];\n  logAnalyticsWorkspaces: SelectableValue[];\n}\n\nexport class ConfigEditor extends PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    const { options } = this.props;\n\n    this.state = {\n      config: ConfigEditor.keyFill(options),\n      subscriptions: [],\n      logAnalyticsSubscriptions: [],\n      logAnalyticsWorkspaces: [],\n    };\n\n    this.backendSrv = getBackendSrv();\n    this.templateSrv = new TemplateSrv();\n\n    if (options.id) {\n      this.state.config.url = '/api/datasources/proxy/' + options.id;\n      this.init();\n    }\n\n    this.updateDatasource(this.state.config);\n  }\n\n  static getDerivedStateFromProps(props: Props, state: State) {\n    return {\n      ...state,\n      config: ConfigEditor.keyFill(props.options),\n    };\n  }\n\n  static keyFill = (options: any) => {\n    options.jsonData.cloudName = options.jsonData.cloudName || 'azuremonitor';\n\n    if (!options.jsonData.hasOwnProperty('azureLogAnalyticsSameAs')) {\n      options.jsonData.azureLogAnalyticsSameAs = true;\n    }\n\n    if (!options.hasOwnProperty('editorSecureJsonData')) {\n      options.editorSecureJsonData = {\n        clientSecret: '',\n        logAnalyticsClientSecret: '',\n        appInsightsApiKey: '',\n      };\n    }\n\n    if (!options.hasOwnProperty('editorJsonData')) {\n      options.editorJsonData = {\n        clientId: options.jsonData.clientId || '',\n        tenantId: options.jsonData.tenantId || '',\n        subscriptionId: options.jsonData.subscriptionId || '',\n        logAnalyticsClientId: options.jsonData.logAnalyticsClientId || '',\n        logAnalyticsDefaultWorkspace: options.jsonData.logAnalyticsDefaultWorkspace || '',\n        logAnalyticsTenantId: options.jsonData.logAnalyticsTenantId || '',\n        logAnalyticsSubscriptionId: options.jsonData.logAnalyticsSubscriptionId || '',\n        appInsightsAppId: options.jsonData.appInsightsAppId || '',\n      };\n    }\n\n    if (!options.hasOwnProperty('secureJsonFields')) {\n      options.secureJsonFields = {\n        clientSecret: false,\n        logAnalyticsClientSecret: false,\n        appInsightsApiKey: false,\n      };\n    }\n\n    return options;\n  };\n\n  backendSrv: BackendSrv = null;\n  templateSrv: TemplateSrv = null;\n\n  init = async () => {\n    await this.getSubscriptions();\n\n    if (!this.state.config.jsonData.azureLogAnalyticsSameAs) {\n      await this.getLogAnalyticsSubscriptions();\n    }\n  };\n\n  updateDatasource = async (config: any) => {\n    for (const j in config.jsonData) {\n      if (config.jsonData[j].length === 0) {\n        delete config.jsonData[j];\n      }\n    }\n\n    for (const k in config.secureJsonData) {\n      if (config.secureJsonData[k].length === 0) {\n        delete config.secureJsonData[k];\n      }\n    }\n\n    for (const m in config.editorJsonData) {\n      if (!config.hasOwnProperty('jsonData')) {\n        config.jsonData = {};\n      }\n      if (config.editorJsonData[m].length === 0) {\n        if (config.hasOwnProperty('jsonData') && config.jsonData.hasOwnProperty(m)) {\n          delete config.jsonData[m];\n        }\n      } else {\n        config.jsonData[m] = config.editorJsonData[m];\n      }\n    }\n\n    for (const l in config.editorSecureJsonData) {\n      if (!config.hasOwnProperty('secureJsonData')) {\n        config.secureJsonData = {};\n      }\n      if (config.editorSecureJsonData[l].length === 0) {\n        if (config.hasOwnProperty('secureJsonData') && config.secureJsonData.hasOwnProperty(l)) {\n          delete config.secureJsonData[l];\n        }\n      } else {\n        config.secureJsonData[l] = config.editorSecureJsonData[l];\n      }\n    }\n\n    this.props.onOptionsChange({\n      ...config,\n    });\n  };\n\n  hasNecessaryCredentials = () => {\n    if (!this.state.config.secureJsonFields.clientSecret && !this.state.config.editorSecureJsonData.clientSecret) {\n      return false;\n    }\n\n    if (!this.state.config.jsonData.clientId || !this.state.config.jsonData.tenantId) {\n      return false;\n    }\n\n    return true;\n  };\n\n  logAnalyticsHasNecessaryCredentials = () => {\n    if (\n      !this.state.config.secureJsonFields.logAnalyticsClientSecret &&\n      !this.state.config.editorSecureJsonData.logAnalyticsClientSecret\n    ) {\n      return false;\n    }\n\n    if (!this.state.config.jsonData.logAnalyticsClientId || !this.state.config.jsonData.logAnalyticsTenantId) {\n      return false;\n    }\n\n    return true;\n  };\n\n  onConfigUpdate = (config: any) => {\n    this.updateDatasource(config);\n  };\n\n  onLoadSubscriptions = async (type?: string) => {\n    await this.backendSrv.put(`/api/datasources/${this.state.config.id}`, this.state.config).then(() => {\n      this.updateDatasource({\n        ...this.state.config,\n        version: this.state.config.version + 1,\n      });\n    });\n\n    if (type && type === 'workspacesloganalytics') {\n      this.getLogAnalyticsSubscriptions();\n    } else {\n      this.getSubscriptions();\n    }\n  };\n\n  getSubscriptions = async () => {\n    if (!this.hasNecessaryCredentials()) {\n      return;\n    }\n\n    const azureMonitorDatasource = new AzureMonitorDatasource(this.state.config, this.backendSrv, this.templateSrv);\n\n    let subscriptions = (await azureMonitorDatasource.getSubscriptions()) || [];\n    subscriptions = subscriptions.map((subscription: any) => {\n      return {\n        value: subscription.value,\n        label: subscription.text,\n      };\n    });\n\n    if (subscriptions && subscriptions.length > 0) {\n      this.setState({ subscriptions });\n\n      this.state.config.editorJsonData.subscriptionId =\n        this.state.config.editorJsonData.subscriptionId || subscriptions[0].value;\n    }\n\n    if (this.state.config.editorJsonData.subscriptionId && this.state.config.jsonData.azureLogAnalyticsSameAs) {\n      await this.getWorkspaces();\n    }\n  };\n\n  getLogAnalyticsSubscriptions = async () => {\n    if (!this.logAnalyticsHasNecessaryCredentials()) {\n      return;\n    }\n\n    const azureMonitorDatasource = new AzureMonitorDatasource(this.state.config, this.backendSrv, this.templateSrv);\n\n    let logAnalyticsSubscriptions = (await azureMonitorDatasource.getSubscriptions('workspacesloganalytics')) || [];\n    logAnalyticsSubscriptions = logAnalyticsSubscriptions.map((subscription: any) => {\n      return {\n        value: subscription.value,\n        label: subscription.text,\n      };\n    });\n\n    if (logAnalyticsSubscriptions && logAnalyticsSubscriptions.length > 0) {\n      this.setState({ logAnalyticsSubscriptions });\n\n      this.state.config.editorJsonData.logAnalyticsSubscriptionId =\n        this.state.config.editorJsonData.logAnalyticsSubscriptionId || logAnalyticsSubscriptions[0].value;\n    }\n\n    if (this.state.config.editorJsonData.logAnalyticsSubscriptionId) {\n      await this.getWorkspaces();\n    }\n  };\n\n  getWorkspaces = async () => {\n    const sameAs =\n      this.state.config.jsonData.azureLogAnalyticsSameAs && this.state.config.editorJsonData.subscriptionId;\n    if (!sameAs && !this.state.config.editorJsonData.logAnalyticsSubscriptionId) {\n      return;\n    }\n\n    const azureLogAnalyticsDatasource = new AzureLogAnalyticsDatasource(\n      this.state.config,\n      this.backendSrv,\n      this.templateSrv\n    );\n\n    let logAnalyticsWorkspaces = await azureLogAnalyticsDatasource.getWorkspaces(\n      sameAs\n        ? this.state.config.editorJsonData.subscriptionId\n        : this.state.config.editorJsonData.logAnalyticsSubscriptionId\n    );\n    logAnalyticsWorkspaces = logAnalyticsWorkspaces.map((workspace: any) => {\n      return {\n        value: workspace.value,\n        label: workspace.text,\n      };\n    });\n\n    if (logAnalyticsWorkspaces.length > 0) {\n      this.setState({ logAnalyticsWorkspaces });\n\n      this.state.config.editorJsonData.logAnalyticsDefaultWorkspace =\n        this.state.config.editorJsonData.logAnalyticsDefaultWorkspace || logAnalyticsWorkspaces[0].value;\n    }\n  };\n\n  render() {\n    const { config, subscriptions, logAnalyticsSubscriptions, logAnalyticsWorkspaces } = this.state;\n\n    return (\n      <>\n        <MonitorConfig\n          datasourceConfig={config}\n          subscriptions={subscriptions}\n          onLoadSubscriptions={this.onLoadSubscriptions}\n          onDatasourceUpdate={this.onConfigUpdate}\n        />\n\n        <AnalyticsConfig\n          datasourceConfig={config}\n          logAnalyticsWorkspaces={logAnalyticsWorkspaces}\n          logAnalyticsSubscriptions={logAnalyticsSubscriptions}\n          onLoadSubscriptions={this.onLoadSubscriptions}\n          onDatasourceUpdate={this.onConfigUpdate}\n          onLoadWorkspaces={this.getWorkspaces}\n        />\n\n        <InsightsConfig datasourceConfig={config} onDatasourceUpdate={this.onConfigUpdate} />\n      </>\n    );\n  }\n}\n\nexport default ConfigEditor;\n","import { TemplateSrv } from 'app/features/templating/template_srv';\n\nexport class AzureMonitorAnnotationsQueryCtrl {\n  static templateUrl = 'partials/annotations.editor.html';\n  datasource: any;\n  annotation: any;\n  workspaces: any[];\n  subscriptions: Array<{ text: string; value: string }>;\n\n  defaultQuery =\n    '<your table>\\n| where $__timeFilter() \\n| project TimeGenerated, Text=YourTitleColumn, Tags=\"tag1,tag2\"';\n\n  /** @ngInject */\n  constructor(private templateSrv: TemplateSrv) {\n    this.annotation.queryType = this.annotation.queryType || 'Azure Log Analytics';\n    this.annotation.rawQuery = this.annotation.rawQuery || this.defaultQuery;\n    this.initDropdowns();\n  }\n\n  async initDropdowns() {\n    await this.getSubscriptions();\n    await this.getWorkspaces();\n  }\n\n  async getSubscriptions() {\n    if (!this.datasource.azureMonitorDatasource.isConfigured()) {\n      return;\n    }\n\n    return this.datasource.azureMonitorDatasource.getSubscriptions().then((subs: any[]) => {\n      this.subscriptions = subs;\n\n      if (!this.annotation.subscription && this.annotation.queryType === 'Azure Log Analytics') {\n        this.annotation.subscription = this.datasource.azureLogAnalyticsDatasource.subscriptionId;\n      }\n\n      if (!this.annotation.subscription && this.subscriptions.length > 0) {\n        this.annotation.subscription = this.subscriptions[0].value;\n      }\n    });\n  }\n\n  async getWorkspaces(bustCache?: boolean) {\n    if (!bustCache && this.workspaces && this.workspaces.length > 0) {\n      return this.workspaces;\n    }\n\n    return this.datasource\n      .getAzureLogAnalyticsWorkspaces(this.annotation.subscription)\n      .then((list: any[]) => {\n        this.workspaces = list;\n        if (list.length > 0 && !this.annotation.workspace) {\n          this.annotation.workspace = list[0].value;\n        }\n        return this.workspaces;\n      })\n      .catch(() => {});\n  }\n\n  getAzureLogAnalyticsSchema = () => {\n    return this.getWorkspaces()\n      .then(() => {\n        return this.datasource.azureLogAnalyticsDatasource.getSchema(this.annotation.workspace);\n      })\n      .catch(() => {});\n  };\n\n  onSubscriptionChange = () => {\n    this.getWorkspaces(true);\n  };\n\n  onLogAnalyticsQueryChange = (nextQuery: string) => {\n    this.annotation.rawQuery = nextQuery;\n  };\n\n  get templateVariables() {\n    return this.templateSrv.variables.map((t: any) => '$' + t.name);\n  }\n}\n","import { DataSourcePlugin } from '@grafana/ui';\nimport { AzureMonitorQueryCtrl } from './query_ctrl';\nimport Datasource from './datasource';\nimport { ConfigEditor } from './ConfigEditor';\nimport { AzureMonitorAnnotationsQueryCtrl } from './annotations_query_ctrl';\n\nexport const plugin = new DataSourcePlugin(Datasource)\n  .setConfigEditor(ConfigEditor)\n  .setQueryCtrl(AzureMonitorQueryCtrl)\n  .setAnnotationQueryCtrl(AzureMonitorAnnotationsQueryCtrl);\n"],"sourceRoot":""}