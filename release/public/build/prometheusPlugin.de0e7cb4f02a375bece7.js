(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{EaOu:function(e,t,a){"use strict";a.r(t);var r=a("Obii"),s=a("t8hP"),n=a("m257"),i=a("NPB1"),o=a("5kRJ"),l=a("LvDl"),c=a("HyWp"),u=a.n(c),h=a("K9Ia"),d=a("F/XL"),p=a("y3By"),m=a("p0ib"),g=a("VNr4"),b=a("XlPw"),v=a("xMyE"),f=a("VnD/"),y=a("67Y/"),j=a("9Z1F"),x=a("eqT+"),O=a("48Ei"),S=a("ceQ3");function _(){return(_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var T=a("VphZ");function w(e){return"values"in e}function I(){return(I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function C(e,t){const a={format:t.target.format,step:t.query.step,legendFormat:t.target.legendFormat,start:t.query.start,end:t.query.end,query:t.query.expr,responseListLength:t.responseListLength,scopedVars:t.scopedVars,refId:t.target.refId,valueWithRefId:t.target.valueWithRefId,meta:{preferredVisualisationType:t.query.instant?"table":"graph"}},n=e.data.data;if(null!=(l=n)&&Array.isArray(l)&&l.length&&"exemplars"in l[0]){var i;const e=[];n.forEach(t=>{const a=t.exemplars.map(e=>I({[r.TIME_SERIES_TIME_FIELD_NAME]:1e3*e.timestamp,[r.TIME_SERIES_VALUE_FIELD_NAME]:e.value},e.labels,t.seriesLabels));e.push(...a)});const s=function(e,t){const a=t.step||15,s={},n=[];for(const t of e){const e=String(Math.floor(t[r.TIME_SERIES_TIME_FIELD_NAME]/1e3/a)*a*1e3);s[e]||(s[e]=[]),s[e].push(t),n.push(t[r.TIME_SERIES_VALUE_FIELD_NAME])}const i=Object(T.deviation)(n),o=Object.keys(s).sort(),l=[];for(const e of o){const t=s[e];if(1===t.length)l.push(t[0]);else{const e=t.map(e=>e[r.TIME_SERIES_VALUE_FIELD_NAME]).sort(T.descending).reduce((e,t)=>{if(0===e.length)e.push(t);else{const a=e[e.length-1];i&&a-t>=2*i&&e.push(t)}return e},[]);l.push(...e.map(e=>t.find(t=>t[r.TIME_SERIES_VALUE_FIELD_NAME]===e)))}}return l}(e,a),l=new r.ArrayDataFrame(s);if(l.meta={dataTopic:r.DataTopic.Annotations},null!==(i=t.exemplarTraceIdDestinations)&&void 0!==i&&i.length)for(const e of t.exemplarTraceIdDestinations){const t=l.fields.find(t=>t.name===e.name);if(t){var o;const a=E(e);t.config.links=null!==(o=t.config.links)&&void 0!==o&&o.length?[...t.config.links,...a]:a}}return[l]}var l;if(null==n||!n.result)return[];if("scalar"===n.resultType)return[{meta:a.meta,refId:a.refId,length:1,fields:[P([n.result]),D({data:[n.result]})]}];if("table"===a.format){return[function(e,t){if(!e||0===e.length)return{meta:t.meta,refId:t.refId,length:0,fields:[]};const a=t.responseListLength>1||t.valueWithRefId?"Value #"+t.refId:"Value",s=P([]),n=Object.keys(e.reduce((e,t)=>I({},e,t.metric),{})).sort().map(e=>({name:e,config:{filterable:!0},type:"le"===e?r.FieldType.number:r.FieldType.string,values:new r.ArrayVector})),i=D({data:[],valueName:a});return e.forEach(e=>{w(e)?e.values.forEach(t=>{s.values.add(1e3*t[0]),n.forEach(t=>t.values.add(q(e.metric,t.name))),i.values.add(F(t[1]))}):(s.values.add(1e3*e.value[0]),n.forEach(t=>t.values.add(q(e.metric,t.name))),i.values.add(F(e.value[1])))}),{meta:t.meta,refId:t.refId,length:s.values.length,fields:[s,...n,i]}}(n.result,a)]}const c=[];if(n.result.forEach(e=>c.push(function(e,t){const{name:a,labels:n}=function(e,t){if(null!=t&&t.legendFormat){return{name:L(Object(s.getTemplateSrv)().replace(t.legendFormat,null==t?void 0:t.scopedVars),e),labels:e}}const{__name__:a}=e,n=function(e,t){if(null==e)return{};var a,r,s={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e,["__name__"]),i=Object(r.formatLabels)(n);let o=`${null!=a?a:""}${i}`;o||(o=t.query);return{name:o,labels:n}}(e.metric,t),i=[];if(w(e)){const r=t.step?1e3*t.step:NaN;let s=1e3*t.start;const o=[];for(const t of e.values){let e=F(t[1]);isNaN(e)&&(e=null);const a=1e3*t[0];for(let e=s;e<a;e+=r)o.push([e,null]);s=a+r,o.push([a,e])}const l=1e3*t.end;for(let e=s;e<=l;e+=r)o.push([e,null]);i.push(P(o,!0)),i.push(D({data:o,parseValue:!1,labels:n,displayNameFromDS:a}))}else i.push(P([e.value])),i.push(D({data:[e.value],labels:n,displayNameFromDS:a}));return{meta:t.meta,refId:t.refId,length:i[0].values.length,fields:i,name:a}}(e,a))),"heatmap"===a.format){c.sort(k);return function(e){for(let t=e.length-1;t>0;t--){const a=e[t].fields.find(e=>e.name===r.TIME_SERIES_VALUE_FIELD_NAME),s=e[t-1].fields.find(e=>e.name===r.TIME_SERIES_VALUE_FIELD_NAME);if(!a||!s)throw new Error("Prometheus heatmap transform error: data should be a time series");for(let e=0;e<a.values.length;e++){const t=s.values.get(e)||[0];a.values.toArray()[e]-=t}}return e}(c)}return c}function E(e){const t=[];if(e.datasourceUid){var a;const r=Object(s.getDataSourceSrv)().getInstanceSettings(e.datasourceUid);t.push({title:"Query with "+(null==r?void 0:r.name),url:"",internal:{query:{query:"${__value.raw}",queryType:"traceId"},datasourceUid:e.datasourceUid,datasourceName:null!==(a=null==r?void 0:r.name)&&void 0!==a?a:"Data source not found"}})}return e.url&&t.push({title:"Go to "+e.url,url:e.url,targetBlank:!0}),t}function q(e,t){return e.hasOwnProperty(t)?"le"===t?F(e[t]):e[t]:""}function P(e,t=!1){return{name:r.TIME_SERIES_TIME_FIELD_NAME,type:r.FieldType.time,config:{},values:new r.ArrayVector(e.map(e=>t?e[0]:1e3*e[0]))}}function D({data:e,valueName:t=r.TIME_SERIES_VALUE_FIELD_NAME,parseValue:a=!0,labels:s,displayNameFromDS:n}){return{name:t,type:r.FieldType.number,display:Object(r.getDisplayProcessor)(),config:{displayNameFromDS:n},labels:s,values:new r.ArrayVector(e.map(e=>a?F(e[1]):e[1]))}}function L(e,t){return e.replace(/\{\{\s*(.+?)\s*\}\}/g,(e,a)=>t[a]?t[a]:"")}function k(e,t){let a,r;try{var s,n;a=F(null!==(s=e.name)&&void 0!==s?s:""),r=F(null!==(n=t.name)&&void 0!==n?n:"")}catch(e){return console.error(e),0}return a>r?1:a<r?-1:0}function F(e){switch(e){case"+Inf":return Number.POSITIVE_INFINITY;case"-Inf":return Number.NEGATIVE_INFINITY;default:return parseFloat(e)}}var N=a("0/uQ");class R{constructor(e,t){this.range=void 0,this.datasource=e,this.query=t,this.datasource=e,this.query=t,this.range=Object(i.a)().timeRange()}process(){if(this.query.match(/^label_names\(\)\s*$/))return this.labelNamesQuery();const e=this.query.match(/^label_values\((?:(.+),\s*)?([a-zA-Z_][a-zA-Z0-9_]*)\)\s*$/);if(e)return e[1]?this.labelValuesQuery(e[2],e[1]):this.labelValuesQuery(e[2]);const t=this.query.match(/^metrics\((.+)\)\s*$/);if(t)return this.metricNameQuery(t[1]);const a=this.query.match(/^query_result\((.+)\)\s*$/);return a?this.queryResultQuery(a[1]).toPromise():this.metricNameAndLabelsQuery(this.query)}labelNamesQuery(){const e=this.datasource.getPrometheusTime(this.range.from,!1),t=this.datasource.getPrometheusTime(this.range.to,!0),a={start:e.toString(),end:t.toString()};return this.datasource.metadataRequest("/api/v1/labels",a).then(e=>Object(l.map)(e.data.data,e=>({text:e})))}labelValuesQuery(e,t){const a=this.datasource.getPrometheusTime(this.range.from,!1),r=this.datasource.getPrometheusTime(this.range.to,!0);let s;if(t){const n={"match[]":t,start:a.toString(),end:r.toString()};return s="/api/v1/series",this.datasource.metadataRequest(s,n).then(t=>{const a=Object(l.map)(t.data.data,t=>t[e]||"").filter(e=>""!==e);return Object(l.uniq)(a).map(e=>({text:e,expandable:!0}))})}{const t={start:a.toString(),end:r.toString()};return s=`/api/v1/label/${e}/values`,this.datasource.metadataRequest(s,t).then(e=>Object(l.map)(e.data.data,e=>({text:e})))}}metricNameQuery(e){const t=this.datasource.getPrometheusTime(this.range.from,!1),a=this.datasource.getPrometheusTime(this.range.to,!0),r={start:t.toString(),end:a.toString()};return this.datasource.metadataRequest("/api/v1/label/__name__/values",r).then(t=>Object(l.chain)(t.data.data).filter(t=>new RegExp(e).test(t)).map(e=>({text:e,expandable:!0})).value())}queryResultQuery(e){const t=this.datasource.getPrometheusTime(this.range.to,!0),a={expr:e};return this.datasource.performInstantQuery(a,t).pipe(Object(y.a)(e=>Object(l.map)(e.data.data.result,e=>{let t=e.metric.__name__||"";return delete e.metric.__name__,t+="{"+Object(l.map)(e.metric,(e,t)=>t+'="'+e+'"').join(",")+"}",t+=" "+e.value[1]+" "+1e3*e.value[0],{text:t,expandable:!0}})))}metricNameAndLabelsQuery(e){const t=this.datasource.getPrometheusTime(this.range.from,!1),a=this.datasource.getPrometheusTime(this.range.to,!0),r={"match[]":e,start:t.toString(),end:a.toString()},s=this;return this.datasource.metadataRequest("/api/v1/series",r).then(e=>Object(l.map)(e.data.data,e=>({text:s.datasource.getOriginalMetricName(e),expandable:!0})))}}function Q(){return(Q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}class M extends r.StandardVariableSupport{constructor(e,t=Object(s.getTemplateSrv)(),a=Object(i.a)()){super(),this.datasource=e,this.templateSrv=t,this.timeSrv=a,this.query=this.query.bind(this)}query(e){const t=e.targets[0].expr;if(!t)return Object(d.a)({data:[]});const a=Q({},e.scopedVars,{__interval:{text:this.datasource.interval,value:this.datasource.interval},__interval_ms:{text:r.rangeUtil.intervalToMs(this.datasource.interval),value:r.rangeUtil.intervalToMs(this.datasource.interval)}},this.datasource.getRangeScopedVars(this.timeSrv.timeRange())),s=this.templateSrv.replace(t,a,this.datasource.interpolateQueryExpr),n=new R(this.datasource,s);return Object(N.a)(n.process()).pipe(Object(y.a)(e=>({data:e})))}toDataQuery(e){return{refId:"PrometheusDatasource-VariableQuery",expr:e.query}}}function $(){return($=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const A=["api/v1/query","api/v1/query_range","api/v1/series","api/v1/labels"];class V extends r.DataSourceApi{constructor(e,t=Object(o.a)(),a=Object(i.a)()){var s;super(e),this.type=void 0,this.editorSrc=void 0,this.ruleMappings=void 0,this.url=void 0,this.directUrl=void 0,this.basicAuth=void 0,this.withCredentials=void 0,this.metricsNameCache=new u.a(10),this.interval=void 0,this.queryTimeout=void 0,this.httpMethod=void 0,this.languageProvider=void 0,this.exemplarTraceIdDestinations=void 0,this.lookupsDisabled=void 0,this.customQueryParameters=void 0,this.exemplarErrors=new h.b,this.init=()=>{this.loadRules()},this.prepareTargets=(e,t,a)=>{const s=[],n=[],i=Object(l.cloneDeep)(e.targets);for(const o of i){if(!o.expr||o.hide)continue;o.requestId=e.panelId+o.refId;const i=this.languageProvider.histogramMetrics.find(e=>o.expr.includes(e));if(e.app===r.CoreApp.Explore&&o.range===o.instant){const r=Object(l.cloneDeep)(o);r.format="table",r.instant=!0,r.range=!1,r.valueWithRefId=!0,delete r.maxDataPoints,r.requestId+="_instant";const c=Object(l.cloneDeep)(o);if(c.format="time_series",c.instant=!1,r.range=!0,o.exemplar){if(!i||i&&!n.some(e=>e.expr.includes(i))){const r=Object(l.cloneDeep)(o);r.instant=!1,r.requestId+="_exemplar",s.push(this.createQuery(r,e,t,a)),n.push(r)}r.exemplar=!1,c.exemplar=!1}n.push(r,c),s.push(this.createQuery(r,e,t,a),this.createQuery(c,e,t,a))}else if(o.instant&&e.app===r.CoreApp.Explore){const r=Object(l.cloneDeep)(o);r.format="table",s.push(this.createQuery(r,e,t,a)),n.push(r)}else{if(o.exemplar&&!o.instant){if(!i||i&&!n.some(e=>e.expr.includes(i))){const r=Object(l.cloneDeep)(o);r.requestId+="_exemplar",s.push(this.createQuery(r,e,t,a)),n.push(r),this.exemplarErrors.next()}o.exemplar=!1}o.exemplar&&o.instant&&this.exemplarErrors.next("Exemplars are not available for instant queries."),s.push(this.createQuery(o,e,t,a)),n.push(o)}}return{queries:s,activeTargets:n}},this.handleErrors=(e,t)=>{const a={message:e&&e.statusText||"Unknown error during query transaction. Please check JS console logs.",refId:t.refId};return e.data?"string"==typeof e.data?a.message=e.data:e.data.error&&(a.message=Object(n.q)(e.data.error)):e.message?a.message=e.message:"string"==typeof e&&(a.message=e),a.status=e.status,a.statusText=e.statusText,a},this.createAnnotationQueryOptions=e=>{const t=e.annotation;return $({},e,{interval:t&&t.step&&"string"==typeof t.step?t.step:"60s"})},this.templateSrv=t,this.timeSrv=a,this.type="prometheus",this.editorSrc="app/features/prometheus/partials/query.editor.html",this.url=e.url,this.basicAuth=e.basicAuth,this.withCredentials=e.withCredentials,this.interval=e.jsonData.timeInterval||"15s",this.queryTimeout=e.jsonData.queryTimeout,this.httpMethod=e.jsonData.httpMethod||"POST",this.directUrl=e.jsonData.directUrl,this.exemplarTraceIdDestinations=e.jsonData.exemplarTraceIdDestinations,this.ruleMappings={},this.languageProvider=new O.b(this),this.lookupsDisabled=null!==(s=e.jsonData.disableMetricsLookup)&&void 0!==s&&s,this.customQueryParameters=new URLSearchParams(e.jsonData.customQueryParameters),this.variables=new M(this,this.templateSrv,this.timeSrv)}getQueryDisplayText(e){return e.expr}_addTracingHeaders(e,t){e.headers={};!this.url.match(/^http/)&&(e.headers["X-Dashboard-Id"]=t.dashboardId,e.headers["X-Panel-Id"]=t.panelId)}_request(e,t,a={}){t=t||{};for(const[e,a]of this.customQueryParameters)null==t[e]&&(t[e]=a);const r=Object(l.defaults)(a,{url:this.url+e,method:this.httpMethod,headers:{}});return"GET"===r.method?t&&Object.keys(t).length&&(r.url=r.url+(r.url.search(/\?/)>=0?"&":"?")+Object.entries(t).map(([e,t])=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`).join("&")):(r.headers["Content-Type"]="application/x-www-form-urlencoded",r.data=t),(this.basicAuth||this.withCredentials)&&(r.withCredentials=!0),this.basicAuth&&(r.headers.Authorization=this.basicAuth),Object(s.getBackendSrv)().fetch(r)}async metadataRequest(e,t={}){if(A.some(t=>e.includes(t)))try{return await this._request(e,t,{method:this.httpMethod,hideFromInspector:!0}).toPromise()}catch(e){if("POST"!==this.httpMethod||405!==e.status)throw e;console.warn("Couldn't use configured POST HTTP method for this request. Trying to use GET method instead.")}return await this._request(e,t,{method:"GET",hideFromInspector:!0}).toPromise()}interpolateQueryExpr(e=[],t){if(!t.multi&&!t.includeAll)return U(e);if("string"==typeof e)return B(e);const a=e.map(e=>B(e));return 1===a.length?a[0]:"("+a.join("|")+")"}targetContainsTemplate(e){return this.templateSrv.variableExists(e.expr)}query(e){const t=this.getPrometheusTime(e.range.from,!1),a=this.getPrometheusTime(e.range.to,!0),{queries:s,activeTargets:n}=this.prepareTargets(e,t,a);return s&&s.length?e.app===r.CoreApp.Explore?this.exploreQuery(s,n,a):this.panelsQuery(s,n,a,e.requestId,e.scopedVars):Object(d.a)({data:[],state:r.LoadingState.Done})}exploreQuery(e,t,a){let s=e.length;const n=e.map((n,i)=>{const o=t[i],l=Object(p.a)(Object(v.a)(()=>s--),Object(f.a)(e=>!e.cancelled),Object(y.a)(t=>({data:C(t,{query:n,target:o,responseListLength:e.length,exemplarTraceIdDestinations:this.exemplarTraceIdDestinations}),key:n.requestId,state:0===s?r.LoadingState.Done:r.LoadingState.Loading})));return this.runQuery(n,a,l)});return Object(m.a)(...n)}panelsQuery(e,t,a,s,n){const i=e.map((r,s)=>{const i=t[s],o=Object(p.a)(Object(f.a)(e=>!e.cancelled),Object(y.a)(t=>C(t,{query:r,target:i,responseListLength:e.length,scopedVars:n,exemplarTraceIdDestinations:this.exemplarTraceIdDestinations})));return this.runQuery(r,a,o)});return Object(g.a)(i).pipe(Object(y.a)(e=>({data:e.reduce((e,t)=>[...e,...t],[]),key:s,state:r.LoadingState.Done})))}runQuery(e,t,a){return e.instant?this.performInstantQuery(e,t).pipe(a):e.exemplar?this.getExemplars(e).pipe(Object(j.a)(e=>(this.exemplarErrors.next("Exemplars for this data source are not available."),Object(d.a)({data:[],state:r.LoadingState.Done}))),a):this.performTimeSeriesQuery(e,e.start,e.end).pipe(a)}createQuery(e,t,a,s){const n={hinting:e.hinting,instant:e.instant,exemplar:e.exemplar,step:0,expr:"",requestId:e.requestId,refId:e.refId,start:0,end:0},i=Math.ceil(s-a);let o=r.rangeUtil.intervalToSeconds(t.interval);const l=r.rangeUtil.intervalToSeconds(this.templateSrv.replace(e.interval||t.interval,t.scopedVars)),c=e.interval?r.rangeUtil.intervalToSeconds(this.templateSrv.replace(e.interval,t.scopedVars)):r.rangeUtil.intervalToSeconds(this.interval),u=e.intervalFactor||1,h=this.adjustInterval(o,l,i,u);let d=$({},t.scopedVars,this.getRangeScopedVars(t.range),this.getRateIntervalScopedVariable(h,c));o!==h&&(o=h,d=Object.assign({},t.scopedVars,$({__interval:{text:o+"s",value:o+"s"},__interval_ms:{text:1e3*o,value:1e3*o}},this.getRateIntervalScopedVariable(o,c),this.getRangeScopedVars(t.range)))),n.step=o;let p=e.expr;p=this.templateSrv.getAdhocFilters(this.name).reduce((e,t)=>{const{key:a,operator:r}=t;let{value:s}=t;return"=~"!==r&&"!~"!==r||(s=U(s)),Object(x.b)(e,a,s,r)},p),n.expr=this.templateSrv.replace(p,d,this.interpolateQueryExpr);const m=function(e,t,a,r){const s=Math.floor((t+r)/a)*a-r,n=Math.floor((e+r)/a)*a-r;return{end:s,start:n}}(a,s,n.step,60*this.timeSrv.timeRange().to.utcOffset());return n.start=m.start,n.end=m.end,this._addTracingHeaders(n,t),n}getRateIntervalScopedVariable(e,t){0===t&&(t=15);const a=Math.max(e+t,4*t);return{__rate_interval:{text:a+"s",value:a+"s"}}}adjustInterval(e,t,a,r){let s=a/11e3;return s>1&&(s=Math.ceil(s)),Math.max(e*r,t,s)}performTimeSeriesQuery(e,t,a){if(t>a)throw{message:"Invalid time range"};const r={query:e.expr,start:t,end:a,step:e.step};return this.queryTimeout&&(r.timeout=this.queryTimeout),this._request("/api/v1/query_range",r,{requestId:e.requestId,headers:e.headers}).pipe(Object(j.a)(t=>t.cancelled?Object(d.a)(t):Object(b.a)(this.handleErrors(t,e))))}performInstantQuery(e,t){const a={query:e.expr,time:t};return this.queryTimeout&&(a.timeout=this.queryTimeout),this._request("/api/v1/query",a,{requestId:e.requestId,headers:e.headers}).pipe(Object(j.a)(t=>t.cancelled?Object(d.a)(t):Object(b.a)(this.handleErrors(t,e))))}metricFindQuery(e){if(!e)return Promise.resolve([]);const t=$({__interval:{text:this.interval,value:this.interval},__interval_ms:{text:r.rangeUtil.intervalToMs(this.interval),value:r.rangeUtil.intervalToMs(this.interval)}},this.getRangeScopedVars(this.timeSrv.timeRange())),a=this.templateSrv.replace(e,t,this.interpolateQueryExpr);return new R(this,a).process()}getRangeScopedVars(e=this.timeSrv.timeRange()){const t=e.to.diff(e.from),a=Math.round(t/1e3);return{__range_ms:{text:t,value:t},__range_s:{text:a,value:a},__range:{text:a+"s",value:a+"s"}}}async annotationQuery(e){var t,a,r,s;const n=e.annotation,{expr:i="",tagKeys:o="",titleFormat:l="",textFormat:c=""}=n;if(!i)return Promise.resolve([]);const u=this.getPrometheusTime(e.range.from,!1),h=this.getPrometheusTime(e.range.to,!0),d=this.createAnnotationQueryOptions(e),p={expr:i,interval:"1s",refId:"X",requestId:"prom-query-"+n.name},m=this.createQuery(p,d,u,h),g=await this.performTimeSeriesQuery(m,m.start,m.end).toPromise(),b=[],v=o.split(",");if(function(e){return"cancelled"in e}(g)&&g.cancelled)return[];const f=1e3*Math.floor(null!==(t=m.step)&&void 0!==t?t:15);return null==g||null===(a=g.data)||void 0===a||null===(r=a.data)||void 0===r||null===(s=r.result)||void 0===s||s.forEach(e=>{const t=Object.entries(e.metric).filter(([e])=>v.includes(e)).map(([e,t])=>t);e.values.forEach(e=>{let t;n.useValueForTime?(t=Math.floor(parseFloat(e[1])),e[1]=1):t=1e3*Math.floor(parseFloat(e[0])),e[0]=t});const a=e.values.filter(e=>parseFloat(e[1])>=1).map(e=>e[0]);let r=null;for(const i of a){var s;r&&(null!==(s=r.timeEnd)&&void 0!==s?s:0)+f>=i?r.timeEnd=i:(r&&b.push(r),r={time:i,timeEnd:i,annotation:n,title:L(l,e.metric),tags:t,text:L(c,e.metric)})}r&&(r.timeEnd=a[a.length-1],b.push(r))}),b}getExemplars(e){return this._request("/api/v1/query_exemplars",{query:e.expr,start:e.start.toString(),end:e.end.toString()},{requestId:e.requestId,headers:e.headers})}async getTagKeys(){var e,t,a;const r=await this.metadataRequest("/api/v1/labels");return null!==(e=null==r||null===(t=r.data)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.map(e=>({text:e})))&&void 0!==e?e:[]}async getTagValues(e={}){var t,a,r;const s=await this.metadataRequest(`/api/v1/label/${e.key}/values`);return null!==(t=null==s||null===(a=s.data)||void 0===a||null===(r=a.data)||void 0===r?void 0:r.map(e=>({text:e})))&&void 0!==t?t:[]}async testDatasource(){const e=(new Date).getTime(),t=await this.performInstantQuery({expr:"1+1"},e/1e3).toPromise();return"success"===t.data.status?{status:"success",message:"Data source is working"}:{status:"error",message:t.data.error}}interpolateVariablesInQueries(e,t){let a=e;return e&&e.length&&(a=e.map(e=>$({},e,{datasource:this.name,expr:this.templateSrv.replace(e.expr,t,this.interpolateQueryExpr)}))),a}getQueryHints(e,t){var a;return function(e,t,a){const r=[];if(e.trim().match(/^\w+_bucket$/)){const t="Time series has buckets, you probably wanted a histogram.";r.push({type:"HISTOGRAM_QUANTILE",label:t,fix:{label:"Fix by adding histogram_quantile().",action:{type:"ADD_HISTOGRAM_QUANTILE",query:e}}})}if(-1===e.indexOf("rate(")&&-1===e.indexOf("increase(")){var s,n;const t=e.match(/\b(\w+_(total|sum|count))\b/);let o=t?t[1]:"";const l=null!==(s=null==a||null===(n=a.languageProvider)||void 0===n?void 0:n.metricsMetadata)&&void 0!==s?s:{},c=Object.keys(l);let u=!1;var i;if(c.length>0)o=null!==(i=c.find(t=>{if("counter"===l[t][0].type.toLowerCase()){const a=new RegExp(`\\b${t}\\b`);if(e.match(a))return u=!0,!0}return!1}))&&void 0!==i?i:"";if(o){const t=e.trim().match(/^\w+$/);let a,s=`Metric ${o} ${u?"is":"looks like"} a counter.`;t?a={label:"Fix by adding rate().",action:{type:"ADD_RATE",query:e}}:s+=" Try applying a rate() function.",r.push({type:"APPLY_RATE",label:s,fix:a})}}if(a&&a.ruleMappings){const t=a.ruleMappings,s=Object.keys(t).reduce((a,r)=>e.search(r)>-1?_({},a,{[r]:t[r]}):a,{});if(Object(l.size)(s)>0){const t="Query contains recording rules.";r.push({type:"EXPAND_RULES",label:t,fix:{label:"Expand rules",action:{type:"EXPAND_RULES",query:e,mapping:s}}})}}if(t&&t.length>=20){e.trim().match(/^\w+$/)&&r.push({type:"ADD_SUM",label:"Many time series results returned.",fix:{label:"Consider aggregating with sum().",action:{type:"ADD_SUM",query:e,preventSubmit:!0}}})}return r}(null!==(a=e.expr)&&void 0!==a?a:"",t,this)}getInitHints(){return function(e){const t=[];return e.directUrl.includes("/loki")&&!e.languageProvider.metrics.length&&t.push({label:"Using Loki as a Prometheus data source is no longer supported. You must use the Loki data source for your Loki instance.",type:"INFO"}),e.lookupsDisabled&&t.push({label:"Labels and metrics lookup was disabled in data source settings.",type:"INFO"}),t}(this)}async loadRules(){try{var e,t;const a=null===(e=(await this.metadataRequest("/api/v1/rules")).data)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.groups;a&&(this.ruleMappings=function(e){return e.reduce((e,t)=>t.rules.filter(e=>"recording"===e.type).reduce((e,t)=>$({},e,{[t.name]:t.query}),e),{})}(a))}catch(e){console.log("Rules API is experimental. Ignore next error."),console.error(e)}}modifyQuery(e,t){var a;let r=null!==(a=e.expr)&&void 0!==a?a:"";switch(t.type){case"ADD_FILTER":r=Object(x.b)(r,t.key,t.value);break;case"ADD_FILTER_OUT":r=Object(x.b)(r,t.key,t.value,"!=");break;case"ADD_HISTOGRAM_QUANTILE":r=`histogram_quantile(0.95, sum(rate(${r}[5m])) by (le))`;break;case"ADD_RATE":r=`rate(${r}[5m])`;break;case"ADD_SUM":r=`sum(${r.trim()}) by ($1)`;break;case"EXPAND_RULES":t.mapping&&(r=Object(S.b)(r,t.mapping))}return $({},e,{expr:r})}getPrometheusTime(e,t){return"string"==typeof e&&(e=r.dateMath.parse(e,t)),Math.ceil(e.valueOf()/1e3)}getTimeRangeParams(){const e=this.timeSrv.timeRange();return{start:this.getPrometheusTime(e.from,!1).toString(),end:this.getPrometheusTime(e.to,!0).toString()}}getOriginalMetricName(e){return function(e){const t=e.__name__||"";return delete e.__name__,`${t}{${Object.entries(e).map(e=>`${e[0]}="${e[1]}"`).join(",")}}`}(e)}}function U(e){return"string"==typeof e?e.replace(/\\/g,"\\\\").replace(/'/g,"\\\\'"):e}function B(e){return"string"==typeof e?e.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]\'+?.()|]/g,"\\\\$&"):e}var H=a("q1tI"),W=a.n(H),G=a("kDLi"),z=a("wZee");var K=a("vF1F"),Y=a("SMGL"),X=a("iR1w"),J=a("WG1l"),Z=a.n(J),ee=a("nKUr");function te(){return(te=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const ae=Object(H.forwardRef)((e,t)=>{let{name:a,value:r,hidden:s,facets:n,onClick:i,className:o,loading:l,searchTerm:c,active:u,style:h,title:d}=e,p=function(e,t){if(null==e)return{};var a,r,s={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e,["name","value","hidden","facets","onClick","className","loading","searchTerm","active","style","title"]);const m=Object(G.useTheme2)(),g=re(m),b=c?[c]:[];let v=r||a;return n&&(v=`${v} (${n})`),Object(ee.jsx)("span",te({ref:t,onClick:e=>{i&&!s&&i(a,r,e)},style:h,title:d||v,role:"option","aria-selected":!!u,className:Object(K.cx)(g.base,u&&g.active,l&&g.loading,s&&g.hidden,o,i&&!s&&g.hover)},p,{children:Object(ee.jsx)(Z.a,{textToHighlight:v,searchWords:b,autoEscape:!0,highlightClassName:g.matchHighLight})}),v)});ae.displayName="Label";const re=e=>({base:K.css`
    cursor: pointer;
    font-size: ${e.typography.size.sm};
    line-height: ${e.typography.bodySmall.lineHeight};
    background-color: ${e.colors.background.secondary};
    vertical-align: baseline;
    color: ${e.colors.text};
    white-space: nowrap;
    text-shadow: none;
    padding: ${e.spacing(.5)};
    border-radius: ${e.shape.borderRadius()};
    margin-right: ${e.spacing(1)};
    margin-bottom: ${e.spacing(.5)};
  `,loading:K.css`
    font-weight: ${e.typography.fontWeightMedium};
    background-color: ${e.colors.primary.shade};
    color: ${e.colors.text.primary};
    animation: pulse 3s ease-out 0s infinite normal forwards;
    @keyframes pulse {
      0% {
        color: ${e.colors.text.primary};
      }
      50% {
        color: ${e.colors.text.secondary};
      }
      100% {
        color: ${e.colors.text.disabled};
      }
    }
  `,active:K.css`
    font-weight: ${e.typography.fontWeightMedium};
    background-color: ${e.colors.primary.main};
    color: ${e.colors.primary.contrastText};
  `,matchHighLight:K.css`
    background: inherit;
    color: ${e.colors.primary.text};
    background-color: ${e.colors.primary.transparent};
  `,hidden:K.css`
    opacity: 0.6;
    cursor: default;
    border: 1px solid transparent;
  `,hover:K.css`
    &:hover {
      opacity: 0.85;
      cursor: pointer;
    }
  `});var se,ne,ie,oe,le;function ce(){return(ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const ue="grafana.datasources.prometheus.browser.labels";function he(e){let t="";const a=[];for(const r of e)if(("__name__"===r.name||r.selected)&&r.values&&r.values.length>0){const e=r.values.filter(e=>e.selected).map(e=>e.name);e.length>1?a.push(`${r.name}=~"${e.join("|")}"`):1===e.length&&("__name__"===r.name?t=e[0]:a.push(`${r.name}="${e[0]}"`))}return[t,"{",a.join(","),"}"].join("")}const de=Object(G.stylesFactory)(e=>({wrapper:K.css`
    background-color: ${e.colors.bg2};
    padding: ${e.spacing.sm};
    width: 100%;
  `,list:K.css`
    margin-top: ${e.spacing.sm};
    display: flex;
    flex-wrap: wrap;
    max-height: 200px;
    overflow: auto;
    align-content: flex-start;
  `,section:K.css`
    & + & {
      margin: ${e.spacing.md} 0;
    }
    position: relative;
  `,selector:K.css`
    font-family: ${e.typography.fontFamily.monospace};
    margin-bottom: ${e.spacing.sm};
  `,status:K.css`
    padding: ${e.spacing.xs};
    color: ${e.colors.textSemiWeak};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    /* using absolute positioning because flex interferes with ellipsis */
    position: absolute;
    width: 50%;
    right: 0;
    text-align: right;
    transition: opacity 100ms linear;
    opacity: 0;
  `,statusShowing:K.css`
    opacity: 1;
  `,error:K.css`
    color: ${e.palette.brandDanger};
  `,valueList:K.css`
    margin-right: ${e.spacing.sm};
  `,valueListWrapper:K.css`
    border-left: 1px solid ${e.colors.border2};
    margin: ${e.spacing.sm} 0;
    padding: ${e.spacing.sm} 0 ${e.spacing.sm} ${e.spacing.sm};
  `,valueListArea:K.css`
    display: flex;
    flex-wrap: wrap;
    margin-top: ${e.spacing.sm};
  `,valueTitle:K.css`
    margin-left: -${e.spacing.xs};
    margin-bottom: ${e.spacing.sm};
  `,validationStatus:K.css`
    padding: ${e.spacing.xs};
    margin-bottom: ${e.spacing.sm};
    color: ${e.colors.textStrong};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  `}));class pe extends W.a.Component{constructor(...e){super(...e),this.valueListsRef=W.a.createRef(),this.state={labels:[],labelSearchTerm:"",metricSearchTerm:"",status:"Ready",error:"",validationStatus:"",valueSearchTerm:""},this.onChangeLabelSearch=e=>{this.setState({labelSearchTerm:e.target.value})},this.onChangeMetricSearch=e=>{this.setState({metricSearchTerm:e.target.value})},this.onChangeValueSearch=e=>{this.setState({valueSearchTerm:e.target.value})},this.onClickRunQuery=()=>{const e=he(this.state.labels);this.props.onChange(e)},this.onClickRunRateQuery=()=>{const e=`rate(${he(this.state.labels)}[$__interval])`;this.props.onChange(e)},this.onClickClear=()=>{this.setState(e=>({labels:e.labels.map(e=>ce({},e,{values:void 0,selected:!1,loading:!1,hidden:!1,facets:void 0})),labelSearchTerm:"",metricSearchTerm:"",status:"",error:"",validationStatus:"",valueSearchTerm:""})),Y.a.delete(ue),this.fetchValues("__name__","{}")},this.onClickLabel=(e,t,a)=>{const r=this.state.labels.find(t=>t.name===e);if(!r)return;const s=!r.selected;let n={selected:s};if(r.values&&!s){const e=r.values.map(e=>ce({},e,{selected:!1}));n=ce({},n,{facets:0,values:e})}this.setState({labelSearchTerm:""}),this.updateLabelState(e,n,"",()=>this.doFacettingForLabel(e))},this.onClickValue=(e,t,a)=>{const r=this.state.labels.find(t=>t.name===e);if(!r||!r.values)return;this.setState({labelSearchTerm:""});const s=r.values.map(e=>ce({},e,{selected:e.name===t?!e.selected:e.selected}));this.updateLabelState(e,{values:s},"",()=>this.doFacetting(e))},this.onClickMetric=(e,t,a)=>{const r=this.state.labels.find(t=>t.name===e);if(!r||!r.values)return;this.setState({metricSearchTerm:""});const s=r.values.map(e=>ce({},e,{selected:e.name===t||e.selected?!e.selected:e.selected})),n=s.some(e=>e.selected);this.updateLabelState(e,{selected:n,values:s},"",()=>this.doFacetting(e))},this.onClickValidate=()=>{const e=he(this.state.labels);this.validateSelector(e)},this.doFacetting=e=>{const t=he(this.state.labels);if("{}"===t){const e=this.state.labels.map(e=>ce({},e,{facets:0,values:void 0,hidden:!1}));this.setState({labels:e},()=>{this.state.labels.forEach(e=>(e.selected||"__name__"===e.name)&&this.fetchValues(e.name,t))})}else this.fetchSeries(t,e)}}updateLabelState(e,t,a="",r){this.setState(r=>{const s=r.labels.map(a=>a.name===e?ce({},a,t):a),n=a?"":r.error;return{labels:s,status:a,error:n,validationStatus:""}},r)}componentDidMount(){const{languageProvider:e}=this.props;if(e){const t=Y.a.getObject(ue,[]);e.start().then(()=>{let a=e.getLabelKeys();if(a.length>1e4){const e=`Too many labels found (showing only 10000 of ${a.length})`;a=a.slice(0,1e4),this.setState({error:e})}this.fetchValues("__name__","{}");const r=a.map((e,a,r)=>({name:e,selected:t.includes(e),loading:!1}));this.setState({labels:r},()=>{this.state.labels.forEach(e=>{e.selected&&this.fetchValues(e.name,"{}")})})})}}doFacettingForLabel(e){const t=this.state.labels.find(t=>t.name===e);if(!t)return;const a=this.state.labels.filter(e=>e.selected).map(e=>e.name);Y.a.setObject(ue,a),t.selected?t.values||this.fetchValues(e,he(this.state.labels)):this.doFacetting()}async fetchValues(e,t){const{languageProvider:a}=this.props;this.updateLabelState(e,{loading:!0},"Fetching values for "+e);try{let s=await a.getLabelValues(e);if(t!==he(this.state.labels))return void this.updateLabelState(e,{loading:!1});if(s.length>5e4){const t=`Too many values for ${e} (showing only 50000 of ${s.length})`;s=s.slice(0,5e4),this.setState({error:t})}const n=[],{metricsMetadata:i}=a;for(const t of s){const a={name:t};if("__name__"===e&&i){var r;const e=null===(r=i[t])||void 0===r?void 0:r[0];e&&(a.details=`(${e.type}) ${e.help}`)}n.push(a)}this.updateLabelState(e,{values:n,loading:!1})}catch(e){console.error(e)}}async fetchSeries(e,t){const{languageProvider:a}=this.props;t&&this.updateLabelState(t,{loading:!0},"Facetting labels for "+e);try{const r=await a.fetchSeriesLabels(e,!0);if(e!==he(this.state.labels))return void(t&&this.updateLabelState(t,{loading:!1}));if(0===Object.keys(r).length)return console.error("No results for label combination, but should not occur."),void this.setState({error:"Facetting failed for "+e});const s=function(e,t,a){return e.map(e=>{const r=t[e.name];if(r){let t;if(e.name===a&&e.values)t=e.values;else{var s;const a=new Set((null===(s=e.values)||void 0===s?void 0:s.filter(e=>e.selected).map(e=>e.name))||[]);t=r.map(e=>({name:e,selected:a.has(e)}))}return ce({},e,{loading:!1,values:t,hidden:!r,facets:t.length})}return ce({},e,{loading:!1,hidden:!r,values:void 0,facets:0})})}(this.state.labels,r,t);this.setState({labels:s,error:""}),t&&this.updateLabelState(t,{loading:!1})}catch(e){console.error(e)}}async validateSelector(e){const{languageProvider:t}=this.props;this.setState({validationStatus:"Validating selector "+e,error:""});const a=await t.fetchSeries(e);this.setState({validationStatus:`Selector is valid (${a.length} series found)`})}render(){var e,t;const{theme:a}=this.props,{labels:r,labelSearchTerm:s,metricSearchTerm:n,status:i,error:o,validationStatus:l,valueSearchTerm:c}=this.state,u=de(a);if(0===r.length)return Object(ee.jsx)("div",{className:u.wrapper,children:se||(se=Object(ee.jsx)(G.LoadingPlaceholder,{text:"Loading labels..."}))});let h=r.find(e=>"__name__"===e.name);var d;h&&n&&(h=ce({},h,{values:null===(d=h.values)||void 0===d?void 0:d.filter(e=>e.selected||e.name.includes(n))}));let p=r.filter(e=>!e.hidden&&"__name__"!==e.name);s&&(p=p.filter(e=>e.selected||e.name.includes(s)));let m=p.filter(e=>e.selected&&e.values);c&&(m=m.map(e=>{var t;return ce({},e,{values:null===(t=e.values)||void 0===t?void 0:t.filter(e=>e.selected||e.name.includes(c))})}));const g=he(this.state.labels),b="{}"===g,v=(null===(e=h)||void 0===e||null===(t=e.values)||void 0===t?void 0:t.length)||0;return Object(ee.jsxs)("div",{className:u.wrapper,children:[Object(ee.jsxs)(G.HorizontalGroup,{align:"flex-start",spacing:"lg",children:[Object(ee.jsx)("div",{children:Object(ee.jsxs)("div",{className:u.section,children:[ne||(ne=Object(ee.jsx)(G.Label,{description:"Once a metric is selected only possible labels are shown.",children:"1. Select a metric"})),Object(ee.jsx)("div",{children:Object(ee.jsx)(G.Input,{onChange:this.onChangeMetricSearch,"aria-label":"Filter expression for metric",value:n})}),Object(ee.jsx)("div",{role:"list",className:u.valueListWrapper,children:Object(ee.jsx)(X.a,{height:Math.min(450,25*v),itemCount:v,itemSize:25,itemKey:e=>h.values[e].name,width:300,className:u.valueList,children:({index:e,style:t})=>{var a,r;const s=null===(a=h)||void 0===a||null===(r=a.values)||void 0===r?void 0:r[e];return s?Object(ee.jsx)("div",{style:t,children:Object(ee.jsx)(ae,{name:h.name,value:null==s?void 0:s.name,title:s.details,active:null==s?void 0:s.selected,onClick:this.onClickMetric,searchTerm:n})}):null}})})]})}),Object(ee.jsxs)("div",{children:[Object(ee.jsxs)("div",{className:u.section,children:[ie||(ie=Object(ee.jsx)(G.Label,{description:"Once label values are selected, only possible label combinations are shown.",children:"2. Select labels to search in"})),Object(ee.jsx)("div",{children:Object(ee.jsx)(G.Input,{onChange:this.onChangeLabelSearch,"aria-label":"Filter expression for label",value:s})}),Object(ee.jsx)("div",{className:u.list,style:{height:120},children:p.map(e=>Object(ee.jsx)(ae,{name:e.name,loading:e.loading,active:e.selected,hidden:e.hidden,facets:e.facets,onClick:this.onClickLabel,searchTerm:s},e.name))})]}),Object(ee.jsxs)("div",{className:u.section,children:[oe||(oe=Object(ee.jsx)(G.Label,{description:"Use the search field to find values across selected labels.",children:"3. Select (multiple) values for your labels"})),Object(ee.jsx)("div",{children:Object(ee.jsx)(G.Input,{onChange:this.onChangeValueSearch,"aria-label":"Filter expression for label values",value:c})}),Object(ee.jsx)("div",{className:u.valueListArea,ref:this.valueListsRef,children:m.map(e=>{var t,a,r;return Object(ee.jsxs)("div",{role:"list","aria-label":"Values for "+e.name,className:u.valueListWrapper,children:[Object(ee.jsx)("div",{className:u.valueTitle,children:Object(ee.jsx)(ae,{name:e.name,loading:e.loading,active:e.selected,hidden:e.hidden,facets:e.facets||(null===(t=e.values)||void 0===t?void 0:t.length),onClick:this.onClickLabel})}),Object(ee.jsx)(X.a,{height:Math.min(200,25*((null===(a=e.values)||void 0===a?void 0:a.length)||0)),itemCount:(null===(r=e.values)||void 0===r?void 0:r.length)||0,itemSize:25,itemKey:t=>e.values[t].name,width:200,className:u.valueList,children:({index:t,style:a})=>{var r;const s=null===(r=e.values)||void 0===r?void 0:r[t];return s?Object(ee.jsx)("div",{style:a,children:Object(ee.jsx)(ae,{name:e.name,value:null==s?void 0:s.name,active:null==s?void 0:s.selected,onClick:this.onClickValue,searchTerm:c})}):null}})]},e.name)})})]})]})]}),Object(ee.jsxs)("div",{className:u.section,children:[le||(le=Object(ee.jsx)(G.Label,{children:"4. Resulting selector"})),Object(ee.jsx)("div",{"aria-label":"selector",className:u.selector,children:g}),l&&Object(ee.jsx)("div",{className:u.validationStatus,children:l}),Object(ee.jsxs)(G.HorizontalGroup,{children:[Object(ee.jsx)(G.Button,{"aria-label":"Use selector for query button",disabled:b,onClick:this.onClickRunQuery,children:"Use query"}),Object(ee.jsx)(G.Button,{"aria-label":"Use selector as metrics button",variant:"secondary",disabled:b,onClick:this.onClickRunRateQuery,children:"Use as rate query"}),Object(ee.jsx)(G.Button,{"aria-label":"Validate submit button",variant:"secondary",disabled:b,onClick:this.onClickValidate,children:"Validate selector"}),Object(ee.jsx)(G.Button,{"aria-label":"Selector clear button",variant:"secondary",onClick:this.onClickClear,children:"Clear"}),Object(ee.jsx)("div",{className:Object(K.cx)(u.status,(i||o)&&u.statusShowing),children:Object(ee.jsx)("span",{className:o?u.error:"",children:o||i})})]})]})]})}}const me=Object(G.withTheme)(pe);function ge(){return(ge=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function be(e,{typeaheadContext:t,typeaheadText:a}){switch(t){case"context-labels":{const t=G.DOMUtil.getNextCharacter();t&&"}"!==t&&","!==t||(e+="=");break}case"context-label-values":a.match(/^(!?=~?"|")/)||(e='"'+e),'"'!==G.DOMUtil.getNextCharacter()&&(e+='"')}return e}class ve extends W.a.PureComponent{constructor(e,t){super(e,t),this.plugins=void 0,this.languageProviderInitializationPromise=void 0,this.refreshHint=()=>{const{datasource:e,query:t,data:a}=this.props,s=e.getInitHints(),n=s.length>0?s[0]:null;if(!a||0===a.series.length)return void this.setState({hint:n});const i=Object(r.isDataFrame)(a.series[0])?a.series.map(r.toLegacyResponseData):a.series,o=e.getQueryHints(t,i);let l=o.length>0?o[0]:null;this.setState({hint:null!=l?l:n})},this.refreshMetrics=async()=>{const{datasource:{languageProvider:e}}=this.props;this.languageProviderInitializationPromise=(e=>{let t=!1;return{promise:new Promise((a,r)=>{e.then(e=>t?r({isCanceled:!0}):a(e)),e.catch(e=>r(t?{isCanceled:!0}:e))}),cancel(){t=!0}}})(e.start());try{const e=await this.languageProviderInitializationPromise.promise;await Promise.all(e),this.onUpdateLanguage()}catch(e){if(!e.isCanceled)throw e}},this.onChangeLabelBrowser=e=>{this.onChangeQuery(e,!0),this.setState({labelBrowserVisible:!1})},this.onChangeQuery=(e,t)=>{const{query:a,onChange:r,onRunQuery:s}=this.props;if(r){r(ge({},a,{expr:e})),t&&s&&s()}},this.onClickChooserButton=()=>{this.setState(e=>({labelBrowserVisible:!e.labelBrowserVisible}))},this.onClickHintFix=()=>{const{datasource:e,query:t,onChange:a,onRunQuery:r}=this.props,{hint:s}=this.state;a(e.modifyQuery(t,s.fix.action)),r()},this.onUpdateLanguage=()=>{const{datasource:{languageProvider:e}}=this.props,{metrics:t}=e;t&&this.setState({syntaxLoaded:!0})},this.onTypeahead=async e=>{const{datasource:{languageProvider:t}}=this.props;if(!t)return{suggestions:[]};const{history:a}=this.props,{prefix:r,text:s,value:n,wrapperClasses:i,labelKey:o}=e;return await t.provideCompletionItems({text:s,value:n,prefix:r,wrapperClasses:i,labelKey:o},{history:a})},this.plugins=[Object(G.BracesPlugin)(),Object(G.SlatePrism)({onlyIn:e=>"code_block"===e.type,getSyntax:e=>"promql"},ge({},z.languages,{promql:this.props.datasource.languageProvider.syntax}))],this.state={labelBrowserVisible:!1,syntaxLoaded:!1,hint:null}}componentDidMount(){this.props.datasource.languageProvider&&this.refreshMetrics(),this.refreshHint()}componentWillUnmount(){this.languageProviderInitializationPromise&&this.languageProviderInitializationPromise.cancel()}componentDidUpdate(e){const{data:t,datasource:{languageProvider:a},range:r}=this.props;a!==e.datasource.languageProvider&&this.setState({syntaxLoaded:!1});const s=this.rangeChangedToRefresh(r,e.range);(a!==e.datasource.languageProvider||s)&&this.refreshMetrics(),t&&e.data&&e.data.series!==t.series&&this.refreshHint()}rangeChangedToRefresh(e,t){if(e&&t){const a=Object(S.i)(e.from.valueOf())===Object(S.i)(t.from.valueOf()),r=Object(S.i)(e.to.valueOf())===Object(S.i)(t.to.valueOf());return!(a&&r)}return!1}render(){const{datasource:e,datasource:{languageProvider:t},query:a,ExtraFieldElement:r,placeholder:s="Enter a PromQL query (run with Shift+Enter)"}=this.props,{labelBrowserVisible:n,syntaxLoaded:i,hint:o}=this.state,l=t?t.cleanText:void 0,c=t.metrics.length>0,u=function(e,t,a){return e?"(Disabled)":t?a?"Metrics browser":"(No metrics found)":"Loading metrics..."}(e.lookupsDisabled,i,c),h=!(i&&c);return Object(ee.jsxs)(ee.Fragment,{children:[Object(ee.jsxs)("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1","data-testid":this.props["data-testid"],children:[Object(ee.jsxs)("button",{className:"gf-form-label query-keyword pointer",onClick:this.onClickChooserButton,disabled:h,children:[u,Object(ee.jsx)(G.Icon,{name:n?"angle-down":"angle-right"})]}),Object(ee.jsx)("div",{className:"gf-form gf-form--grow flex-shrink-1 min-width-15",children:Object(ee.jsx)(G.QueryField,{additionalPlugins:this.plugins,cleanText:l,query:a.expr,onTypeahead:this.onTypeahead,onWillApplySuggestion:be,onBlur:this.props.onBlur,onChange:this.onChangeQuery,onRunQuery:this.props.onRunQuery,placeholder:s,portalOrigin:"prometheus",syntaxLoaded:i})})]}),n&&Object(ee.jsx)("div",{className:"gf-form",children:Object(ee.jsx)(me,{languageProvider:t,onChange:this.onChangeLabelBrowser})}),r,o?Object(ee.jsx)("div",{className:"query-row-break",children:Object(ee.jsxs)("div",{className:"prom-query-field-info text-warning",children:[o.label," ",o.fix?Object(ee.jsx)("a",{className:"text-link muted",onClick:this.onClickHintFix,children:o.fix.label}):null]})}):null]})}}var fe=ve;const ye=({panelData:e,query:t,datasource:a})=>{const[s,n]=Object(H.useState)("");return Object(H.useEffect)(()=>{if(e){n((()=>{if(!e.request)return"";const{request:{range:r,interval:s}}=e,n=a.getPrometheusTime(r.from,!1),i=a.getPrometheusTime(r.to,!0),o=Math.ceil(i-n),c=r.to.utc().format("YYYY-MM-DD HH:mm"),u={interval:s},h=a.createQuery(t,u,n,i),d={"g0.expr":h.expr,"g0.range_input":o+"s","g0.end_input":c,"g0.step_input":h.step,"g0.tab":0},p=Object(l.map)(d,(e,t)=>t+"="+encodeURIComponent(e)).join("&");return`${a.directUrl}/graph?${p}`})())}},[a,e,t]),Object(ee.jsx)("a",{href:r.textUtil.sanitizeUrl(s),target:"_blank",rel:"noopener noreferrer",children:"Prometheus"})};var je,xe,Oe,Se,_e=Object(H.memo)(ye);function Te({datasource:e,onChange:t,isEnabled:a}){const[r,s]=Object(H.useState)(),n=Object(G.useStyles)(we);Object(H.useEffect)(()=>{const t=e.exemplarErrors.subscribe(e=>{s(e)});return()=>{t.unsubscribe()}},[e]);const i=Object(K.cx)({[n.activeIcon]:a},n.eyeIcon);return Object(ee.jsx)(G.InlineLabel,{width:"auto",children:Object(ee.jsx)(G.Tooltip,{content:null!=r?r:"",children:Object(ee.jsxs)("div",{className:n.iconWrapper,children:["Exemplars",Object(ee.jsx)(G.IconButton,{name:"eye",tooltip:a?"Disable query with exemplars":"Enable query with exemplars",disabled:!!r,className:i,onClick:()=>{t(!a)}})]})})})}function we(e){return{eyeIcon:K.css`
      margin-left: ${e.spacing.md};
    `,activeIcon:K.css`
      color: ${e.palette.blue95};
    `,iconWrapper:K.css`
      display: flex;
      align-items: center;
    `}}function Ie(){return(Ie=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const{Switch:Ce}=G.LegacyForms,Ee=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"},{label:"Heatmap",value:"heatmap"}],qe=Object(l.map)([1,2,3,4,5,10],e=>({value:e,label:"1/"+e}));class Pe extends H.PureComponent{constructor(e){super(e),this.query=void 0,this.onFieldChange=(e,t)=>{this.query.expr=e.expr},this.onFormatChange=e=>{this.query.format=e.value,this.setState({formatOption:e},this.onRunQuery)},this.onInstantChange=e=>{const t=e.target.checked;this.query.instant=t,this.setState({instant:t},this.onRunQuery)},this.onIntervalChange=e=>{const t=e.currentTarget.value;this.query.interval=t,this.setState({interval:t})},this.onIntervalFactorChange=e=>{this.query.intervalFactor=e.value,this.setState({intervalFactorOption:e},this.onRunQuery)},this.onLegendChange=e=>{const t=e.currentTarget.value;this.query.legendFormat=t,this.setState({legendFormat:t})},this.onExemplarChange=e=>{this.query.exemplar=e,this.setState({exemplar:e},this.onRunQuery)},this.onRunQuery=()=>{const{query:e}=this,{hide:t}=this.props.query;this.props.onChange(Ie({},e,{hide:t})),this.props.onRunQuery()};const t=Object.assign({},{expr:"",legendFormat:"",interval:"",exemplar:!0},e.query);this.query=t,this.state={interval:t.interval,legendFormat:t.legendFormat,formatOption:Ee.find(e=>e.value===t.format)||Ee[0],intervalFactorOption:qe.find(e=>e.value===t.intervalFactor)||qe[0],instant:Boolean(t.instant),exemplar:Boolean(t.exemplar)}}render(){const{datasource:e,query:t,range:a,data:r}=this.props,{formatOption:s,instant:n,interval:i,intervalFactorOption:o,legendFormat:l,exemplar:c}=this.state;return Object(ee.jsx)(fe,{datasource:e,query:t,range:a,onRunQuery:this.onRunQuery,onChange:this.onFieldChange,history:[],data:r,"data-testid":De.editor,ExtraFieldElement:Object(ee.jsxs)("div",{className:"gf-form-inline",children:[Object(ee.jsxs)("div",{className:"gf-form",children:[je||(je=Object(ee.jsx)(G.InlineFormLabel,{width:7,tooltip:"Controls the name of the time series, using name or pattern. For example {{hostname}} will be replaced with label value for the label hostname.",children:"Legend"})),Object(ee.jsx)("input",{type:"text",className:"gf-form-input",placeholder:"legend format",value:l,onChange:this.onLegendChange,onBlur:this.onRunQuery})]}),Object(ee.jsxs)("div",{className:"gf-form",children:[xe||(xe=Object(ee.jsx)(G.InlineFormLabel,{width:7,tooltip:Object(ee.jsxs)(ee.Fragment,{children:["An additional lower limit for the step parameter of the Prometheus query and for the"," ",Object(ee.jsx)("code",{children:"$__interval"})," and ",Object(ee.jsx)("code",{children:"$__rate_interval"}),' variables. The limit is absolute and not modified by the "Resolution" setting.']}),children:"Min step"})),Object(ee.jsx)("input",{type:"text",className:"gf-form-input width-8",placeholder:i,onChange:this.onIntervalChange,onBlur:this.onRunQuery,value:i})]}),Object(ee.jsxs)("div",{className:"gf-form",children:[Oe||(Oe=Object(ee.jsx)("div",{className:"gf-form-label",children:"Resolution"})),Object(ee.jsx)(G.Select,{isSearchable:!1,options:qe,onChange:this.onIntervalFactorChange,value:o})]}),Object(ee.jsxs)("div",{className:"gf-form",children:[Se||(Se=Object(ee.jsx)("div",{className:"gf-form-label width-7",children:"Format"})),Object(ee.jsx)(G.Select,{width:16,isSearchable:!1,options:Ee,onChange:this.onFormatChange,value:s}),Object(ee.jsx)(Ce,{label:"Instant",checked:n,onChange:this.onInstantChange}),Object(ee.jsx)(G.InlineFormLabel,{width:10,tooltip:"Link to Graph in Prometheus",children:Object(ee.jsx)(_e,{datasource:e,query:this.query,panelData:r})})]}),Object(ee.jsx)(Te,{isEnabled:c,onChange:this.onExemplarChange,datasource:e})]})})}}const De={editor:"prom-editor"};function Le(e){const{datasource:t,query:a,range:r,data:s,onChange:n,onRunQuery:i}=e;return Object(ee.jsx)(fe,{datasource:t,query:a,onRunQuery:i,onChange:n,history:[],range:r,data:s,placeholder:"Enter a PromQL query","data-testid":ke.editor})}const ke={editor:"prom-editor-cloud-alerting"};function Fe(){return(Fe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ne(e){const{app:t}=e;switch(t){case r.CoreApp.CloudAlerting:return Object(ee.jsx)(Le,Fe({},e));default:return Object(ee.jsx)(Pe,Fe({},e))}}var Re,Qe=Object(H.memo)(Ne);const Me=[{title:"Request Rate",expression:"rate(http_request_total[5m])",label:"Given an HTTP request counter, this query calculates the per-second average request rate over the last 5 minutes."},{title:"95th Percentile of Request Latencies",expression:"histogram_quantile(0.95, sum(rate(prometheus_http_request_duration_seconds_bucket[5m])) by (le))",label:"Calculates the 95th percentile of HTTP request rate over 5 minute windows."},{title:"Alerts Firing",expression:'sort_desc(sum(sum_over_time(ALERTS{alertstate="firing"}[24h])) by (alertname))',label:"Sums up the alerts that have been firing over the last 24 hours."},{title:"Step",label:"Defines the graph resolution using a duration format (15s, 1m, 3h, ...). Small steps create high-resolution graphs but can be slow over larger time ranges. Using a longer step lowers the resolution and smooths the graph by producing fewer datapoints. If no step is given the resolution is calculated automatically."}];var $e,Ae,Ve=e=>Object(ee.jsxs)("div",{children:[Re||(Re=Object(ee.jsx)("h2",{children:"PromQL Cheat Sheet"})),Me.map((t,a)=>Object(ee.jsxs)("div",{className:"cheat-sheet-item",children:[Object(ee.jsx)("div",{className:"cheat-sheet-item__title",children:t.title}),t.expression?Object(ee.jsx)("div",{className:"cheat-sheet-item__example",onClick:a=>e.onClickExample({refId:"A",expr:t.expression}),children:Object(ee.jsx)("code",{children:t.expression})}):null,Object(ee.jsx)("div",{className:"cheat-sheet-item__label",children:t.label})]},a))]});function Ue(){return(Ue=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const Be=Object(H.memo)(({queryType:e,stepValue:t,query:a,onChange:r,onStepChange:s,onQueryTypeChange:n,onKeyDownFunc:i,datasource:o})=>Object(ee.jsxs)("div",{"aria-label":"Prometheus extra field",className:"gf-form-inline",children:[Object(ee.jsxs)("div",{"data-testid":"queryTypeField",className:Object(K.cx)("gf-form explore-input-margin",K.css`
              flex-wrap: nowrap;
            `),"aria-label":"Query type field",children:[$e||($e=Object(ee.jsx)(G.InlineFormLabel,{width:"auto",children:"Query type"})),Object(ee.jsx)(G.RadioButtonGroup,{options:[{value:"range",label:"Range",description:"Run query over a range of time."},{value:"instant",label:"Instant",description:'Run query against a single point in time. For this query, the "To" time is used.'},{value:"both",label:"Both",description:"Run an Instant query and a Range query."}],value:e,onChange:n})]}),Object(ee.jsxs)("div",{"data-testid":"stepField",className:Object(K.cx)("gf-form",K.css`
              flex-wrap: nowrap;
            `),"aria-label":"Step field",children:[Ae||(Ae=Object(ee.jsx)(G.InlineFormLabel,{width:5,tooltip:"Time units can be used here, for example: 5s, 1m, 3h, 1d, 1y (Default if no unit is specified: s)",children:"Step"})),Object(ee.jsx)("input",{type:"text",className:"gf-form-input width-4",placeholder:"auto",onChange:s,onKeyDown:i,value:t})]}),Object(ee.jsx)(Te,{isEnabled:Boolean(a.exemplar),onChange:e=>r(Ue({},a,{exemplar:e})),datasource:o})]}));function He(){return(He=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const We=e=>{const{range:t,query:a,data:r,datasource:s,history:n,onChange:i,onRunQuery:o}=e;return Object(H.useEffect)(()=>{void 0===a.exemplar&&i(He({},a,{exemplar:!0}))},[i,a]),Object(ee.jsx)(fe,{datasource:s,query:a,range:t,onRunQuery:o,onChange:i,onBlur:()=>{},history:n,data:r,ExtraFieldElement:Object(ee.jsx)(Be,{queryType:a.range===a.instant?"both":a.instant?"instant":"range",stepValue:a.interval||"",onQueryTypeChange:function(t){const{query:a,onChange:r}=e;let s;s=He({},a,"instant"===t?{instant:!0,range:!1}:"range"===t?{instant:!1,range:!0}:{instant:!0,range:!0}),r(s)},onStepChange:function(t){t.currentTarget.value!==a.interval&&function(t){const{query:a,onChange:r}=e;r(He({},a,{interval:t}))}(t.currentTarget.value)},onKeyDownFunc:function(e){"Enter"===e.key&&(e.shiftKey||e.ctrlKey)&&o()},query:a,onChange:i,datasource:s})})};var Ge,ze,Ke,Ye=Object(H.memo)(We),Xe=a("Csm0");function Je(){return(Je=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ze({value:e,onChange:t,onDelete:a}){const[r,n]=Object(H.useState)(Boolean(e.datasourceUid));return Object(ee.jsxs)("div",{className:"gf-form-group",children:[Object(ee.jsx)(G.InlineField,{label:"Internal link",labelWidth:24,children:Object(ee.jsxs)(ee.Fragment,{children:[Object(ee.jsx)(G.InlineSwitch,{value:r,"aria-label":Xe.selectors.components.DataSource.Prometheus.configPage.internalLinkSwitch,onChange:e=>n(e.currentTarget.checked)}),Object(ee.jsx)(G.Button,{variant:"destructive",title:"Remove link",icon:"times",onClick:e=>{e.preventDefault(),a()},className:K.css`
              margin-left: 8px;
            `})]})}),r?Object(ee.jsx)(G.InlineField,{label:"Data source",labelWidth:24,tooltip:"The data source the exemplar is going to navigate to.",children:Object(ee.jsx)(s.DataSourcePicker,{tracing:!0,current:e.datasourceUid,noDefault:!0,width:40,onChange:a=>t({datasourceUid:a.uid,name:e.name,url:void 0})})}):Object(ee.jsx)(G.InlineField,{label:"URL",labelWidth:24,tooltip:"The URL of the trace backend the user would go to see its trace.",children:Object(ee.jsx)(G.Input,{placeholder:"https://example.com/${__value.raw}",spellCheck:!1,width:40,value:e.url,onChange:a=>t({datasourceUid:void 0,name:e.name,url:a.currentTarget.value})})}),Object(ee.jsx)(G.InlineField,{label:"Label name",labelWidth:24,tooltip:"The name of the field in the labels object that should be used to get the traceID.",children:Object(ee.jsx)(G.Input,{placeholder:"traceID",spellCheck:!1,width:40,value:e.name,onChange:a=>t(Je({},e,{name:a.currentTarget.value}))})})]})}function et({options:e,onChange:t}){return Object(ee.jsxs)(ee.Fragment,{children:[Ge||(Ge=Object(ee.jsx)("h3",{className:"page-heading",children:"Exemplars"})),e&&e.map((a,r)=>Object(ee.jsx)(Ze,{value:a,onChange:a=>{const s=[...e];s.splice(r,1,a),t(s)},onDelete:()=>{const a=[...e];a.splice(r,1),t(a)}},r)),Object(ee.jsx)(G.Button,{variant:"secondary","aria-label":Xe.selectors.components.DataSource.Prometheus.configPage.exemplarsAddButton,className:K.css`
          margin-bottom: 10px;
        `,icon:"plus",onClick:a=>{a.preventDefault();const r=[...e||[],{name:"traceID"}];t(r)},children:"Add"})]})}function tt(){return(tt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const{Select:at,Input:rt,FormField:st,Switch:nt}=G.LegacyForms,it=[{value:"POST",label:"POST"},{value:"GET",label:"GET"}],ot=e=>{var t;const{options:a,onOptionsChange:s}=e;return a.jsonData.httpMethod||(a.jsonData.httpMethod="POST"),Object(ee.jsxs)(ee.Fragment,{children:[Object(ee.jsxs)("div",{className:"gf-form-group",children:[Object(ee.jsx)("div",{className:"gf-form-inline",children:Object(ee.jsx)("div",{className:"gf-form",children:Object(ee.jsx)(st,{label:"Scrape interval",labelWidth:13,inputEl:Object(ee.jsx)(rt,{className:"width-6",value:a.jsonData.timeInterval,spellCheck:!1,placeholder:"15s",onChange:ut("timeInterval",a,s),validationEvents:lt}),tooltip:"Set this to the typical scrape and evaluation interval configured in Prometheus. Defaults to 15s."})})}),Object(ee.jsx)("div",{className:"gf-form-inline",children:Object(ee.jsx)("div",{className:"gf-form",children:Object(ee.jsx)(st,{label:"Query timeout",labelWidth:13,inputEl:Object(ee.jsx)(rt,{className:"width-6",value:a.jsonData.queryTimeout,onChange:ut("queryTimeout",a,s),spellCheck:!1,placeholder:"60s",validationEvents:lt}),tooltip:"Set the Prometheus query timeout."})})}),Object(ee.jsxs)("div",{className:"gf-form",children:[ze||(ze=Object(ee.jsx)(G.InlineFormLabel,{width:13,tooltip:"You can use either POST or GET HTTP method to query your Prometheus data source. POST is the recommended method as it allows bigger queries. Change this to GET if you have a Prometheus version older than 2.1 or if POST requests are restricted in your network.",children:"HTTP Method"})),Object(ee.jsx)(at,{options:it,value:it.find(e=>e.value===a.jsonData.httpMethod),onChange:ut("httpMethod",a,s),width:7})]})]}),Ke||(Ke=Object(ee.jsx)("h3",{className:"page-heading",children:"Misc"})),Object(ee.jsxs)("div",{className:"gf-form-group",children:[Object(ee.jsx)("div",{className:"gf-form",children:Object(ee.jsx)(nt,{checked:null!==(t=a.jsonData.disableMetricsLookup)&&void 0!==t&&t,label:"Disable metrics lookup",labelClass:"width-14",onChange:Object(r.onUpdateDatasourceJsonDataOptionChecked)(e,"disableMetricsLookup"),tooltip:"Checking this option will disable the metrics chooser and metric/label support in the query field's autocomplete. This helps if you have performance issues with bigger Prometheus instances."})}),Object(ee.jsx)("div",{className:"gf-form-inline",children:Object(ee.jsx)("div",{className:"gf-form max-width-30",children:Object(ee.jsx)(st,{label:"Custom query parameters",labelWidth:14,tooltip:"Add Custom parameters to all Prometheus or Thanos queries.",inputEl:Object(ee.jsx)(rt,{className:"width-25",value:a.jsonData.customQueryParameters,onChange:ut("customQueryParameters",a,s),spellCheck:!1,placeholder:"Example: max_source_resolution=5m&timeout=10"})})})})]}),Object(ee.jsx)(et,{options:a.jsonData.exemplarTraceIdDestinations,onChange:e=>Object(r.updateDatasourcePluginJsonDataOption)({onOptionsChange:s,options:a},"exemplarTraceIdDestinations",e)})]})},lt={[G.EventsWithValidation.onBlur]:[Object(G.regexValidation)(/^$|^\d+(ms|[Mwdhmsy])$/,"Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s")]},ct=e=>e?e.hasOwnProperty("currentTarget")?e.currentTarget.value:e.value:"",ut=(e,t,a)=>r=>{a(tt({},t,{jsonData:tt({},t.jsonData,{[e]:ct(r)})}))};var ht=a("ZFWI");a.d(t,"plugin",(function(){return pt}));class dt{constructor(){this.stepDefaultValuePlaceholder="60s"}}dt.templateUrl="partials/annotations.editor.html";const pt=new r.DataSourcePlugin(V).setQueryEditor(Qe).setConfigEditor(e=>{const{options:t,onOptionsChange:a}=e;return Object(ee.jsxs)(ee.Fragment,{children:[Object(ee.jsx)(G.DataSourceHttpSettings,{defaultUrl:"http://localhost:9090",dataSourceConfig:t,showAccessOptions:!0,onChange:a,sigV4AuthToggleEnabled:ht.a.sigV4AuthEnabled}),Object(ee.jsx)(ot,{options:t,onOptionsChange:a})]})}).setExploreMetricsQueryField(Ye).setAnnotationQueryCtrl(dt).setQueryEditorHelp(Ve)}}]);
//# sourceMappingURL=prometheusPlugin.de0e7cb4f02a375bece7.js.map