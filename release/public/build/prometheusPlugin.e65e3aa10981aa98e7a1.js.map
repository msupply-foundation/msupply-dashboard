{"version":3,"file":"prometheusPlugin.e65e3aa10981aa98e7a1.js","mappings":"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","sources":["webpack://grafana/./public/app/plugins/datasource/prometheus/types.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/result_transformer.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/metric_find_query.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/variables.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/datasource.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/query_hints.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/components/PrometheusMetricsBrowser.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/components/monaco-query-field/MonacoQueryFieldLazy.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/components/monaco-query-field/MonacoQueryFieldWrapper.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/components/PromQueryField.tsx","webpack://grafana/./public/app/core/utils/CancelablePromise.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/components/PromLink.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/components/PromExemplarField.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/components/PromQueryEditor.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/components/PromQueryEditorForAlerting.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/LabelParamEditor.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/types.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/operations.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/aggregations.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/PromQueryModeller.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/MetricSelect.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/NestedQuery.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/NestedQueryList.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/QueryPreview.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/shared/OperationsEditorRow.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/PromQueryBuilder.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/PromQueryBuilderExplained.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/querybuilder/components/PromQueryEditorSelector.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/components/PromExploreExtraField.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/components/PromExploreQueryEditor.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/components/PromQueryEditorByApp.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/components/PromCheatSheet.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/configuration/AzureCredentials.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/configuration/AzureCredentialsConfig.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/configuration/AzureCredentialsForm.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/configuration/AzureAuthSettings.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/configuration/ExemplarSetting.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/configuration/ExemplarsSettings.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/configuration/PromSettings.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/module.ts","webpack://grafana/./public/app/plugins/datasource/prometheus/configuration/ConfigEditor.tsx","webpack://grafana/./public/app/plugins/datasource/prometheus/promql.ts"],"sourcesContent":["import { DataQuery, DataSourceJsonData, QueryResultMeta, ScopedVars } from '@grafana/data';\nimport { QueryEditorMode } from './querybuilder/shared/types';\nimport { PromVisualQuery } from './querybuilder/types';\n\nexport interface PromQuery extends DataQuery {\n  expr: string;\n  format?: string;\n  instant?: boolean;\n  range?: boolean;\n  exemplar?: boolean;\n  hinting?: boolean;\n  interval?: string;\n  intervalFactor?: number;\n  // Timezone offset to align start & end time on backend\n  utcOffsetSec?: number;\n  legendFormat?: string;\n  valueWithRefId?: boolean;\n  requestId?: string;\n  showingGraph?: boolean;\n  showingTable?: boolean;\n  editorMode?: QueryEditorMode;\n  /** Temporary until we have a parser */\n  visualQuery?: PromVisualQuery;\n}\n\nexport interface PromOptions extends DataSourceJsonData {\n  timeInterval?: string;\n  queryTimeout?: string;\n  httpMethod?: string;\n  directUrl?: string;\n  customQueryParameters?: string;\n  disableMetricsLookup?: boolean;\n  exemplarTraceIdDestinations?: ExemplarTraceIdDestination[];\n}\n\nexport enum PromQueryType {\n  timeSeriesQuery = 'timeSeriesQuery',\n}\n\nexport type ExemplarTraceIdDestination = {\n  name: string;\n  url?: string;\n  urlDisplayLabel?: string;\n  datasourceUid?: string;\n};\n\nexport interface PromQueryRequest extends PromQuery {\n  step?: number;\n  requestId?: string;\n  start: number;\n  end: number;\n  headers?: any;\n}\n\nexport interface PromMetricsMetadataItem {\n  type: string;\n  help: string;\n  unit?: string;\n}\n\nexport interface PromMetricsMetadata {\n  [metric: string]: PromMetricsMetadataItem;\n}\n\nexport interface PromDataSuccessResponse<T = PromData> {\n  status: 'success';\n  data: T;\n}\n\nexport interface PromDataErrorResponse<T = PromData> {\n  status: 'error';\n  errorType: string;\n  error: string;\n  data: T;\n}\n\nexport type PromData = PromMatrixData | PromVectorData | PromScalarData | PromExemplarData[];\n\nexport interface Labels {\n  [index: string]: any;\n}\n\nexport interface Exemplar {\n  labels: Labels;\n  value: number;\n  timestamp: number;\n}\n\nexport interface PromExemplarData {\n  seriesLabels: PromMetric;\n  exemplars: Exemplar[];\n}\n\nexport interface PromVectorData {\n  resultType: 'vector';\n  result: Array<{\n    metric: PromMetric;\n    value: PromValue;\n  }>;\n}\n\nexport interface PromMatrixData {\n  resultType: 'matrix';\n  result: Array<{\n    metric: PromMetric;\n    values: PromValue[];\n  }>;\n}\n\nexport interface PromScalarData {\n  resultType: 'scalar';\n  result: PromValue;\n}\n\nexport type PromValue = [number, any];\n\nexport interface PromMetric {\n  __name__?: string;\n  [index: string]: any;\n}\n\nexport function isMatrixData(result: MatrixOrVectorResult): result is PromMatrixData['result'][0] {\n  return 'values' in result;\n}\n\nexport function isExemplarData(result: PromData): result is PromExemplarData[] {\n  if (result == null || !Array.isArray(result)) {\n    return false;\n  }\n  return result.length ? 'exemplars' in result[0] : false;\n}\n\nexport type MatrixOrVectorResult = PromMatrixData['result'][0] | PromVectorData['result'][0];\n\nexport interface TransformOptions {\n  format?: string;\n  step?: number;\n  legendFormat?: string;\n  start: number;\n  end: number;\n  query: string;\n  responseListLength: number;\n  scopedVars?: ScopedVars;\n  refId: string;\n  valueWithRefId?: boolean;\n  meta: QueryResultMeta;\n}\n\nexport interface PromLabelQueryResponse {\n  data: {\n    status: string;\n    data: string[];\n  };\n  cancelled?: boolean;\n}\n","import {\n  ArrayDataFrame,\n  ArrayVector,\n  DataFrame,\n  DataLink,\n  DataTopic,\n  Field,\n  FieldType,\n  formatLabels,\n  getDisplayProcessor,\n  Labels,\n  MutableField,\n  ScopedVars,\n  TIME_SERIES_TIME_FIELD_NAME,\n  TIME_SERIES_VALUE_FIELD_NAME,\n  DataQueryResponse,\n  DataQueryRequest,\n  PreferredVisualisationType,\n  CoreApp,\n} from '@grafana/data';\nimport { FetchResponse, getDataSourceSrv, getTemplateSrv } from '@grafana/runtime';\nimport { partition, groupBy } from 'lodash';\nimport { descending, deviation } from 'd3';\nimport {\n  ExemplarTraceIdDestination,\n  isExemplarData,\n  isMatrixData,\n  MatrixOrVectorResult,\n  PromDataSuccessResponse,\n  PromMetric,\n  PromQuery,\n  PromQueryRequest,\n  PromValue,\n  TransformOptions,\n} from './types';\nimport { renderLegendFormat } from './legend';\n\nconst POSITIVE_INFINITY_SAMPLE_VALUE = '+Inf';\nconst NEGATIVE_INFINITY_SAMPLE_VALUE = '-Inf';\n\ninterface TimeAndValue {\n  [TIME_SERIES_TIME_FIELD_NAME]: number;\n  [TIME_SERIES_VALUE_FIELD_NAME]: number;\n}\n\nconst isTableResult = (dataFrame: DataFrame, options: DataQueryRequest<PromQuery>): boolean => {\n  // We want to process vector and scalar results in Explore as table\n  if (\n    options.app === CoreApp.Explore &&\n    (dataFrame.meta?.custom?.resultType === 'vector' || dataFrame.meta?.custom?.resultType === 'scalar')\n  ) {\n    return true;\n  }\n\n  // We want to process all dataFrames with target.format === 'table' as table\n  const target = options.targets.find((target) => target.refId === dataFrame.refId);\n  return target?.format === 'table';\n};\n\nconst isHeatmapResult = (dataFrame: DataFrame, options: DataQueryRequest<PromQuery>): boolean => {\n  const target = options.targets.find((target) => target.refId === dataFrame.refId);\n  return target?.format === 'heatmap';\n};\n\n// V2 result trasnformer used to transform query results from queries that were run trough prometheus backend\nexport function transformV2(\n  response: DataQueryResponse,\n  request: DataQueryRequest<PromQuery>,\n  options: { exemplarTraceIdDestinations?: ExemplarTraceIdDestination[] }\n) {\n  const [tableFrames, framesWithoutTable] = partition<DataFrame>(response.data, (df) => isTableResult(df, request));\n  const processedTableFrames = transformDFToTable(tableFrames);\n\n  const [heatmapResults, framesWithoutTableAndHeatmaps] = partition<DataFrame>(framesWithoutTable, (df) =>\n    isHeatmapResult(df, request)\n  );\n  const processedHeatmapFrames = transformToHistogramOverTime(heatmapResults.sort(sortSeriesByLabel));\n\n  const [exemplarFrames, framesWithoutTableHeatmapsAndExemplars] = partition<DataFrame>(\n    framesWithoutTableAndHeatmaps,\n    (df) => df.meta?.custom?.resultType === 'exemplar'\n  );\n\n  // EXEMPLAR FRAMES: We enrich exemplar frames with data links and add dataTopic meta info\n  const { exemplarTraceIdDestinations: destinations } = options;\n  const processedExemplarFrames = exemplarFrames.map((dataFrame) => {\n    if (destinations?.length) {\n      for (const exemplarTraceIdDestination of destinations) {\n        const traceIDField = dataFrame.fields.find((field) => field.name === exemplarTraceIdDestination.name);\n        if (traceIDField) {\n          const links = getDataLinks(exemplarTraceIdDestination);\n          traceIDField.config.links = traceIDField.config.links?.length\n            ? [...traceIDField.config.links, ...links]\n            : links;\n        }\n      }\n    }\n\n    return { ...dataFrame, meta: { ...dataFrame.meta, dataTopic: DataTopic.Annotations } };\n  });\n\n  // Everything else is processed as time_series result and graph preferredVisualisationType\n  const otherFrames = framesWithoutTableHeatmapsAndExemplars.map((dataFrame) => {\n    const df = {\n      ...dataFrame,\n      meta: {\n        ...dataFrame.meta,\n        preferredVisualisationType: 'graph',\n      },\n    } as DataFrame;\n    return df;\n  });\n\n  return {\n    ...response,\n    data: [...otherFrames, ...processedTableFrames, ...processedHeatmapFrames, ...processedExemplarFrames],\n  };\n}\n\nexport function transformDFToTable(dfs: DataFrame[]): DataFrame[] {\n  // If no dataFrames or if 1 dataFrames with no values, return original dataFrame\n  if (dfs.length === 0 || (dfs.length === 1 && dfs[0].length === 0)) {\n    return dfs;\n  }\n\n  // Group results by refId and process dataFrames with the same refId as 1 dataFrame\n  const dataFramesByRefId = groupBy(dfs, 'refId');\n  const refIds = Object.keys(dataFramesByRefId);\n\n  const frames = refIds.map((refId) => {\n    // Create timeField, valueField and labelFields\n    const valueText = getValueText(refIds.length, refId);\n    const valueField = getValueField({ data: [], valueName: valueText });\n    const timeField = getTimeField([]);\n    const labelFields: MutableField[] = [];\n\n    // Fill labelsFields with labels from dataFrames\n    dataFramesByRefId[refId].forEach((df) => {\n      const frameValueField = df.fields[1];\n      const promLabels = frameValueField.labels ?? {};\n\n      Object.keys(promLabels)\n        .sort()\n        .forEach((label) => {\n          // If we don't have label in labelFields, add it\n          if (!labelFields.some((l) => l.name === label)) {\n            const numberField = label === 'le';\n            labelFields.push({\n              name: label,\n              config: { filterable: true },\n              type: numberField ? FieldType.number : FieldType.string,\n              values: new ArrayVector(),\n            });\n          }\n        });\n    });\n\n    // Fill valueField, timeField and labelFields with values\n    dataFramesByRefId[refId].forEach((df) => {\n      df.fields[0].values.toArray().forEach((value) => timeField.values.add(value));\n      df.fields[1].values.toArray().forEach((value) => {\n        valueField.values.add(parseSampleValue(value));\n        const labelsForField = df.fields[1].labels ?? {};\n        labelFields.forEach((field) => field.values.add(getLabelValue(labelsForField, field.name)));\n      });\n    });\n\n    const fields = [timeField, ...labelFields, valueField];\n    return {\n      refId,\n      fields,\n      meta: { ...dfs[0].meta, preferredVisualisationType: 'table' as PreferredVisualisationType },\n      length: timeField.values.length,\n    };\n  });\n  return frames;\n}\n\nfunction getValueText(responseLength: number, refId = '') {\n  return responseLength > 1 ? `Value #${refId}` : 'Value';\n}\n\nexport function transform(\n  response: FetchResponse<PromDataSuccessResponse>,\n  transformOptions: {\n    query: PromQueryRequest;\n    exemplarTraceIdDestinations?: ExemplarTraceIdDestination[];\n    target: PromQuery;\n    responseListLength: number;\n    scopedVars?: ScopedVars;\n  }\n) {\n  // Create options object from transformOptions\n  const options: TransformOptions = {\n    format: transformOptions.target.format,\n    step: transformOptions.query.step,\n    legendFormat: transformOptions.target.legendFormat,\n    start: transformOptions.query.start,\n    end: transformOptions.query.end,\n    query: transformOptions.query.expr,\n    responseListLength: transformOptions.responseListLength,\n    scopedVars: transformOptions.scopedVars,\n    refId: transformOptions.target.refId,\n    valueWithRefId: transformOptions.target.valueWithRefId,\n    meta: {\n      // Fix for showing of Prometheus results in Explore table\n      preferredVisualisationType: transformOptions.query.instant ? 'table' : 'graph',\n    },\n  };\n  const prometheusResult = response.data.data;\n\n  if (isExemplarData(prometheusResult)) {\n    const events: TimeAndValue[] = [];\n    prometheusResult.forEach((exemplarData) => {\n      const data = exemplarData.exemplars.map((exemplar) => {\n        return {\n          [TIME_SERIES_TIME_FIELD_NAME]: exemplar.timestamp * 1000,\n          [TIME_SERIES_VALUE_FIELD_NAME]: exemplar.value,\n          ...exemplar.labels,\n          ...exemplarData.seriesLabels,\n        };\n      });\n      events.push(...data);\n    });\n\n    // Grouping exemplars by step\n    const sampledExemplars = sampleExemplars(events, options);\n\n    const dataFrame = new ArrayDataFrame(sampledExemplars);\n    dataFrame.meta = { dataTopic: DataTopic.Annotations };\n\n    // Add data links if configured\n    if (transformOptions.exemplarTraceIdDestinations?.length) {\n      for (const exemplarTraceIdDestination of transformOptions.exemplarTraceIdDestinations) {\n        const traceIDField = dataFrame.fields.find((field) => field.name === exemplarTraceIdDestination.name);\n        if (traceIDField) {\n          const links = getDataLinks(exemplarTraceIdDestination);\n          traceIDField.config.links = traceIDField.config.links?.length\n            ? [...traceIDField.config.links, ...links]\n            : links;\n        }\n      }\n    }\n    return [dataFrame];\n  }\n\n  if (!prometheusResult?.result) {\n    return [];\n  }\n\n  // Return early if result type is scalar\n  if (prometheusResult.resultType === 'scalar') {\n    return [\n      {\n        meta: options.meta,\n        refId: options.refId,\n        length: 1,\n        fields: [getTimeField([prometheusResult.result]), getValueField({ data: [prometheusResult.result] })],\n      },\n    ];\n  }\n\n  // Return early again if the format is table, this needs special transformation.\n  if (options.format === 'table') {\n    const tableData = transformMetricDataToTable(prometheusResult.result, options);\n    return [tableData];\n  }\n\n  // Process matrix and vector results to DataFrame\n  const dataFrame: DataFrame[] = [];\n  prometheusResult.result.forEach((data: MatrixOrVectorResult) => dataFrame.push(transformToDataFrame(data, options)));\n\n  // When format is heatmap use the already created data frames and transform it more\n  if (options.format === 'heatmap') {\n    dataFrame.sort(sortSeriesByLabel);\n    const seriesList = transformToHistogramOverTime(dataFrame);\n    return seriesList;\n  }\n\n  // Return matrix or vector result as DataFrame[]\n  return dataFrame;\n}\n\nfunction getDataLinks(options: ExemplarTraceIdDestination): DataLink[] {\n  const dataLinks: DataLink[] = [];\n\n  if (options.datasourceUid) {\n    const dataSourceSrv = getDataSourceSrv();\n    const dsSettings = dataSourceSrv.getInstanceSettings(options.datasourceUid);\n\n    dataLinks.push({\n      title: options.urlDisplayLabel || `Query with ${dsSettings?.name}`,\n      url: '',\n      internal: {\n        query: { query: '${__value.raw}', queryType: 'traceId' },\n        datasourceUid: options.datasourceUid,\n        datasourceName: dsSettings?.name ?? 'Data source not found',\n      },\n    });\n  }\n\n  if (options.url) {\n    dataLinks.push({\n      title: options.urlDisplayLabel || `Go to ${options.url}`,\n      url: options.url,\n      targetBlank: true,\n    });\n  }\n  return dataLinks;\n}\n\n/**\n * Reduce the density of the exemplars by making sure that the highest value exemplar is included\n * and then only the ones that are 2 times the standard deviation of the all the values.\n * This makes sure not to show too many dots near each other.\n */\nfunction sampleExemplars(events: TimeAndValue[], options: TransformOptions) {\n  const step = options.step || 15;\n  const bucketedExemplars: { [ts: string]: TimeAndValue[] } = {};\n  const values: number[] = [];\n  for (const exemplar of events) {\n    // Align exemplar timestamp to nearest step second\n    const alignedTs = String(Math.floor(exemplar[TIME_SERIES_TIME_FIELD_NAME] / 1000 / step) * step * 1000);\n    if (!bucketedExemplars[alignedTs]) {\n      // New bucket found\n      bucketedExemplars[alignedTs] = [];\n    }\n    bucketedExemplars[alignedTs].push(exemplar);\n    values.push(exemplar[TIME_SERIES_VALUE_FIELD_NAME]);\n  }\n\n  // Getting exemplars from each bucket\n  const standardDeviation = deviation(values);\n  const sampledBuckets = Object.keys(bucketedExemplars).sort();\n  const sampledExemplars = [];\n  for (const ts of sampledBuckets) {\n    const exemplarsInBucket = bucketedExemplars[ts];\n    if (exemplarsInBucket.length === 1) {\n      sampledExemplars.push(exemplarsInBucket[0]);\n    } else {\n      // Choose which values to sample\n      const bucketValues = exemplarsInBucket.map((ex) => ex[TIME_SERIES_VALUE_FIELD_NAME]).sort(descending);\n      const sampledBucketValues = bucketValues.reduce((acc: number[], curr) => {\n        if (acc.length === 0) {\n          // First value is max and is always added\n          acc.push(curr);\n        } else {\n          // Then take values only when at least 2 standard deviation distance to previously taken value\n          const prev = acc[acc.length - 1];\n          if (standardDeviation && prev - curr >= 2 * standardDeviation) {\n            acc.push(curr);\n          }\n        }\n        return acc;\n      }, []);\n      // Find the exemplars for the sampled values\n      sampledExemplars.push(\n        ...sampledBucketValues.map(\n          (value) => exemplarsInBucket.find((ex) => ex[TIME_SERIES_VALUE_FIELD_NAME] === value)!\n        )\n      );\n    }\n  }\n  return sampledExemplars;\n}\n\n/**\n * Transforms matrix and vector result from Prometheus result to DataFrame\n */\nfunction transformToDataFrame(data: MatrixOrVectorResult, options: TransformOptions): DataFrame {\n  const { name, labels } = createLabelInfo(data.metric, options);\n\n  const fields: Field[] = [];\n\n  if (isMatrixData(data)) {\n    const stepMs = options.step ? options.step * 1000 : NaN;\n    let baseTimestamp = options.start * 1000;\n    const dps: PromValue[] = [];\n\n    for (const value of data.values) {\n      let dpValue: number | null = parseSampleValue(value[1]);\n\n      if (isNaN(dpValue)) {\n        dpValue = null;\n      }\n\n      const timestamp = value[0] * 1000;\n      for (let t = baseTimestamp; t < timestamp; t += stepMs) {\n        dps.push([t, null]);\n      }\n      baseTimestamp = timestamp + stepMs;\n      dps.push([timestamp, dpValue]);\n    }\n\n    const endTimestamp = options.end * 1000;\n    for (let t = baseTimestamp; t <= endTimestamp; t += stepMs) {\n      dps.push([t, null]);\n    }\n    fields.push(getTimeField(dps, true));\n    fields.push(getValueField({ data: dps, parseValue: false, labels, displayNameFromDS: name }));\n  } else {\n    fields.push(getTimeField([data.value]));\n    fields.push(getValueField({ data: [data.value], labels, displayNameFromDS: name }));\n  }\n\n  return {\n    meta: options.meta,\n    refId: options.refId,\n    length: fields[0].values.length,\n    fields,\n    name,\n  };\n}\n\nfunction transformMetricDataToTable(md: MatrixOrVectorResult[], options: TransformOptions): DataFrame {\n  if (!md || md.length === 0) {\n    return {\n      meta: options.meta,\n      refId: options.refId,\n      length: 0,\n      fields: [],\n    };\n  }\n\n  const valueText = options.responseListLength > 1 || options.valueWithRefId ? `Value #${options.refId}` : 'Value';\n\n  const timeField = getTimeField([]);\n  const metricFields = Object.keys(md.reduce((acc, series) => ({ ...acc, ...series.metric }), {}))\n    .sort()\n    .map((label) => {\n      // Labels have string field type, otherwise table tries to figure out the type which can result in unexpected results\n      // Only \"le\" label has a number field type\n      const numberField = label === 'le';\n      return {\n        name: label,\n        config: { filterable: true },\n        type: numberField ? FieldType.number : FieldType.string,\n        values: new ArrayVector(),\n      };\n    });\n  const valueField = getValueField({ data: [], valueName: valueText });\n\n  md.forEach((d) => {\n    if (isMatrixData(d)) {\n      d.values.forEach((val) => {\n        timeField.values.add(val[0] * 1000);\n        metricFields.forEach((metricField) => metricField.values.add(getLabelValue(d.metric, metricField.name)));\n        valueField.values.add(parseSampleValue(val[1]));\n      });\n    } else {\n      timeField.values.add(d.value[0] * 1000);\n      metricFields.forEach((metricField) => metricField.values.add(getLabelValue(d.metric, metricField.name)));\n      valueField.values.add(parseSampleValue(d.value[1]));\n    }\n  });\n\n  return {\n    meta: options.meta,\n    refId: options.refId,\n    length: timeField.values.length,\n    fields: [timeField, ...metricFields, valueField],\n  };\n}\n\nfunction getLabelValue(metric: PromMetric, label: string): string | number {\n  if (metric.hasOwnProperty(label)) {\n    if (label === 'le') {\n      return parseSampleValue(metric[label]);\n    }\n    return metric[label];\n  }\n  return '';\n}\n\nfunction getTimeField(data: PromValue[], isMs = false): MutableField {\n  return {\n    name: TIME_SERIES_TIME_FIELD_NAME,\n    type: FieldType.time,\n    config: {},\n    values: new ArrayVector<number>(data.map((val) => (isMs ? val[0] : val[0] * 1000))),\n  };\n}\ntype ValueFieldOptions = {\n  data: PromValue[];\n  valueName?: string;\n  parseValue?: boolean;\n  labels?: Labels;\n  displayNameFromDS?: string;\n};\n\nfunction getValueField({\n  data,\n  valueName = TIME_SERIES_VALUE_FIELD_NAME,\n  parseValue = true,\n  labels,\n  displayNameFromDS,\n}: ValueFieldOptions): MutableField {\n  return {\n    name: valueName,\n    type: FieldType.number,\n    display: getDisplayProcessor(),\n    config: {\n      displayNameFromDS,\n    },\n    labels,\n    values: new ArrayVector<number | null>(data.map((val) => (parseValue ? parseSampleValue(val[1]) : val[1]))),\n  };\n}\n\nfunction createLabelInfo(labels: { [key: string]: string }, options: TransformOptions) {\n  if (options?.legendFormat) {\n    const title = renderLegendFormat(getTemplateSrv().replace(options.legendFormat, options?.scopedVars), labels);\n    return { name: title, labels };\n  }\n\n  const { __name__, ...labelsWithoutName } = labels;\n  const labelPart = formatLabels(labelsWithoutName);\n  let title = `${__name__ ?? ''}${labelPart}`;\n\n  if (!title) {\n    title = options.query;\n  }\n\n  return { name: title, labels: labelsWithoutName };\n}\n\nexport function getOriginalMetricName(labelData: { [key: string]: string }) {\n  const metricName = labelData.__name__ || '';\n  delete labelData.__name__;\n  const labelPart = Object.entries(labelData)\n    .map((label) => `${label[0]}=\"${label[1]}\"`)\n    .join(',');\n  return `${metricName}{${labelPart}}`;\n}\n\nfunction transformToHistogramOverTime(seriesList: DataFrame[]) {\n  /*      t1 = timestamp1, t2 = timestamp2 etc.\n            t1  t2  t3          t1  t2  t3\n    le10    10  10  0     =>    10  10  0\n    le20    20  10  30    =>    10  0   30\n    le30    30  10  35    =>    10  0   5\n    */\n  for (let i = seriesList.length - 1; i > 0; i--) {\n    const topSeries = seriesList[i].fields.find((s) => s.name === TIME_SERIES_VALUE_FIELD_NAME);\n    const bottomSeries = seriesList[i - 1].fields.find((s) => s.name === TIME_SERIES_VALUE_FIELD_NAME);\n    if (!topSeries || !bottomSeries) {\n      throw new Error('Prometheus heatmap transform error: data should be a time series');\n    }\n\n    for (let j = 0; j < topSeries.values.length; j++) {\n      const bottomPoint = bottomSeries.values.get(j) || [0];\n      topSeries.values.toArray()[j] -= bottomPoint;\n    }\n  }\n\n  return seriesList;\n}\n\nfunction sortSeriesByLabel(s1: DataFrame, s2: DataFrame): number {\n  let le1, le2;\n\n  try {\n    // fail if not integer. might happen with bad queries\n    le1 = parseSampleValue(s1.name ?? '');\n    le2 = parseSampleValue(s2.name ?? '');\n  } catch (err) {\n    console.error(err);\n    return 0;\n  }\n\n  if (le1 > le2) {\n    return 1;\n  }\n\n  if (le1 < le2) {\n    return -1;\n  }\n\n  return 0;\n}\n\nfunction parseSampleValue(value: string): number {\n  switch (value) {\n    case POSITIVE_INFINITY_SAMPLE_VALUE:\n      return Number.POSITIVE_INFINITY;\n    case NEGATIVE_INFINITY_SAMPLE_VALUE:\n      return Number.NEGATIVE_INFINITY;\n    default:\n      return parseFloat(value);\n  }\n}\n","import { chain, map as _map, uniq } from 'lodash';\nimport { lastValueFrom } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { MetricFindValue, TimeRange } from '@grafana/data';\n\nimport { PrometheusDatasource } from './datasource';\nimport { PromQueryRequest } from './types';\nimport { getTimeSrv } from 'app/features/dashboard/services/TimeSrv';\n\nexport default class PrometheusMetricFindQuery {\n  range: TimeRange;\n\n  constructor(private datasource: PrometheusDatasource, private query: string) {\n    this.datasource = datasource;\n    this.query = query;\n    this.range = getTimeSrv().timeRange();\n  }\n\n  process(): Promise<MetricFindValue[]> {\n    const labelNamesRegex = /^label_names\\(\\)\\s*$/;\n    const labelValuesRegex = /^label_values\\((?:(.+),\\s*)?([a-zA-Z_][a-zA-Z0-9_]*)\\)\\s*$/;\n    const metricNamesRegex = /^metrics\\((.+)\\)\\s*$/;\n    const queryResultRegex = /^query_result\\((.+)\\)\\s*$/;\n    const labelNamesQuery = this.query.match(labelNamesRegex);\n    if (labelNamesQuery) {\n      return this.labelNamesQuery();\n    }\n\n    const labelValuesQuery = this.query.match(labelValuesRegex);\n    if (labelValuesQuery) {\n      if (labelValuesQuery[1]) {\n        return this.labelValuesQuery(labelValuesQuery[2], labelValuesQuery[1]);\n      } else {\n        return this.labelValuesQuery(labelValuesQuery[2]);\n      }\n    }\n\n    const metricNamesQuery = this.query.match(metricNamesRegex);\n    if (metricNamesQuery) {\n      return this.metricNameQuery(metricNamesQuery[1]);\n    }\n\n    const queryResultQuery = this.query.match(queryResultRegex);\n    if (queryResultQuery) {\n      return lastValueFrom(this.queryResultQuery(queryResultQuery[1]));\n    }\n\n    // if query contains full metric name, return metric name and label list\n    return this.metricNameAndLabelsQuery(this.query);\n  }\n\n  labelNamesQuery() {\n    const start = this.datasource.getPrometheusTime(this.range.from, false);\n    const end = this.datasource.getPrometheusTime(this.range.to, true);\n    const params = {\n      start: start.toString(),\n      end: end.toString(),\n    };\n\n    const url = `/api/v1/labels`;\n\n    return this.datasource.metadataRequest(url, params).then((result: any) => {\n      return _map(result.data.data, (value) => {\n        return { text: value };\n      });\n    });\n  }\n\n  labelValuesQuery(label: string, metric?: string) {\n    const start = this.datasource.getPrometheusTime(this.range.from, false);\n    const end = this.datasource.getPrometheusTime(this.range.to, true);\n\n    let url: string;\n\n    if (!metric) {\n      const params = {\n        start: start.toString(),\n        end: end.toString(),\n      };\n      // return label values globally\n      url = `/api/v1/label/${label}/values`;\n\n      return this.datasource.metadataRequest(url, params).then((result: any) => {\n        return _map(result.data.data, (value) => {\n          return { text: value };\n        });\n      });\n    } else {\n      const params = {\n        'match[]': metric,\n        start: start.toString(),\n        end: end.toString(),\n      };\n      url = `/api/v1/series`;\n\n      return this.datasource.metadataRequest(url, params).then((result: any) => {\n        const _labels = _map(result.data.data, (metric) => {\n          return metric[label] || '';\n        }).filter((label) => {\n          return label !== '';\n        });\n\n        return uniq(_labels).map((metric) => {\n          return {\n            text: metric,\n            expandable: true,\n          };\n        });\n      });\n    }\n  }\n\n  metricNameQuery(metricFilterPattern: string) {\n    const start = this.datasource.getPrometheusTime(this.range.from, false);\n    const end = this.datasource.getPrometheusTime(this.range.to, true);\n    const params = {\n      start: start.toString(),\n      end: end.toString(),\n    };\n    const url = `/api/v1/label/__name__/values`;\n\n    return this.datasource.metadataRequest(url, params).then((result: any) => {\n      return chain(result.data.data)\n        .filter((metricName) => {\n          const r = new RegExp(metricFilterPattern);\n          return r.test(metricName);\n        })\n        .map((matchedMetricName) => {\n          return {\n            text: matchedMetricName,\n            expandable: true,\n          };\n        })\n        .value();\n    });\n  }\n\n  queryResultQuery(query: string) {\n    const end = this.datasource.getPrometheusTime(this.range.to, true);\n    const instantQuery: PromQueryRequest = { expr: query } as PromQueryRequest;\n    return this.datasource.performInstantQuery(instantQuery, end).pipe(\n      map((result) => {\n        return _map(result.data.data.result, (metricData) => {\n          let text = metricData.metric.__name__ || '';\n          delete metricData.metric.__name__;\n          text +=\n            '{' +\n            _map(metricData.metric, (v, k) => {\n              return k + '=\"' + v + '\"';\n            }).join(',') +\n            '}';\n          text += ' ' + metricData.value[1] + ' ' + metricData.value[0] * 1000;\n\n          return {\n            text: text,\n            expandable: true,\n          };\n        });\n      })\n    );\n  }\n\n  metricNameAndLabelsQuery(query: string): Promise<MetricFindValue[]> {\n    const start = this.datasource.getPrometheusTime(this.range.from, false);\n    const end = this.datasource.getPrometheusTime(this.range.to, true);\n    const params = {\n      'match[]': query,\n      start: start.toString(),\n      end: end.toString(),\n    };\n\n    const url = `/api/v1/series`;\n    const self = this;\n\n    return this.datasource.metadataRequest(url, params).then((result: any) => {\n      return _map(result.data.data, (metric: { [key: string]: string }) => {\n        return {\n          text: self.datasource.getOriginalMetricName(metric),\n          expandable: true,\n        };\n      });\n    });\n  }\n}\n","import { from, Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport {\n  DataQueryRequest,\n  DataQueryResponse,\n  rangeUtil,\n  StandardVariableQuery,\n  StandardVariableSupport,\n} from '@grafana/data';\nimport { getTemplateSrv, TemplateSrv } from '@grafana/runtime';\n\nimport { PrometheusDatasource } from './datasource';\nimport { PromQuery } from './types';\nimport PrometheusMetricFindQuery from './metric_find_query';\nimport { getTimeSrv, TimeSrv } from '../../../features/dashboard/services/TimeSrv';\n\nexport class PrometheusVariableSupport extends StandardVariableSupport<PrometheusDatasource> {\n  constructor(\n    private readonly datasource: PrometheusDatasource,\n    private readonly templateSrv: TemplateSrv = getTemplateSrv(),\n    private readonly timeSrv: TimeSrv = getTimeSrv()\n  ) {\n    super();\n    this.query = this.query.bind(this);\n  }\n\n  query(request: DataQueryRequest<PromQuery>): Observable<DataQueryResponse> {\n    const query = request.targets[0].expr;\n    if (!query) {\n      return of({ data: [] });\n    }\n\n    const scopedVars = {\n      ...request.scopedVars,\n      __interval: { text: this.datasource.interval, value: this.datasource.interval },\n      __interval_ms: {\n        text: rangeUtil.intervalToMs(this.datasource.interval),\n        value: rangeUtil.intervalToMs(this.datasource.interval),\n      },\n      ...this.datasource.getRangeScopedVars(this.timeSrv.timeRange()),\n    };\n\n    const interpolated = this.templateSrv.replace(query, scopedVars, this.datasource.interpolateQueryExpr);\n    const metricFindQuery = new PrometheusMetricFindQuery(this.datasource, interpolated);\n    const metricFindStream = from(metricFindQuery.process());\n\n    return metricFindStream.pipe(map((results) => ({ data: results })));\n  }\n\n  toDataQuery(query: StandardVariableQuery): PromQuery {\n    return {\n      refId: 'PrometheusDatasource-VariableQuery',\n      expr: query.query,\n    };\n  }\n}\n","import { cloneDeep, defaults } from 'lodash';\nimport { forkJoin, lastValueFrom, merge, Observable, of, OperatorFunction, pipe, throwError } from 'rxjs';\nimport { catchError, filter, map, tap } from 'rxjs/operators';\nimport LRU from 'lru-cache';\nimport {\n  AnnotationEvent,\n  CoreApp,\n  DataQueryError,\n  DataQueryRequest,\n  DataQueryResponse,\n  DataSourceInstanceSettings,\n  DataSourceWithQueryExportSupport,\n  DataSourceWithQueryImportSupport,\n  dateMath,\n  DateTime,\n  AbstractQuery,\n  LoadingState,\n  rangeUtil,\n  ScopedVars,\n  TimeRange,\n  DataFrame,\n  dateTime,\n} from '@grafana/data';\nimport {\n  BackendSrvRequest,\n  FetchError,\n  FetchResponse,\n  getBackendSrv,\n  DataSourceWithBackend,\n  BackendDataSourceResponse,\n  toDataQueryResponse,\n} from '@grafana/runtime';\n\nimport { safeStringifyValue } from 'app/core/utils/explore';\nimport { getTimeSrv, TimeSrv } from 'app/features/dashboard/services/TimeSrv';\nimport { getTemplateSrv, TemplateSrv } from 'app/features/templating/template_srv';\nimport addLabelToQuery from './add_label_to_query';\nimport PrometheusLanguageProvider from './language_provider';\nimport { expandRecordingRules } from './language_utils';\nimport { getInitHints, getQueryHints } from './query_hints';\nimport { getOriginalMetricName, transform, transformV2 } from './result_transformer';\nimport {\n  ExemplarTraceIdDestination,\n  PromDataErrorResponse,\n  PromDataSuccessResponse,\n  PromExemplarData,\n  PromMatrixData,\n  PromOptions,\n  PromQuery,\n  PromQueryRequest,\n  PromQueryType,\n  PromScalarData,\n  PromVectorData,\n} from './types';\nimport { PrometheusVariableSupport } from './variables';\nimport PrometheusMetricFindQuery from './metric_find_query';\nimport { renderLegendFormat } from './legend';\n\nexport const ANNOTATION_QUERY_STEP_DEFAULT = '60s';\nconst GET_AND_POST_METADATA_ENDPOINTS = ['api/v1/query', 'api/v1/query_range', 'api/v1/series', 'api/v1/labels'];\n\nexport class PrometheusDatasource\n  extends DataSourceWithBackend<PromQuery, PromOptions>\n  implements DataSourceWithQueryImportSupport<PromQuery>, DataSourceWithQueryExportSupport<PromQuery>\n{\n  type: string;\n  editorSrc: string;\n  ruleMappings: { [index: string]: string };\n  url: string;\n  id: number;\n  directUrl: string;\n  access: 'direct' | 'proxy';\n  basicAuth: any;\n  withCredentials: any;\n  metricsNameCache = new LRU<string, string[]>(10);\n  interval: string;\n  queryTimeout: string | undefined;\n  httpMethod: string;\n  languageProvider: PrometheusLanguageProvider;\n  exemplarTraceIdDestinations: ExemplarTraceIdDestination[] | undefined;\n  lookupsDisabled: boolean;\n  customQueryParameters: any;\n  exemplarsAvailable: boolean;\n\n  constructor(\n    instanceSettings: DataSourceInstanceSettings<PromOptions>,\n    private readonly templateSrv: TemplateSrv = getTemplateSrv(),\n    private readonly timeSrv: TimeSrv = getTimeSrv(),\n    languageProvider?: PrometheusLanguageProvider\n  ) {\n    super(instanceSettings);\n\n    this.type = 'prometheus';\n    this.editorSrc = 'app/features/prometheus/partials/query.editor.html';\n    this.id = instanceSettings.id;\n    this.url = instanceSettings.url!;\n    this.access = instanceSettings.access;\n    this.basicAuth = instanceSettings.basicAuth;\n    this.withCredentials = instanceSettings.withCredentials;\n    this.interval = instanceSettings.jsonData.timeInterval || '15s';\n    this.queryTimeout = instanceSettings.jsonData.queryTimeout;\n    this.httpMethod = instanceSettings.jsonData.httpMethod || 'POST';\n    // `directUrl` is never undefined, we set it at https://github.com/grafana/grafana/blob/main/pkg/api/frontendsettings.go#L108\n    // here we \"fall back\" to this.url to make typescript happy, but it should never happen\n    this.directUrl = instanceSettings.jsonData.directUrl ?? this.url;\n    this.exemplarTraceIdDestinations = instanceSettings.jsonData.exemplarTraceIdDestinations;\n    this.ruleMappings = {};\n    this.languageProvider = languageProvider ?? new PrometheusLanguageProvider(this);\n    this.lookupsDisabled = instanceSettings.jsonData.disableMetricsLookup ?? false;\n    this.customQueryParameters = new URLSearchParams(instanceSettings.jsonData.customQueryParameters);\n    this.variables = new PrometheusVariableSupport(this, this.templateSrv, this.timeSrv);\n    this.exemplarsAvailable = true;\n  }\n\n  init = async () => {\n    this.loadRules();\n    this.exemplarsAvailable = await this.areExemplarsAvailable();\n  };\n\n  getQueryDisplayText(query: PromQuery) {\n    return query.expr;\n  }\n\n  _addTracingHeaders(httpOptions: PromQueryRequest, options: DataQueryRequest<PromQuery>) {\n    httpOptions.headers = {};\n    const proxyMode = !this.url.match(/^http/);\n    if (proxyMode) {\n      httpOptions.headers['X-Dashboard-Id'] = options.dashboardId;\n      httpOptions.headers['X-Panel-Id'] = options.panelId;\n    }\n  }\n\n  /**\n   * Any request done from this data source should go through here as it contains some common processing for the\n   * request. Any processing done here needs to be also copied on the backend as this goes through data source proxy\n   * but not through the same code as alerting.\n   */\n  _request<T = any>(\n    url: string,\n    data: Record<string, string> | null,\n    overrides: Partial<BackendSrvRequest> = {}\n  ): Observable<FetchResponse<T>> {\n    data = data || {};\n    for (const [key, value] of this.customQueryParameters) {\n      if (data[key] == null) {\n        data[key] = value;\n      }\n    }\n\n    const options: BackendSrvRequest = defaults(overrides, {\n      url: this.url + url,\n      method: this.httpMethod,\n      headers: {},\n    });\n\n    if (options.method === 'GET') {\n      if (data && Object.keys(data).length) {\n        options.url =\n          options.url +\n          (options.url.search(/\\?/) >= 0 ? '&' : '?') +\n          Object.entries(data)\n            .map(([k, v]) => `${encodeURIComponent(k)}=${encodeURIComponent(v)}`)\n            .join('&');\n      }\n    } else {\n      options.headers!['Content-Type'] = 'application/x-www-form-urlencoded';\n      options.data = data;\n    }\n\n    if (this.basicAuth || this.withCredentials) {\n      options.withCredentials = true;\n    }\n\n    if (this.basicAuth) {\n      options.headers!.Authorization = this.basicAuth;\n    }\n\n    return getBackendSrv().fetch<T>(options);\n  }\n\n  async importFromAbstractQueries(abstractQueries: AbstractQuery[]): Promise<PromQuery[]> {\n    return abstractQueries.map((abstractQuery) => this.languageProvider.importFromAbstractQuery(abstractQuery));\n  }\n\n  async exportToAbstractQueries(queries: PromQuery[]): Promise<AbstractQuery[]> {\n    return queries.map((query) => this.languageProvider.exportToAbstractQuery(query));\n  }\n\n  // Use this for tab completion features, wont publish response to other components\n  async metadataRequest<T = any>(url: string, params = {}) {\n    // If URL includes endpoint that supports POST and GET method, try to use configured method. This might fail as POST is supported only in v2.10+.\n    if (GET_AND_POST_METADATA_ENDPOINTS.some((endpoint) => url.includes(endpoint))) {\n      try {\n        return await lastValueFrom(this._request<T>(url, params, { method: this.httpMethod, hideFromInspector: true }));\n      } catch (err) {\n        // If status code of error is Method Not Allowed (405) and HTTP method is POST, retry with GET\n        if (this.httpMethod === 'POST' && err.status === 405) {\n          console.warn(`Couldn't use configured POST HTTP method for this request. Trying to use GET method instead.`);\n        } else {\n          throw err;\n        }\n      }\n    }\n\n    return await lastValueFrom(this._request<T>(url, params, { method: 'GET', hideFromInspector: true })); // toPromise until we change getTagValues, getTagKeys to Observable\n  }\n\n  interpolateQueryExpr(value: string | string[] = [], variable: any) {\n    // if no multi or include all do not regexEscape\n    if (!variable.multi && !variable.includeAll) {\n      return prometheusRegularEscape(value);\n    }\n\n    if (typeof value === 'string') {\n      return prometheusSpecialRegexEscape(value);\n    }\n\n    const escapedValues = value.map((val) => prometheusSpecialRegexEscape(val));\n\n    if (escapedValues.length === 1) {\n      return escapedValues[0];\n    }\n\n    return '(' + escapedValues.join('|') + ')';\n  }\n\n  targetContainsTemplate(target: PromQuery) {\n    return this.templateSrv.variableExists(target.expr);\n  }\n\n  prepareTargets = (options: DataQueryRequest<PromQuery>, start: number, end: number) => {\n    const queries: PromQueryRequest[] = [];\n    const activeTargets: PromQuery[] = [];\n    const clonedTargets = cloneDeep(options.targets);\n\n    for (const target of clonedTargets) {\n      if (!target.expr || target.hide) {\n        continue;\n      }\n\n      target.requestId = options.panelId + target.refId;\n      const metricName = this.languageProvider.histogramMetrics.find((m) => target.expr.includes(m));\n\n      // In Explore, we run both (instant and range) queries if both are true (selected) or both are undefined (legacy Explore queries)\n      if (options.app === CoreApp.Explore && target.range === target.instant) {\n        // Create instant target\n        const instantTarget: any = cloneDeep(target);\n        instantTarget.format = 'table';\n        instantTarget.instant = true;\n        instantTarget.range = false;\n        instantTarget.valueWithRefId = true;\n        delete instantTarget.maxDataPoints;\n        instantTarget.requestId += '_instant';\n\n        // Create range target\n        const rangeTarget: any = cloneDeep(target);\n        rangeTarget.format = 'time_series';\n        rangeTarget.instant = false;\n        instantTarget.range = true;\n\n        // Create exemplar query\n        if (target.exemplar) {\n          // Only create exemplar target for different metric names\n          if (\n            !metricName ||\n            (metricName && !activeTargets.some((activeTarget) => activeTarget.expr.includes(metricName)))\n          ) {\n            const exemplarTarget = cloneDeep(target);\n            exemplarTarget.instant = false;\n            exemplarTarget.requestId += '_exemplar';\n            queries.push(this.createQuery(exemplarTarget, options, start, end));\n            activeTargets.push(exemplarTarget);\n          }\n          instantTarget.exemplar = false;\n          rangeTarget.exemplar = false;\n        }\n\n        // Add both targets to activeTargets and queries arrays\n        activeTargets.push(instantTarget, rangeTarget);\n        queries.push(\n          this.createQuery(instantTarget, options, start, end),\n          this.createQuery(rangeTarget, options, start, end)\n        );\n        // If running only instant query in Explore, format as table\n      } else if (target.instant && options.app === CoreApp.Explore) {\n        const instantTarget: any = cloneDeep(target);\n        instantTarget.format = 'table';\n        queries.push(this.createQuery(instantTarget, options, start, end));\n        activeTargets.push(instantTarget);\n      } else {\n        // It doesn't make sense to query for exemplars in dashboard if only instant is selected\n        if (target.exemplar && !target.instant) {\n          if (\n            !metricName ||\n            (metricName && !activeTargets.some((activeTarget) => activeTarget.expr.includes(metricName)))\n          ) {\n            const exemplarTarget = cloneDeep(target);\n            exemplarTarget.requestId += '_exemplar';\n            queries.push(this.createQuery(exemplarTarget, options, start, end));\n            activeTargets.push(exemplarTarget);\n          }\n          target.exemplar = false;\n        }\n        queries.push(this.createQuery(target, options, start, end));\n        activeTargets.push(target);\n      }\n    }\n\n    return {\n      queries,\n      activeTargets,\n    };\n  };\n\n  shouldRunExemplarQuery(target: PromQuery, request: DataQueryRequest<PromQuery>): boolean {\n    if (target.exemplar) {\n      // We check all already processed targets and only create exemplar target for not used metric names\n      const metricName = this.languageProvider.histogramMetrics.find((m) => target.expr.includes(m));\n      // Remove targets that weren't processed yet (in targets array they are after current target)\n      const currentTargetIdx = request.targets.findIndex((t) => t.refId === target.refId);\n      const targets = request.targets.slice(0, currentTargetIdx);\n\n      if (!metricName || (metricName && !targets.some((t) => t.expr.includes(metricName)))) {\n        return true;\n      }\n      return false;\n    }\n    return false;\n  }\n\n  processTargetV2(target: PromQuery, request: DataQueryRequest<PromQuery>) {\n    const processedTarget = {\n      ...target,\n      queryType: PromQueryType.timeSeriesQuery,\n      exemplar: this.shouldRunExemplarQuery(target, request),\n      requestId: request.panelId + target.refId,\n      // We need to pass utcOffsetSec to backend to calculate aligned range\n      utcOffsetSec: this.timeSrv.timeRange().to.utcOffset() * 60,\n    };\n    return processedTarget;\n  }\n\n  query(request: DataQueryRequest<PromQuery>): Observable<DataQueryResponse> {\n    if (this.access === 'proxy') {\n      const targets = request.targets.map((target) => this.processTargetV2(target, request));\n      return super\n        .query({ ...request, targets })\n        .pipe(\n          map((response) =>\n            transformV2(response, request, { exemplarTraceIdDestinations: this.exemplarTraceIdDestinations })\n          )\n        );\n      // Run queries trough browser/proxy\n    } else {\n      const start = this.getPrometheusTime(request.range.from, false);\n      const end = this.getPrometheusTime(request.range.to, true);\n      const { queries, activeTargets } = this.prepareTargets(request, start, end);\n\n      // No valid targets, return the empty result to save a round trip.\n      if (!queries || !queries.length) {\n        return of({\n          data: [],\n          state: LoadingState.Done,\n        });\n      }\n\n      if (request.app === CoreApp.Explore) {\n        return this.exploreQuery(queries, activeTargets, end);\n      }\n\n      return this.panelsQuery(queries, activeTargets, end, request.requestId, request.scopedVars);\n    }\n  }\n\n  private exploreQuery(queries: PromQueryRequest[], activeTargets: PromQuery[], end: number) {\n    let runningQueriesCount = queries.length;\n\n    const subQueries = queries.map((query, index) => {\n      const target = activeTargets[index];\n\n      const filterAndMapResponse = pipe(\n        // Decrease the counter here. We assume that each request returns only single value and then completes\n        // (should hold until there is some streaming requests involved).\n        tap(() => runningQueriesCount--),\n        filter((response: any) => (response.cancelled ? false : true)),\n        map((response: any) => {\n          const data = transform(response, {\n            query,\n            target,\n            responseListLength: queries.length,\n            exemplarTraceIdDestinations: this.exemplarTraceIdDestinations,\n          });\n          return {\n            data,\n            key: query.requestId,\n            state: runningQueriesCount === 0 ? LoadingState.Done : LoadingState.Loading,\n          } as DataQueryResponse;\n        })\n      );\n\n      return this.runQuery(query, end, filterAndMapResponse);\n    });\n\n    return merge(...subQueries);\n  }\n\n  private panelsQuery(\n    queries: PromQueryRequest[],\n    activeTargets: PromQuery[],\n    end: number,\n    requestId: string,\n    scopedVars: ScopedVars\n  ) {\n    const observables = queries.map((query, index) => {\n      const target = activeTargets[index];\n\n      const filterAndMapResponse = pipe(\n        filter((response: any) => (response.cancelled ? false : true)),\n        map((response: any) => {\n          const data = transform(response, {\n            query,\n            target,\n            responseListLength: queries.length,\n            scopedVars,\n            exemplarTraceIdDestinations: this.exemplarTraceIdDestinations,\n          });\n          return data;\n        })\n      );\n\n      return this.runQuery(query, end, filterAndMapResponse);\n    });\n\n    return forkJoin(observables).pipe(\n      map((results) => {\n        const data = results.reduce((result, current) => {\n          return [...result, ...current];\n        }, []);\n        return {\n          data,\n          key: requestId,\n          state: LoadingState.Done,\n        };\n      })\n    );\n  }\n\n  private runQuery<T>(query: PromQueryRequest, end: number, filter: OperatorFunction<any, T>): Observable<T> {\n    if (query.instant) {\n      return this.performInstantQuery(query, end).pipe(filter);\n    }\n\n    if (query.exemplar) {\n      return this.getExemplars(query).pipe(\n        catchError(() => {\n          return of({\n            data: [],\n            state: LoadingState.Done,\n          });\n        }),\n        filter\n      );\n    }\n\n    return this.performTimeSeriesQuery(query, query.start, query.end).pipe(filter);\n  }\n\n  createQuery(target: PromQuery, options: DataQueryRequest<PromQuery>, start: number, end: number) {\n    const query: PromQueryRequest = {\n      hinting: target.hinting,\n      instant: target.instant,\n      exemplar: target.exemplar,\n      step: 0,\n      expr: '',\n      requestId: target.requestId,\n      refId: target.refId,\n      start: 0,\n      end: 0,\n    };\n    const range = Math.ceil(end - start);\n\n    // options.interval is the dynamically calculated interval\n    let interval: number = rangeUtil.intervalToSeconds(options.interval);\n    // Minimum interval (\"Min step\"), if specified for the query, or same as interval otherwise.\n    const minInterval = rangeUtil.intervalToSeconds(\n      this.templateSrv.replace(target.interval || options.interval, options.scopedVars)\n    );\n    // Scrape interval as specified for the query (\"Min step\") or otherwise taken from the datasource.\n    // Min step field can have template variables in it, make sure to replace it.\n    const scrapeInterval = target.interval\n      ? rangeUtil.intervalToSeconds(this.templateSrv.replace(target.interval, options.scopedVars))\n      : rangeUtil.intervalToSeconds(this.interval);\n\n    const intervalFactor = target.intervalFactor || 1;\n    // Adjust the interval to take into account any specified minimum and interval factor plus Prometheus limits\n    const adjustedInterval = this.adjustInterval(interval, minInterval, range, intervalFactor);\n    let scopedVars = {\n      ...options.scopedVars,\n      ...this.getRangeScopedVars(options.range),\n      ...this.getRateIntervalScopedVariable(adjustedInterval, scrapeInterval),\n    };\n    // If the interval was adjusted, make a shallow copy of scopedVars with updated interval vars\n    if (interval !== adjustedInterval) {\n      interval = adjustedInterval;\n      scopedVars = Object.assign({}, options.scopedVars, {\n        __interval: { text: interval + 's', value: interval + 's' },\n        __interval_ms: { text: interval * 1000, value: interval * 1000 },\n        ...this.getRateIntervalScopedVariable(interval, scrapeInterval),\n        ...this.getRangeScopedVars(options.range),\n      });\n    }\n    query.step = interval;\n\n    let expr = target.expr;\n\n    // Apply adhoc filters\n    expr = this.enhanceExprWithAdHocFilters(expr);\n\n    // Only replace vars in expression after having (possibly) updated interval vars\n    query.expr = this.templateSrv.replace(expr, scopedVars, this.interpolateQueryExpr);\n\n    // Align query interval with step to allow query caching and to ensure\n    // that about-same-time query results look the same.\n    const adjusted = alignRange(start, end, query.step, this.timeSrv.timeRange().to.utcOffset() * 60);\n    query.start = adjusted.start;\n    query.end = adjusted.end;\n    this._addTracingHeaders(query, options);\n\n    return query;\n  }\n\n  getRateIntervalScopedVariable(interval: number, scrapeInterval: number) {\n    // Fall back to the default scrape interval of 15s if scrapeInterval is 0 for some reason.\n    if (scrapeInterval === 0) {\n      scrapeInterval = 15;\n    }\n    const rateInterval = Math.max(interval + scrapeInterval, 4 * scrapeInterval);\n    return { __rate_interval: { text: rateInterval + 's', value: rateInterval + 's' } };\n  }\n\n  adjustInterval(interval: number, minInterval: number, range: number, intervalFactor: number) {\n    // Prometheus will drop queries that might return more than 11000 data points.\n    // Calculate a safe interval as an additional minimum to take into account.\n    // Fractional safeIntervals are allowed, however serve little purpose if the interval is greater than 1\n    // If this is the case take the ceil of the value.\n    let safeInterval = range / 11000;\n    if (safeInterval > 1) {\n      safeInterval = Math.ceil(safeInterval);\n    }\n    return Math.max(interval * intervalFactor, minInterval, safeInterval);\n  }\n\n  performTimeSeriesQuery(query: PromQueryRequest, start: number, end: number) {\n    if (start > end) {\n      throw { message: 'Invalid time range' };\n    }\n\n    const url = '/api/v1/query_range';\n    const data: any = {\n      query: query.expr,\n      start,\n      end,\n      step: query.step,\n    };\n\n    if (this.queryTimeout) {\n      data['timeout'] = this.queryTimeout;\n    }\n\n    return this._request<PromDataSuccessResponse<PromMatrixData>>(url, data, {\n      requestId: query.requestId,\n      headers: query.headers,\n    }).pipe(\n      catchError((err: FetchError<PromDataErrorResponse<PromMatrixData>>) => {\n        if (err.cancelled) {\n          return of(err);\n        }\n\n        return throwError(this.handleErrors(err, query));\n      })\n    );\n  }\n\n  performInstantQuery(\n    query: PromQueryRequest,\n    time: number\n  ): Observable<FetchResponse<PromDataSuccessResponse<PromVectorData | PromScalarData>> | FetchError> {\n    const url = '/api/v1/query';\n    const data: any = {\n      query: query.expr,\n      time,\n    };\n\n    if (this.queryTimeout) {\n      data['timeout'] = this.queryTimeout;\n    }\n\n    return this._request<PromDataSuccessResponse<PromVectorData | PromScalarData>>(url, data, {\n      requestId: query.requestId,\n      headers: query.headers,\n    }).pipe(\n      catchError((err: FetchError<PromDataErrorResponse<PromVectorData | PromScalarData>>) => {\n        if (err.cancelled) {\n          return of(err);\n        }\n\n        return throwError(this.handleErrors(err, query));\n      })\n    );\n  }\n\n  handleErrors = (err: any, target: PromQuery) => {\n    const error: DataQueryError = {\n      message: (err && err.statusText) || 'Unknown error during query transaction. Please check JS console logs.',\n      refId: target.refId,\n    };\n\n    if (err.data) {\n      if (typeof err.data === 'string') {\n        error.message = err.data;\n      } else if (err.data.error) {\n        error.message = safeStringifyValue(err.data.error);\n      }\n    } else if (err.message) {\n      error.message = err.message;\n    } else if (typeof err === 'string') {\n      error.message = err;\n    }\n\n    error.status = err.status;\n    error.statusText = err.statusText;\n\n    return error;\n  };\n\n  metricFindQuery(query: string) {\n    if (!query) {\n      return Promise.resolve([]);\n    }\n\n    const scopedVars = {\n      __interval: { text: this.interval, value: this.interval },\n      __interval_ms: { text: rangeUtil.intervalToMs(this.interval), value: rangeUtil.intervalToMs(this.interval) },\n      ...this.getRangeScopedVars(this.timeSrv.timeRange()),\n    };\n    const interpolated = this.templateSrv.replace(query, scopedVars, this.interpolateQueryExpr);\n    const metricFindQuery = new PrometheusMetricFindQuery(this, interpolated);\n    return metricFindQuery.process();\n  }\n\n  getRangeScopedVars(range: TimeRange = this.timeSrv.timeRange()) {\n    const msRange = range.to.diff(range.from);\n    const sRange = Math.round(msRange / 1000);\n    return {\n      __range_ms: { text: msRange, value: msRange },\n      __range_s: { text: sRange, value: sRange },\n      __range: { text: sRange + 's', value: sRange + 's' },\n    };\n  }\n\n  async annotationQuery(options: any): Promise<AnnotationEvent[]> {\n    const annotation = options.annotation;\n    const { expr = '' } = annotation;\n\n    if (!expr) {\n      return Promise.resolve([]);\n    }\n\n    const step = options.annotation.step || ANNOTATION_QUERY_STEP_DEFAULT;\n    const queryModel = {\n      expr,\n      range: true,\n      instant: false,\n      exemplar: false,\n      interval: step,\n      queryType: PromQueryType.timeSeriesQuery,\n      refId: 'X',\n      datasource: this.getRef(),\n    };\n\n    return await lastValueFrom(\n      getBackendSrv()\n        .fetch<BackendDataSourceResponse>({\n          url: '/api/ds/query',\n          method: 'POST',\n          data: {\n            from: (this.getPrometheusTime(options.range.from, false) * 1000).toString(),\n            to: (this.getPrometheusTime(options.range.to, true) * 1000).toString(),\n            queries: [this.applyTemplateVariables(queryModel, {})],\n          },\n          requestId: `prom-query-${annotation.name}`,\n        })\n        .pipe(\n          map((rsp: FetchResponse<BackendDataSourceResponse>) => {\n            return this.processAnnotationResponse(options, rsp.data);\n          })\n        )\n    );\n  }\n\n  processAnnotationResponse = (options: any, data: BackendDataSourceResponse) => {\n    const frames: DataFrame[] = toDataQueryResponse({ data: data }).data;\n    if (!frames || !frames.length) {\n      return [];\n    }\n\n    const annotation = options.annotation;\n    const { tagKeys = '', titleFormat = '', textFormat = '' } = annotation;\n\n    const step = rangeUtil.intervalToSeconds(annotation.step || ANNOTATION_QUERY_STEP_DEFAULT) * 1000;\n    const tagKeysArray = tagKeys.split(',');\n\n    const eventList: AnnotationEvent[] = [];\n\n    for (const frame of frames) {\n      const timeField = frame.fields[0];\n      const valueField = frame.fields[1];\n      const labels = valueField?.labels || {};\n\n      const tags = Object.keys(labels)\n        .filter((label) => tagKeysArray.includes(label))\n        .map((label) => labels[label]);\n\n      const timeValueTuple: Array<[number, number]> = [];\n\n      let idx = 0;\n      valueField.values.toArray().forEach((value: string) => {\n        let timeStampValue: number;\n        let valueValue: number;\n        const time = timeField.values.get(idx);\n\n        // If we want to use value as a time, we use value as timeStampValue and valueValue will be 1\n        if (options.annotation.useValueForTime) {\n          timeStampValue = Math.floor(parseFloat(value));\n          valueValue = 1;\n        } else {\n          timeStampValue = Math.floor(parseFloat(time));\n          valueValue = parseFloat(value);\n        }\n\n        idx++;\n        timeValueTuple.push([timeStampValue, valueValue]);\n      });\n\n      const activeValues = timeValueTuple.filter((value) => value[1] >= 1);\n      const activeValuesTimestamps = activeValues.map((value) => value[0]);\n\n      // Instead of creating singular annotation for each active event we group events into region if they are less\n      // or equal to `step` apart.\n      let latestEvent: AnnotationEvent | null = null;\n\n      for (const timestamp of activeValuesTimestamps) {\n        // We already have event `open` and we have new event that is inside the `step` so we just update the end.\n        if (latestEvent && (latestEvent.timeEnd ?? 0) + step >= timestamp) {\n          latestEvent.timeEnd = timestamp;\n          continue;\n        }\n\n        // Event exists but new one is outside of the `step` so we add it to eventList.\n        if (latestEvent) {\n          eventList.push(latestEvent);\n        }\n\n        // We start a new region.\n        latestEvent = {\n          time: timestamp,\n          timeEnd: timestamp,\n          annotation,\n          title: renderLegendFormat(titleFormat, labels),\n          tags,\n          text: renderLegendFormat(textFormat, labels),\n        };\n      }\n\n      if (latestEvent) {\n        // Finish up last point if we have one\n        latestEvent.timeEnd = activeValuesTimestamps[activeValuesTimestamps.length - 1];\n        eventList.push(latestEvent);\n      }\n    }\n\n    return eventList;\n  };\n\n  getExemplars(query: PromQueryRequest) {\n    const url = '/api/v1/query_exemplars';\n    return this._request<PromDataSuccessResponse<PromExemplarData>>(\n      url,\n      { query: query.expr, start: query.start.toString(), end: query.end.toString() },\n      { requestId: query.requestId, headers: query.headers }\n    );\n  }\n\n  async getTagKeys(options?: any) {\n    if (options?.series) {\n      // Get tags for the provided series only\n      const seriesLabels: Array<Record<string, string[]>> = await Promise.all(\n        options.series.map((series: string) => this.languageProvider.fetchSeriesLabels(series))\n      );\n      const uniqueLabels = [...new Set(...seriesLabels.map((value) => Object.keys(value)))];\n      return uniqueLabels.map((value: any) => ({ text: value }));\n    } else {\n      // Get all tags\n      const result = await this.metadataRequest('/api/v1/labels');\n      return result?.data?.data?.map((value: any) => ({ text: value })) ?? [];\n    }\n  }\n\n  async getTagValues(options: { key?: string } = {}) {\n    const result = await this.metadataRequest(`/api/v1/label/${options.key}/values`);\n    return result?.data?.data?.map((value: any) => ({ text: value })) ?? [];\n  }\n\n  async testDatasource() {\n    const now = new Date().getTime();\n    const request: DataQueryRequest<PromQuery> = {\n      targets: [{ refId: 'test', expr: '1+1', instant: true }],\n      requestId: `${this.id}-health`,\n      scopedVars: {},\n      dashboardId: 0,\n      panelId: 0,\n      interval: '1m',\n      intervalMs: 60000,\n      maxDataPoints: 1,\n      range: {\n        from: dateTime(now - 1000),\n        to: dateTime(now),\n      },\n    } as DataQueryRequest<PromQuery>;\n\n    return lastValueFrom(this.query(request))\n      .then((res: DataQueryResponse) => {\n        if (!res || !res.data || res.state !== LoadingState.Done) {\n          return { status: 'error', message: `Error reading Prometheus: ${res?.error?.message}` };\n        } else {\n          return { status: 'success', message: 'Data source is working' };\n        }\n      })\n      .catch((err: any) => {\n        console.error('Prometheus Error', err);\n        return { status: 'error', message: err.message };\n      });\n  }\n\n  interpolateVariablesInQueries(queries: PromQuery[], scopedVars: ScopedVars): PromQuery[] {\n    let expandedQueries = queries;\n    if (queries && queries.length) {\n      expandedQueries = queries.map((query) => {\n        const expandedQuery = {\n          ...query,\n          datasource: this.getRef(),\n          expr: this.templateSrv.replace(query.expr, scopedVars, this.interpolateQueryExpr),\n          interval: this.templateSrv.replace(query.interval, scopedVars),\n        };\n        return expandedQuery;\n      });\n    }\n    return expandedQueries;\n  }\n\n  getQueryHints(query: PromQuery, result: any[]) {\n    return getQueryHints(query.expr ?? '', result, this);\n  }\n\n  getInitHints() {\n    return getInitHints(this);\n  }\n\n  async loadRules() {\n    try {\n      const res = await this.metadataRequest('/api/v1/rules');\n      const groups = res.data?.data?.groups;\n\n      if (groups) {\n        this.ruleMappings = extractRuleMappingFromGroups(groups);\n      }\n    } catch (e) {\n      console.log('Rules API is experimental. Ignore next error.');\n      console.error(e);\n    }\n  }\n\n  async areExemplarsAvailable() {\n    try {\n      const res = await this.metadataRequest('/api/v1/query_exemplars', { query: 'test' });\n      if (res.data.status === 'success') {\n        return true;\n      }\n      return false;\n    } catch (err) {\n      return false;\n    }\n  }\n\n  modifyQuery(query: PromQuery, action: any): PromQuery {\n    let expression = query.expr ?? '';\n    switch (action.type) {\n      case 'ADD_FILTER': {\n        expression = addLabelToQuery(expression, action.key, action.value);\n        break;\n      }\n      case 'ADD_FILTER_OUT': {\n        expression = addLabelToQuery(expression, action.key, action.value, '!=');\n        break;\n      }\n      case 'ADD_HISTOGRAM_QUANTILE': {\n        expression = `histogram_quantile(0.95, sum(rate(${expression}[5m])) by (le))`;\n        break;\n      }\n      case 'ADD_RATE': {\n        expression = `rate(${expression}[5m])`;\n        break;\n      }\n      case 'ADD_SUM': {\n        expression = `sum(${expression.trim()}) by ($1)`;\n        break;\n      }\n      case 'EXPAND_RULES': {\n        if (action.mapping) {\n          expression = expandRecordingRules(expression, action.mapping);\n        }\n        break;\n      }\n      default:\n        break;\n    }\n    return { ...query, expr: expression };\n  }\n\n  getPrometheusTime(date: string | DateTime, roundUp: boolean) {\n    if (typeof date === 'string') {\n      date = dateMath.parse(date, roundUp)!;\n    }\n\n    return Math.ceil(date.valueOf() / 1000);\n  }\n\n  getTimeRangeParams(): { start: string; end: string } {\n    const range = this.timeSrv.timeRange();\n    return {\n      start: this.getPrometheusTime(range.from, false).toString(),\n      end: this.getPrometheusTime(range.to, true).toString(),\n    };\n  }\n\n  getOriginalMetricName(labelData: { [key: string]: string }) {\n    return getOriginalMetricName(labelData);\n  }\n\n  enhanceExprWithAdHocFilters(expr: string) {\n    const adhocFilters = this.templateSrv.getAdhocFilters(this.name);\n    let finalQuery = expr;\n    finalQuery = adhocFilters.reduce((acc: string, filter: { key?: any; operator?: any; value?: any }) => {\n      const { key, operator } = filter;\n      let { value } = filter;\n      if (operator === '=~' || operator === '!~') {\n        value = prometheusRegularEscape(value);\n      }\n      return addLabelToQuery(acc, key, value, operator);\n    }, finalQuery);\n    return finalQuery;\n  }\n\n  // Used when running queries trough backend\n  filterQuery(query: PromQuery): boolean {\n    if (query.hide || !query.expr) {\n      return false;\n    }\n    return true;\n  }\n\n  // Used when running queries trough backend\n  applyTemplateVariables(target: PromQuery, scopedVars: ScopedVars): Record<string, any> {\n    const variables = cloneDeep(scopedVars);\n\n    // We want to interpolate these variables on backend\n    delete variables.__interval;\n    delete variables.__interval_ms;\n\n    //Add ad hoc filters\n    const expr = this.enhanceExprWithAdHocFilters(target.expr);\n\n    return {\n      ...target,\n      legendFormat: this.templateSrv.replace(target.legendFormat, variables),\n      expr: this.templateSrv.replace(expr, variables, this.interpolateQueryExpr),\n      interval: this.templateSrv.replace(target.interval, variables),\n    };\n  }\n}\n\n/**\n * Align query range to step.\n * Rounds start and end down to a multiple of step.\n * @param start Timestamp marking the beginning of the range.\n * @param end Timestamp marking the end of the range.\n * @param step Interval to align start and end with.\n * @param utcOffsetSec Number of seconds current timezone is offset from UTC\n */\nexport function alignRange(\n  start: number,\n  end: number,\n  step: number,\n  utcOffsetSec: number\n): { end: number; start: number } {\n  const alignedEnd = Math.floor((end + utcOffsetSec) / step) * step - utcOffsetSec;\n  const alignedStart = Math.floor((start + utcOffsetSec) / step) * step - utcOffsetSec;\n  return {\n    end: alignedEnd,\n    start: alignedStart,\n  };\n}\n\nexport function extractRuleMappingFromGroups(groups: any[]) {\n  return groups.reduce(\n    (mapping, group) =>\n      group.rules\n        .filter((rule: any) => rule.type === 'recording')\n        .reduce(\n          (acc: { [key: string]: string }, rule: any) => ({\n            ...acc,\n            [rule.name]: rule.query,\n          }),\n          mapping\n        ),\n    {}\n  );\n}\n\n// NOTE: these two functions are very similar to the escapeLabelValueIn* functions\n// in language_utils.ts, but they are not exactly the same algorithm, and we found\n// no way to reuse one in the another or vice versa.\nexport function prometheusRegularEscape(value: any) {\n  return typeof value === 'string' ? value.replace(/\\\\/g, '\\\\\\\\').replace(/'/g, \"\\\\\\\\'\") : value;\n}\n\nexport function prometheusSpecialRegexEscape(value: any) {\n  return typeof value === 'string' ? value.replace(/\\\\/g, '\\\\\\\\\\\\\\\\').replace(/[$^*{}\\[\\]\\'+?.()|]/g, '\\\\\\\\$&') : value;\n}\n","import { size } from 'lodash';\nimport { QueryHint, QueryFix } from '@grafana/data';\nimport { PrometheusDatasource } from './datasource';\n\n/**\n * Number of time series results needed before starting to suggest sum aggregation hints\n */\nexport const SUM_HINT_THRESHOLD_COUNT = 20;\n\nexport function getQueryHints(query: string, series?: any[], datasource?: PrometheusDatasource): QueryHint[] {\n  const hints = [];\n\n  // ..._bucket metric needs a histogram_quantile()\n  const histogramMetric = query.trim().match(/^\\w+_bucket$/);\n  if (histogramMetric) {\n    const label = 'Time series has buckets, you probably wanted a histogram.';\n    hints.push({\n      type: 'HISTOGRAM_QUANTILE',\n      label,\n      fix: {\n        label: 'Fix by adding histogram_quantile().',\n        action: {\n          type: 'ADD_HISTOGRAM_QUANTILE',\n          query,\n        },\n      } as QueryFix,\n    });\n  }\n\n  // Check for need of rate()\n  if (query.indexOf('rate(') === -1 && query.indexOf('increase(') === -1) {\n    // Use metric metadata for exact types\n    const nameMatch = query.match(/\\b(\\w+_(total|sum|count))\\b/);\n    let counterNameMetric = nameMatch ? nameMatch[1] : '';\n    const metricsMetadata = datasource?.languageProvider?.metricsMetadata ?? {};\n    const metricMetadataKeys = Object.keys(metricsMetadata);\n    let certain = false;\n\n    if (metricMetadataKeys.length > 0) {\n      counterNameMetric =\n        metricMetadataKeys.find((metricName) => {\n          // Only considering first type information, could be non-deterministic\n          const metadata = metricsMetadata[metricName];\n          if (metadata.type.toLowerCase() === 'counter') {\n            const metricRegex = new RegExp(`\\\\b${metricName}\\\\b`);\n            if (query.match(metricRegex)) {\n              certain = true;\n              return true;\n            }\n          }\n          return false;\n        }) ?? '';\n    }\n\n    if (counterNameMetric) {\n      const simpleMetric = query.trim().match(/^\\w+$/);\n      const verb = certain ? 'is' : 'looks like';\n      let label = `Metric ${counterNameMetric} ${verb} a counter.`;\n      let fix: QueryFix | undefined;\n\n      if (simpleMetric) {\n        fix = {\n          label: 'Fix by adding rate().',\n          action: {\n            type: 'ADD_RATE',\n            query,\n          },\n        };\n      } else {\n        label = `${label} Try applying a rate() function.`;\n      }\n\n      hints.push({\n        type: 'APPLY_RATE',\n        label,\n        fix,\n      });\n    }\n  }\n\n  // Check for recording rules expansion\n  if (datasource && datasource.ruleMappings) {\n    const mapping = datasource.ruleMappings;\n    const mappingForQuery = Object.keys(mapping).reduce((acc, ruleName) => {\n      if (query.search(ruleName) > -1) {\n        return {\n          ...acc,\n          [ruleName]: mapping[ruleName],\n        };\n      }\n      return acc;\n    }, {});\n    if (size(mappingForQuery) > 0) {\n      const label = 'Query contains recording rules.';\n      hints.push({\n        type: 'EXPAND_RULES',\n        label,\n        fix: {\n          label: 'Expand rules',\n          action: {\n            type: 'EXPAND_RULES',\n            query,\n            mapping: mappingForQuery,\n          },\n        } as any as QueryFix,\n      });\n    }\n  }\n\n  if (series && series.length >= SUM_HINT_THRESHOLD_COUNT) {\n    const simpleMetric = query.trim().match(/^\\w+$/);\n    if (simpleMetric) {\n      hints.push({\n        type: 'ADD_SUM',\n        label: 'Many time series results returned.',\n        fix: {\n          label: 'Consider aggregating with sum().',\n          action: {\n            type: 'ADD_SUM',\n            query: query,\n            preventSubmit: true,\n          },\n        } as QueryFix,\n      });\n    }\n  }\n\n  return hints;\n}\n\nexport function getInitHints(datasource: PrometheusDatasource): QueryHint[] {\n  const hints = [];\n  // Hint if using Loki as Prometheus data source\n  if (datasource.directUrl.includes('/loki') && !datasource.languageProvider.metrics.length) {\n    hints.push({\n      label: `Using Loki as a Prometheus data source is no longer supported. You must use the Loki data source for your Loki instance.`,\n      type: 'INFO',\n    });\n  }\n\n  // Hint for big disabled lookups\n  if (datasource.lookupsDisabled) {\n    hints.push({\n      label: `Labels and metrics lookup was disabled in data source settings.`,\n      type: 'INFO',\n    });\n  }\n\n  return hints;\n}\n","import React, { ChangeEvent } from 'react';\nimport {\n  Button,\n  HorizontalGroup,\n  Input,\n  Label,\n  LoadingPlaceholder,\n  stylesFactory,\n  withTheme,\n  BrowserLabel as PromLabel,\n} from '@grafana/ui';\nimport PromQlLanguageProvider from '../language_provider';\nimport { escapeLabelValueInExactSelector, escapeLabelValueInRegexSelector } from '../language_utils';\nimport { css, cx } from '@emotion/css';\nimport { FixedSizeList } from 'react-window';\n\nimport { GrafanaTheme } from '@grafana/data';\n\n// Hard limit on labels to render\nconst EMPTY_SELECTOR = '{}';\nconst METRIC_LABEL = '__name__';\nconst LIST_ITEM_SIZE = 25;\n\nexport interface BrowserProps {\n  languageProvider: PromQlLanguageProvider;\n  onChange: (selector: string) => void;\n  theme: GrafanaTheme;\n  autoSelect?: number;\n  hide?: () => void;\n  lastUsedLabels: string[];\n  storeLastUsedLabels: (labels: string[]) => void;\n  deleteLastUsedLabels: () => void;\n}\n\ninterface BrowserState {\n  labels: SelectableLabel[];\n  labelSearchTerm: string;\n  metricSearchTerm: string;\n  status: string;\n  error: string;\n  validationStatus: string;\n  valueSearchTerm: string;\n}\n\ninterface FacettableValue {\n  name: string;\n  selected?: boolean;\n  details?: string;\n}\n\nexport interface SelectableLabel {\n  name: string;\n  selected?: boolean;\n  loading?: boolean;\n  values?: FacettableValue[];\n  hidden?: boolean;\n  facets?: number;\n}\n\nexport function buildSelector(labels: SelectableLabel[]): string {\n  let singleMetric = '';\n  const selectedLabels = [];\n  for (const label of labels) {\n    if ((label.name === METRIC_LABEL || label.selected) && label.values && label.values.length > 0) {\n      const selectedValues = label.values.filter((value) => value.selected).map((value) => value.name);\n      if (selectedValues.length > 1) {\n        selectedLabels.push(`${label.name}=~\"${selectedValues.map(escapeLabelValueInRegexSelector).join('|')}\"`);\n      } else if (selectedValues.length === 1) {\n        if (label.name === METRIC_LABEL) {\n          singleMetric = selectedValues[0];\n        } else {\n          selectedLabels.push(`${label.name}=\"${escapeLabelValueInExactSelector(selectedValues[0])}\"`);\n        }\n      }\n    }\n  }\n  return [singleMetric, '{', selectedLabels.join(','), '}'].join('');\n}\n\nexport function facetLabels(\n  labels: SelectableLabel[],\n  possibleLabels: Record<string, string[]>,\n  lastFacetted?: string\n): SelectableLabel[] {\n  return labels.map((label) => {\n    const possibleValues = possibleLabels[label.name];\n    if (possibleValues) {\n      let existingValues: FacettableValue[];\n      if (label.name === lastFacetted && label.values) {\n        // Facetting this label, show all values\n        existingValues = label.values;\n      } else {\n        // Keep selection in other facets\n        const selectedValues: Set<string> = new Set(\n          label.values?.filter((value) => value.selected).map((value) => value.name) || []\n        );\n        // Values for this label have not been requested yet, let's use the facetted ones as the initial values\n        existingValues = possibleValues.map((value) => ({ name: value, selected: selectedValues.has(value) }));\n      }\n      return {\n        ...label,\n        loading: false,\n        values: existingValues,\n        hidden: !possibleValues,\n        facets: existingValues.length,\n      };\n    }\n\n    // Label is facetted out, hide all values\n    return { ...label, loading: false, hidden: !possibleValues, values: undefined, facets: 0 };\n  });\n}\n\nconst getStyles = stylesFactory((theme: GrafanaTheme) => ({\n  wrapper: css`\n    background-color: ${theme.colors.bg2};\n    padding: ${theme.spacing.sm};\n    width: 100%;\n  `,\n  list: css`\n    margin-top: ${theme.spacing.sm};\n    display: flex;\n    flex-wrap: wrap;\n    max-height: 200px;\n    overflow: auto;\n    align-content: flex-start;\n  `,\n  section: css`\n    & + & {\n      margin: ${theme.spacing.md} 0;\n    }\n    position: relative;\n  `,\n  selector: css`\n    font-family: ${theme.typography.fontFamily.monospace};\n    margin-bottom: ${theme.spacing.sm};\n  `,\n  status: css`\n    padding: ${theme.spacing.xs};\n    color: ${theme.colors.textSemiWeak};\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    /* using absolute positioning because flex interferes with ellipsis */\n    position: absolute;\n    width: 50%;\n    right: 0;\n    text-align: right;\n    transition: opacity 100ms linear;\n    opacity: 0;\n  `,\n  statusShowing: css`\n    opacity: 1;\n  `,\n  error: css`\n    color: ${theme.palette.brandDanger};\n  `,\n  valueList: css`\n    margin-right: ${theme.spacing.sm};\n  `,\n  valueListWrapper: css`\n    border-left: 1px solid ${theme.colors.border2};\n    margin: ${theme.spacing.sm} 0;\n    padding: ${theme.spacing.sm} 0 ${theme.spacing.sm} ${theme.spacing.sm};\n  `,\n  valueListArea: css`\n    display: flex;\n    flex-wrap: wrap;\n    margin-top: ${theme.spacing.sm};\n  `,\n  valueTitle: css`\n    margin-left: -${theme.spacing.xs};\n    margin-bottom: ${theme.spacing.sm};\n  `,\n  validationStatus: css`\n    padding: ${theme.spacing.xs};\n    margin-bottom: ${theme.spacing.sm};\n    color: ${theme.colors.textStrong};\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  `,\n}));\n\n/**\n * TODO #33976: Remove duplicated code. The component is very similar to LokiLabelBrowser.tsx. Check if it's possible\n *              to create a single, generic component.\n */\nexport class UnthemedPrometheusMetricsBrowser extends React.Component<BrowserProps, BrowserState> {\n  valueListsRef = React.createRef<HTMLDivElement>();\n  state: BrowserState = {\n    labels: [] as SelectableLabel[],\n    labelSearchTerm: '',\n    metricSearchTerm: '',\n    status: 'Ready',\n    error: '',\n    validationStatus: '',\n    valueSearchTerm: '',\n  };\n\n  onChangeLabelSearch = (event: ChangeEvent<HTMLInputElement>) => {\n    this.setState({ labelSearchTerm: event.target.value });\n  };\n\n  onChangeMetricSearch = (event: ChangeEvent<HTMLInputElement>) => {\n    this.setState({ metricSearchTerm: event.target.value });\n  };\n\n  onChangeValueSearch = (event: ChangeEvent<HTMLInputElement>) => {\n    this.setState({ valueSearchTerm: event.target.value });\n  };\n\n  onClickRunQuery = () => {\n    const selector = buildSelector(this.state.labels);\n    this.props.onChange(selector);\n  };\n\n  onClickRunRateQuery = () => {\n    const selector = buildSelector(this.state.labels);\n    const query = `rate(${selector}[$__interval])`;\n    this.props.onChange(query);\n  };\n\n  onClickClear = () => {\n    this.setState((state) => {\n      const labels: SelectableLabel[] = state.labels.map((label) => ({\n        ...label,\n        values: undefined,\n        selected: false,\n        loading: false,\n        hidden: false,\n        facets: undefined,\n      }));\n      return {\n        labels,\n        labelSearchTerm: '',\n        metricSearchTerm: '',\n        status: '',\n        error: '',\n        validationStatus: '',\n        valueSearchTerm: '',\n      };\n    });\n    this.props.deleteLastUsedLabels();\n    // Get metrics\n    this.fetchValues(METRIC_LABEL, EMPTY_SELECTOR);\n  };\n\n  onClickLabel = (name: string, value: string | undefined, event: React.MouseEvent<HTMLElement>) => {\n    const label = this.state.labels.find((l) => l.name === name);\n    if (!label) {\n      return;\n    }\n    // Toggle selected state\n    const selected = !label.selected;\n    let nextValue: Partial<SelectableLabel> = { selected };\n    if (label.values && !selected) {\n      // Deselect all values if label was deselected\n      const values = label.values.map((value) => ({ ...value, selected: false }));\n      nextValue = { ...nextValue, facets: 0, values };\n    }\n    // Resetting search to prevent empty results\n    this.setState({ labelSearchTerm: '' });\n    this.updateLabelState(name, nextValue, '', () => this.doFacettingForLabel(name));\n  };\n\n  onClickValue = (name: string, value: string | undefined, event: React.MouseEvent<HTMLElement>) => {\n    const label = this.state.labels.find((l) => l.name === name);\n    if (!label || !label.values) {\n      return;\n    }\n    // Resetting search to prevent empty results\n    this.setState({ labelSearchTerm: '' });\n    // Toggling value for selected label, leaving other values intact\n    const values = label.values.map((v) => ({ ...v, selected: v.name === value ? !v.selected : v.selected }));\n    this.updateLabelState(name, { values }, '', () => this.doFacetting(name));\n  };\n\n  onClickMetric = (name: string, value: string | undefined, event: React.MouseEvent<HTMLElement>) => {\n    // Finding special metric label\n    const label = this.state.labels.find((l) => l.name === name);\n    if (!label || !label.values) {\n      return;\n    }\n    // Resetting search to prevent empty results\n    this.setState({ metricSearchTerm: '' });\n    // Toggling value for selected label, leaving other values intact\n    const values = label.values.map((v) => ({\n      ...v,\n      selected: v.name === value || v.selected ? !v.selected : v.selected,\n    }));\n    // Toggle selected state of special metrics label\n    const selected = values.some((v) => v.selected);\n    this.updateLabelState(name, { selected, values }, '', () => this.doFacetting(name));\n  };\n\n  onClickValidate = () => {\n    const selector = buildSelector(this.state.labels);\n    this.validateSelector(selector);\n  };\n\n  updateLabelState(name: string, updatedFields: Partial<SelectableLabel>, status = '', cb?: () => void) {\n    this.setState((state) => {\n      const labels: SelectableLabel[] = state.labels.map((label) => {\n        if (label.name === name) {\n          return { ...label, ...updatedFields };\n        }\n        return label;\n      });\n      // New status overrides errors\n      const error = status ? '' : state.error;\n      return { labels, status, error, validationStatus: '' };\n    }, cb);\n  }\n\n  componentDidMount() {\n    const { languageProvider, lastUsedLabels } = this.props;\n    if (languageProvider) {\n      const selectedLabels: string[] = lastUsedLabels;\n      languageProvider.start().then(() => {\n        let rawLabels: string[] = languageProvider.getLabelKeys();\n        // Get metrics\n        this.fetchValues(METRIC_LABEL, EMPTY_SELECTOR);\n        // Auto-select previously selected labels\n        const labels: SelectableLabel[] = rawLabels.map((label, i, arr) => ({\n          name: label,\n          selected: selectedLabels.includes(label),\n          loading: false,\n        }));\n        // Pre-fetch values for selected labels\n        this.setState({ labels }, () => {\n          this.state.labels.forEach((label) => {\n            if (label.selected) {\n              this.fetchValues(label.name, EMPTY_SELECTOR);\n            }\n          });\n        });\n      });\n    }\n  }\n\n  doFacettingForLabel(name: string) {\n    const label = this.state.labels.find((l) => l.name === name);\n    if (!label) {\n      return;\n    }\n    const selectedLabels = this.state.labels.filter((label) => label.selected).map((label) => label.name);\n    this.props.storeLastUsedLabels(selectedLabels);\n    if (label.selected) {\n      // Refetch values for newly selected label...\n      if (!label.values) {\n        this.fetchValues(name, buildSelector(this.state.labels));\n      }\n    } else {\n      // Only need to facet when deselecting labels\n      this.doFacetting();\n    }\n  }\n\n  doFacetting = (lastFacetted?: string) => {\n    const selector = buildSelector(this.state.labels);\n    if (selector === EMPTY_SELECTOR) {\n      // Clear up facetting\n      const labels: SelectableLabel[] = this.state.labels.map((label) => {\n        return { ...label, facets: 0, values: undefined, hidden: false };\n      });\n      this.setState({ labels }, () => {\n        // Get fresh set of values\n        this.state.labels.forEach(\n          (label) => (label.selected || label.name === METRIC_LABEL) && this.fetchValues(label.name, selector)\n        );\n      });\n    } else {\n      // Do facetting\n      this.fetchSeries(selector, lastFacetted);\n    }\n  };\n\n  async fetchValues(name: string, selector: string) {\n    const { languageProvider } = this.props;\n    this.updateLabelState(name, { loading: true }, `Fetching values for ${name}`);\n    try {\n      let rawValues = await languageProvider.getLabelValues(name);\n      // If selector changed, clear loading state and discard result by returning early\n      if (selector !== buildSelector(this.state.labels)) {\n        this.updateLabelState(name, { loading: false });\n        return;\n      }\n      const values: FacettableValue[] = [];\n      const { metricsMetadata } = languageProvider;\n      for (const labelValue of rawValues) {\n        const value: FacettableValue = { name: labelValue };\n        // Adding type/help text to metrics\n        if (name === METRIC_LABEL && metricsMetadata) {\n          const meta = metricsMetadata[labelValue];\n          if (meta) {\n            value.details = `(${meta.type}) ${meta.help}`;\n          }\n        }\n        values.push(value);\n      }\n      this.updateLabelState(name, { values, loading: false });\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async fetchSeries(selector: string, lastFacetted?: string) {\n    const { languageProvider } = this.props;\n    if (lastFacetted) {\n      this.updateLabelState(lastFacetted, { loading: true }, `Facetting labels for ${selector}`);\n    }\n    try {\n      const possibleLabels = await languageProvider.fetchSeriesLabels(selector, true);\n      // If selector changed, clear loading state and discard result by returning early\n      if (selector !== buildSelector(this.state.labels)) {\n        if (lastFacetted) {\n          this.updateLabelState(lastFacetted, { loading: false });\n        }\n        return;\n      }\n      if (Object.keys(possibleLabels).length === 0) {\n        this.setState({ error: `Empty results, no matching label for ${selector}` });\n        return;\n      }\n      const labels: SelectableLabel[] = facetLabels(this.state.labels, possibleLabels, lastFacetted);\n      this.setState({ labels, error: '' });\n      if (lastFacetted) {\n        this.updateLabelState(lastFacetted, { loading: false });\n      }\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async validateSelector(selector: string) {\n    const { languageProvider } = this.props;\n    this.setState({ validationStatus: `Validating selector ${selector}`, error: '' });\n    const streams = await languageProvider.fetchSeries(selector);\n    this.setState({ validationStatus: `Selector is valid (${streams.length} series found)` });\n  }\n\n  render() {\n    const { theme } = this.props;\n    const { labels, labelSearchTerm, metricSearchTerm, status, error, validationStatus, valueSearchTerm } = this.state;\n    const styles = getStyles(theme);\n    if (labels.length === 0) {\n      return (\n        <div className={styles.wrapper}>\n          <LoadingPlaceholder text=\"Loading labels...\" />\n        </div>\n      );\n    }\n\n    // Filter metrics\n    let metrics = labels.find((label) => label.name === METRIC_LABEL);\n    if (metrics && metricSearchTerm) {\n      metrics = {\n        ...metrics,\n        values: metrics.values?.filter((value) => value.selected || value.name.includes(metricSearchTerm)),\n      };\n    }\n\n    // Filter labels\n    let nonMetricLabels = labels.filter((label) => !label.hidden && label.name !== METRIC_LABEL);\n    if (labelSearchTerm) {\n      nonMetricLabels = nonMetricLabels.filter((label) => label.selected || label.name.includes(labelSearchTerm));\n    }\n\n    // Filter non-metric label values\n    let selectedLabels = nonMetricLabels.filter((label) => label.selected && label.values);\n    if (valueSearchTerm) {\n      selectedLabels = selectedLabels.map((label) => ({\n        ...label,\n        values: label.values?.filter((value) => value.selected || value.name.includes(valueSearchTerm)),\n      }));\n    }\n    const selector = buildSelector(this.state.labels);\n    const empty = selector === EMPTY_SELECTOR;\n    const metricCount = metrics?.values?.length || 0;\n\n    return (\n      <div className={styles.wrapper}>\n        <HorizontalGroup align=\"flex-start\" spacing=\"lg\">\n          <div>\n            <div className={styles.section}>\n              <Label description=\"Once a metric is selected only possible labels are shown.\">1. Select a metric</Label>\n              <div>\n                <Input\n                  onChange={this.onChangeMetricSearch}\n                  aria-label=\"Filter expression for metric\"\n                  value={metricSearchTerm}\n                />\n              </div>\n              <div role=\"list\" className={styles.valueListWrapper}>\n                <FixedSizeList\n                  height={Math.min(450, metricCount * LIST_ITEM_SIZE)}\n                  itemCount={metricCount}\n                  itemSize={LIST_ITEM_SIZE}\n                  itemKey={(i) => (metrics!.values as FacettableValue[])[i].name}\n                  width={300}\n                  className={styles.valueList}\n                >\n                  {({ index, style }) => {\n                    const value = metrics?.values?.[index];\n                    if (!value) {\n                      return null;\n                    }\n                    return (\n                      <div style={style}>\n                        <PromLabel\n                          name={metrics!.name}\n                          value={value?.name}\n                          title={value.details}\n                          active={value?.selected}\n                          onClick={this.onClickMetric}\n                          searchTerm={metricSearchTerm}\n                        />\n                      </div>\n                    );\n                  }}\n                </FixedSizeList>\n              </div>\n            </div>\n          </div>\n\n          <div>\n            <div className={styles.section}>\n              <Label description=\"Once label values are selected, only possible label combinations are shown.\">\n                2. Select labels to search in\n              </Label>\n              <div>\n                <Input\n                  onChange={this.onChangeLabelSearch}\n                  aria-label=\"Filter expression for label\"\n                  value={labelSearchTerm}\n                />\n              </div>\n              {/* Using fixed height here to prevent jumpy layout */}\n              <div className={styles.list} style={{ height: 120 }}>\n                {nonMetricLabels.map((label) => (\n                  <PromLabel\n                    key={label.name}\n                    name={label.name}\n                    loading={label.loading}\n                    active={label.selected}\n                    hidden={label.hidden}\n                    facets={label.facets}\n                    onClick={this.onClickLabel}\n                    searchTerm={labelSearchTerm}\n                  />\n                ))}\n              </div>\n            </div>\n            <div className={styles.section}>\n              <Label description=\"Use the search field to find values across selected labels.\">\n                3. Select (multiple) values for your labels\n              </Label>\n              <div>\n                <Input\n                  onChange={this.onChangeValueSearch}\n                  aria-label=\"Filter expression for label values\"\n                  value={valueSearchTerm}\n                />\n              </div>\n              <div className={styles.valueListArea} ref={this.valueListsRef}>\n                {selectedLabels.map((label) => (\n                  <div\n                    role=\"list\"\n                    key={label.name}\n                    aria-label={`Values for ${label.name}`}\n                    className={styles.valueListWrapper}\n                  >\n                    <div className={styles.valueTitle}>\n                      <PromLabel\n                        name={label.name}\n                        loading={label.loading}\n                        active={label.selected}\n                        hidden={label.hidden}\n                        //If no facets, we want to show number of all label values\n                        facets={label.facets || label.values?.length}\n                        onClick={this.onClickLabel}\n                      />\n                    </div>\n                    <FixedSizeList\n                      height={Math.min(200, LIST_ITEM_SIZE * (label.values?.length || 0))}\n                      itemCount={label.values?.length || 0}\n                      itemSize={28}\n                      itemKey={(i) => (label.values as FacettableValue[])[i].name}\n                      width={200}\n                      className={styles.valueList}\n                    >\n                      {({ index, style }) => {\n                        const value = label.values?.[index];\n                        if (!value) {\n                          return null;\n                        }\n                        return (\n                          <div style={style}>\n                            <PromLabel\n                              name={label.name}\n                              value={value?.name}\n                              active={value?.selected}\n                              onClick={this.onClickValue}\n                              searchTerm={valueSearchTerm}\n                            />\n                          </div>\n                        );\n                      }}\n                    </FixedSizeList>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </HorizontalGroup>\n\n        <div className={styles.section}>\n          <Label>4. Resulting selector</Label>\n          <div aria-label=\"selector\" className={styles.selector}>\n            {selector}\n          </div>\n          {validationStatus && <div className={styles.validationStatus}>{validationStatus}</div>}\n          <HorizontalGroup>\n            <Button aria-label=\"Use selector for query button\" disabled={empty} onClick={this.onClickRunQuery}>\n              Use query\n            </Button>\n            <Button\n              aria-label=\"Use selector as metrics button\"\n              variant=\"secondary\"\n              disabled={empty}\n              onClick={this.onClickRunRateQuery}\n            >\n              Use as rate query\n            </Button>\n            <Button\n              aria-label=\"Validate submit button\"\n              variant=\"secondary\"\n              disabled={empty}\n              onClick={this.onClickValidate}\n            >\n              Validate selector\n            </Button>\n            <Button aria-label=\"Selector clear button\" variant=\"secondary\" onClick={this.onClickClear}>\n              Clear\n            </Button>\n            <div className={cx(styles.status, (status || error) && styles.statusShowing)}>\n              <span className={error ? styles.error : ''}>{error || status}</span>\n            </div>\n          </HorizontalGroup>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport const PrometheusMetricsBrowser = withTheme(UnthemedPrometheusMetricsBrowser);\n","import React, { Suspense } from 'react';\nimport { Props } from './MonacoQueryFieldProps';\n\nconst Field = React.lazy(() => import(/* webpackChunkName: \"prom-query-field\" */ './MonacoQueryField'));\n\nexport const MonacoQueryFieldLazy = (props: Props) => {\n  return (\n    <Suspense fallback={null}>\n      <Field {...props} />\n    </Suspense>\n  );\n};\n","import React, { useRef } from 'react';\nimport { MonacoQueryFieldLazy } from './MonacoQueryFieldLazy';\nimport { Props as MonacoProps } from './MonacoQueryFieldProps';\n\ntype Props = Omit<MonacoProps, 'onRunQuery' | 'onBlur'> & {\n  onChange: (query: string) => void;\n  onRunQuery: () => void;\n  runQueryOnBlur: boolean;\n};\n\nexport const MonacoQueryFieldWrapper = (props: Props) => {\n  const lastRunValueRef = useRef<string | null>(null);\n  const { runQueryOnBlur, onRunQuery, onChange, ...rest } = props;\n\n  const handleRunQuery = (value: string) => {\n    lastRunValueRef.current = value;\n    onChange(value);\n    onRunQuery();\n  };\n\n  const handleBlur = (value: string) => {\n    if (runQueryOnBlur) {\n      // run handleRunQuery only if the current value is different from the last-time-executed value\n      if (value !== lastRunValueRef.current) {\n        handleRunQuery(value);\n      }\n    } else {\n      onChange(value);\n    }\n  };\n\n  return <MonacoQueryFieldLazy onRunQuery={handleRunQuery} onBlur={handleBlur} {...rest} />;\n};\n","import React, { ReactNode } from 'react';\n\nimport { Plugin } from 'slate';\nimport {\n  SlatePrism,\n  TypeaheadInput,\n  TypeaheadOutput,\n  BracesPlugin,\n  DOMUtil,\n  SuggestionsState,\n  Icon,\n} from '@grafana/ui';\n\nimport { LanguageMap, languages as prismLanguages } from 'prismjs';\n\n// dom also includes Element polyfills\nimport { PromQuery, PromOptions } from '../types';\nimport { roundMsToMin } from '../language_utils';\nimport { CancelablePromise, makePromiseCancelable } from 'app/core/utils/CancelablePromise';\nimport { QueryEditorProps, QueryHint, isDataFrame, toLegacyResponseData, TimeRange, CoreApp } from '@grafana/data';\nimport { PrometheusDatasource } from '../datasource';\nimport { PrometheusMetricsBrowser } from './PrometheusMetricsBrowser';\nimport { MonacoQueryFieldWrapper } from './monaco-query-field/MonacoQueryFieldWrapper';\nimport { LocalStorageValueProvider } from 'app/core/components/LocalStorageValueProvider';\n\nexport const RECORDING_RULES_GROUP = '__recording_rules__';\nconst LAST_USED_LABELS_KEY = 'grafana.datasources.prometheus.browser.labels';\n\nfunction getChooserText(metricsLookupDisabled: boolean, hasSyntax: boolean, hasMetrics: boolean) {\n  if (metricsLookupDisabled) {\n    return '(Disabled)';\n  }\n\n  if (!hasSyntax) {\n    return 'Loading metrics...';\n  }\n\n  if (!hasMetrics) {\n    return '(No metrics found)';\n  }\n\n  return 'Metrics browser';\n}\n\nexport function willApplySuggestion(suggestion: string, { typeaheadContext, typeaheadText }: SuggestionsState): string {\n  // Modify suggestion based on context\n  switch (typeaheadContext) {\n    case 'context-labels': {\n      const nextChar = DOMUtil.getNextCharacter();\n      if (!nextChar || nextChar === '}' || nextChar === ',') {\n        suggestion += '=';\n      }\n      break;\n    }\n\n    case 'context-label-values': {\n      // Always add quotes and remove existing ones instead\n      if (!typeaheadText.match(/^(!?=~?\"|\")/)) {\n        suggestion = `\"${suggestion}`;\n      }\n      if (DOMUtil.getNextCharacter() !== '\"') {\n        suggestion = `${suggestion}\"`;\n      }\n      break;\n    }\n\n    default:\n  }\n  return suggestion;\n}\n\ninterface PromQueryFieldProps extends QueryEditorProps<PrometheusDatasource, PromQuery, PromOptions> {\n  ExtraFieldElement?: ReactNode;\n  'data-testid'?: string;\n}\n\ninterface PromQueryFieldState {\n  labelBrowserVisible: boolean;\n  syntaxLoaded: boolean;\n  hint: QueryHint | null;\n}\n\nclass PromQueryField extends React.PureComponent<PromQueryFieldProps, PromQueryFieldState> {\n  plugins: Plugin[];\n  declare languageProviderInitializationPromise: CancelablePromise<any>;\n\n  constructor(props: PromQueryFieldProps, context: React.Context<any>) {\n    super(props, context);\n\n    this.plugins = [\n      BracesPlugin(),\n      SlatePrism(\n        {\n          onlyIn: (node: any) => node.type === 'code_block',\n          getSyntax: (node: any) => 'promql',\n        },\n        { ...(prismLanguages as LanguageMap), promql: this.props.datasource.languageProvider.syntax }\n      ),\n    ];\n\n    this.state = {\n      labelBrowserVisible: false,\n      syntaxLoaded: false,\n      hint: null,\n    };\n  }\n\n  componentDidMount() {\n    if (this.props.datasource.languageProvider) {\n      this.refreshMetrics();\n    }\n    this.refreshHint();\n  }\n\n  componentWillUnmount() {\n    if (this.languageProviderInitializationPromise) {\n      this.languageProviderInitializationPromise.cancel();\n    }\n  }\n\n  componentDidUpdate(prevProps: PromQueryFieldProps) {\n    const {\n      data,\n      datasource: { languageProvider },\n      range,\n    } = this.props;\n\n    if (languageProvider !== prevProps.datasource.languageProvider) {\n      // We reset this only on DS change so we do not flesh loading state on every rangeChange which happens on every\n      // query run if using relative range.\n      this.setState({\n        syntaxLoaded: false,\n      });\n    }\n\n    const changedRangeToRefresh = this.rangeChangedToRefresh(range, prevProps.range);\n    // We want to refresh metrics when language provider changes and/or when range changes (we round up intervals to a minute)\n    if (languageProvider !== prevProps.datasource.languageProvider || changedRangeToRefresh) {\n      this.refreshMetrics();\n    }\n\n    if (data && prevProps.data && prevProps.data.series !== data.series) {\n      this.refreshHint();\n    }\n  }\n\n  refreshHint = () => {\n    const { datasource, query, data } = this.props;\n    const initHints = datasource.getInitHints();\n    const initHint = initHints.length > 0 ? initHints[0] : null;\n\n    if (!data || data.series.length === 0) {\n      this.setState({\n        hint: initHint,\n      });\n      return;\n    }\n\n    const result = isDataFrame(data.series[0]) ? data.series.map(toLegacyResponseData) : data.series;\n    const queryHints = datasource.getQueryHints(query, result);\n    let queryHint = queryHints.length > 0 ? queryHints[0] : null;\n\n    this.setState({ hint: queryHint ?? initHint });\n  };\n\n  refreshMetrics = async () => {\n    const {\n      datasource: { languageProvider },\n    } = this.props;\n\n    this.languageProviderInitializationPromise = makePromiseCancelable(languageProvider.start());\n\n    try {\n      const remainingTasks = await this.languageProviderInitializationPromise.promise;\n      await Promise.all(remainingTasks);\n      this.onUpdateLanguage();\n    } catch (err) {\n      if (!err.isCanceled) {\n        throw err;\n      }\n    }\n  };\n\n  rangeChangedToRefresh(range?: TimeRange, prevRange?: TimeRange): boolean {\n    if (range && prevRange) {\n      const sameMinuteFrom = roundMsToMin(range.from.valueOf()) === roundMsToMin(prevRange.from.valueOf());\n      const sameMinuteTo = roundMsToMin(range.to.valueOf()) === roundMsToMin(prevRange.to.valueOf());\n      // If both are same, don't need to refresh.\n      return !(sameMinuteFrom && sameMinuteTo);\n    }\n    return false;\n  }\n\n  /**\n   * TODO #33976: Remove this, add histogram group (query = `histogram_quantile(0.95, sum(rate(${metric}[5m])) by (le))`;)\n   */\n  onChangeLabelBrowser = (selector: string) => {\n    this.onChangeQuery(selector, true);\n    this.setState({ labelBrowserVisible: false });\n  };\n\n  onChangeQuery = (value: string, override?: boolean) => {\n    // Send text change to parent\n    const { query, onChange, onRunQuery } = this.props;\n    if (onChange) {\n      const nextQuery: PromQuery = { ...query, expr: value };\n      onChange(nextQuery);\n\n      if (override && onRunQuery) {\n        onRunQuery();\n      }\n    }\n  };\n\n  onClickChooserButton = () => {\n    this.setState((state) => ({ labelBrowserVisible: !state.labelBrowserVisible }));\n  };\n\n  onClickHintFix = () => {\n    const { datasource, query, onChange, onRunQuery } = this.props;\n    const { hint } = this.state;\n\n    onChange(datasource.modifyQuery(query, hint!.fix!.action));\n    onRunQuery();\n  };\n\n  onUpdateLanguage = () => {\n    const {\n      datasource: { languageProvider },\n    } = this.props;\n    const { metrics } = languageProvider;\n\n    if (!metrics) {\n      return;\n    }\n\n    this.setState({ syntaxLoaded: true });\n  };\n\n  onTypeahead = async (typeahead: TypeaheadInput): Promise<TypeaheadOutput> => {\n    const {\n      datasource: { languageProvider },\n    } = this.props;\n\n    if (!languageProvider) {\n      return { suggestions: [] };\n    }\n\n    const { history } = this.props;\n    const { prefix, text, value, wrapperClasses, labelKey } = typeahead;\n\n    const result = await languageProvider.provideCompletionItems(\n      { text, value, prefix, wrapperClasses, labelKey },\n      { history }\n    );\n\n    return result;\n  };\n\n  render() {\n    const {\n      datasource,\n      datasource: { languageProvider },\n      query,\n      ExtraFieldElement,\n      history = [],\n    } = this.props;\n\n    const { labelBrowserVisible, syntaxLoaded, hint } = this.state;\n    const hasMetrics = languageProvider.metrics.length > 0;\n    const chooserText = getChooserText(datasource.lookupsDisabled, syntaxLoaded, hasMetrics);\n    const buttonDisabled = !(syntaxLoaded && hasMetrics);\n\n    return (\n      <LocalStorageValueProvider<string[]> storageKey={LAST_USED_LABELS_KEY} defaultValue={[]}>\n        {(lastUsedLabels, onLastUsedLabelsSave, onLastUsedLabelsDelete) => {\n          return (\n            <>\n              <div\n                className=\"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1\"\n                data-testid={this.props['data-testid']}\n              >\n                <button\n                  className=\"gf-form-label query-keyword pointer\"\n                  onClick={this.onClickChooserButton}\n                  disabled={buttonDisabled}\n                >\n                  {chooserText}\n                  <Icon name={labelBrowserVisible ? 'angle-down' : 'angle-right'} />\n                </button>\n\n                <div className=\"gf-form gf-form--grow flex-shrink-1 min-width-15\">\n                  <MonacoQueryFieldWrapper\n                    runQueryOnBlur={this.props.app !== CoreApp.Explore}\n                    languageProvider={languageProvider}\n                    history={history}\n                    onChange={this.onChangeQuery}\n                    onRunQuery={this.props.onRunQuery}\n                    initialValue={query.expr ?? ''}\n                  />\n                </div>\n              </div>\n              {labelBrowserVisible && (\n                <div className=\"gf-form\">\n                  <PrometheusMetricsBrowser\n                    languageProvider={languageProvider}\n                    onChange={this.onChangeLabelBrowser}\n                    lastUsedLabels={lastUsedLabels || []}\n                    storeLastUsedLabels={onLastUsedLabelsSave}\n                    deleteLastUsedLabels={onLastUsedLabelsDelete}\n                  />\n                </div>\n              )}\n\n              {ExtraFieldElement}\n              {hint ? (\n                <div className=\"query-row-break\">\n                  <div className=\"prom-query-field-info text-warning\">\n                    {hint.label}{' '}\n                    {hint.fix ? (\n                      <a className=\"text-link muted\" onClick={this.onClickHintFix}>\n                        {hint.fix.label}\n                      </a>\n                    ) : null}\n                  </div>\n                </div>\n              ) : null}\n            </>\n          );\n        }}\n      </LocalStorageValueProvider>\n    );\n  }\n}\n\nexport default PromQueryField;\n","// https://github.com/facebook/react/issues/5465\n\nexport interface CancelablePromise<T> {\n  promise: Promise<T>;\n  cancel: () => void;\n}\n\nexport const makePromiseCancelable = <T>(promise: Promise<T>): CancelablePromise<T> => {\n  let hasCanceled_ = false;\n\n  const wrappedPromise = new Promise<T>((resolve, reject) => {\n    promise.then((val) => (hasCanceled_ ? reject({ isCanceled: true }) : resolve(val)));\n    promise.catch((error) => (hasCanceled_ ? reject({ isCanceled: true }) : reject(error)));\n  });\n\n  return {\n    promise: wrappedPromise,\n    cancel() {\n      hasCanceled_ = true;\n    },\n  };\n};\n","import { map } from 'lodash';\nimport React, { FC, useEffect, useState, memo } from 'react';\n\nimport { PrometheusDatasource } from '../datasource';\nimport { PromQuery } from '../types';\nimport { DataQueryRequest, PanelData, ScopedVars, textUtil, rangeUtil } from '@grafana/data';\n\ninterface Props {\n  datasource: PrometheusDatasource;\n  query: PromQuery;\n  panelData?: PanelData;\n}\n\nconst PromLink: FC<Props> = ({ panelData, query, datasource }) => {\n  const [href, setHref] = useState('');\n\n  useEffect(() => {\n    if (panelData) {\n      const getExternalLink = () => {\n        if (!panelData.request) {\n          return '';\n        }\n\n        const {\n          request: { range, interval, scopedVars },\n        } = panelData;\n\n        const start = datasource.getPrometheusTime(range.from, false);\n        const end = datasource.getPrometheusTime(range.to, true);\n        const rangeDiff = Math.ceil(end - start);\n        const endTime = range.to.utc().format('YYYY-MM-DD HH:mm');\n\n        const enrichedScopedVars: ScopedVars = {\n          ...scopedVars,\n          // As we support $__rate_interval variable in min step, we need add it to scopedVars\n          ...datasource.getRateIntervalScopedVariable(\n            rangeUtil.intervalToSeconds(interval),\n            rangeUtil.intervalToSeconds(datasource.interval)\n          ),\n        };\n\n        const options = {\n          interval,\n          scopedVars: enrichedScopedVars,\n        } as DataQueryRequest<PromQuery>;\n\n        const customQueryParameters: { [key: string]: string } = {};\n        if (datasource.customQueryParameters) {\n          for (const [k, v] of datasource.customQueryParameters) {\n            customQueryParameters[k] = v;\n          }\n        }\n\n        const queryOptions = datasource.createQuery(query, options, start, end);\n\n        const expr = {\n          ...customQueryParameters,\n          'g0.expr': queryOptions.expr,\n          'g0.range_input': rangeDiff + 's',\n          'g0.end_input': endTime,\n          'g0.step_input': queryOptions.step,\n          'g0.tab': 0,\n        };\n\n        const args = map(expr, (v: string, k: string) => {\n          return k + '=' + encodeURIComponent(v);\n        }).join('&');\n        return `${datasource.directUrl}/graph?${args}`;\n      };\n\n      setHref(getExternalLink());\n    }\n  }, [datasource, panelData, query]);\n\n  return (\n    <a href={textUtil.sanitizeUrl(href)} target=\"_blank\" rel=\"noopener noreferrer\">\n      Prometheus\n    </a>\n  );\n};\n\nexport default memo(PromLink);\n","import { GrafanaTheme2 } from '@grafana/data';\nimport { IconButton, InlineLabel, Tooltip, useStyles2 } from '@grafana/ui';\nimport { css, cx } from '@emotion/css';\nimport React, { useEffect, useState } from 'react';\nimport { usePrevious } from 'react-use';\nimport { PrometheusDatasource } from '../datasource';\nimport { PromQuery } from '../types';\n\ninterface Props {\n  onChange: (exemplar: boolean) => void;\n  datasource: PrometheusDatasource;\n  query: PromQuery;\n  'data-testid'?: string;\n}\n\nexport function PromExemplarField({ datasource, onChange, query, ...rest }: Props) {\n  const [error, setError] = useState<string | null>(null);\n  const styles = useStyles2(getStyles);\n  const prevError = usePrevious(error);\n\n  useEffect(() => {\n    if (!datasource.exemplarsAvailable) {\n      setError('Exemplars for this query are not available');\n      onChange(false);\n    } else if (query.instant && !query.range) {\n      setError('Exemplars are not available for instant queries');\n      onChange(false);\n    } else {\n      setError(null);\n      // If error is cleared, we want to change exemplar to true\n      if (prevError && !error) {\n        onChange(true);\n      }\n    }\n  }, [datasource.exemplarsAvailable, query.instant, query.range, onChange, prevError, error]);\n\n  const iconButtonStyles = cx(\n    {\n      [styles.activeIcon]: !!query.exemplar,\n    },\n    styles.eyeIcon\n  );\n\n  return (\n    <InlineLabel width=\"auto\" data-testid={rest['data-testid']}>\n      <Tooltip content={error ?? ''}>\n        <div className={styles.iconWrapper}>\n          Exemplars\n          <IconButton\n            name=\"eye\"\n            tooltip={!!query.exemplar ? 'Disable query with exemplars' : 'Enable query with exemplars'}\n            disabled={!!error}\n            className={iconButtonStyles}\n            onClick={() => {\n              onChange(!query.exemplar);\n            }}\n          />\n        </div>\n      </Tooltip>\n    </InlineLabel>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    eyeIcon: css`\n      margin-left: ${theme.spacing(2)};\n    `,\n    activeIcon: css`\n      color: ${theme.colors.primary.main};\n    `,\n    iconWrapper: css`\n      display: flex;\n      align-items: center;\n    `,\n  };\n}\n","import { map } from 'lodash';\nimport React, { PureComponent } from 'react';\n\n// Types\nimport { InlineFormLabel, LegacyForms, Select } from '@grafana/ui';\nimport { CoreApp, SelectableValue } from '@grafana/data';\nimport { PromQuery } from '../types';\n\nimport PromQueryField from './PromQueryField';\nimport PromLink from './PromLink';\nimport { PromExemplarField } from './PromExemplarField';\nimport { PromQueryEditorProps } from './types';\n\nconst { Switch } = LegacyForms;\n\nconst FORMAT_OPTIONS: Array<SelectableValue<string>> = [\n  { label: 'Time series', value: 'time_series' },\n  { label: 'Table', value: 'table' },\n  { label: 'Heatmap', value: 'heatmap' },\n];\n\nconst INTERVAL_FACTOR_OPTIONS: Array<SelectableValue<number>> = map([1, 2, 3, 4, 5, 10], (value: number) => ({\n  value,\n  label: '1/' + value,\n}));\n\ninterface State {\n  legendFormat?: string;\n  formatOption: SelectableValue<string>;\n  interval?: string;\n  intervalFactorOption: SelectableValue<number>;\n  instant: boolean;\n  exemplar: boolean;\n}\n\nexport class PromQueryEditor extends PureComponent<PromQueryEditorProps, State> {\n  // Query target to be modified and used for queries\n  query: PromQuery;\n\n  constructor(props: PromQueryEditorProps) {\n    super(props);\n    // Use default query to prevent undefined input values\n    const defaultQuery: Partial<PromQuery> = {\n      expr: '',\n      legendFormat: '',\n      interval: '',\n      // Set exemplar to false for alerting queries\n      exemplar: props.app === CoreApp.UnifiedAlerting ? false : true,\n    };\n    const query = Object.assign({}, defaultQuery, props.query);\n    this.query = query;\n    // Query target properties that are fully controlled inputs\n    this.state = {\n      // Fully controlled text inputs\n      interval: query.interval,\n      legendFormat: query.legendFormat,\n      // Select options\n      formatOption: FORMAT_OPTIONS.find((option) => option.value === query.format) || FORMAT_OPTIONS[0],\n      intervalFactorOption:\n        INTERVAL_FACTOR_OPTIONS.find((option) => option.value === query.intervalFactor) || INTERVAL_FACTOR_OPTIONS[0],\n      // Switch options\n      instant: Boolean(query.instant),\n      exemplar: Boolean(query.exemplar),\n    };\n  }\n\n  onFieldChange = (query: PromQuery, override?: any) => {\n    this.query.expr = query.expr;\n  };\n\n  onFormatChange = (option: SelectableValue<string>) => {\n    this.query.format = option.value;\n    this.setState({ formatOption: option }, this.onRunQuery);\n  };\n\n  onInstantChange = (e: React.SyntheticEvent<HTMLInputElement>) => {\n    const instant = (e.target as HTMLInputElement).checked;\n    this.query.instant = instant;\n    this.setState({ instant }, this.onRunQuery);\n  };\n\n  onIntervalChange = (e: React.SyntheticEvent<HTMLInputElement>) => {\n    const interval = e.currentTarget.value;\n    this.query.interval = interval;\n    this.setState({ interval });\n  };\n\n  onIntervalFactorChange = (option: SelectableValue<number>) => {\n    this.query.intervalFactor = option.value;\n    this.setState({ intervalFactorOption: option }, this.onRunQuery);\n  };\n\n  onLegendChange = (e: React.SyntheticEvent<HTMLInputElement>) => {\n    const legendFormat = e.currentTarget.value;\n    this.query.legendFormat = legendFormat;\n    this.setState({ legendFormat });\n  };\n\n  onExemplarChange = (isEnabled: boolean) => {\n    this.query.exemplar = isEnabled;\n    this.setState({ exemplar: isEnabled }, this.onRunQuery);\n  };\n\n  onRunQuery = () => {\n    const { query } = this;\n    // Change of query.hide happens outside of this component and is just passed as prop. We have to update it when running queries.\n    const { hide } = this.props.query;\n    this.props.onChange({ ...query, hide });\n    this.props.onRunQuery();\n  };\n\n  render() {\n    const { datasource, query, range, data } = this.props;\n    const { formatOption, instant, interval, intervalFactorOption, legendFormat } = this.state;\n    //We want to hide exemplar field for unified alerting as exemplars in alerting don't make sense and are source of confusion\n    const showExemplarField = this.props.app !== CoreApp.UnifiedAlerting;\n\n    return (\n      <PromQueryField\n        datasource={datasource}\n        query={query}\n        range={range}\n        onRunQuery={this.onRunQuery}\n        onChange={this.onFieldChange}\n        history={[]}\n        data={data}\n        data-testid={testIds.editor}\n        ExtraFieldElement={\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <InlineFormLabel\n                width={7}\n                tooltip=\"Controls the name of the time series, using name or pattern. For example\n        {{hostname}} will be replaced with label value for the label hostname.\"\n              >\n                Legend\n              </InlineFormLabel>\n              <input\n                type=\"text\"\n                className=\"gf-form-input\"\n                placeholder=\"legend format\"\n                value={legendFormat}\n                onChange={this.onLegendChange}\n                onBlur={this.onRunQuery}\n              />\n            </div>\n\n            <div className=\"gf-form\">\n              <InlineFormLabel\n                width={7}\n                tooltip={\n                  <>\n                    An additional lower limit for the step parameter of the Prometheus query and for the{' '}\n                    <code>$__interval</code> and <code>$__rate_interval</code> variables. The limit is absolute and not\n                    modified by the &quot;Resolution&quot; setting.\n                  </>\n                }\n              >\n                Min step\n              </InlineFormLabel>\n              <input\n                type=\"text\"\n                className=\"gf-form-input width-8\"\n                aria-label=\"Set lower limit for the step parameter\"\n                placeholder={interval}\n                onChange={this.onIntervalChange}\n                onBlur={this.onRunQuery}\n                value={interval}\n              />\n            </div>\n\n            <div className=\"gf-form\">\n              <div className=\"gf-form-label\">Resolution</div>\n              <Select\n                aria-label=\"Select resolution\"\n                menuShouldPortal\n                isSearchable={false}\n                options={INTERVAL_FACTOR_OPTIONS}\n                onChange={this.onIntervalFactorChange}\n                value={intervalFactorOption}\n              />\n            </div>\n\n            <div className=\"gf-form\">\n              <div className=\"gf-form-label width-7\">Format</div>\n              <Select\n                menuShouldPortal\n                className=\"select-container\"\n                width={16}\n                isSearchable={false}\n                options={FORMAT_OPTIONS}\n                onChange={this.onFormatChange}\n                value={formatOption}\n                aria-label=\"Select format\"\n              />\n              <Switch label=\"Instant\" checked={instant} onChange={this.onInstantChange} />\n\n              <InlineFormLabel width={10} tooltip=\"Link to Graph in Prometheus\">\n                <PromLink\n                  datasource={datasource}\n                  query={this.query} // Use modified query\n                  panelData={data}\n                />\n              </InlineFormLabel>\n            </div>\n            {showExemplarField && (\n              <PromExemplarField\n                onChange={this.onExemplarChange}\n                datasource={datasource}\n                query={this.query}\n                data-testid={testIds.exemplar}\n              />\n            )}\n          </div>\n        }\n      />\n    );\n  }\n}\n\nexport const testIds = {\n  editor: 'prom-editor',\n  exemplar: 'exemplar-editor',\n};\n","import React from 'react';\nimport PromQueryField from './PromQueryField';\nimport { PromQueryEditorProps } from './types';\n\nexport function PromQueryEditorForAlerting(props: PromQueryEditorProps) {\n  const { datasource, query, range, data, onChange, onRunQuery } = props;\n\n  return (\n    <PromQueryField\n      datasource={datasource}\n      query={query}\n      onRunQuery={onRunQuery}\n      onChange={onChange}\n      history={[]}\n      range={range}\n      data={data}\n      data-testid={testIds.editor}\n    />\n  );\n}\n\nexport const testIds = {\n  editor: 'prom-editor-cloud-alerting',\n};\n","import { SelectableValue, toOption } from '@grafana/data';\nimport { Select } from '@grafana/ui';\nimport React, { useState } from 'react';\nimport { PrometheusDatasource } from '../../datasource';\nimport { promQueryModeller } from '../PromQueryModeller';\nimport { QueryBuilderOperationParamEditorProps } from '../shared/types';\nimport { PromVisualQuery } from '../types';\n\nexport function LabelParamEditor({ onChange, index, value, query, datasource }: QueryBuilderOperationParamEditorProps) {\n  const [state, setState] = useState<{\n    options?: Array<SelectableValue<any>>;\n    isLoading?: boolean;\n  }>({});\n\n  return (\n    <Select\n      menuShouldPortal\n      autoFocus={value === '' ? true : undefined}\n      openMenuOnFocus\n      onOpenMenu={async () => {\n        setState({ isLoading: true });\n        const options = await loadGroupByLabels(query as PromVisualQuery, datasource as PrometheusDatasource);\n        setState({ options, isLoading: undefined });\n      }}\n      isLoading={state.isLoading}\n      allowCustomValue\n      noOptionsMessage=\"No labels found\"\n      loadingMessage=\"Loading labels\"\n      options={state.options}\n      value={toOption(value as string)}\n      onChange={(value) => onChange(index, value.value!)}\n    />\n  );\n}\n\nasync function loadGroupByLabels(\n  query: PromVisualQuery,\n  datasource: PrometheusDatasource\n): Promise<Array<SelectableValue<any>>> {\n  const labels = [{ label: '__name__', op: '=', value: query.metric }, ...query.labels];\n  const expr = promQueryModeller.renderLabels(labels);\n\n  const result = await datasource.languageProvider.fetchSeriesLabels(expr);\n\n  return Object.keys(result).map((x) => ({\n    label: x,\n    value: x,\n  }));\n}\n","import { VisualQueryBinary } from './shared/LokiAndPromQueryModellerBase';\nimport { QueryBuilderLabelFilter, QueryBuilderOperation } from './shared/types';\n\n/**\n * Visual query model\n */\nexport interface PromVisualQuery {\n  metric: string;\n  labels: QueryBuilderLabelFilter[];\n  operations: QueryBuilderOperation[];\n  binaryQueries?: PromVisualQueryBinary[];\n}\n\nexport type PromVisualQueryBinary = VisualQueryBinary<PromVisualQuery>;\n\nexport enum PromVisualQueryOperationCategory {\n  Aggregations = 'Aggregations',\n  RangeFunctions = 'Range functions',\n  Functions = 'Functions',\n  BinaryOps = 'Binary operations',\n}\n\nexport interface PromQueryPattern {\n  name: string;\n  operations: QueryBuilderOperation[];\n}\n\nexport function getDefaultEmptyQuery() {\n  const model: PromVisualQuery = {\n    metric: '',\n    labels: [],\n    operations: [],\n  };\n\n  return model;\n}\n","import {\n  defaultAddOperationHandler,\n  functionRendererLeft,\n  functionRendererRight,\n  getPromAndLokiOperationDisplayName,\n} from './shared/operationUtils';\nimport {\n  QueryBuilderOperation,\n  QueryBuilderOperationDef,\n  QueryBuilderOperationParamDef,\n  VisualQueryModeller,\n} from './shared/types';\nimport { PromVisualQuery, PromVisualQueryOperationCategory } from './types';\n\nexport function getOperationDefinitions(): QueryBuilderOperationDef[] {\n  const list: QueryBuilderOperationDef[] = [\n    {\n      id: 'histogram_quantile',\n      name: 'Histogram quantile',\n      params: [{ name: 'Quantile', type: 'number', options: [0.99, 0.95, 0.9, 0.75, 0.5, 0.25] }],\n      defaultParams: [0.9],\n      category: PromVisualQueryOperationCategory.Functions,\n      renderer: functionRendererLeft,\n      addOperationHandler: defaultAddOperationHandler,\n    },\n    {\n      id: 'label_replace',\n      name: 'Label replace',\n      params: [\n        { name: 'Destination label', type: 'string' },\n        { name: 'Replacement', type: 'string' },\n        { name: 'Source label', type: 'string' },\n        { name: 'Regex', type: 'string' },\n      ],\n      category: PromVisualQueryOperationCategory.Functions,\n      defaultParams: ['', '$1', '', '(.*)'],\n      renderer: functionRendererRight,\n      addOperationHandler: defaultAddOperationHandler,\n    },\n    {\n      id: 'ln',\n      name: 'Ln',\n      params: [],\n      defaultParams: [],\n      category: PromVisualQueryOperationCategory.Functions,\n      renderer: functionRendererLeft,\n      addOperationHandler: defaultAddOperationHandler,\n    },\n    createRangeFunction('changes'),\n    createRangeFunction('rate'),\n    createRangeFunction('irate'),\n    createRangeFunction('increase'),\n    createRangeFunction('delta'),\n    // Not sure about this one. It could also be a more generic \"Simple math operation\" where user specifies\n    // both the operator and the operand in a single input\n    {\n      id: '__multiply_by',\n      name: 'Multiply by scalar',\n      params: [{ name: 'Factor', type: 'number' }],\n      defaultParams: [2],\n      category: PromVisualQueryOperationCategory.BinaryOps,\n      renderer: getSimpleBinaryRenderer('*'),\n      addOperationHandler: defaultAddOperationHandler,\n    },\n    {\n      id: '__divide_by',\n      name: 'Divide by scalar',\n      params: [{ name: 'Factor', type: 'number' }],\n      defaultParams: [2],\n      category: PromVisualQueryOperationCategory.BinaryOps,\n      renderer: getSimpleBinaryRenderer('/'),\n      addOperationHandler: defaultAddOperationHandler,\n    },\n    {\n      id: '__nested_query',\n      name: 'Binary operation with query',\n      params: [],\n      defaultParams: [],\n      category: PromVisualQueryOperationCategory.BinaryOps,\n      renderer: (model, def, innerExpr) => innerExpr,\n      addOperationHandler: addNestedQueryHandler,\n    },\n  ];\n\n  return list;\n}\n\nfunction createRangeFunction(name: string): QueryBuilderOperationDef {\n  return {\n    id: name,\n    name: getPromAndLokiOperationDisplayName(name),\n    params: [getRangeVectorParamDef()],\n    defaultParams: ['auto'],\n    alternativesKey: 'range function',\n    category: PromVisualQueryOperationCategory.RangeFunctions,\n    renderer: operationWithRangeVectorRenderer,\n    addOperationHandler: addOperationWithRangeVector,\n  };\n}\n\nfunction operationWithRangeVectorRenderer(\n  model: QueryBuilderOperation,\n  def: QueryBuilderOperationDef,\n  innerExpr: string\n) {\n  let rangeVector = (model.params ?? [])[0] ?? 'auto';\n\n  if (rangeVector === 'auto') {\n    rangeVector = '$__rate_interval';\n  }\n\n  return `${def.id}(${innerExpr}[${rangeVector}])`;\n}\n\nfunction getSimpleBinaryRenderer(operator: string) {\n  return function binaryRenderer(model: QueryBuilderOperation, def: QueryBuilderOperationDef, innerExpr: string) {\n    return `${innerExpr} ${operator} ${model.params[0]}`;\n  };\n}\n\nfunction getRangeVectorParamDef(): QueryBuilderOperationParamDef {\n  return {\n    name: 'Range vector',\n    type: 'string',\n    options: ['auto', '$__rate_interval', '$__interval', '$__range', '1m', '5m', '10m', '1h', '24h'],\n  };\n}\n\n/**\n * Since there can only be one operation with range vector this will replace the current one (if one was added )\n */\nexport function addOperationWithRangeVector(\n  def: QueryBuilderOperationDef,\n  query: PromVisualQuery,\n  modeller: VisualQueryModeller\n) {\n  if (query.operations.length > 0) {\n    const firstOp = modeller.getOperationDef(query.operations[0].id);\n\n    if (firstOp.addOperationHandler === addOperationWithRangeVector) {\n      return {\n        ...query,\n        operations: [\n          {\n            ...query.operations[0],\n            id: def.id,\n          },\n          ...query.operations.slice(1),\n        ],\n      };\n    }\n  }\n\n  const newOperation: QueryBuilderOperation = {\n    id: def.id,\n    params: def.defaultParams,\n  };\n\n  return {\n    ...query,\n    operations: [newOperation, ...query.operations],\n  };\n}\n\nfunction addNestedQueryHandler(def: QueryBuilderOperationDef, query: PromVisualQuery): PromVisualQuery {\n  return {\n    ...query,\n    binaryQueries: [\n      ...(query.binaryQueries ?? []),\n      {\n        operator: '/',\n        query,\n      },\n    ],\n  };\n}\n","import pluralize from 'pluralize';\nimport { LabelParamEditor } from './components/LabelParamEditor';\nimport { addOperationWithRangeVector } from './operations';\nimport {\n  defaultAddOperationHandler,\n  functionRendererLeft,\n  getPromAndLokiOperationDisplayName,\n} from './shared/operationUtils';\nimport { QueryBuilderOperation, QueryBuilderOperationDef, QueryBuilderOperationParamDef } from './shared/types';\nimport { PromVisualQueryOperationCategory } from './types';\n\nexport function getAggregationOperations(): QueryBuilderOperationDef[] {\n  return [\n    ...createAggregationOperation('sum'),\n    ...createAggregationOperation('avg'),\n    ...createAggregationOperation('min'),\n    ...createAggregationOperation('max'),\n    ...createAggregationOperation('count'),\n    ...createAggregationOperation('topk'),\n    createAggregationOverTime('sum'),\n    createAggregationOverTime('avg'),\n    createAggregationOverTime('min'),\n    createAggregationOverTime('max'),\n    createAggregationOverTime('count'),\n    createAggregationOverTime('last'),\n    createAggregationOverTime('present'),\n    createAggregationOverTime('stddev'),\n    createAggregationOverTime('stdvar'),\n  ];\n}\n\nfunction createAggregationOperation(name: string): QueryBuilderOperationDef[] {\n  const operations: QueryBuilderOperationDef[] = [\n    {\n      id: name,\n      name: getPromAndLokiOperationDisplayName(name),\n      params: [\n        {\n          name: 'By label',\n          type: 'string',\n          restParam: true,\n          optional: true,\n        },\n      ],\n      defaultParams: [],\n      alternativesKey: 'plain aggregations',\n      category: PromVisualQueryOperationCategory.Aggregations,\n      renderer: functionRendererLeft,\n      addOperationHandler: defaultAddOperationHandler,\n      paramChangedHandler: getOnLabelAdddedHandler(`__${name}_by`),\n    },\n    {\n      id: `__${name}_by`,\n      name: `${getPromAndLokiOperationDisplayName(name)} by`,\n      params: [\n        {\n          name: 'Label',\n          type: 'string',\n          restParam: true,\n          optional: true,\n          editor: LabelParamEditor,\n        },\n      ],\n      defaultParams: [''],\n      alternativesKey: 'aggregations by',\n      category: PromVisualQueryOperationCategory.Aggregations,\n      renderer: getAggregationByRenderer(name),\n      addOperationHandler: defaultAddOperationHandler,\n      paramChangedHandler: getLastLabelRemovedHandler(name),\n      explainHandler: getAggregationExplainer(name),\n      hideFromList: true,\n    },\n  ];\n\n  // Handle some special aggregations that have parameters\n  if (name === 'topk') {\n    const param: QueryBuilderOperationParamDef = {\n      name: 'K-value',\n      type: 'number',\n    };\n    operations[0].params.unshift(param);\n    operations[1].params.unshift(param);\n    operations[0].defaultParams = [5];\n    operations[1].defaultParams = [5, ''];\n    operations[1].renderer = getAggregationByRendererWithParameter(name);\n  }\n\n  return operations;\n}\n\nfunction getAggregationByRenderer(aggregation: string) {\n  return function aggregationRenderer(model: QueryBuilderOperation, def: QueryBuilderOperationDef, innerExpr: string) {\n    return `${aggregation} by(${model.params.join(', ')}) (${innerExpr})`;\n  };\n}\n\n/**\n * Very simple poc implementation, needs to be modified to support all aggregation operators\n */\nfunction getAggregationExplainer(aggregationName: string) {\n  return function aggregationExplainer(model: QueryBuilderOperation) {\n    const labels = model.params.map((label) => `\\`${label}\\``).join(' and ');\n    const labelWord = pluralize('label', model.params.length);\n    return `Calculates ${aggregationName} over dimensions while preserving ${labelWord} ${labels}.`;\n  };\n}\n\nfunction getAggregationByRendererWithParameter(aggregation: string) {\n  return function aggregationRenderer(model: QueryBuilderOperation, def: QueryBuilderOperationDef, innerExpr: string) {\n    const firstParam = model.params[0];\n    const restParams = model.params.slice(1);\n    return `${aggregation} by(${restParams.join(', ')}) (${firstParam}, ${innerExpr})`;\n  };\n}\n\n/**\n * This function will transform operations without labels to their plan aggregation operation\n */\nfunction getLastLabelRemovedHandler(changeToOperartionId: string) {\n  return function onParamChanged(index: number, op: QueryBuilderOperation, def: QueryBuilderOperationDef) {\n    // If definition has more params then is defined there are no optional rest params anymore\n    // We then transform this operation into a different one\n    if (op.params.length < def.params.length) {\n      return {\n        ...op,\n        id: changeToOperartionId,\n      };\n    }\n\n    return op;\n  };\n}\n\nfunction getOnLabelAdddedHandler(changeToOperartionId: string) {\n  return function onParamChanged(index: number, op: QueryBuilderOperation) {\n    return {\n      ...op,\n      id: changeToOperartionId,\n    };\n  };\n}\n\nfunction createAggregationOverTime(name: string): QueryBuilderOperationDef {\n  const functionName = `${name}_over_time`;\n  return {\n    id: functionName,\n    name: getPromAndLokiOperationDisplayName(functionName),\n    params: [getAggregationOverTimeRangeVector()],\n    defaultParams: ['auto'],\n    alternativesKey: 'overtime function',\n    category: PromVisualQueryOperationCategory.RangeFunctions,\n    renderer: operationWithRangeVectorRenderer,\n    addOperationHandler: addOperationWithRangeVector,\n  };\n}\n\nfunction getAggregationOverTimeRangeVector(): QueryBuilderOperationParamDef {\n  return {\n    name: 'Range vector',\n    type: 'string',\n    options: ['auto', '$__interval', '$__range', '1m', '5m', '10m', '1h', '24h'],\n  };\n}\n\nfunction operationWithRangeVectorRenderer(\n  model: QueryBuilderOperation,\n  def: QueryBuilderOperationDef,\n  innerExpr: string\n) {\n  let rangeVector = (model.params ?? [])[0] ?? 'auto';\n\n  if (rangeVector === 'auto') {\n    rangeVector = '$__interval';\n  }\n\n  return `${def.id}(${innerExpr}[${rangeVector}])`;\n}\n","import { FUNCTIONS } from '../promql';\nimport { getAggregationOperations } from './aggregations';\nimport { getOperationDefinitions } from './operations';\nimport { LokiAndPromQueryModellerBase } from './shared/LokiAndPromQueryModellerBase';\nimport { PromQueryPattern, PromVisualQuery, PromVisualQueryOperationCategory } from './types';\n\nexport class PromQueryModeller extends LokiAndPromQueryModellerBase<PromVisualQuery> {\n  constructor() {\n    super(() => {\n      const allOperations = [...getOperationDefinitions(), ...getAggregationOperations()];\n      for (const op of allOperations) {\n        const func = FUNCTIONS.find((x) => x.insertText === op.id);\n        if (func) {\n          op.documentation = func.documentation;\n        }\n      }\n      return allOperations;\n    });\n\n    this.setOperationCategories([\n      PromVisualQueryOperationCategory.Aggregations,\n      PromVisualQueryOperationCategory.RangeFunctions,\n      PromVisualQueryOperationCategory.Functions,\n      PromVisualQueryOperationCategory.BinaryOps,\n    ]);\n  }\n\n  renderQuery(query: PromVisualQuery) {\n    let queryString = `${query.metric}${this.renderLabels(query.labels)}`;\n    queryString = this.renderOperations(queryString, query.operations);\n    queryString = this.renderBinaryQueries(queryString, query.binaryQueries);\n    return queryString;\n  }\n\n  getQueryPatterns(): PromQueryPattern[] {\n    return [\n      {\n        name: 'Rate then sum',\n        operations: [\n          { id: 'rate', params: ['auto'] },\n          { id: 'sum', params: [] },\n        ],\n      },\n      {\n        name: 'Rate then sum by(label) then avg',\n        operations: [\n          { id: 'rate', params: ['auto'] },\n          { id: '__sum_by', params: [''] },\n          { id: 'avg', params: [] },\n        ],\n      },\n      {\n        name: 'Histogram quantile on rate',\n        operations: [\n          { id: 'rate', params: ['auto'] },\n          { id: '__sum_by', params: ['le'] },\n          { id: 'histogram_quantile', params: [0.95] },\n        ],\n      },\n      {\n        name: 'Histogram quantile on increase ',\n        operations: [\n          { id: 'increase', params: ['auto'] },\n          { id: '__max_by', params: ['le'] },\n          { id: 'histogram_quantile', params: [0.95] },\n        ],\n      },\n    ];\n  }\n}\n\nexport const promQueryModeller = new PromQueryModeller();\n","import { Select } from '@grafana/ui';\nimport React, { useState } from 'react';\nimport { PromVisualQuery } from '../types';\nimport { SelectableValue, toOption } from '@grafana/data';\nimport { EditorField, EditorFieldGroup } from '@grafana/experimental';\nimport { css } from '@emotion/css';\n\nexport interface Props {\n  query: PromVisualQuery;\n  onChange: (query: PromVisualQuery) => void;\n  onGetMetrics: () => Promise<string[]>;\n}\n\nexport function MetricSelect({ query, onChange, onGetMetrics }: Props) {\n  const styles = getStyles();\n  const [state, setState] = useState<{\n    metrics?: Array<SelectableValue<any>>;\n    isLoading?: boolean;\n  }>({});\n\n  const loadMetrics = async () => {\n    return await onGetMetrics().then((res) => {\n      return res.map((value) => ({ label: value, value }));\n    });\n  };\n\n  return (\n    <EditorFieldGroup>\n      <EditorField label=\"Metric\">\n        <Select\n          inputId=\"prometheus-metric-select\"\n          className={styles.select}\n          value={query.metric ? toOption(query.metric) : undefined}\n          placeholder=\"Select metric\"\n          allowCustomValue\n          onOpenMenu={async () => {\n            setState({ isLoading: true });\n            const metrics = await loadMetrics();\n            setState({ metrics, isLoading: undefined });\n          }}\n          isLoading={state.isLoading}\n          options={state.metrics}\n          onChange={({ value }) => {\n            if (value) {\n              onChange({ ...query, metric: value, labels: [] });\n            }\n          }}\n        />\n      </EditorField>\n    </EditorFieldGroup>\n  );\n}\n\nconst getStyles = () => ({\n  select: css`\n    min-width: 125px;\n  `,\n});\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2, toOption } from '@grafana/data';\nimport { FlexItem } from '@grafana/experimental';\nimport { IconButton, Input, Select, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { PrometheusDatasource } from '../../datasource';\nimport { PromVisualQueryBinary } from '../types';\nimport { PromQueryBuilder } from './PromQueryBuilder';\n\nexport interface Props {\n  nestedQuery: PromVisualQueryBinary;\n  datasource: PrometheusDatasource;\n  index: number;\n  onChange: (index: number, update: PromVisualQueryBinary) => void;\n  onRemove: (index: number) => void;\n  onRunQuery: () => void;\n}\n\nexport const NestedQuery = React.memo<Props>(({ nestedQuery, index, datasource, onChange, onRemove, onRunQuery }) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.card}>\n      <div className={styles.header}>\n        <div className={styles.name}>Operator</div>\n        <Select\n          width=\"auto\"\n          options={operators}\n          value={toOption(nestedQuery.operator)}\n          onChange={(value) => {\n            onChange(index, {\n              ...nestedQuery,\n              operator: value.value!,\n            });\n          }}\n        />\n        <div className={styles.name}>Vector matches</div>\n\n        <Input\n          width={20}\n          defaultValue={nestedQuery.vectorMatches}\n          onBlur={(evt) => {\n            onChange(index, {\n              ...nestedQuery,\n              vectorMatches: evt.currentTarget.value,\n            });\n          }}\n        />\n\n        <FlexItem grow={1} />\n        <IconButton name=\"times\" size=\"sm\" onClick={() => onRemove(index)} />\n      </div>\n      <div className={styles.body}>\n        <PromQueryBuilder\n          query={nestedQuery.query}\n          datasource={datasource}\n          nested={true}\n          onRunQuery={onRunQuery}\n          onChange={(update) => {\n            onChange(index, { ...nestedQuery, query: update });\n          }}\n        />\n      </div>\n    </div>\n  );\n});\n\nconst operators = [\n  { label: '/', value: '/' },\n  { label: '*', value: '*' },\n  { label: '+', value: '+' },\n  { label: '==', value: '==' },\n  { label: '>', value: '>' },\n  { label: '<', value: '<' },\n];\n\nNestedQuery.displayName = 'NestedQuery';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    card: css({\n      background: theme.colors.background.primary,\n      border: `1px solid ${theme.colors.border.medium}`,\n      display: 'flex',\n      flexDirection: 'column',\n      cursor: 'grab',\n      borderRadius: theme.shape.borderRadius(1),\n    }),\n    header: css({\n      borderBottom: `1px solid ${theme.colors.border.medium}`,\n      padding: theme.spacing(0.5, 0.5, 0.5, 1),\n      gap: theme.spacing(1),\n      display: 'flex',\n      alignItems: 'center',\n    }),\n    name: css({\n      whiteSpace: 'nowrap',\n    }),\n    body: css({\n      margin: theme.spacing(1, 1, 0.5, 1),\n      display: 'table',\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\nimport { Stack } from '@grafana/experimental';\nimport React from 'react';\nimport { PrometheusDatasource } from '../../datasource';\nimport { PromVisualQuery, PromVisualQueryBinary } from '../types';\nimport { NestedQuery } from './NestedQuery';\n\nexport interface Props {\n  query: PromVisualQuery;\n  datasource: PrometheusDatasource;\n  onChange: (query: PromVisualQuery) => void;\n  onRunQuery: () => void;\n}\n\nexport function NestedQueryList({ query, datasource, onChange, onRunQuery }: Props) {\n  const styles = useStyles2(getStyles);\n  const nestedQueries = query.binaryQueries ?? [];\n\n  const onNestedQueryUpdate = (index: number, update: PromVisualQueryBinary) => {\n    const updatedList = [...nestedQueries];\n    updatedList.splice(index, 1, update);\n    onChange({ ...query, binaryQueries: updatedList });\n  };\n\n  const onRemove = (index: number) => {\n    const updatedList = [...nestedQueries.slice(0, index), ...nestedQueries.slice(index + 1)];\n    onChange({ ...query, binaryQueries: updatedList });\n  };\n\n  return (\n    <div className={styles.body}>\n      <Stack gap={1} direction=\"column\">\n        <h5 className={styles.heading}>Binary operations</h5>\n        <Stack gap={1} direction=\"column\">\n          {nestedQueries.map((nestedQuery, index) => (\n            <NestedQuery\n              key={index.toString()}\n              nestedQuery={nestedQuery}\n              index={index}\n              onChange={onNestedQueryUpdate}\n              datasource={datasource}\n              onRemove={onRemove}\n              onRunQuery={onRunQuery}\n            />\n          ))}\n        </Stack>\n      </Stack>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    heading: css({\n      fontSize: 12,\n      fontWeight: theme.typography.fontWeightMedium,\n    }),\n    body: css({\n      width: '100%',\n    }),\n    connectingLine: css({\n      height: '2px',\n      width: '16px',\n      backgroundColor: theme.colors.border.strong,\n      alignSelf: 'center',\n    }),\n    addOperation: css({\n      paddingLeft: theme.spacing(2),\n    }),\n  };\n};\n","import React from 'react';\nimport { PromVisualQuery } from '../types';\nimport { useTheme2 } from '@grafana/ui';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { promQueryModeller } from '../PromQueryModeller';\nimport { css, cx } from '@emotion/css';\nimport { EditorField, EditorFieldGroup } from '@grafana/experimental';\nimport Prism from 'prismjs';\nimport { promqlGrammar } from '../../promql';\n\nexport interface Props {\n  query: PromVisualQuery;\n}\n\nexport function QueryPreview({ query }: Props) {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  const hightlighted = Prism.highlight(promQueryModeller.renderQuery(query), promqlGrammar, 'promql');\n\n  return (\n    <EditorFieldGroup>\n      <EditorField label=\"Query text\">\n        <div\n          className={cx(styles.editorField, 'prism-syntax-highlight')}\n          aria-label=\"selector\"\n          dangerouslySetInnerHTML={{ __html: hightlighted }}\n        />\n      </EditorField>\n    </EditorFieldGroup>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    editorField: css({\n      padding: theme.spacing(0.25, 1),\n      fontFamily: theme.typography.fontFamilyMonospace,\n      fontSize: theme.typography.bodySmall.fontSize,\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Stack } from '@grafana/experimental';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\ninterface Props {\n  children: React.ReactNode;\n}\n\nexport function OperationsEditorRow({ children }: Props) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.root}>\n      <Stack gap={1}>{children}</Stack>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    root: css({\n      padding: theme.spacing(1, 1, 0, 1),\n      backgroundColor: theme.colors.background.secondary,\n      borderRadius: theme.shape.borderRadius(1),\n    }),\n  };\n};\n","import React from 'react';\nimport { MetricSelect } from './MetricSelect';\nimport { PromVisualQuery } from '../types';\nimport { LabelFilters } from '../shared/LabelFilters';\nimport { OperationList } from '../shared/OperationList';\nimport { EditorRows, EditorRow } from '@grafana/experimental';\nimport { PrometheusDatasource } from '../../datasource';\nimport { NestedQueryList } from './NestedQueryList';\nimport { promQueryModeller } from '../PromQueryModeller';\nimport { QueryBuilderLabelFilter } from '../shared/types';\nimport { QueryPreview } from './QueryPreview';\nimport { DataSourceApi } from '@grafana/data';\nimport { OperationsEditorRow } from '../shared/OperationsEditorRow';\n\nexport interface Props {\n  query: PromVisualQuery;\n  datasource: PrometheusDatasource;\n  onChange: (update: PromVisualQuery) => void;\n  onRunQuery: () => void;\n  nested?: boolean;\n}\n\nexport const PromQueryBuilder = React.memo<Props>(({ datasource, query, onChange, onRunQuery, nested }) => {\n  const onChangeLabels = (labels: QueryBuilderLabelFilter[]) => {\n    onChange({ ...query, labels });\n  };\n\n  const onGetLabelNames = async (forLabel: Partial<QueryBuilderLabelFilter>): Promise<string[]> => {\n    // If no metric we need to use a different method\n    if (!query.metric) {\n      // Todo add caching but inside language provider!\n      await datasource.languageProvider.fetchLabels();\n      return datasource.languageProvider.getLabelKeys();\n    }\n\n    const labelsToConsider = query.labels.filter((x) => x !== forLabel);\n    labelsToConsider.push({ label: '__name__', op: '=', value: query.metric });\n    const expr = promQueryModeller.renderLabels(labelsToConsider);\n    const labelsIndex = await datasource.languageProvider.fetchSeriesLabels(expr);\n\n    // filter out already used labels\n    return Object.keys(labelsIndex).filter(\n      (labelName) => !labelsToConsider.find((filter) => filter.label === labelName)\n    );\n  };\n\n  const onGetLabelValues = async (forLabel: Partial<QueryBuilderLabelFilter>) => {\n    if (!forLabel.label) {\n      return [];\n    }\n\n    // If no metric we need to use a different method\n    if (!query.metric) {\n      return await datasource.languageProvider.getLabelValues(forLabel.label);\n    }\n\n    const labelsToConsider = query.labels.filter((x) => x !== forLabel);\n    labelsToConsider.push({ label: '__name__', op: '=', value: query.metric });\n    const expr = promQueryModeller.renderLabels(labelsToConsider);\n    const result = await datasource.languageProvider.fetchSeriesLabels(expr);\n    return result[forLabel.label] ?? [];\n  };\n\n  const onGetMetrics = async () => {\n    if (query.labels.length > 0) {\n      const expr = promQueryModeller.renderLabels(query.labels);\n      return (await datasource.languageProvider.getSeries(expr, true))['__name__'] ?? [];\n    } else {\n      return (await datasource.languageProvider.getLabelValues('__name__')) ?? [];\n    }\n  };\n\n  return (\n    <EditorRows>\n      <EditorRow>\n        <MetricSelect query={query} onChange={onChange} onGetMetrics={onGetMetrics} />\n        <LabelFilters\n          labelsFilters={query.labels}\n          onChange={onChangeLabels}\n          onGetLabelNames={onGetLabelNames}\n          onGetLabelValues={onGetLabelValues}\n        />\n      </EditorRow>\n      <OperationsEditorRow>\n        <OperationList<PromVisualQuery>\n          queryModeller={promQueryModeller}\n          datasource={datasource as DataSourceApi}\n          query={query}\n          onChange={onChange}\n          onRunQuery={onRunQuery}\n        />\n        {query.binaryQueries && query.binaryQueries.length > 0 && (\n          <NestedQueryList query={query} datasource={datasource} onChange={onChange} onRunQuery={onRunQuery} />\n        )}\n      </OperationsEditorRow>\n      {!nested && (\n        <EditorRow>\n          <QueryPreview query={query} />\n        </EditorRow>\n      )}\n    </EditorRows>\n  );\n});\n\nPromQueryBuilder.displayName = 'PromQueryBuilder';\n","import React from 'react';\nimport { PromVisualQuery } from '../types';\nimport { Stack } from '@grafana/experimental';\nimport { promQueryModeller } from '../PromQueryModeller';\nimport { OperationListExplained } from '../shared/OperationListExplained';\nimport { OperationExplainedBox } from '../shared/OperationExplainedBox';\n\nexport interface Props {\n  query: PromVisualQuery;\n  nested?: boolean;\n}\n\nexport const PromQueryBuilderExplained = React.memo<Props>(({ query, nested }) => {\n  return (\n    <Stack gap={0} direction=\"column\">\n      <OperationExplainedBox stepNumber={1} title={`${query.metric} ${promQueryModeller.renderLabels(query.labels)}`}>\n        Fetch all series matching metric name and label filters.\n      </OperationExplainedBox>\n      <OperationListExplained<PromVisualQuery> stepNumber={2} queryModeller={promQueryModeller} query={query} />\n    </Stack>\n  );\n});\n\nPromQueryBuilderExplained.displayName = 'PromQueryBuilderExplained';\n","import { css } from '@emotion/css';\nimport { CoreApp, GrafanaTheme2, LoadingState } from '@grafana/data';\nimport { EditorHeader, FlexItem, InlineSelect, Space } from '@grafana/experimental';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React, { SyntheticEvent, useCallback, useState } from 'react';\nimport { PromQueryEditor } from '../../components/PromQueryEditor';\nimport { PromQueryEditorProps } from '../../components/types';\nimport { promQueryModeller } from '../PromQueryModeller';\nimport { QueryEditorModeToggle } from '../shared/QueryEditorModeToggle';\nimport { QueryHeaderSwitch } from '../shared/QueryHeaderSwitch';\nimport { QueryEditorMode } from '../shared/types';\nimport { getDefaultEmptyQuery, PromVisualQuery } from '../types';\nimport { PromQueryBuilder } from './PromQueryBuilder';\nimport { PromQueryBuilderExplained } from './PromQueryBuilderExplained';\n\nexport const PromQueryEditorSelector = React.memo<PromQueryEditorProps>((props) => {\n  const { query, onChange, onRunQuery, data } = props;\n  const styles = useStyles2(getStyles);\n  const [visualQuery, setVisualQuery] = useState<PromVisualQuery>(query.visualQuery ?? getDefaultEmptyQuery());\n\n  const onEditorModeChange = useCallback(\n    (newMetricEditorMode: QueryEditorMode) => {\n      onChange({ ...query, editorMode: newMetricEditorMode });\n    },\n    [onChange, query]\n  );\n\n  const onChangeViewModel = (updatedQuery: PromVisualQuery) => {\n    setVisualQuery(updatedQuery);\n\n    onChange({\n      ...query,\n      expr: promQueryModeller.renderQuery(updatedQuery),\n      visualQuery: updatedQuery,\n      editorMode: QueryEditorMode.Builder,\n    });\n  };\n\n  const onInstantChange = (event: SyntheticEvent<HTMLInputElement>) => {\n    const isEnabled = event.currentTarget.checked;\n    onChange({ ...query, instant: isEnabled, exemplar: false });\n    onRunQuery();\n  };\n\n  const onExemplarChange = (event: SyntheticEvent<HTMLInputElement>) => {\n    const isEnabled = event.currentTarget.checked;\n    onChange({ ...query, exemplar: isEnabled });\n    onRunQuery();\n  };\n\n  // If no expr (ie new query) then default to builder\n  const editorMode = query.editorMode ?? (query.expr ? QueryEditorMode.Code : QueryEditorMode.Builder);\n  const showExemplarSwitch = props.app !== CoreApp.UnifiedAlerting && !query.instant;\n\n  return (\n    <>\n      <EditorHeader>\n        <FlexItem grow={1} />\n        <Button\n          className={styles.runQuery}\n          variant=\"secondary\"\n          size=\"sm\"\n          fill=\"outline\"\n          onClick={onRunQuery}\n          icon={data?.state === LoadingState.Loading ? 'fa fa-spinner' : undefined}\n          disabled={data?.state === LoadingState.Loading}\n        >\n          Run query\n        </Button>\n        <QueryHeaderSwitch label=\"Instant\" value={query.instant} onChange={onInstantChange} />\n        {showExemplarSwitch && (\n          <QueryHeaderSwitch label=\"Exemplars\" value={query.exemplar} onChange={onExemplarChange} />\n        )}\n        {editorMode === QueryEditorMode.Builder && (\n          <>\n            <InlineSelect\n              value={null}\n              placeholder=\"Query patterns\"\n              allowCustomValue\n              onChange={({ value }) => {\n                onChangeViewModel({\n                  ...visualQuery,\n                  operations: value?.operations!,\n                });\n              }}\n              options={promQueryModeller.getQueryPatterns().map((x) => ({ label: x.name, value: x }))}\n            />\n          </>\n        )}\n        <QueryEditorModeToggle mode={editorMode} onChange={onEditorModeChange} />\n      </EditorHeader>\n      <Space v={0.5} />\n      {editorMode === QueryEditorMode.Code && <PromQueryEditor {...props} />}\n      {editorMode === QueryEditorMode.Builder && (\n        <PromQueryBuilder\n          query={visualQuery}\n          datasource={props.datasource}\n          onChange={onChangeViewModel}\n          onRunQuery={props.onRunQuery}\n        />\n      )}\n      {editorMode === QueryEditorMode.Explain && <PromQueryBuilderExplained query={visualQuery} />}\n    </>\n  );\n});\n\nPromQueryEditorSelector.displayName = 'PromQueryEditorSelector';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    runQuery: css({\n      color: theme.colors.text.secondary,\n    }),\n    switchLabel: css({\n      color: theme.colors.text.secondary,\n      fontSize: theme.typography.bodySmall.fontSize,\n    }),\n  };\n};\n","import React, { memo, useCallback } from 'react';\nimport { usePrevious } from 'react-use';\nimport { isEqual } from 'lodash';\nimport { css, cx } from '@emotion/css';\nimport { InlineFormLabel, RadioButtonGroup } from '@grafana/ui';\nimport { PromQuery } from '../types';\nimport { PromExemplarField } from './PromExemplarField';\nimport { PrometheusDatasource } from '../datasource';\n\nexport interface PromExploreExtraFieldProps {\n  query: PromQuery;\n  onChange: (value: PromQuery) => void;\n  onRunQuery: () => void;\n  datasource: PrometheusDatasource;\n}\n\nexport const PromExploreExtraField: React.FC<PromExploreExtraFieldProps> = memo(\n  ({ query, datasource, onChange, onRunQuery }) => {\n    const rangeOptions = [\n      { value: 'range', label: 'Range', description: 'Run query over a range of time.' },\n      {\n        value: 'instant',\n        label: 'Instant',\n        description: 'Run query against a single point in time. For this query, the \"To\" time is used.',\n      },\n      { value: 'both', label: 'Both', description: 'Run an Instant query and a Range query.' },\n    ];\n\n    const prevQuery = usePrevious(query);\n\n    const onExemplarChange = useCallback(\n      (exemplar: boolean) => {\n        if (!isEqual(query, prevQuery) || exemplar !== query.exemplar) {\n          onChange({ ...query, exemplar });\n        }\n      },\n      [prevQuery, query, onChange]\n    );\n\n    function onChangeQueryStep(interval: string) {\n      onChange({ ...query, interval });\n    }\n\n    function onStepChange(e: React.SyntheticEvent<HTMLInputElement>) {\n      if (e.currentTarget.value !== query.interval) {\n        onChangeQueryStep(e.currentTarget.value);\n      }\n    }\n\n    function onReturnKeyDown(e: React.KeyboardEvent<HTMLInputElement>) {\n      if (e.key === 'Enter' && e.shiftKey) {\n        onRunQuery();\n      }\n    }\n\n    function onQueryTypeChange(queryType: string) {\n      let nextQuery;\n      if (queryType === 'instant') {\n        nextQuery = { ...query, instant: true, range: false };\n      } else if (queryType === 'range') {\n        nextQuery = { ...query, instant: false, range: true };\n      } else {\n        nextQuery = { ...query, instant: true, range: true };\n      }\n      onChange(nextQuery);\n    }\n\n    return (\n      <div aria-label=\"Prometheus extra field\" className=\"gf-form-inline\" data-testid={testIds.extraFieldEditor}>\n        {/*Query type field*/}\n        <div\n          data-testid={testIds.queryTypeField}\n          className={cx(\n            'gf-form explore-input-margin',\n            css`\n              flex-wrap: nowrap;\n            `\n          )}\n          aria-label=\"Query type field\"\n        >\n          <InlineFormLabel width=\"auto\">Query type</InlineFormLabel>\n\n          <RadioButtonGroup\n            options={rangeOptions}\n            value={query.range && query.instant ? 'both' : query.instant ? 'instant' : 'range'}\n            onChange={onQueryTypeChange}\n          />\n        </div>\n        {/*Step field*/}\n        <div\n          data-testid={testIds.stepField}\n          className={cx(\n            'gf-form',\n            css`\n              flex-wrap: nowrap;\n            `\n          )}\n          aria-label=\"Step field\"\n        >\n          <InlineFormLabel\n            width={6}\n            tooltip={\n              'Time units and built-in variables can be used here, for example: $__interval, $__rate_interval, 5s, 1m, 3h, 1d, 1y (Default if no unit is specified: s)'\n            }\n          >\n            Min step\n          </InlineFormLabel>\n          <input\n            type={'text'}\n            className=\"gf-form-input width-4\"\n            placeholder={'auto'}\n            onChange={onStepChange}\n            onKeyDown={onReturnKeyDown}\n            value={query.interval ?? ''}\n          />\n        </div>\n\n        <PromExemplarField onChange={onExemplarChange} datasource={datasource} query={query} />\n      </div>\n    );\n  }\n);\n\nPromExploreExtraField.displayName = 'PromExploreExtraField';\n\nexport const testIds = {\n  extraFieldEditor: 'prom-editor-extra-field',\n  stepField: 'prom-editor-extra-field-step',\n  queryTypeField: 'prom-editor-extra-field-query-type',\n};\n","import React, { memo, useEffect } from 'react';\nimport { QueryEditorProps, CoreApp } from '@grafana/data';\nimport { PrometheusDatasource } from '../datasource';\nimport { PromQuery, PromOptions } from '../types';\nimport PromQueryField from './PromQueryField';\nimport { PromExploreExtraField } from './PromExploreExtraField';\n\nexport type Props = QueryEditorProps<PrometheusDatasource, PromQuery, PromOptions>;\n\nexport const PromExploreQueryEditor = memo((props: Props) => {\n  const { range, query, data, datasource, history, onChange, onRunQuery } = props;\n\n  // Setting default values\n  useEffect(() => {\n    if (query.expr === undefined) {\n      onChange({ ...query, expr: '' });\n    }\n    if (query.exemplar === undefined) {\n      onChange({ ...query, exemplar: true });\n    }\n\n    // Override query type to \"Both\" only for new queries (no query.expr).\n    if (!query.instant && !query.range && !query.expr) {\n      onChange({ ...query, instant: true, range: true });\n    }\n  }, [onChange, query]);\n\n  return (\n    <PromQueryField\n      app={CoreApp.Explore}\n      datasource={datasource}\n      query={query}\n      range={range}\n      onRunQuery={onRunQuery}\n      onChange={onChange}\n      onBlur={() => {}}\n      history={history}\n      data={data}\n      data-testid={testIds.editor}\n      ExtraFieldElement={\n        <PromExploreExtraField query={query} onChange={onChange} datasource={datasource} onRunQuery={onRunQuery} />\n      }\n    />\n  );\n});\n\nPromExploreQueryEditor.displayName = 'PromExploreQueryEditor';\n\nexport const testIds = {\n  editor: 'prom-editor-explore',\n};\n","import React, { memo } from 'react';\nimport { CoreApp } from '@grafana/data';\nimport { PromQueryEditorProps } from './types';\nimport { PromQueryEditor } from './PromQueryEditor';\nimport { PromQueryEditorForAlerting } from './PromQueryEditorForAlerting';\nimport { config } from '@grafana/runtime';\nimport { PromQueryEditorSelector } from '../querybuilder/components/PromQueryEditorSelector';\nimport { PromExploreQueryEditor } from './PromExploreQueryEditor';\n\nexport function PromQueryEditorByApp(props: PromQueryEditorProps) {\n  const { app } = props;\n\n  switch (app) {\n    case CoreApp.CloudAlerting:\n      return <PromQueryEditorForAlerting {...props} />;\n    case CoreApp.Explore:\n      if (config.featureToggles.promQueryBuilder) {\n        return <PromQueryEditorSelector {...props} />;\n      }\n      return <PromExploreQueryEditor {...props} />;\n    default:\n      if (config.featureToggles.promQueryBuilder) {\n        return <PromQueryEditorSelector {...props} />;\n      }\n      return <PromQueryEditor {...props} />;\n  }\n}\n\nexport default memo(PromQueryEditorByApp);\n","import React from 'react';\nimport { QueryEditorHelpProps } from '@grafana/data';\nimport { PromQuery } from '../types';\n\nconst CHEAT_SHEET_ITEMS = [\n  {\n    title: 'Request Rate',\n    expression: 'rate(http_request_total[5m])',\n    label:\n      'Given an HTTP request counter, this query calculates the per-second average request rate over the last 5 minutes.',\n  },\n  {\n    title: '95th Percentile of Request Latencies',\n    expression: 'histogram_quantile(0.95, sum(rate(prometheus_http_request_duration_seconds_bucket[5m])) by (le))',\n    label: 'Calculates the 95th percentile of HTTP request rate over 5 minute windows.',\n  },\n  {\n    title: 'Alerts Firing',\n    expression: 'sort_desc(sum(sum_over_time(ALERTS{alertstate=\"firing\"}[24h])) by (alertname))',\n    label: 'Sums up the alerts that have been firing over the last 24 hours.',\n  },\n  {\n    title: 'Step',\n    label:\n      'Defines the graph resolution using a duration format (15s, 1m, 3h, ...). Small steps create high-resolution graphs but can be slow over larger time ranges. Using a longer step lowers the resolution and smooths the graph by producing fewer datapoints. If no step is given the resolution is calculated automatically.',\n  },\n];\n\nconst PromCheatSheet = (props: QueryEditorHelpProps<PromQuery>) => (\n  <div>\n    <h2>PromQL Cheat Sheet</h2>\n    {CHEAT_SHEET_ITEMS.map((item, index) => (\n      <div className=\"cheat-sheet-item\" key={index}>\n        <div className=\"cheat-sheet-item__title\">{item.title}</div>\n        {item.expression ? (\n          <div\n            className=\"cheat-sheet-item__example\"\n            onClick={(e) => props.onClickExample({ refId: 'A', expr: item.expression })}\n          >\n            <code>{item.expression}</code>\n          </div>\n        ) : null}\n        <div className=\"cheat-sheet-item__label\">{item.label}</div>\n      </div>\n    ))}\n  </div>\n);\n\nexport default PromCheatSheet;\n","import { SelectableValue } from '@grafana/data';\n\nexport enum AzureCloud {\n  Public = 'AzureCloud',\n  China = 'AzureChinaCloud',\n  USGovernment = 'AzureUSGovernment',\n  Germany = 'AzureGermanCloud',\n  None = '',\n}\n\nexport const KnownAzureClouds = [\n  { value: AzureCloud.Public, label: 'Azure' },\n  { value: AzureCloud.China, label: 'Azure China' },\n  { value: AzureCloud.USGovernment, label: 'Azure US Government' },\n  { value: AzureCloud.Germany, label: 'Azure Germany' },\n] as SelectableValue[];\n\nexport type AzureAuthType = 'msi' | 'clientsecret';\n\nexport type ConcealedSecret = symbol;\n\ninterface AzureCredentialsBase {\n  authType: AzureAuthType;\n  defaultSubscriptionId?: string;\n}\n\nexport interface AzureManagedIdentityCredentials extends AzureCredentialsBase {\n  authType: 'msi';\n}\n\nexport interface AzureClientSecretCredentials extends AzureCredentialsBase {\n  authType: 'clientsecret';\n  azureCloud?: string;\n  tenantId?: string;\n  clientId?: string;\n  clientSecret?: string | ConcealedSecret;\n}\n\nexport type AzureCredentials = AzureManagedIdentityCredentials | AzureClientSecretCredentials;\n\nexport function isCredentialsComplete(credentials: AzureCredentials): boolean {\n  switch (credentials.authType) {\n    case 'msi':\n      return true;\n    case 'clientsecret':\n      return !!(credentials.azureCloud && credentials.tenantId && credentials.clientId && credentials.clientSecret);\n  }\n}\n","import { DataSourceSettings } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { AzureCloud, AzureCredentials, ConcealedSecret } from './AzureCredentials';\n\nconst concealed: ConcealedSecret = Symbol('Concealed client secret');\n\nfunction getDefaultAzureCloud(): string {\n  return config.azure.cloud || AzureCloud.Public;\n}\n\nfunction getSecret(options: DataSourceSettings<any, any>): undefined | string | ConcealedSecret {\n  if (options.secureJsonFields.azureClientSecret) {\n    // The secret is concealed on server\n    return concealed;\n  } else {\n    const secret = options.secureJsonData?.azureClientSecret;\n    return typeof secret === 'string' && secret.length > 0 ? secret : undefined;\n  }\n}\n\nexport function hasCredentials(options: DataSourceSettings<any, any>): boolean {\n  return !!options.jsonData.azureCredentials;\n}\n\nexport function getDefaultCredentials(): AzureCredentials {\n  if (config.azure.managedIdentityEnabled) {\n    return { authType: 'msi' };\n  } else {\n    return { authType: 'clientsecret', azureCloud: getDefaultAzureCloud() };\n  }\n}\n\nexport function getCredentials(options: DataSourceSettings<any, any>): AzureCredentials {\n  const credentials = options.jsonData.azureCredentials as AzureCredentials | undefined;\n\n  // If no credentials saved, then return empty credentials\n  // of type based on whether the managed identity enabled\n  if (!credentials) {\n    return getDefaultCredentials();\n  }\n\n  switch (credentials.authType) {\n    case 'msi':\n      if (config.azure.managedIdentityEnabled) {\n        return {\n          authType: 'msi',\n        };\n      } else {\n        // If authentication type is managed identity but managed identities were disabled in Grafana config,\n        // then we should fallback to an empty app registration (client secret) configuration\n        return {\n          authType: 'clientsecret',\n          azureCloud: getDefaultAzureCloud(),\n        };\n      }\n    case 'clientsecret':\n      return {\n        authType: 'clientsecret',\n        azureCloud: credentials.azureCloud || getDefaultAzureCloud(),\n        tenantId: credentials.tenantId,\n        clientId: credentials.clientId,\n        clientSecret: getSecret(options),\n      };\n  }\n}\n\nexport function updateCredentials(\n  options: DataSourceSettings<any, any>,\n  credentials: AzureCredentials\n): DataSourceSettings<any, any> {\n  switch (credentials.authType) {\n    case 'msi':\n      if (!config.azure.managedIdentityEnabled) {\n        throw new Error('Managed Identity authentication is not enabled in Grafana config.');\n      }\n\n      options = {\n        ...options,\n        jsonData: {\n          ...options.jsonData,\n          azureCredentials: {\n            authType: 'msi',\n          },\n        },\n      };\n\n      return options;\n\n    case 'clientsecret':\n      options = {\n        ...options,\n        jsonData: {\n          ...options.jsonData,\n          azureCredentials: {\n            authType: 'clientsecret',\n            azureCloud: credentials.azureCloud || getDefaultAzureCloud(),\n            tenantId: credentials.tenantId,\n            clientId: credentials.clientId,\n          },\n        },\n        secureJsonData: {\n          ...options.secureJsonData,\n          azureClientSecret:\n            typeof credentials.clientSecret === 'string' && credentials.clientSecret.length > 0\n              ? credentials.clientSecret\n              : undefined,\n        },\n        secureJsonFields: {\n          ...options.secureJsonFields,\n          azureClientSecret: typeof credentials.clientSecret === 'symbol',\n        },\n      };\n\n      return options;\n  }\n}\n\nexport function setDefaultCredentials(options: DataSourceSettings<any, any>): Partial<DataSourceSettings<any, any>> {\n  return {\n    jsonData: {\n      ...options.jsonData,\n      azureCredentials: getDefaultCredentials(),\n    },\n  };\n}\n\nexport function resetCredentials(options: DataSourceSettings<any, any>): Partial<DataSourceSettings<any, any>> {\n  return {\n    jsonData: {\n      ...options.jsonData,\n      azureAuth: undefined,\n      azureCredentials: undefined,\n      azureEndpointResourceId: undefined,\n    },\n  };\n}\n","import React, { ChangeEvent, FunctionComponent, useEffect, useReducer, useState } from 'react';\nimport { SelectableValue } from '@grafana/data';\nimport { InlineFormLabel, Button } from '@grafana/ui/src/components';\nimport { Select } from '@grafana/ui/src/components/Forms/Legacy/Select/Select';\nimport { Input } from '@grafana/ui/src/components/Forms/Legacy/Input/Input';\nimport { AzureAuthType, AzureCredentials, isCredentialsComplete } from './AzureCredentials';\n\nexport interface Props {\n  managedIdentityEnabled: boolean;\n  credentials: AzureCredentials;\n  azureCloudOptions?: SelectableValue[];\n  onCredentialsChange: (updatedCredentials: AzureCredentials) => void;\n  getSubscriptions?: () => Promise<SelectableValue[]>;\n}\n\nconst authTypeOptions: Array<SelectableValue<AzureAuthType>> = [\n  {\n    value: 'msi',\n    label: 'Managed Identity',\n  },\n  {\n    value: 'clientsecret',\n    label: 'App Registration',\n  },\n];\n\nexport const AzureCredentialsForm: FunctionComponent<Props> = (props: Props) => {\n  const { credentials, azureCloudOptions, onCredentialsChange, getSubscriptions } = props;\n  const hasRequiredFields = isCredentialsComplete(credentials);\n\n  const [subscriptions, setSubscriptions] = useState<Array<SelectableValue<string>>>([]);\n  const [loadSubscriptionsClicked, onLoadSubscriptions] = useReducer((val) => val + 1, 0);\n  useEffect(() => {\n    if (!getSubscriptions || !hasRequiredFields) {\n      updateSubscriptions([]);\n      return;\n    }\n    let canceled = false;\n    getSubscriptions().then((result) => {\n      if (!canceled) {\n        updateSubscriptions(result, loadSubscriptionsClicked);\n      }\n    });\n    return () => {\n      canceled = true;\n    };\n    // This effect is intended to be called only once initially and on Load Subscriptions click\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loadSubscriptionsClicked]);\n\n  const updateSubscriptions = (received: Array<SelectableValue<string>>, autoSelect = false) => {\n    setSubscriptions(received);\n    if (getSubscriptions) {\n      if (autoSelect && !credentials.defaultSubscriptionId && received.length > 0) {\n        // Selecting the default subscription if subscriptions received but no default subscription selected\n        onSubscriptionChange(received[0]);\n      } else if (credentials.defaultSubscriptionId) {\n        const found = received.find((opt) => opt.value === credentials.defaultSubscriptionId);\n        if (!found) {\n          // Unselecting the default subscription if it isn't found among the received subscriptions\n          onSubscriptionChange(undefined);\n        }\n      }\n    }\n  };\n\n  const onAuthTypeChange = (selected: SelectableValue<AzureAuthType>) => {\n    if (onCredentialsChange) {\n      setSubscriptions([]);\n      const updated: AzureCredentials = {\n        ...credentials,\n        authType: selected.value || 'msi',\n        defaultSubscriptionId: undefined,\n      };\n      onCredentialsChange(updated);\n    }\n  };\n\n  const onAzureCloudChange = (selected: SelectableValue<string>) => {\n    if (onCredentialsChange && credentials.authType === 'clientsecret') {\n      setSubscriptions([]);\n      const updated: AzureCredentials = {\n        ...credentials,\n        azureCloud: selected.value,\n        defaultSubscriptionId: undefined,\n      };\n      onCredentialsChange(updated);\n    }\n  };\n\n  const onTenantIdChange = (event: ChangeEvent<HTMLInputElement>) => {\n    if (onCredentialsChange && credentials.authType === 'clientsecret') {\n      setSubscriptions([]);\n      const updated: AzureCredentials = {\n        ...credentials,\n        tenantId: event.target.value,\n        defaultSubscriptionId: undefined,\n      };\n      onCredentialsChange(updated);\n    }\n  };\n\n  const onClientIdChange = (event: ChangeEvent<HTMLInputElement>) => {\n    if (onCredentialsChange && credentials.authType === 'clientsecret') {\n      setSubscriptions([]);\n      const updated: AzureCredentials = {\n        ...credentials,\n        clientId: event.target.value,\n        defaultSubscriptionId: undefined,\n      };\n      onCredentialsChange(updated);\n    }\n  };\n\n  const onClientSecretChange = (event: ChangeEvent<HTMLInputElement>) => {\n    if (onCredentialsChange && credentials.authType === 'clientsecret') {\n      setSubscriptions([]);\n      const updated: AzureCredentials = {\n        ...credentials,\n        clientSecret: event.target.value,\n        defaultSubscriptionId: undefined,\n      };\n      onCredentialsChange(updated);\n    }\n  };\n\n  const onClientSecretReset = () => {\n    if (onCredentialsChange && credentials.authType === 'clientsecret') {\n      setSubscriptions([]);\n      const updated: AzureCredentials = {\n        ...credentials,\n        clientSecret: '',\n        defaultSubscriptionId: undefined,\n      };\n      onCredentialsChange(updated);\n    }\n  };\n\n  const onSubscriptionChange = (selected: SelectableValue<string> | undefined) => {\n    if (onCredentialsChange) {\n      const updated: AzureCredentials = {\n        ...credentials,\n        defaultSubscriptionId: selected?.value,\n      };\n      onCredentialsChange(updated);\n    }\n  };\n\n  return (\n    <div className=\"gf-form-group\">\n      {props.managedIdentityEnabled && (\n        <div className=\"gf-form-inline\">\n          <div className=\"gf-form\">\n            <InlineFormLabel className=\"width-12\" tooltip=\"Choose the type of authentication to Azure services\">\n              Authentication\n            </InlineFormLabel>\n            <Select\n              menuShouldPortal\n              className=\"width-15\"\n              value={authTypeOptions.find((opt) => opt.value === credentials.authType)}\n              options={authTypeOptions}\n              onChange={onAuthTypeChange}\n            />\n          </div>\n        </div>\n      )}\n      {credentials.authType === 'clientsecret' && (\n        <>\n          {azureCloudOptions && (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <InlineFormLabel className=\"width-12\" tooltip=\"Choose an Azure Cloud\">\n                  Azure Cloud\n                </InlineFormLabel>\n                <Select\n                  menuShouldPortal\n                  className=\"width-15\"\n                  value={azureCloudOptions.find((opt) => opt.value === credentials.azureCloud)}\n                  options={azureCloudOptions}\n                  onChange={onAzureCloudChange}\n                />\n              </div>\n            </div>\n          )}\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <InlineFormLabel className=\"width-12\">Directory (tenant) ID</InlineFormLabel>\n              <div className=\"width-15\">\n                <Input\n                  className=\"width-30\"\n                  placeholder=\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n                  value={credentials.tenantId || ''}\n                  onChange={onTenantIdChange}\n                />\n              </div>\n            </div>\n          </div>\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <InlineFormLabel className=\"width-12\">Application (client) ID</InlineFormLabel>\n              <div className=\"width-15\">\n                <Input\n                  className=\"width-30\"\n                  placeholder=\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n                  value={credentials.clientId || ''}\n                  onChange={onClientIdChange}\n                />\n              </div>\n            </div>\n          </div>\n          {typeof credentials.clientSecret === 'symbol' ? (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <InlineFormLabel className=\"width-12\">Client Secret</InlineFormLabel>\n                <Input className=\"width-25\" placeholder=\"configured\" disabled={true} />\n              </div>\n              <div className=\"gf-form\">\n                <div className=\"max-width-30 gf-form-inline\">\n                  <Button variant=\"secondary\" type=\"button\" onClick={onClientSecretReset}>\n                    reset\n                  </Button>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"gf-form-inline\">\n              <div className=\"gf-form\">\n                <InlineFormLabel className=\"width-12\">Client Secret</InlineFormLabel>\n                <div className=\"width-15\">\n                  <Input\n                    className=\"width-30\"\n                    placeholder=\"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\"\n                    value={credentials.clientSecret || ''}\n                    onChange={onClientSecretChange}\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n        </>\n      )}\n      {getSubscriptions && (\n        <>\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <InlineFormLabel className=\"width-12\">Default Subscription</InlineFormLabel>\n              <div className=\"width-25\">\n                <Select\n                  menuShouldPortal\n                  value={\n                    credentials.defaultSubscriptionId\n                      ? subscriptions.find((opt) => opt.value === credentials.defaultSubscriptionId)\n                      : undefined\n                  }\n                  options={subscriptions}\n                  onChange={onSubscriptionChange}\n                />\n              </div>\n            </div>\n          </div>\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form\">\n              <div className=\"max-width-30 gf-form-inline\">\n                <Button\n                  variant=\"secondary\"\n                  size=\"sm\"\n                  type=\"button\"\n                  onClick={onLoadSubscriptions}\n                  disabled={!hasRequiredFields}\n                >\n                  Load Subscriptions\n                </Button>\n              </div>\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default AzureCredentialsForm;\n","import React, { FunctionComponent, useMemo } from 'react';\nimport { InlineFormLabel, Input } from '@grafana/ui';\nimport { config } from '@grafana/runtime';\nimport { KnownAzureClouds, AzureCredentials } from './AzureCredentials';\nimport { getCredentials, updateCredentials } from './AzureCredentialsConfig';\nimport { AzureCredentialsForm } from './AzureCredentialsForm';\nimport { HttpSettingsBaseProps } from '@grafana/ui/src/components/DataSourceSettings/types';\n\nexport const AzureAuthSettings: FunctionComponent<HttpSettingsBaseProps> = (props: HttpSettingsBaseProps) => {\n  const { dataSourceConfig, onChange } = props;\n\n  const credentials = useMemo(() => getCredentials(dataSourceConfig), [dataSourceConfig]);\n\n  const onCredentialsChange = (credentials: AzureCredentials): void => {\n    onChange(updateCredentials(dataSourceConfig, credentials));\n  };\n\n  return (\n    <>\n      <h6>Azure Authentication</h6>\n      <AzureCredentialsForm\n        managedIdentityEnabled={config.azure.managedIdentityEnabled}\n        credentials={credentials}\n        azureCloudOptions={KnownAzureClouds}\n        onCredentialsChange={onCredentialsChange}\n      />\n      <h6>Azure Configuration</h6>\n      <div className=\"gf-form-group\">\n        <div className=\"gf-form-inline\">\n          <div className=\"gf-form\">\n            <InlineFormLabel className=\"width-12\">AAD resource ID</InlineFormLabel>\n            <div className=\"width-15\">\n              <Input\n                className=\"width-30\"\n                value={dataSourceConfig.jsonData.azureEndpointResourceId || ''}\n                onChange={(event) =>\n                  onChange({\n                    ...dataSourceConfig,\n                    jsonData: { ...dataSourceConfig.jsonData, azureEndpointResourceId: event.currentTarget.value },\n                  })\n                }\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n};\n\nexport default AzureAuthSettings;\n","import { css } from '@emotion/css';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { DataSourcePicker } from '@grafana/runtime';\nimport { Button, InlineField, InlineSwitch, Input } from '@grafana/ui';\nimport React, { useState } from 'react';\nimport { ExemplarTraceIdDestination } from '../types';\n\ntype Props = {\n  value: ExemplarTraceIdDestination;\n  onChange: (value: ExemplarTraceIdDestination) => void;\n  onDelete: () => void;\n};\n\nexport default function ExemplarSetting({ value, onChange, onDelete }: Props) {\n  const [isInternalLink, setIsInternalLink] = useState(Boolean(value.datasourceUid));\n\n  return (\n    <div className=\"gf-form-group\">\n      <InlineField label=\"Internal link\" labelWidth={24}>\n        <>\n          <InlineSwitch\n            value={isInternalLink}\n            aria-label={selectors.components.DataSource.Prometheus.configPage.internalLinkSwitch}\n            onChange={(ev) => setIsInternalLink(ev.currentTarget.checked)}\n          />\n          <Button\n            variant=\"destructive\"\n            title=\"Remove link\"\n            icon=\"times\"\n            onClick={(event) => {\n              event.preventDefault();\n              onDelete();\n            }}\n            className={css`\n              margin-left: 8px;\n            `}\n          />\n        </>\n      </InlineField>\n\n      {isInternalLink ? (\n        <InlineField\n          label=\"Data source\"\n          labelWidth={24}\n          tooltip=\"The data source the exemplar is going to navigate to.\"\n        >\n          <DataSourcePicker\n            tracing={true}\n            current={value.datasourceUid}\n            noDefault={true}\n            width={40}\n            onChange={(ds) =>\n              onChange({\n                ...value,\n                datasourceUid: ds.uid,\n                url: undefined,\n              })\n            }\n          />\n        </InlineField>\n      ) : (\n        <InlineField\n          label=\"URL\"\n          labelWidth={24}\n          tooltip=\"The URL of the trace backend the user would go to see its trace.\"\n        >\n          <Input\n            placeholder=\"https://example.com/${__value.raw}\"\n            spellCheck={false}\n            width={40}\n            value={value.url}\n            onChange={(event) =>\n              onChange({\n                ...value,\n                datasourceUid: undefined,\n                url: event.currentTarget.value,\n              })\n            }\n          />\n        </InlineField>\n      )}\n\n      <InlineField\n        label=\"URL Label\"\n        labelWidth={24}\n        tooltip=\"Use to override the button label on the exemplar traceID field.\"\n      >\n        <Input\n          placeholder=\"Go to example.com\"\n          spellCheck={false}\n          width={40}\n          value={value.urlDisplayLabel}\n          onChange={(event) =>\n            onChange({\n              ...value,\n              urlDisplayLabel: event.currentTarget.value,\n            })\n          }\n        />\n      </InlineField>\n      <InlineField\n        label=\"Label name\"\n        labelWidth={24}\n        tooltip=\"The name of the field in the labels object that should be used to get the traceID.\"\n      >\n        <Input\n          placeholder=\"traceID\"\n          spellCheck={false}\n          width={40}\n          value={value.name}\n          onChange={(event) =>\n            onChange({\n              ...value,\n              name: event.currentTarget.value,\n            })\n          }\n        />\n      </InlineField>\n    </div>\n  );\n}\n","import { css } from '@emotion/css';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Button } from '@grafana/ui';\nimport React from 'react';\nimport { ExemplarTraceIdDestination } from '../types';\nimport ExemplarSetting from './ExemplarSetting';\n\ntype Props = {\n  options?: ExemplarTraceIdDestination[];\n  onChange: (value: ExemplarTraceIdDestination[]) => void;\n};\n\nexport function ExemplarsSettings({ options, onChange }: Props) {\n  return (\n    <>\n      <h3 className=\"page-heading\">Exemplars</h3>\n\n      {options &&\n        options.map((option, index) => {\n          return (\n            <ExemplarSetting\n              key={index}\n              value={option}\n              onChange={(newField) => {\n                const newOptions = [...options];\n                newOptions.splice(index, 1, newField);\n                onChange(newOptions);\n              }}\n              onDelete={() => {\n                const newOptions = [...options];\n                newOptions.splice(index, 1);\n                onChange(newOptions);\n              }}\n            />\n          );\n        })}\n\n      <Button\n        variant=\"secondary\"\n        aria-label={selectors.components.DataSource.Prometheus.configPage.exemplarsAddButton}\n        className={css`\n          margin-bottom: 10px;\n        `}\n        icon=\"plus\"\n        onClick={(event) => {\n          event.preventDefault();\n          const newOptions = [...(options || []), { name: 'traceID' }];\n          onChange(newOptions);\n        }}\n      >\n        Add\n      </Button>\n    </>\n  );\n}\n","import {\n  DataSourcePluginOptionsEditorProps,\n  onUpdateDatasourceJsonDataOptionChecked,\n  SelectableValue,\n  updateDatasourcePluginJsonDataOption,\n} from '@grafana/data';\nimport { EventsWithValidation, InlineFormLabel, LegacyForms, regexValidation } from '@grafana/ui';\nimport React, { SyntheticEvent } from 'react';\nimport { PromOptions } from '../types';\nimport { ExemplarsSettings } from './ExemplarsSettings';\nconst { Select, Input, FormField, Switch } = LegacyForms;\n\nconst httpOptions = [\n  { value: 'POST', label: 'POST' },\n  { value: 'GET', label: 'GET' },\n];\n\ntype Props = Pick<DataSourcePluginOptionsEditorProps<PromOptions>, 'options' | 'onOptionsChange'>;\n\nexport const PromSettings = (props: Props) => {\n  const { options, onOptionsChange } = props;\n\n  // We are explicitly adding httpMethod so it is correctly displayed in dropdown. This way, it is more predictable for users.\n\n  if (!options.jsonData.httpMethod) {\n    options.jsonData.httpMethod = 'POST';\n  }\n\n  return (\n    <>\n      <div className=\"gf-form-group\">\n        <div className=\"gf-form-inline\">\n          <div className=\"gf-form\">\n            <FormField\n              label=\"Scrape interval\"\n              labelWidth={13}\n              inputEl={\n                <Input\n                  className=\"width-6\"\n                  value={options.jsonData.timeInterval}\n                  spellCheck={false}\n                  placeholder=\"15s\"\n                  onChange={onChangeHandler('timeInterval', options, onOptionsChange)}\n                  validationEvents={promSettingsValidationEvents}\n                />\n              }\n              tooltip=\"Set this to the typical scrape and evaluation interval configured in Prometheus. Defaults to 15s.\"\n            />\n          </div>\n        </div>\n        <div className=\"gf-form-inline\">\n          <div className=\"gf-form\">\n            <FormField\n              label=\"Query timeout\"\n              labelWidth={13}\n              inputEl={\n                <Input\n                  className=\"width-6\"\n                  value={options.jsonData.queryTimeout}\n                  onChange={onChangeHandler('queryTimeout', options, onOptionsChange)}\n                  spellCheck={false}\n                  placeholder=\"60s\"\n                  validationEvents={promSettingsValidationEvents}\n                />\n              }\n              tooltip=\"Set the Prometheus query timeout.\"\n            />\n          </div>\n        </div>\n        <div className=\"gf-form\">\n          <InlineFormLabel\n            width={13}\n            tooltip=\"You can use either POST or GET HTTP method to query your Prometheus data source. POST is the recommended method as it allows bigger queries. Change this to GET if you have a Prometheus version older than 2.1 or if POST requests are restricted in your network.\"\n          >\n            HTTP Method\n          </InlineFormLabel>\n          <Select\n            aria-label=\"Select HTTP method\"\n            menuShouldPortal\n            options={httpOptions}\n            value={httpOptions.find((o) => o.value === options.jsonData.httpMethod)}\n            onChange={onChangeHandler('httpMethod', options, onOptionsChange)}\n            width={7}\n          />\n        </div>\n      </div>\n      <h3 className=\"page-heading\">Misc</h3>\n      <div className=\"gf-form-group\">\n        <div className=\"gf-form\">\n          <Switch\n            checked={options.jsonData.disableMetricsLookup ?? false}\n            label=\"Disable metrics lookup\"\n            labelClass=\"width-14\"\n            onChange={onUpdateDatasourceJsonDataOptionChecked(props, 'disableMetricsLookup')}\n            tooltip=\"Checking this option will disable the metrics chooser and metric/label support in the query field's autocomplete. This helps if you have performance issues with bigger Prometheus instances.\"\n          />\n        </div>\n        <div className=\"gf-form-inline\">\n          <div className=\"gf-form max-width-30\">\n            <FormField\n              label=\"Custom query parameters\"\n              labelWidth={14}\n              tooltip=\"Add Custom parameters to all Prometheus or Thanos queries.\"\n              inputEl={\n                <Input\n                  className=\"width-25\"\n                  value={options.jsonData.customQueryParameters}\n                  onChange={onChangeHandler('customQueryParameters', options, onOptionsChange)}\n                  spellCheck={false}\n                  placeholder=\"Example: max_source_resolution=5m&timeout=10\"\n                />\n              }\n            />\n          </div>\n        </div>\n      </div>\n      <ExemplarsSettings\n        options={options.jsonData.exemplarTraceIdDestinations}\n        onChange={(exemplarOptions) =>\n          updateDatasourcePluginJsonDataOption(\n            { onOptionsChange, options },\n            'exemplarTraceIdDestinations',\n            exemplarOptions\n          )\n        }\n      />\n    </>\n  );\n};\n\nexport const promSettingsValidationEvents = {\n  [EventsWithValidation.onBlur]: [\n    regexValidation(\n      /^$|^\\d+(ms|[Mwdhmsy])$/,\n      'Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s'\n    ),\n  ],\n};\n\nexport const getValueFromEventItem = (eventItem: SyntheticEvent<HTMLInputElement> | SelectableValue<string>) => {\n  if (!eventItem) {\n    return '';\n  }\n\n  if (eventItem.hasOwnProperty('currentTarget')) {\n    return eventItem.currentTarget.value;\n  }\n\n  return (eventItem as SelectableValue<string>).value;\n};\n\nconst onChangeHandler =\n  (key: keyof PromOptions, options: Props['options'], onOptionsChange: Props['onOptionsChange']) =>\n  (eventItem: SyntheticEvent<HTMLInputElement> | SelectableValue<string>) => {\n    onOptionsChange({\n      ...options,\n      jsonData: {\n        ...options.jsonData,\n        [key]: getValueFromEventItem(eventItem),\n      },\n    });\n  };\n","import { DataSourcePlugin } from '@grafana/data';\nimport { ANNOTATION_QUERY_STEP_DEFAULT, PrometheusDatasource } from './datasource';\n\nimport PromQueryEditorByApp from './components/PromQueryEditorByApp';\nimport PromCheatSheet from './components/PromCheatSheet';\n\nimport { ConfigEditor } from './configuration/ConfigEditor';\n\nclass PrometheusAnnotationsQueryCtrl {\n  static templateUrl = 'partials/annotations.editor.html';\n  stepDefaultValuePlaceholder = ANNOTATION_QUERY_STEP_DEFAULT;\n}\n\nexport const plugin = new DataSourcePlugin(PrometheusDatasource)\n  .setQueryEditor(PromQueryEditorByApp)\n  .setConfigEditor(ConfigEditor)\n  .setAnnotationQueryCtrl(PrometheusAnnotationsQueryCtrl)\n  .setQueryEditorHelp(PromCheatSheet);\n","import React from 'react';\nimport { AlertingSettings, DataSourceHttpSettings, Alert } from '@grafana/ui';\nimport { DataSourcePluginOptionsEditorProps, DataSourceSettings } from '@grafana/data';\nimport { config } from 'app/core/config';\nimport { PromOptions } from '../types';\nimport { AzureAuthSettings } from './AzureAuthSettings';\nimport { PromSettings } from './PromSettings';\nimport { hasCredentials, setDefaultCredentials, resetCredentials } from './AzureCredentialsConfig';\nimport { getAllAlertmanagerDataSources } from 'app/features/alerting/unified/utils/alertmanager';\n\nexport type Props = DataSourcePluginOptionsEditorProps<PromOptions>;\nexport const ConfigEditor = (props: Props) => {\n  const { options, onOptionsChange } = props;\n  const alertmanagers = getAllAlertmanagerDataSources();\n\n  const azureAuthSettings = {\n    azureAuthSupported: config.featureToggles['prometheus_azure_auth'] ?? false,\n    getAzureAuthEnabled: (config: DataSourceSettings<any, any>): boolean => hasCredentials(config),\n    setAzureAuthEnabled: (config: DataSourceSettings<any, any>, enabled: boolean) =>\n      enabled ? setDefaultCredentials(config) : resetCredentials(config),\n    azureSettingsUI: AzureAuthSettings,\n  };\n\n  return (\n    <>\n      {options.access === 'direct' && (\n        <Alert title=\"Deprecation Notice\" severity=\"warning\">\n          Browser access mode in the Prometheus datasource is deprecated and will be removed in a future release.\n        </Alert>\n      )}\n\n      <DataSourceHttpSettings\n        defaultUrl=\"http://localhost:9090\"\n        dataSourceConfig={options}\n        showAccessOptions={true}\n        onChange={onOptionsChange}\n        sigV4AuthToggleEnabled={config.sigV4AuthEnabled}\n        azureAuthSettings={azureAuthSettings}\n      />\n\n      <AlertingSettings<PromOptions>\n        alertmanagerDataSources={alertmanagers}\n        options={options}\n        onOptionsChange={onOptionsChange}\n      />\n\n      <PromSettings options={options} onOptionsChange={onOptionsChange} />\n    </>\n  );\n};\n","import { Grammar } from 'prismjs';\nimport { CompletionItem } from '@grafana/ui';\n\n// When changing RATE_RANGES, check if Loki/LogQL ranges should be changed too\n// @see public/app/plugins/datasource/loki/language_provider.ts\nexport const RATE_RANGES: CompletionItem[] = [\n  { label: '$__interval', sortValue: '$__interval' },\n  { label: '$__rate_interval', sortValue: '$__rate_interval' },\n  { label: '$__range', sortValue: '$__range' },\n  { label: '1m', sortValue: '00:01:00' },\n  { label: '5m', sortValue: '00:05:00' },\n  { label: '10m', sortValue: '00:10:00' },\n  { label: '30m', sortValue: '00:30:00' },\n  { label: '1h', sortValue: '01:00:00' },\n  { label: '1d', sortValue: '24:00:00' },\n];\n\nexport const OPERATORS = ['by', 'group_left', 'group_right', 'ignoring', 'on', 'offset', 'without'];\nexport const LOGICAL_OPERATORS = ['or', 'and', 'unless'];\n\nconst AGGREGATION_OPERATORS: CompletionItem[] = [\n  {\n    label: 'sum',\n    insertText: 'sum',\n    documentation: 'Calculate sum over dimensions',\n  },\n  {\n    label: 'min',\n    insertText: 'min',\n    documentation: 'Select minimum over dimensions',\n  },\n  {\n    label: 'max',\n    insertText: 'max',\n    documentation: 'Select maximum over dimensions',\n  },\n  {\n    label: 'avg',\n    insertText: 'avg',\n    documentation: 'Calculate the average over dimensions',\n  },\n  {\n    label: 'group',\n    insertText: 'group',\n    documentation: 'All values in the resulting vector are 1',\n  },\n  {\n    label: 'stddev',\n    insertText: 'stddev',\n    documentation: 'Calculate population standard deviation over dimensions',\n  },\n  {\n    label: 'stdvar',\n    insertText: 'stdvar',\n    documentation: 'Calculate population standard variance over dimensions',\n  },\n  {\n    label: 'count',\n    insertText: 'count',\n    documentation: 'Count number of elements in the vector',\n  },\n  {\n    label: 'count_values',\n    insertText: 'count_values',\n    documentation: 'Count number of elements with the same value',\n  },\n  {\n    label: 'bottomk',\n    insertText: 'bottomk',\n    documentation: 'Smallest k elements by sample value',\n  },\n  {\n    label: 'topk',\n    insertText: 'topk',\n    documentation: 'Largest k elements by sample value',\n  },\n  {\n    label: 'quantile',\n    insertText: 'quantile',\n    documentation: 'Calculate φ-quantile (0 ≤ φ ≤ 1) over dimensions',\n  },\n];\n\nexport const FUNCTIONS = [\n  ...AGGREGATION_OPERATORS,\n  {\n    insertText: 'abs',\n    label: 'abs',\n    detail: 'abs(v instant-vector)',\n    documentation: 'Returns the input vector with all sample values converted to their absolute value.',\n  },\n  {\n    insertText: 'absent',\n    label: 'absent',\n    detail: 'absent(v instant-vector)',\n    documentation:\n      'Returns an empty vector if the vector passed to it has any elements and a 1-element vector with the value 1 if the vector passed to it has no elements. This is useful for alerting on when no time series exist for a given metric name and label combination.',\n  },\n  {\n    insertText: 'absent_over_time',\n    label: 'absent_over_time',\n    detail: 'absent(v range-vector)',\n    documentation:\n      'Returns an empty vector if the range vector passed to it has any elements and a 1-element vector with the value 1 if the range vector passed to it has no elements.',\n  },\n  {\n    insertText: 'ceil',\n    label: 'ceil',\n    detail: 'ceil(v instant-vector)',\n    documentation: 'Rounds the sample values of all elements in `v` up to the nearest integer.',\n  },\n  {\n    insertText: 'changes',\n    label: 'changes',\n    detail: 'changes(v range-vector)',\n    documentation:\n      'For each input time series, `changes(v range-vector)` returns the number of times its value has changed within the provided time range as an instant vector.',\n  },\n  {\n    insertText: 'clamp',\n    label: 'clamp',\n    detail: 'clamp(v instant-vector, min scalar, max scalar)',\n    documentation:\n      'Clamps the sample values of all elements in `v` to have a lower limit of `min` and an upper limit of `max`.',\n  },\n  {\n    insertText: 'clamp_max',\n    label: 'clamp_max',\n    detail: 'clamp_max(v instant-vector, max scalar)',\n    documentation: 'Clamps the sample values of all elements in `v` to have an upper limit of `max`.',\n  },\n  {\n    insertText: 'clamp_min',\n    label: 'clamp_min',\n    detail: 'clamp_min(v instant-vector, min scalar)',\n    documentation: 'Clamps the sample values of all elements in `v` to have a lower limit of `min`.',\n  },\n  {\n    insertText: 'count_scalar',\n    label: 'count_scalar',\n    detail: 'count_scalar(v instant-vector)',\n    documentation:\n      'Returns the number of elements in a time series vector as a scalar. This is in contrast to the `count()` aggregation operator, which always returns a vector (an empty one if the input vector is empty) and allows grouping by labels via a `by` clause.',\n  },\n  {\n    insertText: 'day_of_month',\n    label: 'day_of_month',\n    detail: 'day_of_month(v=vector(time()) instant-vector)',\n    documentation: 'Returns the day of the month for each of the given times in UTC. Returned values are from 1 to 31.',\n  },\n  {\n    insertText: 'day_of_week',\n    label: 'day_of_week',\n    detail: 'day_of_week(v=vector(time()) instant-vector)',\n    documentation:\n      'Returns the day of the week for each of the given times in UTC. Returned values are from 0 to 6, where 0 means Sunday etc.',\n  },\n  {\n    insertText: 'days_in_month',\n    label: 'days_in_month',\n    detail: 'days_in_month(v=vector(time()) instant-vector)',\n    documentation:\n      'Returns number of days in the month for each of the given times in UTC. Returned values are from 28 to 31.',\n  },\n  {\n    insertText: 'delta',\n    label: 'delta',\n    detail: 'delta(v range-vector)',\n    documentation:\n      'Calculates the difference between the first and last value of each time series element in a range vector `v`, returning an instant vector with the given deltas and equivalent labels. The delta is extrapolated to cover the full time range as specified in the range vector selector, so that it is possible to get a non-integer result even if the sample values are all integers.',\n  },\n  {\n    insertText: 'deriv',\n    label: 'deriv',\n    detail: 'deriv(v range-vector)',\n    documentation:\n      'Calculates the per-second derivative of the time series in a range vector `v`, using simple linear regression.',\n  },\n  {\n    insertText: 'drop_common_labels',\n    label: 'drop_common_labels',\n    detail: 'drop_common_labels(instant-vector)',\n    documentation: 'Drops all labels that have the same name and value across all series in the input vector.',\n  },\n  {\n    insertText: 'exp',\n    label: 'exp',\n    detail: 'exp(v instant-vector)',\n    documentation:\n      'Calculates the exponential function for all elements in `v`.\\nSpecial cases are:\\n* `Exp(+Inf) = +Inf` \\n* `Exp(NaN) = NaN`',\n  },\n  {\n    insertText: 'floor',\n    label: 'floor',\n    detail: 'floor(v instant-vector)',\n    documentation: 'Rounds the sample values of all elements in `v` down to the nearest integer.',\n  },\n  {\n    insertText: 'histogram_quantile',\n    label: 'histogram_quantile',\n    detail: 'histogram_quantile(φ float, b instant-vector)',\n    documentation:\n      'Calculates the φ-quantile (0 ≤ φ ≤ 1) from the buckets `b` of a histogram. The samples in `b` are the counts of observations in each bucket. Each sample must have a label `le` where the label value denotes the inclusive upper bound of the bucket. (Samples without such a label are silently ignored.) The histogram metric type automatically provides time series with the `_bucket` suffix and the appropriate labels.',\n  },\n  {\n    insertText: 'holt_winters',\n    label: 'holt_winters',\n    detail: 'holt_winters(v range-vector, sf scalar, tf scalar)',\n    documentation:\n      'Produces a smoothed value for time series based on the range in `v`. The lower the smoothing factor `sf`, the more importance is given to old data. The higher the trend factor `tf`, the more trends in the data is considered. Both `sf` and `tf` must be between 0 and 1.',\n  },\n  {\n    insertText: 'hour',\n    label: 'hour',\n    detail: 'hour(v=vector(time()) instant-vector)',\n    documentation: 'Returns the hour of the day for each of the given times in UTC. Returned values are from 0 to 23.',\n  },\n  {\n    insertText: 'idelta',\n    label: 'idelta',\n    detail: 'idelta(v range-vector)',\n    documentation:\n      'Calculates the difference between the last two samples in the range vector `v`, returning an instant vector with the given deltas and equivalent labels.',\n  },\n  {\n    insertText: 'increase',\n    label: 'increase',\n    detail: 'increase(v range-vector)',\n    documentation:\n      'Calculates the increase in the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. The increase is extrapolated to cover the full time range as specified in the range vector selector, so that it is possible to get a non-integer result even if a counter increases only by integer increments.',\n  },\n  {\n    insertText: 'irate',\n    label: 'irate',\n    detail: 'irate(v range-vector)',\n    documentation:\n      'Calculates the per-second instant rate of increase of the time series in the range vector. This is based on the last two data points. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for.',\n  },\n  {\n    insertText: 'label_join',\n    label: 'label_join',\n    detail:\n      'label_join(v instant-vector, dst_label string, separator string, src_label_1 string, src_label_2 string, ...)',\n    documentation:\n      'For each timeseries in `v`, joins all the values of all the `src_labels` using `separator` and returns the timeseries with the label `dst_label` containing the joined value. There can be any number of `src_labels` in this function.',\n  },\n  {\n    insertText: 'label_replace',\n    label: 'label_replace',\n    detail: 'label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)',\n    documentation:\n      \"For each timeseries in `v`, `label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)`  matches the regular expression `regex` against the label `src_label`.  If it matches, then the timeseries is returned with the label `dst_label` replaced by the expansion of `replacement`. `$1` is replaced with the first matching subgroup, `$2` with the second etc. If the regular expression doesn't match then the timeseries is returned unchanged.\",\n  },\n  {\n    insertText: 'ln',\n    label: 'ln',\n    detail: 'ln(v instant-vector)',\n    documentation:\n      'Calculates the natural logarithm for all elements in `v`.\\nSpecial cases are:\\n * `ln(+Inf) = +Inf`\\n * `ln(0) = -Inf`\\n * `ln(x < 0) = NaN`\\n * `ln(NaN) = NaN`',\n  },\n  {\n    insertText: 'log2',\n    label: 'log2',\n    detail: 'log2(v instant-vector)',\n    documentation:\n      'Calculates the binary logarithm for all elements in `v`. The special cases are equivalent to those in `ln`.',\n  },\n  {\n    insertText: 'log10',\n    label: 'log10',\n    detail: 'log10(v instant-vector)',\n    documentation:\n      'Calculates the decimal logarithm for all elements in `v`. The special cases are equivalent to those in `ln`.',\n  },\n  {\n    insertText: 'minute',\n    label: 'minute',\n    detail: 'minute(v=vector(time()) instant-vector)',\n    documentation:\n      'Returns the minute of the hour for each of the given times in UTC. Returned values are from 0 to 59.',\n  },\n  {\n    insertText: 'month',\n    label: 'month',\n    detail: 'month(v=vector(time()) instant-vector)',\n    documentation:\n      'Returns the month of the year for each of the given times in UTC. Returned values are from 1 to 12, where 1 means January etc.',\n  },\n  {\n    insertText: 'predict_linear',\n    label: 'predict_linear',\n    detail: 'predict_linear(v range-vector, t scalar)',\n    documentation:\n      'Predicts the value of time series `t` seconds from now, based on the range vector `v`, using simple linear regression.',\n  },\n  {\n    insertText: 'rate',\n    label: 'rate',\n    detail: 'rate(v range-vector)',\n    documentation:\n      \"Calculates the per-second average rate of increase of the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. Also, the calculation extrapolates to the ends of the time range, allowing for missed scrapes or imperfect alignment of scrape cycles with the range's time period.\",\n  },\n  {\n    insertText: 'resets',\n    label: 'resets',\n    detail: 'resets(v range-vector)',\n    documentation:\n      'For each input time series, `resets(v range-vector)` returns the number of counter resets within the provided time range as an instant vector. Any decrease in the value between two consecutive samples is interpreted as a counter reset.',\n  },\n  {\n    insertText: 'round',\n    label: 'round',\n    detail: 'round(v instant-vector, to_nearest=1 scalar)',\n    documentation:\n      'Rounds the sample values of all elements in `v` to the nearest integer. Ties are resolved by rounding up. The optional `to_nearest` argument allows specifying the nearest multiple to which the sample values should be rounded. This multiple may also be a fraction.',\n  },\n  {\n    insertText: 'scalar',\n    label: 'scalar',\n    detail: 'scalar(v instant-vector)',\n    documentation:\n      'Given a single-element input vector, `scalar(v instant-vector)` returns the sample value of that single element as a scalar. If the input vector does not have exactly one element, `scalar` will return `NaN`.',\n  },\n  {\n    insertText: 'sgn',\n    label: 'sgn',\n    detail: 'sgn(v instant-vector)',\n    documentation:\n      'Returns a vector with all sample values converted to their sign, defined as this: 1 if v is positive, -1 if v is negative and 0 if v is equal to zero.',\n  },\n  {\n    insertText: 'sort',\n    label: 'sort',\n    detail: 'sort(v instant-vector)',\n    documentation: 'Returns vector elements sorted by their sample values, in ascending order.',\n  },\n  {\n    insertText: 'sort_desc',\n    label: 'sort_desc',\n    detail: 'sort_desc(v instant-vector)',\n    documentation: 'Returns vector elements sorted by their sample values, in descending order.',\n  },\n  {\n    insertText: 'sqrt',\n    label: 'sqrt',\n    detail: 'sqrt(v instant-vector)',\n    documentation: 'Calculates the square root of all elements in `v`.',\n  },\n  {\n    insertText: 'time',\n    label: 'time',\n    detail: 'time()',\n    documentation:\n      'Returns the number of seconds since January 1, 1970 UTC. Note that this does not actually return the current time, but the time at which the expression is to be evaluated.',\n  },\n  {\n    insertText: 'timestamp',\n    label: 'timestamp',\n    detail: 'timestamp(v instant-vector)',\n    documentation:\n      'Returns the timestamp of each of the samples of the given vector as the number of seconds since January 1, 1970 UTC.',\n  },\n  {\n    insertText: 'vector',\n    label: 'vector',\n    detail: 'vector(s scalar)',\n    documentation: 'Returns the scalar `s` as a vector with no labels.',\n  },\n  {\n    insertText: 'year',\n    label: 'year',\n    detail: 'year(v=vector(time()) instant-vector)',\n    documentation: 'Returns the year for each of the given times in UTC.',\n  },\n  {\n    insertText: 'avg_over_time',\n    label: 'avg_over_time',\n    detail: 'avg_over_time(range-vector)',\n    documentation: 'The average value of all points in the specified interval.',\n  },\n  {\n    insertText: 'min_over_time',\n    label: 'min_over_time',\n    detail: 'min_over_time(range-vector)',\n    documentation: 'The minimum value of all points in the specified interval.',\n  },\n  {\n    insertText: 'max_over_time',\n    label: 'max_over_time',\n    detail: 'max_over_time(range-vector)',\n    documentation: 'The maximum value of all points in the specified interval.',\n  },\n  {\n    insertText: 'sum_over_time',\n    label: 'sum_over_time',\n    detail: 'sum_over_time(range-vector)',\n    documentation: 'The sum of all values in the specified interval.',\n  },\n  {\n    insertText: 'count_over_time',\n    label: 'count_over_time',\n    detail: 'count_over_time(range-vector)',\n    documentation: 'The count of all values in the specified interval.',\n  },\n  {\n    insertText: 'quantile_over_time',\n    label: 'quantile_over_time',\n    detail: 'quantile_over_time(scalar, range-vector)',\n    documentation: 'The φ-quantile (0 ≤ φ ≤ 1) of the values in the specified interval.',\n  },\n  {\n    insertText: 'stddev_over_time',\n    label: 'stddev_over_time',\n    detail: 'stddev_over_time(range-vector)',\n    documentation: 'The population standard deviation of the values in the specified interval.',\n  },\n  {\n    insertText: 'stdvar_over_time',\n    label: 'stdvar_over_time',\n    detail: 'stdvar_over_time(range-vector)',\n    documentation: 'The population standard variance of the values in the specified interval.',\n  },\n  {\n    insertText: 'last_over_time',\n    label: 'last_over_time',\n    detail: 'last_over_time(range-vector)',\n    documentation: 'The most recent point value in specified interval.',\n  },\n];\n\nexport const PROM_KEYWORDS = FUNCTIONS.map((keyword) => keyword.label);\n\nexport const promqlGrammar: Grammar = {\n  comment: {\n    pattern: /#.*/,\n  },\n  'context-aggregation': {\n    pattern: /((by|without)\\s*)\\([^)]*\\)/, // by ()\n    lookbehind: true,\n    inside: {\n      'label-key': {\n        pattern: /[^(),\\s][^,)]*[^),\\s]*/,\n        alias: 'attr-name',\n      },\n      punctuation: /[()]/,\n    },\n  },\n  'context-labels': {\n    pattern: /\\{[^}]*(?=}?)/,\n    greedy: true,\n    inside: {\n      comment: {\n        pattern: /#.*/,\n      },\n      'label-key': {\n        pattern: /[a-z_]\\w*(?=\\s*(=|!=|=~|!~))/,\n        alias: 'attr-name',\n        greedy: true,\n      },\n      'label-value': {\n        pattern: /\"(?:\\\\.|[^\\\\\"])*\"/,\n        greedy: true,\n        alias: 'attr-value',\n      },\n      punctuation: /[{]/,\n    },\n  },\n  function: new RegExp(`\\\\b(?:${FUNCTIONS.map((f) => f.label).join('|')})(?=\\\\s*\\\\()`, 'i'),\n  'context-range': [\n    {\n      pattern: /\\[[^\\]]*(?=])/, // [1m]\n      inside: {\n        'range-duration': {\n          pattern: /\\b\\d+[smhdwy]\\b/i,\n          alias: 'number',\n        },\n      },\n    },\n    {\n      pattern: /(offset\\s+)\\w+/, // offset 1m\n      lookbehind: true,\n      inside: {\n        'range-duration': {\n          pattern: /\\b\\d+[smhdwy]\\b/i,\n          alias: 'number',\n        },\n      },\n    },\n  ],\n  idList: {\n    pattern: /\\d+(\\|\\d+)+/,\n    alias: 'number',\n  },\n  number: /\\b-?\\d+((\\.\\d*)?([eE][+-]?\\d+)?)?\\b/,\n  operator: new RegExp(`/[-+*/=%^~]|&&?|\\\\|?\\\\||!=?|<(?:=>?|<|>)?|>[>=]?|\\\\b(?:${OPERATORS.join('|')})\\\\b`, 'i'),\n  punctuation: /[{};()`,.]/,\n};\n\nexport default promqlGrammar;\n"],"names":["PromQueryType","isMatrixData","result","transformV2","response","request","options","tableFrames","framesWithoutTable","partition","data","df","dataFrame","app","CoreApp","meta","custom","resultType","target","targets","find","refId","format","isTableResult","processedTableFrames","dfs","length","dataFramesByRefId","groupBy","refIds","Object","keys","map","valueText","responseLength","getValueText","valueField","getValueField","valueName","timeField","getTimeField","labelFields","forEach","promLabels","fields","labels","sort","label","some","l","name","numberField","push","config","filterable","type","FieldType","values","ArrayVector","toArray","value","add","parseSampleValue","labelsForField","field","getLabelValue","preferredVisualisationType","transformDFToTable","heatmapResults","framesWithoutTableAndHeatmaps","isHeatmapResult","processedHeatmapFrames","transformToHistogramOverTime","sortSeriesByLabel","exemplarFrames","framesWithoutTableHeatmapsAndExemplars","exemplarTraceIdDestinations","destinations","processedExemplarFrames","exemplarTraceIdDestination","traceIDField","links","getDataLinks","dataTopic","DataTopic","otherFrames","transform","transformOptions","step","query","legendFormat","start","end","expr","responseListLength","scopedVars","valueWithRefId","instant","prometheusResult","Array","isArray","events","exemplarData","exemplars","exemplar","TIME_SERIES_TIME_FIELD_NAME","timestamp","TIME_SERIES_VALUE_FIELD_NAME","seriesLabels","sampledExemplars","bucketedExemplars","alignedTs","String","Math","floor","standardDeviation","deviation","sampledBuckets","ts","exemplarsInBucket","sampledBucketValues","ex","descending","reduce","acc","curr","prev","sampleExemplars","ArrayDataFrame","tableData","md","metricFields","series","metric","d","val","metricField","transformMetricDataToTable","renderLegendFormat","getTemplateSrv","replace","__name__","labelsWithoutName","labelPart","formatLabels","title","createLabelInfo","stepMs","NaN","baseTimestamp","dps","dpValue","isNaN","t","endTimestamp","parseValue","displayNameFromDS","transformToDataFrame","dataLinks","datasourceUid","dsSettings","getDataSourceSrv","getInstanceSettings","urlDisplayLabel","url","internal","queryType","datasourceName","targetBlank","hasOwnProperty","isMs","display","getDisplayProcessor","seriesList","i","topSeries","s","bottomSeries","Error","j","bottomPoint","get","s1","s2","le1","le2","err","console","error","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","parseFloat","PrometheusMetricFindQuery","constructor","datasource","this","range","getTimeSrv","timeRange","process","match","labelNamesQuery","labelValuesQuery","metricNamesQuery","metricNameQuery","queryResultQuery","lastValueFrom","metricNameAndLabelsQuery","getPrometheusTime","from","to","params","toString","metadataRequest","then","_map","text","_labels","filter","uniq","expandable","metricFilterPattern","chain","metricName","RegExp","test","matchedMetricName","instantQuery","performInstantQuery","pipe","metricData","v","k","join","self","getOriginalMetricName","PrometheusVariableSupport","StandardVariableSupport","templateSrv","timeSrv","super","bind","of","__interval","interval","__interval_ms","rangeUtil","getRangeScopedVars","interpolated","interpolateQueryExpr","metricFindQuery","results","toDataQuery","ANNOTATION_QUERY_STEP_DEFAULT","GET_AND_POST_METADATA_ENDPOINTS","PrometheusDatasource","DataSourceWithBackend","instanceSettings","languageProvider","LRU","async","loadRules","exemplarsAvailable","areExemplarsAvailable","queries","activeTargets","clonedTargets","cloneDeep","hide","requestId","panelId","histogramMetrics","m","includes","instantTarget","maxDataPoints","rangeTarget","activeTarget","exemplarTarget","createQuery","message","statusText","safeStringifyValue","status","frames","toDataQueryResponse","annotation","tagKeys","titleFormat","textFormat","tagKeysArray","split","eventList","frame","tags","timeValueTuple","idx","timeStampValue","valueValue","time","useValueForTime","activeValuesTimestamps","latestEvent","timeEnd","editorSrc","id","access","basicAuth","withCredentials","jsonData","timeInterval","queryTimeout","httpMethod","directUrl","ruleMappings","PrometheusLanguageProvider","lookupsDisabled","disableMetricsLookup","customQueryParameters","URLSearchParams","variables","getQueryDisplayText","_addTracingHeaders","httpOptions","headers","dashboardId","_request","overrides","key","defaults","method","search","entries","encodeURIComponent","Authorization","getBackendSrv","fetch","abstractQueries","abstractQuery","importFromAbstractQuery","exportToAbstractQuery","endpoint","hideFromInspector","warn","variable","multi","includeAll","prometheusRegularEscape","prometheusSpecialRegexEscape","escapedValues","targetContainsTemplate","variableExists","shouldRunExemplarQuery","currentTargetIdx","findIndex","slice","processTargetV2","timeSeriesQuery","utcOffsetSec","utcOffset","prepareTargets","exploreQuery","panelsQuery","state","LoadingState","runningQueriesCount","subQueries","index","filterAndMapResponse","tap","cancelled","runQuery","merge","observables","forkJoin","current","getExemplars","catchError","performTimeSeriesQuery","hinting","ceil","minInterval","scrapeInterval","intervalFactor","adjustedInterval","adjustInterval","getRateIntervalScopedVariable","assign","enhanceExprWithAdHocFilters","adjusted","alignedEnd","alignedStart","alignRange","rateInterval","max","__rate_interval","safeInterval","throwError","handleErrors","Promise","resolve","msRange","diff","sRange","round","__range_ms","__range_s","__range","queryModel","getRef","applyTemplateVariables","rsp","processAnnotationResponse","all","fetchSeriesLabels","Set","now","Date","getTime","intervalMs","dateTime","res","catch","interpolateVariablesInQueries","expandedQueries","getQueryHints","hints","trim","fix","action","indexOf","nameMatch","counterNameMetric","metricsMetadata","metricMetadataKeys","certain","toLowerCase","metricRegex","simpleMetric","mapping","mappingForQuery","ruleName","size","preventSubmit","getInitHints","metrics","groups","group","rules","rule","extractRuleMappingFromGroups","e","log","modifyQuery","expression","addLabelToQuery","expandRecordingRules","date","roundUp","dateMath","valueOf","getTimeRangeParams","labelData","finalQuery","getAdhocFilters","operator","filterQuery","EMPTY_SELECTOR","METRIC_LABEL","buildSelector","singleMetric","selectedLabels","selected","selectedValues","escapeLabelValueInRegexSelector","escapeLabelValueInExactSelector","getStyles","stylesFactory","theme","wrapper","css","colors","bg2","spacing","sm","list","section","selector","typography","fontFamily","monospace","xs","textSemiWeak","statusShowing","palette","brandDanger","valueList","valueListWrapper","border2","valueListArea","valueTitle","validationStatus","textStrong","UnthemedPrometheusMetricsBrowser","React","labelSearchTerm","metricSearchTerm","valueSearchTerm","event","setState","props","onChange","undefined","loading","hidden","facets","deleteLastUsedLabels","fetchValues","nextValue","updateLabelState","doFacettingForLabel","doFacetting","validateSelector","lastFacetted","fetchSeries","updatedFields","cb","componentDidMount","lastUsedLabels","rawLabels","getLabelKeys","arr","storeLastUsedLabels","rawValues","getLabelValues","labelValue","details","help","possibleLabels","possibleValues","existingValues","has","facetLabels","streams","render","styles","className","LoadingPlaceholder","nonMetricLabels","empty","metricCount","HorizontalGroup","align","Label","description","Input","onChangeMetricSearch","role","height","min","itemCount","itemSize","itemKey","width","style","active","onClick","onClickMetric","searchTerm","onChangeLabelSearch","onClickLabel","onChangeValueSearch","ref","valueListsRef","onClickValue","Button","disabled","onClickRunQuery","variant","onClickRunRateQuery","onClickValidate","onClickClear","cx","PrometheusMetricsBrowser","withTheme","Field","MonacoQueryFieldLazy","Suspense","fallback","MonacoQueryFieldWrapper","lastRunValueRef","useRef","runQueryOnBlur","onRunQuery","rest","handleRunQuery","onBlur","PromQueryField","context","initHints","initHint","hint","isDataFrame","toLegacyResponseData","queryHints","queryHint","languageProviderInitializationPromise","promise","hasCanceled_","reject","isCanceled","cancel","makePromiseCancelable","remainingTasks","onUpdateLanguage","onChangeQuery","labelBrowserVisible","override","syntaxLoaded","suggestions","history","prefix","wrapperClasses","labelKey","typeahead","provideCompletionItems","plugins","BracesPlugin","SlatePrism","onlyIn","node","getSyntax","prismLanguages","promql","syntax","refreshMetrics","refreshHint","componentWillUnmount","componentDidUpdate","prevProps","changedRangeToRefresh","rangeChangedToRefresh","prevRange","sameMinuteFrom","roundMsToMin","sameMinuteTo","ExtraFieldElement","hasMetrics","chooserText","metricsLookupDisabled","hasSyntax","getChooserText","buttonDisabled","LocalStorageValueProvider","storageKey","defaultValue","onLastUsedLabelsSave","onLastUsedLabelsDelete","onClickChooserButton","Icon","initialValue","onChangeLabelBrowser","onClickHintFix","PromLink","panelData","href","setHref","useState","useEffect","rangeDiff","endTime","utc","queryOptions","args","getExternalLink","textUtil","rel","memo","PromExemplarField","setError","useStyles2","prevError","usePrevious","iconButtonStyles","activeIcon","eyeIcon","InlineLabel","Tooltip","content","iconWrapper","IconButton","tooltip","primary","main","Switch","LegacyForms","FORMAT_OPTIONS","INTERVAL_FACTOR_OPTIONS","PromQueryEditor","PureComponent","option","formatOption","checked","currentTarget","intervalFactorOption","isEnabled","defaultQuery","Boolean","showExemplarField","onFieldChange","testIds","editor","InlineFormLabel","placeholder","onLegendChange","onIntervalChange","Select","menuShouldPortal","isSearchable","onIntervalFactorChange","onFormatChange","onInstantChange","onExemplarChange","PromQueryEditorForAlerting","LabelParamEditor","autoFocus","openMenuOnFocus","onOpenMenu","isLoading","op","promQueryModeller","renderLabels","x","loadGroupByLabels","allowCustomValue","noOptionsMessage","loadingMessage","toOption","PromVisualQueryOperationCategory","createRangeFunction","getPromAndLokiOperationDisplayName","defaultParams","alternativesKey","category","RangeFunctions","renderer","operationWithRangeVectorRenderer","addOperationHandler","addOperationWithRangeVector","model","def","innerExpr","rangeVector","getSimpleBinaryRenderer","modeller","operations","getOperationDef","newOperation","addNestedQueryHandler","binaryQueries","createAggregationOperation","restParam","optional","Aggregations","functionRendererLeft","defaultAddOperationHandler","paramChangedHandler","changeToOperartionId","aggregation","getLastLabelRemovedHandler","explainHandler","aggregationName","labelWord","pluralize","hideFromList","param","unshift","firstParam","restParams","getAggregationByRendererWithParameter","createAggregationOverTime","functionName","PromQueryModeller","LokiAndPromQueryModellerBase","allOperations","Functions","functionRendererRight","BinaryOps","func","FUNCTIONS","insertText","documentation","setOperationCategories","renderQuery","queryString","renderOperations","renderBinaryQueries","getQueryPatterns","MetricSelect","onGetMetrics","EditorFieldGroup","EditorField","inputId","select","loadMetrics","NestedQuery","nestedQuery","onRemove","card","header","operators","vectorMatches","evt","FlexItem","grow","body","PromQueryBuilder","nested","update","displayName","background","border","medium","flexDirection","cursor","borderRadius","shape","borderBottom","padding","gap","alignItems","whiteSpace","margin","NestedQueryList","nestedQueries","onNestedQueryUpdate","updatedList","splice","Stack","direction","heading","fontSize","fontWeight","fontWeightMedium","connectingLine","backgroundColor","strong","alignSelf","addOperation","paddingLeft","QueryPreview","useTheme2","hightlighted","Prism","promqlGrammar","editorField","dangerouslySetInnerHTML","__html","fontFamilyMonospace","bodySmall","OperationsEditorRow","children","root","secondary","EditorRows","EditorRow","getSeries","LabelFilters","labelsFilters","onGetLabelNames","fetchLabels","labelsToConsider","forLabel","labelsIndex","labelName","onGetLabelValues","OperationList","queryModeller","PromQueryBuilderExplained","OperationExplainedBox","stepNumber","OperationListExplained","PromQueryEditorSelector","visualQuery","setVisualQuery","onEditorModeChange","useCallback","newMetricEditorMode","editorMode","onChangeViewModel","updatedQuery","QueryEditorMode","showExemplarSwitch","EditorHeader","fill","icon","QueryHeaderSwitch","InlineSelect","QueryEditorModeToggle","mode","Space","color","switchLabel","PromExploreExtraField","prevQuery","isEqual","extraFieldEditor","queryTypeField","RadioButtonGroup","nextQuery","stepField","onKeyDown","shiftKey","PromExploreQueryEditor","PromQueryEditorByApp","CHEAT_SHEET_ITEMS","item","onClickExample","AzureCloud","KnownAzureClouds","Public","China","USGovernment","Germany","concealed","Symbol","getDefaultAzureCloud","getSecret","secureJsonFields","azureClientSecret","secret","secureJsonData","getDefaultCredentials","authType","azureCloud","authTypeOptions","AzureCredentialsForm","credentials","azureCloudOptions","onCredentialsChange","getSubscriptions","hasRequiredFields","tenantId","clientId","clientSecret","isCredentialsComplete","subscriptions","setSubscriptions","loadSubscriptionsClicked","onLoadSubscriptions","useReducer","updateSubscriptions","canceled","received","autoSelect","defaultSubscriptionId","onSubscriptionChange","opt","updated","managedIdentityEnabled","I","AzureAuthSettings","dataSourceConfig","useMemo","azureCredentials","getCredentials","updateCredentials","azureEndpointResourceId","ExemplarSetting","onDelete","isInternalLink","setIsInternalLink","InlineField","labelWidth","InlineSwitch","selectors","ev","preventDefault","DataSourcePicker","tracing","noDefault","ds","uid","spellCheck","ExemplarsSettings","newField","newOptions","FormField","PromSettings","onOptionsChange","inputEl","onChangeHandler","validationEvents","promSettingsValidationEvents","o","labelClass","onUpdateDatasourceJsonDataOptionChecked","exemplarOptions","updateDatasourcePluginJsonDataOption","EventsWithValidation","regexValidation","getValueFromEventItem","eventItem","PrometheusAnnotationsQueryCtrl","plugin","DataSourcePlugin","setQueryEditor","setConfigEditor","alertmanagers","getAllAlertmanagerDataSources","azureAuthSettings","azureAuthSupported","getAzureAuthEnabled","hasCredentials","setAzureAuthEnabled","enabled","setDefaultCredentials","azureAuth","resetCredentials","azureSettingsUI","Alert","severity","DataSourceHttpSettings","defaultUrl","showAccessOptions","sigV4AuthToggleEnabled","AlertingSettings","alertmanagerDataSources","setAnnotationQueryCtrl","setQueryEditorHelp","PromCheatSheet","RATE_RANGES","sortValue","OPERATORS","LOGICAL_OPERATORS","detail","PROM_KEYWORDS","keyword","comment","pattern","lookbehind","inside","alias","punctuation","greedy","function","f","idList","number"],"sourceRoot":""}