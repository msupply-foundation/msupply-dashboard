"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9355],{"./public/app/features/alerting/unified/MuteTimings.tsx":(e,t,a)=>{a.r(t),a.d(t,{default:()=>O});var i=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),n=a("./.yarn/__virtual__/react-router-virtual-31642fe47a/0/cache/react-router-npm-5.2.1-ea754d7473-7daae084bf.zip/node_modules/react-router/esm/react-router.js"),s=a("./public/app/features/alerting/unified/components/AlertingPageWrapper.tsx"),r=a("./packages/grafana-ui/src/index.ts"),l=a("./.yarn/__virtual__/react-hook-form-virtual-92b6119fd4/0/cache/react-hook-form-npm-7.5.3-f9cc466c62-fbfaa3b664.zip/node_modules/react-hook-form/dist/index.esm.js"),d=a("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/0/cache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),o=a("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),m=a("./public/app/features/alerting/unified/components/AlertManagerPicker.tsx"),u=a("./public/app/features/alerting/unified/hooks/useAlertManagerSourceName.ts"),c=a("./public/app/features/alerting/unified/state/actions.ts"),v=a("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts"),p=a("./public/app/features/alerting/unified/utils/redux.ts"),g=a("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js");const h=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],f=["january","february","march","april","may","june","july","august","september","october","november","december"],_={times:[{start_time:"",end_time:""}],weekdays:"",days_of_month:"",months:"",years:""},b=(e,t,a)=>!e||(e.split(",").map((e=>e.trim())).every((e=>e.split(":").every(t)))||a),y=e=>e?e.split(",").map((e=>e.trim())):void 0;var x=a("./public/app/features/alerting/unified/utils/misc.ts"),j=a("./public/app/features/alerting/unified/utils/alertmanager.ts"),k=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const I=e=>{var t,a,i;let{intervalIndex:n}=e;const s=(0,r.useStyles2)(w),{register:d,formState:o}=(0,l.Gc)(),{fields:m,append:u,remove:c}=(0,l.Dq)({name:`time_intervals.${n}.times`}),v=e=>{if(!e)return!0;const[t,a]=e.split(":").map((e=>parseInt(e,10)));return(24===t?0===a:t>=0&&t<25&&(a>-1&&a<60))||"Time is invalid"},p=null===(t=o.errors.time_intervals)||void 0===t?void 0:t[n],g=null!==(a=null==p||null===(i=p.times)||void 0===i?void 0:i.some((e=>(null==e?void 0:e.start_time)||(null==e?void 0:e.end_time))))&&void 0!==a&&a;return(0,k.jsxs)("div",{children:[(0,k.jsx)(r.Field,{className:s.field,label:"Time range",description:"The time inclusive of the starting time and exclusive of the end time in UTC",invalid:g,error:g?"Times must be between 00:00 and 24:00 UTC":"",children:(0,k.jsx)(k.Fragment,{children:m.map(((e,t)=>{var a,i,l,o;return(0,k.jsx)("div",{className:s.timeRange,children:(0,k.jsxs)(r.InlineFieldRow,{children:[(0,k.jsx)(r.InlineField,{label:"Start time",invalid:!(null==p||null===(a=p.times)||void 0===a||null===(i=a[t])||void 0===i||!i.start_time),children:(0,k.jsx)(r.Input,Object.assign({},d(`time_intervals.${n}.times.${t}.start_time`,{validate:v}),{className:s.timeRangeInput,defaultValue:e.start_time,placeholder:"HH:MM","data-testid":"mute-timing-starts-at"}))}),(0,k.jsx)(r.InlineField,{label:"End time",invalid:!(null==p||null===(l=p.times)||void 0===l||null===(o=l[t])||void 0===o||!o.end_time),children:(0,k.jsx)(r.Input,Object.assign({},d(`time_intervals.${n}.times.${t}.end_time`,{validate:v}),{className:s.timeRangeInput,defaultValue:e.end_time,placeholder:"HH:MM","data-testid":"mute-timing-ends-at"}))}),(0,k.jsx)(r.IconButton,{className:s.deleteTimeRange,title:"Remove",name:"trash-alt",type:"button",onClick:e=>{e.preventDefault(),c(t)}})]})},e.id)}))})}),(0,k.jsx)(r.Button,{className:s.addTimeRange,variant:"secondary",type:"button",icon:"plus",onClick:()=>u({start_time:"",end_time:""}),children:"Add another time range"})]})},w=e=>({field:o.css`
    margin-bottom: 0;
  `,timeRange:o.css`
    margin-bottom: ${e.spacing(1)};
  `,timeRangeInput:o.css`
    width: 120px;
  `,deleteTimeRange:o.css`
    margin: ${e.spacing(1)} 0 0 ${e.spacing(.5)};
  `,addTimeRange:o.css`
    margin-bottom: ${e.spacing(2)};
  `});var C;const N=()=>{const e=(0,r.useStyles2)(S),{formState:t,register:a}=(0,l.Gc)(),{fields:i,append:n,remove:s}=(0,l.Dq)({name:"time_intervals"});return(0,k.jsx)(r.FieldSet,{className:e.timeIntervalLegend,label:"Time intervals",children:(0,k.jsxs)(k.Fragment,{children:[C||(C=(0,k.jsx)("p",{children:"A time interval is a definition for a moment in time. All fields are lists, and at least one list element must be satisfied to match the field. If a field is left blank, any moment of time will match the field. For an instant of time to match a complete time interval, all fields must match. A mute timing can contain multiple time intervals."})),i.map(((i,n)=>{var l,d,o,m,u,c,v,p,g,_,y,x,j,w,C,N,S,$,M,T,A,F;const R=t.errors;return(0,k.jsxs)("div",{className:e.timeIntervalSection,children:[(0,k.jsx)(I,{intervalIndex:n}),(0,k.jsx)(r.Field,{label:"Days of the week",error:null!==(l=null===(d=R.time_intervals)||void 0===d||null===(o=d[n])||void 0===o||null===(m=o.weekdays)||void 0===m?void 0:m.message)&&void 0!==l?l:"",invalid:!(null===(u=R.time_intervals)||void 0===u||null===(c=u[n])||void 0===c||!c.weekdays),children:(0,k.jsx)(r.Input,Object.assign({},a(`time_intervals.${n}.weekdays`,{validate:e=>b(e,(e=>h.includes(e.toLowerCase())),"Invalid day of the week")}),{className:e.input,"data-testid":"mute-timing-weekdays",defaultValue:i.weekdays,placeholder:"Example: monday, tuesday:thursday"}))}),(0,k.jsx)(r.Field,{label:"Days of the month",description:"The days of the month, 1-31, of a month. Negative values can be used to represent days which begin at the end of the month",invalid:!(null===(v=R.time_intervals)||void 0===v||null===(p=v[n])||void 0===p||!p.days_of_month),error:null===(g=R.time_intervals)||void 0===g||null===(_=g[n])||void 0===_||null===(y=_.days_of_month)||void 0===y?void 0:y.message,children:(0,k.jsx)(r.Input,Object.assign({},a(`time_intervals.${n}.days_of_month`,{validate:e=>b(e,(e=>{const t=parseInt(e,10);return t>-31&&t<0||t>0&&t<32}),"Invalid day")}),{className:e.input,defaultValue:i.days_of_month,placeholder:"Example: 1, 14:16, -1","data-testid":"mute-timing-days"}))}),(0,k.jsx)(r.Field,{label:"Months",description:"The months of the year in either numerical or the full calendar month",invalid:!(null===(x=R.time_intervals)||void 0===x||null===(j=x[n])||void 0===j||!j.months),error:null===(w=R.time_intervals)||void 0===w||null===(C=w[n])||void 0===C||null===(N=C.months)||void 0===N?void 0:N.message,children:(0,k.jsx)(r.Input,Object.assign({},a(`time_intervals.${n}.months`,{validate:e=>b(e,(e=>f.includes(e)||parseInt(e,10)<13&&parseInt(e,10)>0),"Invalid month")}),{className:e.input,placeholder:"Example: 1:3, may:august, december",defaultValue:i.months,"data-testid":"mute-timing-months"}))}),(0,k.jsx)(r.Field,{label:"Years",invalid:!(null===(S=R.time_intervals)||void 0===S||null===($=S[n])||void 0===$||!$.years),error:null!==(M=null===(T=R.time_intervals)||void 0===T||null===(A=T[n])||void 0===A||null===(F=A.years)||void 0===F?void 0:F.message)&&void 0!==M?M:"",children:(0,k.jsx)(r.Input,Object.assign({},a(`time_intervals.${n}.years`,{validate:e=>b(e,(e=>/^\d{4}$/.test(e)),"Invalid year")}),{className:e.input,placeholder:"Example: 2021:2022, 2030",defaultValue:i.years,"data-testid":"mute-timing-years"}))}),(0,k.jsx)(r.Button,{type:"button",variant:"destructive",icon:"trash-alt",onClick:()=>s(n),children:"Remove time interval"})]},i.id)})),(0,k.jsx)(r.Button,{type:"button",variant:"secondary",className:e.removeTimeIntervalButton,onClick:()=>{n(_)},icon:"plus",children:"Add another time interval"})]})})},S=e=>({input:o.css`
    width: 400px;
  `,timeIntervalLegend:o.css`
    legend {
      font-size: 1.25rem;
    }
  `,timeIntervalSection:o.css`
    background-color: ${e.colors.background.secondary};
    padding: ${e.spacing(1)};
    margin-bottom: ${e.spacing(1)};
  `,removeTimeIntervalButton:o.css`
    margin-top: ${e.spacing(1)};
  `});var $,M;const T=e=>({input:o.css`
    width: 400px;
  `,submitButton:o.css`
    margin-left: ${e.spacing(1)};
  `}),A=e=>{var t,a,n;let{muteTiming:o,showError:h}=e;const f=(0,d.useDispatch)(),[b,I]=(0,u.k)(),w=(0,r.useStyles2)(T),C={alertmanager_config:{},template_files:{}},S=(0,v._)((e=>e.amConfigs)),{result:A=C,loading:F}=b&&S[b]||p.oq,R=null!==(t=null==A?void 0:A.alertmanager_config)&&void 0!==t?t:{},z=(e=>(0,i.useMemo)((()=>{if(!e)return{name:"",time_intervals:[_]};const t=e.time_intervals.map((e=>{var t,a,i,n,s,r,l,d,o;return{times:null!==(t=e.times)&&void 0!==t?t:_.times,weekdays:null!==(a=null==e||null===(i=e.weekdays)||void 0===i?void 0:i.join(", "))&&void 0!==a?a:_.weekdays,days_of_month:null!==(n=null==e||null===(s=e.days_of_month)||void 0===s?void 0:s.join(", "))&&void 0!==n?n:_.days_of_month,months:null!==(r=null==e||null===(l=e.months)||void 0===l?void 0:l.join(", "))&&void 0!==r?r:_.months,years:null!==(d=null==e||null===(o=e.years)||void 0===o?void 0:o.join(", "))&&void 0!==d?d:_.years}}));return{name:e.name,time_intervals:t}}),[e]))(o),B=(0,l.cI)({defaultValues:z});return(0,k.jsxs)(s.J,{pageId:"am-routes",children:[(0,k.jsx)(m.P,{current:b,onChange:I,disabled:!0}),A&&!F&&(0,k.jsx)(l.RV,Object.assign({},B,{children:(0,k.jsxs)("form",{onSubmit:B.handleSubmit((e=>{var t,a;const i=(e=>{const t=e.time_intervals.map((e=>{var t;let{times:a,weekdays:i,days_of_month:n,months:s,years:r}=e;const l={times:a.filter((e=>{let{start_time:t,end_time:a}=e;return!!t&&!!a})),weekdays:null===(t=y(i))||void 0===t?void 0:t.map((e=>e.toLowerCase())),days_of_month:y(n),months:y(s),years:y(r)};return(0,g.omitBy)(l,g.isUndefined)}));return{name:e.name,time_intervals:t}})(e),n=o?null==R||null===(t=R.mute_time_intervals)||void 0===t?void 0:t.filter((e=>{let{name:t}=e;return t!==o.name})):R.mute_time_intervals,s=Object.assign({},A,{alertmanager_config:Object.assign({},R,{route:o&&i.name!==o.name?(0,j.FM)(i.name,o.name,null!==(a=R.route)&&void 0!==a?a:{}):R.route,mute_time_intervals:[...n||[],i]})});f((0,c.mM)({newConfig:s,oldConfig:A,alertManagerSourceName:b,successMessage:"Mute timing saved",redirectPath:"/alerting/routes/"}))})),"data-testid":"mute-timing-form",children:[h&&($||($=(0,k.jsx)(r.Alert,{title:"No matching mute timing found"}))),(0,k.jsxs)(r.FieldSet,{label:"Create mute timing",children:[(0,k.jsx)(r.Field,{required:!0,label:"Name",description:"A unique name for the mute timing",invalid:!(null===(a=B.formState.errors)||void 0===a||!a.name),error:null===(n=B.formState.errors.name)||void 0===n?void 0:n.message,children:(0,k.jsx)(r.Input,Object.assign({},B.register("name",{required:!0,validate:e=>{if(!o){var t;return!(null==R||null===(t=R.mute_time_intervals)||void 0===t?void 0:t.find((t=>{let{name:a}=t;return e===a})))||`Mute timing already exists for "${e}"`}return e.length>0||"Name is required"}}),{className:w.input,"data-testid":"mute-timing-name"}))}),M||(M=(0,k.jsx)(N,{})),(0,k.jsx)(r.LinkButton,{type:"button",variant:"secondary",href:(0,x.eQ)("/alerting/routes/",b),children:"Cancel"}),(0,k.jsx)(r.Button,{type:"submit",className:w.submitButton,children:o?"Save":"Submit"})]})]})}))]})};var F,R,z,B=a("./public/app/core/hooks/useQueryParams.ts");const O=()=>{const[e]=(0,B.K)(),t=(0,d.useDispatch)(),[a]=(0,u.k)(),s=(0,v._)((e=>e.amConfigs)),l=(0,i.useCallback)((()=>{a&&t((0,c.Yh)(a))}),[a,t]);(0,i.useEffect)((()=>{l()}),[l]);const{result:o,error:m,loading:g}=a&&s[a]||p.oq,h=null==o?void 0:o.alertmanager_config,f=(0,i.useCallback)((e=>{var t;return null==h||null===(t=h.mute_time_intervals)||void 0===t?void 0:t.find((t=>{let{name:a}=t;return a===e}))}),[h]);return(0,k.jsxs)(k.Fragment,{children:[g&&(F||(F=(0,k.jsx)(r.LoadingPlaceholder,{text:"Loading mute timing"}))),m&&!g&&(0,k.jsx)(r.Alert,{severity:"error",title:`Error loading Alertmanager config for ${a}`,children:m.message||"Unknown error."}),o&&!m&&(0,k.jsxs)(n.rs,{children:[R||(R=(0,k.jsx)(n.AW,{exact:!0,path:"/alerting/routes/mute-timing/new",children:(0,k.jsx)(A,{})})),(0,k.jsx)(n.AW,{exact:!0,path:"/alerting/routes/mute-timing/edit",children:()=>{if(e.muteName){const t=f(String(e.muteName));return(0,k.jsx)(A,{muteTiming:t,showError:!t})}return z||(z=(0,k.jsx)(n.l_,{to:"/alerting/routes"}))}})]})]})}},"./public/app/features/alerting/unified/components/AlertingPageWrapper.tsx":(e,t,a)=>{a.d(t,{J:()=>l});a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");var i=a("./public/app/core/components/Page/Page.tsx"),n=a("./public/app/core/selectors/navModel.ts"),s=a("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/0/cache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),r=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const l=e=>{let{children:t,pageId:a,isLoading:l}=e;const d=(0,n.h)((0,s.useSelector)((e=>e.navIndex)),a);return(0,r.jsx)(i.Z,{navModel:d,children:(0,r.jsx)(i.Z.Contents,{isLoading:l,children:t})})}},"./public/app/features/alerting/unified/hooks/useAlertManagerSourceName.ts":(e,t,a)=>{a.d(t,{k:()=>o});var i=a("./public/app/core/hooks/useQueryParams.ts"),n=a("./public/app/core/store.ts"),s=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),r=a("./public/app/features/alerting/unified/utils/constants.ts"),l=a("./public/app/features/alerting/unified/utils/datasource.ts");function d(e){return e===l.GC||!!(0,l.aM)().find((t=>t.name===e))}function o(){const[e,t]=(0,i.K)(),a=(0,s.useCallback)((e=>{d(e)&&(e===l.GC?(n.Z.delete(r.de),t({[r.c4]:null})):(n.Z.set(r.de,e),t({[r.c4]:e})))}),[t]),o=e[r.c4];if(o&&"string"==typeof o)return d(o)?[o,a]:[void 0,a];const m=n.Z.get(r.de);return m&&"string"==typeof m&&d(m)?(a(m),[m,a]):[l.GC,a]}}}]);
//# sourceMappingURL=MuteTimings.e65e3aa10981aa98e7a1.js.map