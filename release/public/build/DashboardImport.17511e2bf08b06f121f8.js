(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{gzYa:function(e,t,r){"use strict";r.r(t);var a=r("q1tI"),n=r("vF1F"),s=r("Obii"),o=r("kDLi"),i=r("ZGyg"),d=r("hBny"),c=r("/MKj"),l=r("t8hP"),h=r("fL47"),u=r("d4Ek");const b=e=>{try{return JSON.parse(e),!0}catch(e){return"Not valid JSON"}},j=e=>{const t=/(^\d+$)|dashboards\/(\d+)/.exec(e);return!(!t||!t[1]&&!t[2])||"Could not find a valid Grafana.com ID"},p=e=>Object(l.getBackendSrv)().get("/api/dashboards/uid/"+e).then(e=>`Dashboard named '${null==e?void 0:e.dashboard.title}' in folder '${null==e?void 0:e.meta.folderTitle}' has the same UID`).catch(e=>(e.isHandled=!0,!0));var m,O=r("nKUr");function f(e,t){if(null==e)return{};var r,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)r=s[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}function g(){return(g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}const x=({register:e,errors:t,control:r,getValues:n,uidReset:s,inputs:i,initialFolderId:d,onUidReset:c,onCancel:b,onSubmit:j,watch:x})=>{const[D,I]=Object(a.useState)(!1),F=x("dataSources");return Object(a.useEffect)(()=>{D&&(t.title||t.uid)&&j(n(),{})},[t,n,D,j]),Object(O.jsxs)(O.Fragment,{children:[m||(m=Object(O.jsx)(o.Legend,{children:"Options"})),Object(O.jsx)(o.Field,{label:"Name",invalid:!!t.title,error:t.title&&t.title.message,children:Object(O.jsx)(o.Input,g({},e("title",{required:"Name is required",validate:async e=>{return await(t=e,r=n().folder.id,u.a.validateNewDashboardName(r,t).then(()=>!0).catch(e=>{if("EXISTING"===e.type)return e.message}));var t,r}}),{type:"text"}))}),Object(O.jsx)(o.Field,{label:"Folder",children:Object(O.jsx)(o.InputControl,{render:e=>{let{}=e,t=f(e.field,["ref"]);return Object(O.jsx)(h.a,g({},t,{enableCreateNew:!0,initialFolderId:d}))},name:"folder",control:r})}),Object(O.jsx)(o.Field,{label:"Unique identifier (UID)",description:"The unique identifier (UID) of a dashboard can be used for uniquely identify a dashboard between multiple Grafana installs. The UID allows having consistent URLs for accessing dashboards so changing the title of a dashboard will not break any bookmarked links to that dashboard.",invalid:!!t.uid,error:t.uid&&t.uid.message,children:Object(O.jsx)(O.Fragment,{children:s?Object(O.jsx)(o.Input,g({},e("uid",{required:!0,validate:async e=>await p(e)}))):Object(O.jsx)(o.Input,g({disabled:!0},e("uid",{validate:async e=>await p(e)}),{addonAfter:!s&&Object(O.jsx)(o.Button,{onClick:c,children:"Change uid"})}))})}),i.dataSources&&i.dataSources.map((e,a)=>{const n=`dataSources[${a}]`,s=null!=F?F:[];return Object(O.jsx)(o.Field,{label:e.label,invalid:t.dataSources&&!!t.dataSources[a],error:t.dataSources&&t.dataSources[a]&&"A data source is required",children:Object(O.jsx)(o.InputControl,{name:n,render:t=>{var r;let{}=t,n=f(t.field,["ref"]);return Object(O.jsx)(l.DataSourcePicker,g({},n,{noDefault:!0,placeholder:e.info,pluginId:e.pluginId,current:null===(r=s[a])||void 0===r?void 0:r.name}))},control:r,rules:{required:!0}})},n)}),i.constants&&i.constants.map((r,a)=>{const n=`constants[${a}]`;return Object(O.jsx)(o.Field,{label:r.label,error:t.constants&&t.constants[a]&&r.label+" needs a value",invalid:t.constants&&!!t.constants[a],children:Object(O.jsx)(o.Input,g({},e(n,{required:!0}),{defaultValue:r.value}))},n)}),Object(O.jsxs)(o.HorizontalGroup,{children:[Object(O.jsx)(o.Button,{type:"submit",variant:v(t),onClick:()=>{I(!0)},children:y(t)}),Object(O.jsx)(o.Button,{type:"reset",variant:"secondary",onClick:b,children:"Cancel"})]})]})};function v(e){return e&&(e.title||e.uid)?"destructive":"primary"}function y(e){return e&&(e.title||e.uid)?"Import (Overwrite)":"Import"}var D,I,F=r("5LyR"),S=r("nFP0");function N(){return(N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}class w extends a.PureComponent{constructor(...e){super(...e),this.state={uidReset:!1},this.onSubmit=e=>{this.props.importDashboard(e)},this.onCancel=()=>{this.props.clearLoadedDashboard()},this.onUidReset=()=>{this.setState({uidReset:!0})}}render(){const{dashboard:e,inputs:t,meta:r,source:a,folder:n}=this.props,{uidReset:i}=this.state;return Object(O.jsxs)(O.Fragment,{children:[a===S.a.Gcom&&Object(O.jsxs)("div",{style:{marginBottom:"24px"},children:[Object(O.jsx)("div",{children:Object(O.jsxs)(o.Legend,{children:["Importing dashboard from"," ",Object(O.jsx)("a",{href:"https://grafana.com/dashboards/"+e.gnetId,className:"external-link",target:"_blank",rel:"noreferrer",children:"Grafana.com"})]})}),Object(O.jsx)("table",{className:"filter-table form-inline",children:Object(O.jsxs)("tbody",{children:[Object(O.jsxs)("tr",{children:[D||(D=Object(O.jsx)("td",{children:"Published by"})),Object(O.jsx)("td",{children:r.orgName})]}),Object(O.jsxs)("tr",{children:[I||(I=Object(O.jsx)("td",{children:"Updated on"})),Object(O.jsx)("td",{children:Object(s.dateTimeFormat)(r.updatedAt)})]})]})})]}),Object(O.jsx)(o.Form,{onSubmit:this.onSubmit,defaultValues:N({},e,{constants:[],dataSources:[],folder:n}),validateOnMount:!0,validateFieldsOnMount:["title","uid"],validateOn:"onChange",children:({register:e,errors:r,control:a,watch:s,getValues:o})=>Object(O.jsx)(x,{register:e,errors:r,control:a,getValues:o,uidReset:i,inputs:t,onCancel:this.onCancel,onUidReset:this.onUidReset,onSubmit:this.onSubmit,watch:s,initialFolderId:n.id})})]})}}const J={clearLoadedDashboard:F.a,importDashboard:F.f},U=Object(c.connect)(e=>{const t=l.locationService.getSearchObject();return{dashboard:e.importDashboard.dashboard,meta:e.importDashboard.meta,source:e.importDashboard.source,inputs:e.importDashboard.inputs,folder:t.folderId?{id:Number(t.folderId)}:{id:0}}},J)(w);U.displayName="ImportDashboardOverview";var C,L,k,q,R,G=r("Xmxp"),P=r("lzJ5");function T(){return(T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}r.d(t,"DashboardImportPage",(function(){return $}));class B extends a.PureComponent{constructor(...e){super(...e),this.onFileUpload=e=>{const{importDashboardJson:t}=this.props,r=e.currentTarget.files&&e.currentTarget.files.length>0&&e.currentTarget.files[0];if(r){const e=new FileReader,a=()=>e=>{let r;try{r=JSON.parse(e.target.result)}catch(e){return void G.b.emit(s.AppEvents.alertError,["Import failed","JSON -> JS Serialization failed: "+e.message])}t(r)};e.onload=a(),e.readAsText(r)}},this.getDashboardFromJson=e=>{this.props.importDashboardJson(JSON.parse(e.dashboardJson))},this.getGcomDashboard=e=>{let t;const r=/(^\d+$)|dashboards\/(\d+)/.exec(e.gcomDashboard);r&&r[1]?t=r[1]:r&&r[2]&&(t=r[2]),t&&this.props.fetchGcomDashboard(t)}}renderImportForm(){const e=M(this.props.theme);return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("div",{className:e.option,children:Object(O.jsx)(o.FileUpload,{accept:"application/json",onFileUpload:this.onFileUpload,children:"Upload JSON file"})}),Object(O.jsxs)("div",{className:e.option,children:[C||(C=Object(O.jsx)(o.Legend,{children:"Import via grafana.com"})),Object(O.jsx)(o.Form,{onSubmit:this.getGcomDashboard,defaultValues:{gcomDashboard:""},children:({register:e,errors:t})=>Object(O.jsx)(o.Field,{invalid:!!t.gcomDashboard,error:t.gcomDashboard&&t.gcomDashboard.message,children:Object(O.jsx)(o.Input,T({placeholder:"Grafana.com dashboard URL or ID",type:"text"},e("gcomDashboard",{required:"A Grafana dashboard URL or ID is required",validate:j}),{addonAfter:L||(L=Object(O.jsx)(o.Button,{type:"submit",children:"Load"}))}))})})]}),Object(O.jsxs)("div",{className:e.option,children:[k||(k=Object(O.jsx)(o.Legend,{children:"Import via panel json"})),Object(O.jsx)(o.Form,{onSubmit:this.getDashboardFromJson,defaultValues:{dashboardJson:""},children:({register:e,errors:t})=>Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(o.Field,{invalid:!!t.dashboardJson,error:t.dashboardJson&&t.dashboardJson.message,children:Object(O.jsx)(o.TextArea,T({},e("dashboardJson",{required:"Need a dashboard JSON model",validate:b}),{rows:10}))}),q||(q=Object(O.jsx)(o.Button,{type:"submit",children:"Load"}))]})})]})]})}render(){const{isLoaded:e,navModel:t}=this.props;return Object(O.jsx)(i.a,{navModel:t,children:Object(O.jsx)(i.a.Contents,{children:e?R||(R=Object(O.jsx)(U,{})):this.renderImportForm()})})}}const A=Object(o.withTheme2)(B),V={fetchGcomDashboard:F.e,importDashboardJson:F.g},$=Object(d.a)(e=>({navModel:Object(P.a)(e.navIndex,"import",void 0,!0),isLoaded:e.importDashboard.isLoaded}),V,e=>e.importDashboard)(A);t.default=$;$.displayName="DashboardImport";const M=Object(o.stylesFactory)(e=>({option:n.css`
      margin-bottom: ${e.spacing(4)};
    `}))},hBny:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var a=r("/MKj"),n=r("zVNn"),s=r("q1tI"),o=r("2mql"),i=r.n(o),d=r("nKUr");function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}const l=(e,t,r)=>o=>{const l=Object(a.connect)(e,t)(o),h=e=>{const t=Object(a.useDispatch)();return Object(s.useEffect)(()=>function(){t(Object(n.a)({stateSelector:r}))},[t]),Object(d.jsx)(l,c({},e))};return h.displayName=`ConnectWithCleanUp(${l.displayName})`,i()(h,o),h}}}]);
//# sourceMappingURL=DashboardImport.17511e2bf08b06f121f8.js.map