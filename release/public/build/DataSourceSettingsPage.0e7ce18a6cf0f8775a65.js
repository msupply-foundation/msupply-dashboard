"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3959],{"./public/app/features/datasources/settings/DataSourceSettingsPage.tsx":(e,t,a)=>{a.r(t),a.d(t,{DataSourceSettingsPage:()=>_,default:()=>V});var s=a("./node_modules/react/index.js"),r=a("./node_modules/lodash/lodash.js"),n=a("./public/app/core/components/Page/Page.tsx"),o=a("./packages/grafana-runtime/src/index.ts"),i=a("./node_modules/react/jsx-runtime.js");function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class c extends s.PureComponent{constructor(e){super(e),l(this,"element",null),l(this,"component",void 0),l(this,"scopeProps",void 0),l(this,"onModelChanged",(e=>{this.props.onModelChange(e)})),this.scopeProps={ctrl:{datasourceMeta:e.dataSourceMeta,current:(0,r.cloneDeep)(e.dataSource)},onModelChanged:this.onModelChanged},this.onModelChanged=this.onModelChanged.bind(this)}componentDidMount(){const{plugin:e}=this.props;if(this.element&&!e.components.ConfigEditor){const e=(0,o.getAngularLoader)(),t='<plugin-component type="datasource-config-ctrl" />';this.component=e.load(this.element,this.scopeProps,t)}}componentDidUpdate(e){const{plugin:t}=this.props;var a;t.components.ConfigEditor||this.props.dataSource===e.dataSource||(this.scopeProps.ctrl.current=(0,r.cloneDeep)(this.props.dataSource),null===(a=this.component)||void 0===a||a.digest())}componentWillUnmount(){this.component&&this.component.destroy()}render(){const{plugin:e,dataSource:t}=this.props;return e?(0,i.jsx)("div",{ref:e=>this.element=e,children:e.components.ConfigEditor&&s.createElement(e.components.ConfigEditor,{options:t,onOptionsChange:this.onModelChanged})}):null}}var d,u=a("./packages/grafana-ui/src/index.ts"),p=a("./packages/grafana-e2e-selectors/src/index.ts");const{Input:h,Switch:g}=u.LegacyForms,f=({dataSourceName:e,isDefault:t,onDefaultChange:a,onNameChange:s})=>(0,i.jsx)("div",{className:"gf-form-group","aria-label":"Datasource settings page basic settings",children:(0,i.jsxs)("div",{className:"gf-form-inline",children:[(0,i.jsxs)("div",{className:"gf-form max-width-30",style:{marginRight:"3px"},children:[d||(d=(0,i.jsx)(u.InlineFormLabel,{tooltip:"The name is used when you select the data source in panels. The default data source is preselected in new panels.",children:"Name"})),(0,i.jsx)(h,{className:"gf-form-input max-width-23",type:"text",value:e,placeholder:"Name",onChange:e=>s(e.target.value),required:!0,"aria-label":p.wl.pages.DataSource.name})]}),(0,i.jsx)(g,{label:"Default",checked:t,onChange:e=>{a(e.target.checked)}})]})});var m=a("./public/app/core/config.ts"),S=a("./public/app/types/index.ts"),x=a("./public/app/core/core.ts");const b=({isReadOnly:e,onDelete:t,onSubmit:a,onTest:s,exploreUrl:r})=>{const n=!e&&x.Vt.hasPermission(S.bW.DataSourcesWrite),o=!e&&x.Vt.hasPermission(S.bW.DataSourcesDelete),l=x.Vt.hasPermission(S.bW.DataSourcesExplore);return(0,i.jsxs)("div",{className:"gf-form-button-row",children:[(0,i.jsx)(u.LinkButton,{variant:"secondary",fill:"solid",href:`${m.ZP.appSubUrl}/datasources`,children:"Back"}),(0,i.jsx)(u.LinkButton,{variant:"secondary",fill:"solid",href:r,disabled:!l,children:"Explore"}),(0,i.jsx)(u.Button,{type:"button",variant:"destructive",disabled:!o,onClick:t,"aria-label":p.wl.pages.DataSource.delete,children:"Delete"}),n&&(0,i.jsx)(u.Button,{type:"submit",variant:"primary",disabled:!n,onClick:e=>a(e),"aria-label":p.wl.pages.DataSource.saveAndTest,children:"Save & test"}),!n&&(0,i.jsx)(u.Button,{type:"submit",variant:"primary",onClick:s,children:"Test"})]})};var v=a("./public/app/core/app_events.ts"),D=a("./public/app/features/datasources/state/selectors.ts"),y=a("./public/app/features/datasources/state/actions.ts"),j=a("./public/app/core/selectors/navModel.ts"),C=a("./packages/grafana-data/src/index.ts"),P=a("./public/app/features/datasources/state/navModel.ts"),k=a("./public/app/features/plugins/PluginStateInfo.tsx"),M=a("./public/app/features/datasources/state/reducers.ts"),w=a("./packages/grafana-data/src/types/config.ts"),N=a("./public/app/core/components/LocalStorageValueProvider/index.tsx");const E=({dataSource:e})=>{var t;let a="",s="";if(e.readOnly||(null!==(t=e.version)&&void 0!==t?t:0)>2)return null;if(m.vc.buildInfo.edition!==w.e.OpenSource)return null;switch(e.type){case"prometheus":a="Prometheus",s="Loki";break;case"loki":a="Loki",s="Prometheus";break;default:return null}return(0,i.jsx)(N.G,{storageKey:"datasources.settings.cloudInfoBox.isDismissed",defaultValue:!1,children:(t,r)=>t?null:(0,i.jsxs)(u.Alert,{title:`Configure your ${a} data source below`,severity:"info",bottomSpacing:4,onRemove:()=>{r(!0)},children:["Or skip the effort and get ",a," (and ",s,") as fully-managed, scalable, and hosted data sources from Grafana Labs with the"," ",(0,i.jsx)("a",{className:"external-link",href:`https://grafana.com/signup/cloud/connect-account?src=grafana-oss&cnt=${e.type}-settings`,target:"_blank",rel:"noreferrer",title:"The free plan includes 10k active metrics and 50gb storage.",children:"free-forever Grafana Cloud plan"}),"."]})})};var O,T,B,L=a("./node_modules/react-redux/es/index.js"),I=a("./public/app/core/actions/cleanUp.ts"),U=a("./public/app/types/events.ts");function A(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const R={deleteDataSource:y.xU,loadDataSource:y.gv,setDataSourceName:M.BX,updateDataSource:y.oe,setIsDefault:M.yr,dataSourceLoaded:M.rl,initDataSourceSettings:y.M9,testDataSource:y.kY,cleanUpAction:I.e},W=(0,L.connect)((function(e,t){const a=t.match.params.uid,s=new URLSearchParams(t.location.search),r=(0,D.f6)(e.dataSources,a),{plugin:n,loadError:o,testingStatus:i}=e.dataSourceSettings,l=s.get("page"),c=n?(0,P.nI)((0,P.B1)(r,n),l||"settings"):(0,P.xG)("settings"),d=(0,j.h)(e.navIndex,l?`datasource-page-${l}`:`datasource-settings-${a}`,c);return{dataSource:(0,D.f6)(e.dataSources,a),dataSourceMeta:(0,D.G4)(e.dataSources,r.type),dataSourceId:a,page:l,plugin:n,loadError:o,testingStatus:i,navModel:d}}),R);class _ extends s.PureComponent{constructor(...e){super(...e),A(this,"onSubmit",(async e=>{e.preventDefault(),await this.props.updateDataSource(Object.assign({},this.props.dataSource)),this.testDataSource()})),A(this,"onTest",(async e=>{e.preventDefault(),this.testDataSource()})),A(this,"onDelete",(()=>{v.Z.publish(new U.VJ({title:"Delete",text:"Are you sure you want to delete this data source?",yesText:"Delete",icon:"trash-alt",onConfirm:()=>{this.confirmDelete()}}))})),A(this,"confirmDelete",(()=>{this.props.deleteDataSource()})),A(this,"onModelChange",(e=>{this.props.dataSourceLoaded(e)}))}componentDidMount(){const{initDataSourceSettings:e,dataSourceId:t}=this.props;e(t)}componentWillUnmount(){this.props.cleanUpAction({stateSelector:e=>e.dataSourceSettings})}isReadOnly(){return!0===this.props.dataSource.readOnly}renderIsReadOnlyMessage(){return(0,i.jsx)(u.Alert,{"aria-label":p.wl.pages.DataSource.readOnly,severity:"info",title:"Provisioned data source",children:"This data source was added by config and cannot be modified using the UI. Please contact your server admin to update this data source."})}renderMissingEditRightsMessage(){return O||(O=(0,i.jsx)(u.Alert,{severity:"info",title:"Missing rights",children:"You are not allowed to modify this data source. Please contact your server admin to update this data source."}))}testDataSource(){const{dataSource:e,testDataSource:t}=this.props;t(e.name)}get hasDataSource(){return this.props.dataSource.id>0}onNavigateToExplore(){const{dataSource:e}=this.props,t=JSON.stringify({datasource:e.name,context:"explore"});return C.urlUtil.renderUrl("/explore",{left:t})}renderLoadError(e){let t=!1,a=e.toString();e.data?e.data.message&&(a=e.data.message):(0,r.isString)(e)&&(t=!0);const s={text:a,subTitle:"Data Source Error",icon:"exclamation-triangle"},o={node:s,main:s};return(0,i.jsx)(n.Z,{navModel:o,children:(0,i.jsx)(n.Z.Contents,{children:(0,i.jsx)("div",{children:(0,i.jsxs)("div",{className:"gf-form-button-row",children:[t&&(0,i.jsx)(u.Button,{type:"submit",variant:"destructive",onClick:this.onDelete,children:"Delete"}),T||(T=(0,i.jsx)(u.LinkButton,{variant:"secondary",href:"datasources",fill:"outline",children:"Back"}))]})})})})}renderConfigPageBody(e){const{plugin:t}=this.props;if(!t||!t.configPages)return null;for(const a of t.configPages)if(a.id===e)return(0,i.jsx)(a.body,{plugin:t,query:{}});return(0,i.jsxs)("div",{children:["Page not found: ",e]})}renderAlertDetails(){var e,t,a;const{testingStatus:s}=this.props;return(0,i.jsxs)(i.Fragment,{children:[null==s||null===(e=s.details)||void 0===e?void 0:e.message,null!=s&&null!==(t=s.details)&&void 0!==t&&t.verboseMessage?(0,i.jsx)("details",{style:{whiteSpace:"pre-wrap"},children:null==s||null===(a=s.details)||void 0===a?void 0:a.verboseMessage}):null]})}renderSettings(){const{dataSourceMeta:e,setDataSourceName:t,setIsDefault:a,dataSource:s,plugin:r,testingStatus:n}=this.props,o=x.Vt.hasPermission(S.bW.DataSourcesWrite);return(0,i.jsxs)("form",{onSubmit:this.onSubmit,children:[!o&&this.renderMissingEditRightsMessage(),this.isReadOnly()&&this.renderIsReadOnlyMessage(),e.state&&(0,i.jsxs)("div",{className:"gf-form",children:[B||(B=(0,i.jsx)("label",{className:"gf-form-label width-10",children:"Plugin state"})),(0,i.jsx)("label",{className:"gf-form-label gf-form-label--transparent",children:(0,i.jsx)(k.u,{state:e.state})})]}),(0,i.jsx)(E,{dataSource:s}),(0,i.jsx)(f,{dataSourceName:s.name,isDefault:s.isDefault,onDefaultChange:e=>a(e),onNameChange:e=>t(e)}),r&&(0,i.jsx)(c,{plugin:r,dataSource:s,dataSourceMeta:e,onModelChange:this.onModelChange}),(null==n?void 0:n.message)&&(0,i.jsx)("div",{className:"gf-form-group p-t-2",children:(0,i.jsx)(u.Alert,{severity:"error"===n.status?"error":"success",title:n.message,"aria-label":p.wl.pages.DataSource.alert,children:n.details&&this.renderAlertDetails()})}),(0,i.jsx)(b,{onSubmit:e=>this.onSubmit(e),isReadOnly:this.isReadOnly(),onDelete:this.onDelete,onTest:e=>this.onTest(e),exploreUrl:this.onNavigateToExplore()})]})}render(){const{navModel:e,page:t,loadError:a}=this.props;return a?this.renderLoadError(a):(0,i.jsx)(n.Z,{navModel:e,children:(0,i.jsx)(n.Z.Contents,{isLoading:!this.hasDataSource,children:this.hasDataSource?(0,i.jsx)("div",{children:t?this.renderConfigPageBody(t):this.renderSettings()}):null})})}}const V=W(_)},"./public/app/features/plugins/PluginStateInfo.tsx":(e,t,a)=>{a.d(t,{u:()=>o});a("./node_modules/react/index.js");var s=a("./packages/grafana-ui/src/index.ts"),r=a("./packages/grafana-data/src/index.ts"),n=a("./node_modules/react/jsx-runtime.js");const o=e=>{const t=function(e){switch(e){case r.PluginState.deprecated:return{text:"Deprecated",color:"red",tooltip:"This feature is deprecated and will be removed in a future release"};case r.PluginState.alpha:return{text:"Alpha",color:"blue",tooltip:"This feature is experimental and future updates might not be backward compatible"};case r.PluginState.beta:return{text:"Beta",color:"blue",tooltip:"This feature is close to complete but not fully tested"};default:return null}}(e.state);return t?(0,n.jsx)(s.Badge,{color:t.color,title:t.tooltip,text:t.text,icon:t.icon}):null}}}]);
//# sourceMappingURL=DataSourceSettingsPage.0e7ce18a6cf0f8775a65.js.map