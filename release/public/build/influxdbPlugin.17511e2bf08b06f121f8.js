(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{NluS:function(e,t,a){"use strict";function r(e){return"function"==typeof e?e():e}function s(){var e={};return e.promise=new Promise((function(t,a){e.resolve=t,e.reject=a})),e}e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=void 0,i=void 0,o=void 0,l=[];return function(){var u=r(t),d=(new Date).getTime(),m=!n||d-n>u;n=d;for(var p=arguments.length,h=Array(p),g=0;g<p;g++)h[g]=arguments[g];if(m&&a.leading)return a.accumulate?Promise.resolve(e.call(this,[h])).then((function(e){return e[0]})):Promise.resolve(e.call.apply(e,[this].concat(h)));if(i?clearTimeout(o):i=s(),l.push(h),o=setTimeout(c.bind(this),u),a.accumulate){var f=l.length-1;return i.promise.then((function(e){return e[f]}))}return i.promise};function c(){var t=i;clearTimeout(o),Promise.resolve(a.accumulate?e.call(this,l):e.apply(this,l[l.length-1])).then(t.resolve,t.reject),l=[],i=null}}},sl8e:function(e,t,a){"use strict";a.r(t);var r=a("LvDl"),s=a("Obii"),n=a("7Cbv"),i=a("iZOS");class o{constructor(e){this.refId=void 0,this.series=void 0,this.alias=void 0,this.annotation=void 0,this.meta=void 0,this.series=e.series,this.alias=e.alias,this.annotation=e.annotation,this.meta=e.meta,this.refId=e.refId}getTimeSeries(){const e=[];let t,a;return 0===this.series.length||Object(r.each)(this.series,s=>{const n=s.columns.length,i=Object(r.map)(s.tags,(e,t)=>t+": "+e);for(a=1;a<n;a++){let r=s.name;const n=s.columns[a];"value"!==n&&(r=r+"."+n),this.alias?r=this._getSeriesName(s,a):s.tags&&(r=r+" {"+i.join(", ")+"}");const o=[];if(s.values)for(t=0;t<s.values.length;t++)o[t]=[s.values[t][a],s.values[t][0]];e.push({target:r,datapoints:o,meta:this.meta,refId:this.refId})}}),e}_getSeriesName(e,t){const a=e.name.split(".");return this.alias.replace(/\$(\w+)|\[\[([\s\S]+?)\]\]/g,(r,s,n)=>{const i=s||n,o=parseInt(i,10);if("m"===i||"measurement"===i)return e.name;if("col"===i)return e.columns[t];if(!isNaN(o))return a[o];if(0!==i.indexOf("tag_"))return r;const l=i.replace("tag_","");return e.tags?e.tags[l]:r})}getAnnotations(){const e=[];return Object(r.each)(this.series,t=>{let a=null,s=null,n=null;const i=[];let o=null;Object(r.each)(t.columns,(e,t)=>{"time"!==e?"sequence_number"!==e&&(e!==this.annotation.titleColumn?Object(r.includes)((this.annotation.tagsColumn||"").replace(" ","").split(","),e)?i.push(t):e!==this.annotation.textColumn?e!==this.annotation.timeEndColumn?a||o===t||(a=t):n=t:o=t:a=t):s=t}),Object(r.each)(t.values,t=>{const l={annotation:this.annotation,time:+new Date(t[s]),title:t[a],timeEnd:t[n],tags:Object(r.flatten)(i.filter(e=>t[e]).map(e=>t[e].split(","))),text:t[o]};e.push(l)})}),e}getTable(){const e=new i.a;let t,a;return e.refId=this.refId,e.meta=this.meta,0===this.series.length||Object(r.each)(this.series,(n,i)=>{if(0===i)for(a=0,"time"===n.columns[0]&&(e.columns.push({text:"Time",type:s.FieldType.time}),a++),Object(r.each)(Object(r.keys)(n.tags),t=>{e.columns.push({text:t})});a<n.columns.length;a++)e.columns.push({text:n.columns[a]});if(n.values)for(t=0;t<n.values.length;t++){const r=n.values[t],s=[r[0]];if(n.tags)for(const e in n.tags)n.tags.hasOwnProperty(e)&&s.push(n.tags[e]);for(a=1;a<r.length;a++)s.push(r[a]);e.rows.push(s)}}),e}}var l=a("QNPh");const c=[],u={Aggregations:[],Selectors:[],Transformations:[],Predictors:[],Math:[],Aliasing:[],Fields:[]};function d(e){const t=c[e.type];if(!t)throw{message:"Could not find query part "+e.type};return new l.a(e,t)}function m(e){c[e.type]=new l.b(e),e.category.push(c[e.type])}const p=[];function h(e,t){return"*"===e.params[0]?"*":'"'+e.params[0]+'"'}function g(e,t){for(let a=0;a<e.length;a++){const r=e[a];if(r.def.category===u.Aggregations){if(r.def.type===t.def.type)return;if("count"===r.def.type&&"distinct"===t.def.type)break;if("distinct"===r.def.type){const r=e.length>=a+2;if("count"!==t.def.type&&r){e[a+1].def.category===u.Aggregations&&e.splice(a+1,1)}else if("count"===t.def.type)return void(r&&"count"===e[a+1].def.type||e.splice(a+1,0,t))}return void(e[a]=t)}if(r.def.category===u.Selectors)return void(e[a]=t)}e.splice(1,0,t)}function f(e,t){let a;for(a=0;a<e.length;a++){const t=e[a];if(t.def.category===u.Math||t.def.category===u.Aliasing)break}e.splice(a,0,t)}m({type:"field",addStrategy:function(e,t,a){const s=Object(r.map)(e,e=>d({type:e.def.type,params:Object(r.clone)(e.params)}));a.selectModels.push(s)},category:u.Fields,params:[{type:"field",dynamicLookup:!0}],defaultParams:["value"],renderer:h}),m({type:"count",addStrategy:g,category:u.Aggregations,params:[],defaultParams:[],renderer:l.c}),m({type:"distinct",addStrategy:g,category:u.Aggregations,params:[],defaultParams:[],renderer:l.c}),m({type:"integral",addStrategy:g,category:u.Aggregations,params:[],defaultParams:[],renderer:l.c}),m({type:"mean",addStrategy:g,category:u.Aggregations,params:[],defaultParams:[],renderer:l.c}),m({type:"median",addStrategy:g,category:u.Aggregations,params:[],defaultParams:[],renderer:l.c}),m({type:"mode",addStrategy:g,category:u.Aggregations,params:[],defaultParams:[],renderer:l.c}),m({type:"sum",addStrategy:g,category:u.Aggregations,params:[],defaultParams:[],renderer:l.c}),m({type:"derivative",addStrategy:f,category:u.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:l.c}),m({type:"spread",addStrategy:f,category:u.Transformations,params:[],defaultParams:[],renderer:l.c}),m({type:"non_negative_derivative",addStrategy:f,category:u.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:l.c}),m({type:"difference",addStrategy:f,category:u.Transformations,params:[],defaultParams:[],renderer:l.c}),m({type:"non_negative_difference",addStrategy:f,category:u.Transformations,params:[],defaultParams:[],renderer:l.c}),m({type:"moving_average",addStrategy:f,category:u.Transformations,params:[{name:"window",type:"int",options:[5,10,20,30,40]}],defaultParams:[10],renderer:l.c}),m({type:"cumulative_sum",addStrategy:f,category:u.Transformations,params:[],defaultParams:[],renderer:l.c}),m({type:"stddev",addStrategy:f,category:u.Transformations,params:[],defaultParams:[],renderer:l.c}),m({type:"time",category:p,params:[{name:"interval",type:"time",options:["$__interval","1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["$__interval"],renderer:l.c}),m({type:"fill",category:p,params:[{name:"fill",type:"string",options:["none","null","0","previous","linear"]}],defaultParams:["null"],renderer:l.c}),m({type:"elapsed",addStrategy:f,category:u.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:l.c}),m({type:"holt_winters",addStrategy:f,category:u.Predictors,params:[{name:"number",type:"int",options:[5,10,20,30,40]},{name:"season",type:"int",options:[0,1,2,5,10]}],defaultParams:[10,2],renderer:l.c}),m({type:"holt_winters_with_fit",addStrategy:f,category:u.Predictors,params:[{name:"number",type:"int",options:[5,10,20,30,40]},{name:"season",type:"int",options:[0,1,2,5,10]}],defaultParams:[10,2],renderer:l.c}),m({type:"bottom",addStrategy:g,category:u.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:l.c}),m({type:"first",addStrategy:g,category:u.Selectors,params:[],defaultParams:[],renderer:l.c}),m({type:"last",addStrategy:g,category:u.Selectors,params:[],defaultParams:[],renderer:l.c}),m({type:"max",addStrategy:g,category:u.Selectors,params:[],defaultParams:[],renderer:l.c}),m({type:"min",addStrategy:g,category:u.Selectors,params:[],defaultParams:[],renderer:l.c}),m({type:"percentile",addStrategy:g,category:u.Selectors,params:[{name:"nth",type:"int"}],defaultParams:[95],renderer:l.c}),m({type:"top",addStrategy:g,category:u.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:l.c}),m({type:"tag",category:p,params:[{name:"tag",type:"string",dynamicLookup:!0}],defaultParams:["tag"],renderer:h}),m({type:"math",addStrategy:function(e,t){const a=e.length;if(a>0){if("math"===e[a-1].def.type)return void(e[a-1]=t);if(a>1&&"math"===e[a-2].def.type)return void(e[a-2]=t);if("alias"===e[a-1].def.type)return void e.splice(a-1,0,t)}e.push(t)},category:u.Math,params:[{name:"expr",type:"string"}],defaultParams:[" / 100"],renderer:l.d}),m({type:"alias",addStrategy:function(e,t){const a=e.length;a>0&&"alias"===e[a-1].def.type?e[a-1]=t:e.push(t)},category:u.Aliasing,params:[{name:"name",type:"string",quote:"double"}],defaultParams:["alias"],renderMode:"suffix",renderer:function(e,t){return t+' AS "'+e.params[0]+'"'}});var b={create:d,getCategories:()=>u,replaceAggregationAdd:g},j=a("PbtU");class v{constructor(e,t,a){this.target=void 0,this.selectModels=void 0,this.queryBuilder=void 0,this.groupByParts=void 0,this.templateSrv=void 0,this.scopedVars=void 0,this.refId=void 0,this.target=e,this.templateSrv=t,this.scopedVars=a,e.policy=e.policy||"default",e.resultFormat=e.resultFormat||"time_series",e.orderByTime=e.orderByTime||"ASC",e.tags=e.tags||[],e.groupBy=e.groupBy||[{type:"time",params:["$__interval"]},{type:"fill",params:["null"]}],e.select=e.select||[[{type:"field",params:["value"]},{type:"mean",params:[]}]],this.updateProjection()}updateProjection(){this.selectModels=Object(r.map)(this.target.select,e=>Object(r.map)(e,b.create)),this.groupByParts=Object(r.map)(this.target.groupBy,b.create)}updatePersistedParts(){this.target.select=Object(r.map)(this.selectModels,e=>Object(r.map)(e,e=>({type:e.def.type,params:e.params})))}hasGroupByTime(){return Object(r.find)(this.target.groupBy,e=>"time"===e.type)}hasFill(){return Object(r.find)(this.target.groupBy,e=>"fill"===e.type)}addGroupBy(e){let t=e.match(/^(\w+)\((.*)\)$/);if(!t||!this.target.groupBy)return;const a=t[1],r=t[2],s=b.create({type:a,params:[r]}),n=this.target.groupBy.length;0===n?this.target.groupBy.push(s.part):"time"===a?this.target.groupBy.splice(0,0,s.part):"tag"===a&&"fill"===this.target.groupBy[n-1].type?this.target.groupBy.splice(n-1,0,s.part):this.target.groupBy.push(s.part),this.updateProjection()}removeGroupByPart(e,t){const a=b.getCategories();"time"===e.def.type&&(this.target.groupBy=Object(r.filter)(this.target.groupBy,e=>"fill"!==e.type),this.target.select=Object(r.map)(this.target.select,e=>Object(r.filter)(e,e=>{const t=b.create(e);return t.def.category!==a.Aggregations&&t.def.category!==a.Selectors}))),this.target.groupBy.splice(t,1),this.updateProjection()}removeSelect(e){this.target.select.splice(e,1),this.updateProjection()}removeSelectPart(e,t){if("field"===t.def.type){if(this.selectModels.length>1){const t=Object(r.indexOf)(this.selectModels,e);this.selectModels.splice(t,1)}}else{const a=Object(r.indexOf)(e,t);e.splice(a,1)}this.updatePersistedParts()}addSelectPart(e,t){const a=b.create({type:t});a.def.addStrategy(e,a,this),this.updatePersistedParts()}renderTagCondition(e,t,a){let r="",s=e.operator,n=e.value;return t>0&&(r=(e.condition||"AND")+" "),s||(s=/^\/.*\/$/.test(n)?"=~":"="),"=~"!==s&&"!~"!==s?(a&&(n=this.templateSrv.replace(n,this.scopedVars)),">"!==s&&"<"!==s&&(n="'"+n.replace(/\\/g,"\\\\").replace(/\'/g,"\\'")+"'")):a&&(n=this.templateSrv.replace(n,this.scopedVars,"regex")),r+'"'+e.key+'" '+s+" "+n}getMeasurementAndPolicy(e){let t=this.target.policy,a=this.target.measurement||"measurement";return a.match("^/.*/$")?e&&(a=this.templateSrv.replace(a,this.scopedVars,"regex")):a='"'+a+'"',t="default"!==t?'"'+this.target.policy+'".':"",t+a}interpolateQueryStr(e,t,a){if(!t.multi&&!t.includeAll)return e;if("string"==typeof e)return j.a.regexEscape(e);return"("+Object(r.map)(e,j.a.regexEscape).join("|")+")"}render(e){const t=this.target;if(t.rawQuery)return e?this.templateSrv.replace(t.query,this.scopedVars,this.interpolateQueryStr):t.query;let a,s,n="SELECT ";for(a=0;a<this.selectModels.length;a++){const e=this.selectModels[a];let t="";for(s=0;s<e.length;s++){t=e[s].render(t)}a>0&&(n+=", "),n+=t}n+=" FROM "+this.getMeasurementAndPolicy(e)+" WHERE ";const i=Object(r.map)(t.tags,(t,a)=>this.renderTagCondition(t,a,e));i.length>0&&(n+="("+i.join(" ")+") AND "),n+="$timeFilter";let o="";for(a=0;a<this.groupByParts.length;a++){const e=this.groupByParts[a];a>0&&(o+="fill"===e.def.type?" ":", "),o+=e.render("")}return o.length&&(n+=" GROUP BY "+o),t.fill&&(n+=" fill("+t.fill+")"),"DESC"===t.orderByTime&&(n+=" ORDER BY time DESC"),t.limit&&(n+=" LIMIT "+t.limit),t.slimit&&(n+=" SLIMIT "+t.slimit),t.tz&&(n+=" tz('"+t.tz+"')"),n}renderAdhocFilters(e){return Object(r.map)(e,(e,t)=>this.renderTagCondition(e,t,!0)).join(" ")}}v.$inject=["target","templateSrv","scopedVars"];class y{parse(e,t){if(null==t||!t.results||0===t.results.length)return[];const a=t.results[0];if(!a.series)return[];const s=e.toLowerCase(),n=s.indexOf("show field keys")>=0||s.indexOf("show retention policies")>=0,i=new Set;return Object(r.each)(a.series,e=>{Object(r.each)(e.values,e=>{Object(r.isArray)(e)?n?O(i,e[0]):void 0!==e[1]?O(i,e[1]):O(i,e[0]):O(i,e)})}),Array.from(i).map(e=>({text:e}))}}function O(e,t){e.add(t.toString())}class x{constructor(e,t){this.target=e,this.database=t}buildExploreQuery(e,t,a){let s,n,i="";if("TAG_KEYS"===e)i="SHOW TAG KEYS",s=this.target.measurement,n=this.target.policy;else if("TAG_VALUES"===e)i="SHOW TAG VALUES",s=this.target.measurement,n=this.target.policy;else if("MEASUREMENTS"===e)i="SHOW MEASUREMENTS",a&&(i+=" WITH MEASUREMENT =~ /(?i)"+j.a.regexEscape(a)+"/");else{if("FIELDS"===e)return s=this.target.measurement,n=this.target.policy,s.match("^/.*/")||(s='"'+s+'"',n&&"default"!==n&&(n='"'+n+'"',s=n+"."+s)),"SHOW FIELD KEYS FROM "+s;if("RETENTION POLICIES"===e)return i='SHOW RETENTION POLICIES on "'+this.database+'"',i}if(s&&(s.match("^/.*/")||s.match(/^merge\(.*\)/)||(s='"'+s+'"'),n&&"default"!==n&&(n='"'+n+'"',s=n+"."+s),i+=" FROM "+s),t&&(i+=' WITH KEY = "'+t+'"'),this.target.tags&&this.target.tags.length>0){const e=Object(r.reduce)(this.target.tags,(e,a)=>(a.key===t||">"===a.operator||"<"===a.operator||e.push(function(e,t){let a="",r=e.operator,s=e.value;return t>0&&(a=(e.condition||"AND")+" "),r||(r=/^\/.*\/$/.test(e.value)?"=~":"="),(""===s||"=~"!==r&&"!~"!==r&&isNaN(+s))&&(s="'"+s+"'"),a+'"'+e.key+'" '+r+" "+s}(a,e.length)),e),[]);e.length>0&&(i+=" WHERE "+e.join(" "))}return"MEASUREMENTS"===e&&(i+=" LIMIT 100"),i}}let w;!function(e){e.InfluxQL="InfluxQL",e.Flux="Flux"}(w||(w={}));var S,C,P,T=a("5kRJ"),N=a("t8hP"),E=a("F/XL"),I=a("XlPw"),F=a("q1tI"),D=a.n(F),k=a("vF1F"),R=a("kDLi"),A=a("nKUr");function B(){return(B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const q=[{label:"Show buckets",description:"List the available buckets (table)",value:"buckets()"},{label:"Simple query",description:"filter by measurement and field",value:'from(bucket: "db/rp")\n  |> range(start: v.timeRangeStart, stop:v.timeRangeStop)\n  |> filter(fn: (r) =>\n    r._measurement == "example-measurement" and\n    r._field == "example-field"\n  )'},{label:"Grouped Query",description:"Group by (min/max/sum/median)",value:'// v.windowPeriod is a variable referring to the current optimized window period (currently: $interval)\nfrom(bucket: v.bucket)\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r["_measurement"] == "measurement1" or r["_measurement"] =~ /^.*?regex.*$/)\n  |> filter(fn: (r) => r["_field"] == "field2" or r["_field"] =~ /^.*?regex.*$/)\n  |> aggregateWindow(every: v.windowPeriod, fn: mean|median|max|count|derivative|sum)\n  |> yield(name: "some-name")'},{label:"Filter by value",description:"Results between a min/max",value:'// v.bucket, v.timeRangeStart, and v.timeRange stop are all variables supported by the flux plugin and influxdb\nfrom(bucket: v.bucket)\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r["_value"] >= 10 and r["_value"] <= 20)'},{label:"Schema Exploration: (measurements)",description:"Get a list of measurement using flux",value:'import "influxdata/influxdb/v1"\nv1.measurements(bucket: v.bucket)'},{label:"Schema Exploration: (fields)",description:"Return every possible key in a single table",value:'from(bucket: v.bucket)\n  |> range(start: v.timeRangeStart, stop:v.timeRangeStop)\n  |> keys()\n  |> keep(columns: ["_value"])\n  |> group()\n  |> distinct()'},{label:"Schema Exploration: (tag keys)",description:"Get a list of tag keys using flux",value:'import "influxdata/influxdb/v1"\nv1.tagKeys(bucket: v.bucket)'},{label:"Schema Exploration: (tag values)",description:"Get a list of tag values using flux",value:'import "influxdata/influxdb/v1"\nv1.tagValues(\n    bucket: v.bucket,\n    tag: "host",\n    predicate: (r) => true,\n    start: -1d\n)'}];class M extends F.PureComponent{constructor(...e){super(...e),this.onFluxQueryChange=e=>{this.props.onChange(B({},this.props.query,{query:e})),this.props.onRunQuery()},this.onSampleChange=e=>{this.props.onChange(B({},this.props.query,{query:e.value})),this.forceUpdate(),this.props.onRunQuery()},this.getSuggestions=()=>{const e=[{label:"v.timeRangeStart",kind:R.CodeEditorSuggestionItemKind.Property,detail:"The start time"},{label:"v.timeRangeStop",kind:R.CodeEditorSuggestionItemKind.Property,detail:"The stop time"},{label:"v.windowPeriod",kind:R.CodeEditorSuggestionItemKind.Property,detail:"based on max data points"},{label:"v.defaultBucket",kind:R.CodeEditorSuggestionItemKind.Property,detail:"bucket configured in the datsource"},{label:"v.organization",kind:R.CodeEditorSuggestionItemKind.Property,detail:"org configured for the datsource"}],t=Object(N.getTemplateSrv)();return t.getVariables().forEach(a=>{const r="${"+a.name+"}";let s=t.replace(r);s===r&&(s=""),e.push({label:r,kind:R.CodeEditorSuggestionItemKind.Text,detail:"(Template Variable) "+s})}),e},this.editorDidMountCallbackHack=e=>{setTimeout(()=>e.layout(),100)}}render(){const{query:e}=this.props,t=S||(S=Object(A.jsxs)("div",{children:["Type: ",Object(A.jsx)("i",{children:"ctrl+space"})," to show template variable suggestions ",Object(A.jsx)("br",{}),"Many queries can be copied from chronograph"]}));return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(R.CodeEditor,{height:"200px",language:"sql",value:e.query||"",onBlur:this.onFluxQueryChange,onSave:this.onFluxQueryChange,showMiniMap:!1,showLineNumbers:!0,getSuggestions:this.getSuggestions,onEditorDidMount:this.editorDidMountCallbackHack}),Object(A.jsxs)("div",{className:Object(k.cx)("gf-form-inline",k.css`
              margin-top: 6px;
            `),children:[C||(C=Object(A.jsx)(R.LinkButton,{icon:"external-link-alt",variant:"secondary",target:"blank",href:"https://docs.influxdata.com/influxdb/latest/query-data/get-started/",children:"Flux language syntax"})),Object(A.jsx)(R.Segment,{options:q,value:"Sample Query",onChange:this.onSampleChange}),P||(P=Object(A.jsx)("div",{className:"gf-form gf-form--grow",children:Object(A.jsx)("div",{className:"gf-form-label gf-form-label--grow"})})),Object(A.jsx)(R.InlineFormLabel,{width:5,tooltip:t,children:"Help"})]})]})}}var L=a("67Y/"),Q=a("9Z1F");function _(){return(_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}class V extends N.DataSourceWithBackend{constructor(e,t=Object(T.a)()){var a,r,s;super(e),this.type=void 0,this.urls=void 0,this.username=void 0,this.password=void 0,this.name=void 0,this.database=void 0,this.basicAuth=void 0,this.withCredentials=void 0,this.interval=void 0,this.responseParser=void 0,this.httpMode=void 0,this.isFlux=void 0,this.templateSrv=t,this.type="influxdb",this.urls=(null!==(a=e.url)&&void 0!==a?a:"").split(",").map(e=>e.trim()),this.username=null!==(r=e.username)&&void 0!==r?r:"",this.password=null!==(s=e.password)&&void 0!==s?s:"",this.name=e.name,this.database=e.database,this.basicAuth=e.basicAuth,this.withCredentials=e.withCredentials;const n=e.jsonData||{};this.interval=n.timeInterval,this.httpMode=n.httpMode||"GET",this.responseParser=new y,this.isFlux=n.version===w.Flux,this.isFlux&&(this.annotations={QueryEditor:M})}query(e){if(this.isFlux){const t=_({},e,{targets:e.targets.filter(e=>!0!==e.hide)});return super.query(t)}return this.classicQuery(e)}getQueryDisplayText(e){return this.isFlux?e.query:new v(e).render(!1)}filterQuery(e){return!this.isFlux||!!e.query}applyTemplateVariables(e,t){var a;return _({},e,{query:this.templateSrv.replace(null!==(a=e.query)&&void 0!==a?a:"",t)})}classicQuery(e){let t=this.getTimeFilter(e);const a=e.scopedVars,s=Object(r.cloneDeep)(e.targets),n=[];let i,l,c=Object(r.map)(s,e=>e.hide?"":(n.push(e),a.interval=a.__interval,new v(e,this.templateSrv,a).render(!0))).reduce((e,t)=>(""!==t&&(e+=";"+t),e));if(""===c)return Object(E.a)({data:[]});const u=this.templateSrv.getAdhocFilters(this.name);if(u.length>0){t+=" AND "+new v({refId:"A"},this.templateSrv,a).renderAdhocFilters(u)}return a.timeFilter={value:t},c=this.templateSrv.replace(c,a),this._seriesQuery(c,e).pipe(Object(L.a)(t=>{if(!t||!t.results)return{data:[]};const a=[];for(i=0;i<t.results.length;i++){const r=t.results[i];if(!r||!r.series)continue;const s=n[i];let c=s.alias;c&&(c=this.templateSrv.replace(s.alias,e.scopedVars));const u={executedQueryString:t.executedQueryString},d=new o({refId:s.refId,series:t.results[i].series,alias:c,meta:u});switch(s.resultFormat){case"logs":u.preferredVisualisationType="logs";case"table":a.push(d.getTable());break;default:{const e=d.getTimeSeries();for(l=0;l<e.length;l++)a.push(e[l]);break}}}return{data:a}}))}async annotationQuery(e){if(this.isFlux)return Promise.reject({message:"Flux requires the standard annotation query"});if(!e.annotation.query)return Promise.reject({message:"Query missing in annotation definition"});const t=this.getTimeFilter({rangeRaw:e.rangeRaw,timezone:e.dashboard.timezone});let a=e.annotation.query.replace("$timeFilter",t);return a=this.templateSrv.replace(a,void 0,"regex"),this._seriesQuery(a,e).toPromise().then(t=>{if(!t||!t.results||!t.results[0])throw{message:"No results in response from InfluxDB"};return new o({series:t.results[0].series,annotation:e.annotation}).getAnnotations()})}targetContainsTemplate(e){for(const t of e.groupBy)for(const e of t.params)if(this.templateSrv.variableExists(e))return!0;for(const t in e.tags)if(this.templateSrv.variableExists(e.tags[t].value))return!0;return!1}interpolateVariablesInQueries(e,t){if(!e||0===e.length)return[];let a=e;return e&&e.length>0&&(a=e.map(e=>{var a,r;const s=_({},e,{datasource:this.name,measurement:this.templateSrv.replace(null!==(a=e.measurement)&&void 0!==a?a:"",t,"regex"),policy:this.templateSrv.replace(null!==(r=e.policy)&&void 0!==r?r:"",t,"regex")});var n;e.rawQuery&&(s.query=this.templateSrv.replace(null!==(n=e.query)&&void 0!==n?n:"",t,"regex"));return e.tags&&(s.tags=e.tags.map(e=>_({},e,{value:this.templateSrv.replace(e.value,void 0,"regex")}))),s})),a}async metricFindQuery(e,t){if(this.isFlux){const a={refId:"metricFindQuery",query:e};return super.query(_({},t,{targets:[a]})).toPromise().then(e=>{var t;return null!==(t=e.data)&&void 0!==t&&t.length?Object(N.frameToMetricFindValue)(e.data[0]):[]})}const a=this.templateSrv.replace(e,void 0,"regex");return this._seriesQuery(a,t).toPromise().then(t=>this.responseParser.parse(e,t))}getTagKeys(e={}){const t=new x({measurement:e.measurement||"",tags:[]},this.database).buildExploreQuery("TAG_KEYS");return this.metricFindQuery(t,e)}getTagValues(e={}){const t=new x({measurement:e.measurement||"",tags:[]},this.database).buildExploreQuery("TAG_VALUES",e.key);return this.metricFindQuery(t,e)}_seriesQuery(e,t){if(!e)return Object(E.a)({results:[]});if(t&&t.range){const a=this.getTimeFilter({rangeRaw:t.range,timezone:t.timezone});e=e.replace("$timeFilter",a)}return this._influxRequest(this.httpMode,"/query",{q:e,epoch:"ms"},t)}serializeParams(e){return e?Object(r.reduce)(e,(e,t,a)=>(null==t||e.push(encodeURIComponent(a)+"="+encodeURIComponent(t)),e),[]).join("&"):""}testDatasource(){if(this.isFlux){const e={targets:[{refId:"test",query:"buckets()"}],requestId:`${this.id}-health-${Object(n.a)()}`,dashboardId:0,panelId:0,interval:"1m",intervalMs:6e4,maxDataPoints:423,range:{from:Object(s.dateTime)(1e3),to:Object(s.dateTime)(2e3)}};return super.query(e).toPromise().then(e=>{if(!e||!e.data||e.state!==s.LoadingState.Done)return console.error("InfluxDB Error",e),{status:"error",message:"Error reading InfluxDB"};const t=e.data[0];return t&&t.length?{status:"success",message:t.length+" buckets found"}:(console.error("InfluxDB Error",e),{status:"error",message:"Error reading buckets"})}).catch(e=>(console.error("InfluxDB Error",e),{status:"error",message:e.message}))}const e=new x({measurement:"",tags:[]},this.database).buildExploreQuery("RETENTION POLICIES");return this._seriesQuery(e).toPromise().then(e=>{const t=Object(r.get)(e,"results[0].error");return t?{status:"error",message:t}:{status:"success",message:"Data source is working"}}).catch(e=>({status:"error",message:e.message}))}_influxRequest(e,t,a,s){const n=this.urls.shift();this.urls.push(n);const i={};this.username&&(i.u=this.username,i.p=this.password),s&&s.database?i.db=s.database:this.database&&(i.db=this.database);const{q:o}=a;"POST"===e&&Object(r.has)(a,"q")?(Object(r.extend)(i,Object(r.omit)(a,["q"])),a=this.serializeParams(Object(r.pick)(a,["q"]))):"GET"!==e&&"POST"!==e||(Object(r.extend)(i,a),a=null);const l={method:e,url:n+t,params:i,data:a,precision:"ms",inspect:{type:"influxdb"},paramSerializer:this.serializeParams};return l.headers=l.headers||{},(this.basicAuth||this.withCredentials)&&(l.withCredentials=!0),this.basicAuth&&(l.headers.Authorization=this.basicAuth),"POST"===e&&(l.headers["Content-type"]="application/x-www-form-urlencoded"),Object(N.getBackendSrv)().fetch(l).pipe(Object(L.a)(e=>{const{data:t}=e;if(t&&(t.executedQueryString=o,t.results)){const a=e.data.results.filter(e=>e.error);if(a.length>0)throw{message:"InfluxDB Error: "+a[0].error,data:t}}return t}),Object(Q.a)(e=>e.cancelled?Object(E.a)(e):Object(I.a)(this.handleErrors(e))))}handleErrors(e){const t={message:e&&e.status||e&&e.message||"Unknown error during query transaction. Please check JS console logs."};return(Number.isInteger(e.status)&&0!==e.status||e.status>=300)&&(e.data&&e.data.error?(t.message="InfluxDB Error: "+e.data.error,t.data=e.data,t.config=e.config):(t.message="Network Error: "+e.statusText+"("+e.status+")",t.data=e.data,t.config=e.config)),t}getTimeFilter(e){return"time >= "+this.getInfluxTime(e.rangeRaw.from,!1,e.timezone)+" and time <= "+this.getInfluxTime(e.rangeRaw.to,!0,e.timezone)}getInfluxTime(e,t,a){if(Object(r.isString)(e)){if("now"===e)return"now()";const r=/^now-(\d+)([dhms])$/.exec(e);if(r){return"now() - "+parseInt(r[1],10)+r[2]}e=s.dateMath.parse(e,t,a)}return e.valueOf()+"ms"}}var G=a("tLXD");function U(e){const[t,a]=Object(F.useState)(e),r=Object(G.a)(e);return Object(F.useEffect)(()=>{r!==e&&t!==e&&a(e)},[e,t,r]),[t,a]}function $(){const e=Object(F.useRef)(null);return null==e.current&&(e.current=Object(r.uniqueId)()),e.current}const z=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"},{label:"Logs",value:"logs"}];function W(){return(W=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const H=({query:e,onChange:t,onRunQuery:a})=>{var r;const[s,n]=U(e.query),[i,o]=U(e.alias),l=$(),c=$(),u=()=>{t(W({},e,{query:s,alias:i})),a()};return Object(A.jsxs)("div",{children:[Object(A.jsx)(R.TextArea,{"aria-label":"query",rows:3,spellCheck:!1,placeholder:"InfluxDB Query",onBlur:u,onChange:e=>{n(e.currentTarget.value)},value:null!=s?s:""}),Object(A.jsxs)(R.HorizontalGroup,{children:[Object(A.jsx)(R.InlineFormLabel,{htmlFor:c,children:"Format as"}),Object(A.jsx)(R.Select,{inputId:c,onChange:r=>{t(W({},e,{resultFormat:r.value})),a()},value:null!==(r=e.resultFormat)&&void 0!==r?r:"time_series",options:z}),Object(A.jsx)(R.InlineFormLabel,{htmlFor:l,children:"Alias by"}),Object(A.jsx)(R.Input,{id:l,type:"text",spellCheck:!1,placeholder:"Naming pattern",onBlur:u,onChange:e=>{o(e.currentTarget.value)},value:null!=i?i:""})]})]})};var K=a("NluS"),J=a.n(K),Y=a("Kwub");const X=Object(k.css)({minWidth:"160px"}),Z=e=>e,ee=({loadOptions:e,allowCustomValue:t,onChange:a,onClose:r})=>{const s=J()(e,1e3,{leading:!0});return Object(A.jsx)("div",{className:X,children:Object(A.jsx)(R.AsyncSelect,{formatCreateLabel:Z,defaultOptions:!0,autoFocus:!0,isOpen:!0,onCloseMenu:r,allowCustomValue:t,loadOptions:s,onChange:a})})},te=({loadOptions:e,allowCustomValue:t,onChange:a,onClose:r})=>{var s;const[n,i]=Object(Y.a)(e,[e]);return Object(F.useEffect)(()=>{i()},[i,e]),Object(A.jsx)("div",{className:X,children:Object(A.jsx)(R.Select,{isLoading:n.loading,formatCreateLabel:Z,autoFocus:!0,isOpen:!0,onCloseMenu:r,allowCustomValue:t,options:null!==(s=n.value)&&void 0!==s?s:[],onChange:a})})},ae=({loadOptions:e,filterByLoadOptions:t,allowCustomValue:a,onChange:r,onClose:s})=>t?Object(A.jsx)(ee,{loadOptions:e,allowCustomValue:a,onChange:r,onClose:s}):Object(A.jsx)(te,{loadOptions:e,allowCustomValue:a,onChange:r,onClose:s}),re=({initialValue:e,onChange:t,onClose:a})=>{const[r,s]=U(e);return Object(A.jsx)(R.Input,{autoFocus:!0,type:"text",spellCheck:!1,onBlur:a,onKeyDown:e=>{"Enter"===e.key&&t(r)},onChange:e=>{s(e.currentTarget.value)},value:r})},se=Object(k.css)({width:"auto",cursor:"pointer"}),ne=({value:e,buttonClassName:t,loadOptions:a,filterByLoadOptions:r,allowCustomValue:s,onChange:n})=>{const[i,o]=Object(F.useState)(!1);if(i)return void 0!==a?Object(A.jsx)(ae,{loadOptions:a,filterByLoadOptions:null!=r&&r,allowCustomValue:s,onChange:e=>{o(!1),n(e)},onClose:()=>{o(!1)}}):Object(A.jsx)(re,{initialValue:e,onClose:()=>{o(!1)},onChange:e=>{o(!1),n({value:e,label:e})}});{const a=Object(k.cx)(se,t);return Object(A.jsx)(R.InlineLabel,{as:"button",className:a,onClick:()=>{o(!0)},children:e})}};function ie(e){return{label:e,value:e}}const oe=({policy:e,measurement:t,onChange:a,getPolicyOptions:r,getMeasurementOptions:s})=>Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(ne,{allowCustomValue:!0,value:null!=e?e:"using default policy",loadOptions:async()=>{const e=await r();return(e.some(e=>"default"===e)?e:["default",e]).map(ie)},onChange:e=>{a(e.value,t)}}),Object(A.jsx)(ne,{allowCustomValue:!0,value:null!=t?t:"select measurement",loadOptions:async e=>(await s(e)).map(ie),filterByLoadOptions:!0,onChange:t=>{a(e,t.value)}})]});function le(e){return/^\/.*\/$/.test(e)}function ce(e){var t;return null!==(t=e.operator)&&void 0!==t?t:le(e.value)?"=~":"="}function ue(e,t){var a;return t?void 0:null!==(a=e.condition)&&void 0!==a?a:"AND"}function de(e,t){const a="=~"===e||"!~"===e;return le(t)?a?e:"=~":a?"=":e}function me(e){if(null==e)throw new Error("value must not be nullish");return e}const pe=({loadOptions:e,allowCustomValue:t,onAdd:a})=>Object(A.jsx)(ne,{value:"+",loadOptions:e,allowCustomValue:t,onChange:e=>{a(me(e.value))}});function he(){return(he=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const ge=["=","!=","<>","<",">","=~","!~"].map(ie),fe=["AND","OR"].map(ie),be=()=>Promise.resolve(fe),je=()=>Promise.resolve(ge),ve=({tag:e,isFirst:t,onRemove:a,onChange:r,getTagKeyOptions:s,getTagValueOptions:n})=>{const i=ce(e),o=ue(e,t);return Object(A.jsxs)("div",{className:"gf-form",children:[null!=o&&Object(A.jsx)(ne,{value:o,loadOptions:be,onChange:t=>{r(he({},e,{condition:t.value}))}}),Object(A.jsx)(ne,{allowCustomValue:!0,value:e.key,loadOptions:()=>s().then(e=>[{label:"-- remove filter --",value:void 0},...e.map(ie)]),onChange:t=>{const{value:s}=t;void 0===s?a():r(he({},e,{key:null!=s?s:""}))}}),Object(A.jsx)(ne,{value:i,loadOptions:je,onChange:t=>{r(he({},e,{operator:t.value}))}}),Object(A.jsx)(ne,{allowCustomValue:!0,value:e.value,loadOptions:()=>n(e.key).then(e=>e.map(ie)),onChange:t=>{var a;const s=null!==(a=t.value)&&void 0!==a?a:"";r(he({},e,{value:s,operator:de(i,s)}))}})]})},ye=({tags:e,onChange:t,getTagKeyOptions:a,getTagValueOptions:r})=>Object(A.jsxs)(A.Fragment,{children:[e.map((s,n)=>Object(A.jsx)(ve,{tag:s,isFirst:0===n,onChange:a=>{((a,r)=>{const s=e.map((e,t)=>r===t?a:e);t(s)})(a,n)},onRemove:()=>{(a=>{const r=e.filter((e,t)=>t!==a);t(r)})(n)},getTagKeyOptions:a,getTagValueOptions:r},n)),Object(A.jsx)(pe,{allowCustomValue:!0,loadOptions:()=>a().then(e=>e.map(ie)),onAdd:a=>{((a,r)=>{const s={key:a,value:"select tag value"},n={key:s.key,value:s.value,operator:ce(s),condition:ue(s,r)};t([...e,n])})(a,0===e.length)}})]}),Oe=Object(k.css)({paddingRight:"0",marginRight:"0"}),xe=({name:e,onRemove:t})=>Object(A.jsx)(R.WithContextMenu,{renderMenuItems:()=>{return e=t,Object(A.jsx)(R.MenuGroup,{label:"",ariaLabel:"",children:Object(A.jsx)(R.MenuItem,{label:"remove",ariaLabel:"remove",onClick:e})});var e},children:({openMenu:t})=>Object(A.jsx)("button",{className:Object(k.cx)("gf-form-label",Oe),onClick:t,children:e})}),we=Object(k.css)({paddingLeft:"0",paddingRight:"0",marginLeft:"0",marginRight:"0"}),Se=({name:e,params:t,onChange:a,onRemove:r})=>{const s=Object(R.useTheme2)(),n=Object(F.useMemo)(()=>(e=>Object(k.cx)("gf-form-label",Object(k.css)({paddingLeft:"0",lineHeight:e.typography.body.lineHeight,fontSize:e.typography.body.fontSize})))(s),[s]);return Object(A.jsxs)("div",{className:n,children:[Object(A.jsx)(xe,{name:e,onRemove:r}),"(",t.map((e,r)=>{const{value:s,options:n}=e,i=r===t.length-1,o=null!==n?()=>n().then(e=>e.map(ie)):void 0;return Object(A.jsxs)(D.a.Fragment,{children:[Object(A.jsx)(ne,{allowCustomValue:!0,value:s,buttonClassName:we,loadOptions:o,onChange:e=>{((e,r)=>{const s=t.map(e=>e.value);s[r]=e,a(s)})(me(e.value),r)}}),!i&&","]},r)}),")"]})},Ce=({parts:e,getNewPartOptions:t,onAddNewPart:a,onRemovePart:r,onChange:s})=>Object(A.jsxs)(A.Fragment,{children:[e.map((e,t)=>Object(A.jsx)(Se,{name:e.name,params:e.params,onRemove:()=>{r(t)},onChange:e=>{s(t,e)}},t)),Object(A.jsx)(pe,{loadOptions:t,onAdd:a})]}),Pe=Object(k.css)({paddingRight:"4px"}),Te=[{label:"ascending",value:"ASC"},{label:"descending",value:"DESC"}],Ne=Object(k.cx)("width-9",Pe),Ee=({value:e,onChange:t})=>Object(A.jsx)(A.Fragment,{children:Object(A.jsx)(R.Select,{className:Ne,onChange:e=>{t(me(e.value))},value:e,options:Te})}),Ie=({value:e,onChange:t,isWide:a,placeholder:r})=>{const[s,n]=U(e);return Object(A.jsx)(A.Fragment,{children:Object(A.jsx)(R.Input,{placeholder:r,className:Object(k.cx)(null!=a&&a?"width-14":"width-8",Pe),type:"text",spellCheck:!1,onBlur:()=>{t(""===s?void 0:s)},onChange:e=>{n(e.currentTarget.value)},value:null!=s?s:""})})},Fe=(e,t,a,r,s)=>{const n=new x(r,s.database).buildExploreQuery(e,t,a);return s.metricFindQuery(n)};function De(){return(De=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ke(e){const t=Object(r.cloneDeep)(e);return new v(t).render(!1)}const Re=Object(k.cx)("width-8",Pe),Ae=({format:e,onChange:t})=>Object(A.jsx)(R.Select,{className:Re,onChange:e=>{t(me(e.value))},value:e,options:z}),Be=Object(k.css)({textTransform:"uppercase"}),qe=({name:e,isInitial:t})=>Object(A.jsx)("label",{className:Object(k.cx)("gf-form-label query-keyword",{"width-7":null!=t&&t},Be),children:e});var Me;const Le=()=>Me||(Me=Object(A.jsx)("div",{className:"gf-form gf-form--grow",children:Object(A.jsx)("label",{className:"gf-form-label gf-form-label--grow"})}));function Qe(){return(Qe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function _e(e,t){var a;const r=b.create(e).def,s=(null!==(a=e.params)&&void 0!==a?a:[]).map(e=>e.toString());if(s.length!==r.params.length)throw new Error("Invalid query-segment");return s.map((e,a)=>{const s=r.params[a];return s.dynamicLookup?{value:e,options:me(t.get(`${r.type}_${a}`))}:null!=s.options?{value:e,options:()=>Promise.resolve(s.options)}:{value:e,options:null}})}function Ve(e,t){return e.map(e=>({name:e.type,params:_e(e,t)}))}var Ge,Ue,$e,ze,We;function He(){return(He=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ke(e){return e.then(e=>[...Object(N.getTemplateSrv)().getVariables().map(e=>`/^$${e.name}$/`),...e])}const Je=({initialName:e,children:t})=>Object(A.jsxs)("div",{className:"gf-form-inline",children:[Object(A.jsx)(qe,{name:e,isInitial:!0}),t,Ge||(Ge=Object(A.jsx)(Le,{}))]}),Ye=e=>{var t,a,s,n;const i=function(e){if(void 0!==e.policy&&void 0!==e.resultFormat&&void 0!==e.orderByTime&&void 0!==e.tags&&void 0!==e.groupBy&&void 0!==e.select)return e;const t=Object(r.cloneDeep)(e);return new v(t).target}(e.query),{datasource:o}=e,{measurement:l,policy:c}=i,u=Object(F.useMemo)(()=>{var e;const t=new Map([["field_0",()=>void 0!==l?async function(e,t,a){const r={tags:[],measurement:e,policy:t};return(await Fe("FIELDS",void 0,void 0,r,a)).map(e=>e.text)}(l,c,o):Promise.resolve([])]]);return(null!==(e=i.select)&&void 0!==e?e:[]).map(e=>Ve(e,t))},[l,c,i.select,o]),d=Object(F.useMemo)(()=>()=>{var e;return async function(e,t,a,r){const s={tags:a,measurement:e,policy:t};return(await Fe("TAG_KEYS",void 0,void 0,s,r)).map(e=>e.text)}(l,c,null!==(e=i.tags)&&void 0!==e?e:[],o)},[l,c,i.tags,o]),m=Object(F.useMemo)(()=>{var e;const t=new Map([["tag_0",d]]);return Ve(null!==(e=i.groupBy)&&void 0!==e?e:[],t)},[d,i.groupBy]),p=t=>{e.onChange(t),e.onRunQuery()};return Object(A.jsxs)("div",{children:[Object(A.jsxs)(Je,{initialName:"from",children:[Object(A.jsx)(oe,{policy:c,measurement:l,getPolicyOptions:()=>async function(e){const t={tags:[],measurement:void 0,policy:void 0};return(await Fe("RETENTION POLICIES",void 0,void 0,t,e)).map(e=>e.text)}(o),getMeasurementOptions:e=>{var t;return Ke(async function(e,t,a){const r={tags:t,measurement:void 0,policy:void 0};return(await Fe("MEASUREMENTS",void 0,e,r,a)).map(e=>e.text)}(""===e?void 0:e,null!==(t=i.tags)&&void 0!==t?t:[],o))},onChange:(e,t)=>{p(He({},i,{policy:e,measurement:t}))}}),Ue||(Ue=Object(A.jsx)(qe,{name:"where"})),Object(A.jsx)(ye,{tags:null!==(t=i.tags)&&void 0!==t?t:[],onChange:e=>{p(He({},i,{tags:0===e.length?void 0:e}))},getTagKeyOptions:d,getTagValueOptions:e=>Ke(async function(e,t,a,r){const s={tags:[],measurement:t,policy:a};return(await Fe("TAG_VALUES",e,void 0,s,r)).map(e=>e.text)}(e,l,c,o))})]}),u.map((e,t)=>Object(A.jsx)(Je,{initialName:0===t?"select":"",children:Object(A.jsx)(Ce,{parts:e,getNewPartOptions:()=>Promise.resolve(function(){const e=b.getCategories(),t=[];return Object.keys(e).forEach(a=>{const r=e[a].map(e=>ie(e.type));t.push({label:a,options:r})}),t}()),onChange:(e,a)=>{const r=function(e,t,a,r){var s;const n=[...null!==(s=e.select)&&void 0!==s?s:[]];return n[t]=[...n[t]],n[t][a]=De({},n[t][a],{params:r}),De({},e,{select:n})}(i,t,e,a);p(r)},onAddNewPart:e=>{p(function(e,t,a){const s=Object(r.cloneDeep)(e),n=new v(s);return n.addSelectPart(n.selectModels[a],t),n.target}(i,e,t))},onRemovePart:e=>{p(function(e,t,a){const s=Object(r.cloneDeep)(e),n=new v(s),i=n.selectModels[a];return n.removeSelectPart(i,i[t]),n.target}(i,e,t))}})},t)),Object(A.jsx)(Je,{initialName:"group by",children:Object(A.jsx)(Ce,{parts:m,getNewPartOptions:()=>async function(e,t){const a=await t(),r=Qe({},e),s=new v(r),n=[];return s.hasFill()||n.push(ie("fill(null)")),s.hasGroupByTime()||n.push(ie("time($interval)")),a.forEach(e=>{n.push(ie(`tag(${e})`))}),n}(i,d),onChange:(e,t)=>{const a=function(e,t,a){var r;const s=[...null!==(r=e.groupBy)&&void 0!==r?r:[]];return s[t]=De({},s[t],{params:a}),De({},e,{groupBy:s})}(i,e,t);p(a)},onAddNewPart:e=>{p(function(e,t){const a=Object(r.cloneDeep)(e),s=new v(a);return s.addGroupBy(t),s.target}(i,e))},onRemovePart:e=>{p(function(e,t){const a=Object(r.cloneDeep)(e),s=new v(a);return s.removeGroupByPart(s.groupByParts[t],t),s.target}(i,e))}})}),Object(A.jsxs)(Je,{initialName:"timezone",children:[Object(A.jsx)(Ie,{placeholder:"(optional)",value:i.tz,onChange:e=>{p(He({},i,{tz:e}))}}),$e||($e=Object(A.jsx)(qe,{name:"order by time"})),Object(A.jsx)(Ee,{value:"DESC"===i.orderByTime?"DESC":"ASC",onChange:e=>{p(He({},i,{orderByTime:e}))}})]}),Object(A.jsxs)(Je,{initialName:"limit",children:[Object(A.jsx)(Ie,{placeholder:"(optional)",value:null===(a=i.limit)||void 0===a?void 0:a.toString(),onChange:e=>{p(He({},i,{limit:e}))}}),ze||(ze=Object(A.jsx)(qe,{name:"slimit"})),Object(A.jsx)(Ie,{placeholder:"(optional)",value:null===(s=i.slimit)||void 0===s?void 0:s.toString(),onChange:e=>{p(He({},i,{slimit:e}))}})]}),Object(A.jsxs)(Je,{initialName:"format as",children:[Object(A.jsx)(Ae,{format:null!==(n=i.resultFormat)&&void 0!==n?n:"time_series",onChange:e=>{p(He({},i,{resultFormat:e}))}}),"table"!==i.resultFormat&&Object(A.jsxs)(A.Fragment,{children:[We||(We=Object(A.jsx)(qe,{name:"alias"})),Object(A.jsx)(Ie,{isWide:!0,placeholder:"Naming pattern",value:i.alias,onChange:e=>{p(He({},i,{alias:e}))}})]})]})]})},Xe=({isRaw:e,onChange:t})=>{const[a,r]=Object(F.useState)(!1);return Object(F.useEffect)(()=>{r(!1)},[e]),e?Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(R.Button,{icon:"pen",variant:"secondary",type:"button",onClick:()=>{r(!0)}}),Object(A.jsx)(R.ConfirmModal,{isOpen:a,title:"Switch to visual editor mode",body:"Are you sure to switch to visual editor mode? You will loose the changes done in raw query mode.",confirmText:"Yes, switch to editor mode",dismissText:"No, stay in raw query mode",onConfirm:()=>{t(!1)},onDismiss:()=>{r(!1)}})]}):Object(A.jsx)(R.Button,{icon:"pen",variant:"secondary",type:"button",onClick:()=>{t(!0)}})};function Ze(){return(Ze=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var et;const tt=[{title:"Getting started",label:"Start by selecting a measurement and field from the dropdown above. You can then use the tag selector to further narrow your search."}];var at,rt,st,nt,it,ot,lt,ct,ut,dt,mt,pt,ht=e=>Object(A.jsxs)("div",{children:[et||(et=Object(A.jsx)("h2",{children:"InfluxDB Cheat Sheet"})),tt.map(e=>Object(A.jsxs)("div",{className:"cheat-sheet-item",children:[Object(A.jsx)("div",{className:"cheat-sheet-item__title",children:e.title}),Object(A.jsx)("div",{className:"cheat-sheet-item__label",children:e.label})]},e.title))]});class gt extends F.PureComponent{render(){return Object(A.jsx)(ht,{onClickExample:this.props.onClickExample})}}function ft(){return(ft=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const{Select:bt,Input:jt,SecretFormField:vt}=R.LegacyForms,yt=[{label:"GET",value:"GET"},{label:"POST",value:"POST"}],Ot=[{label:"InfluxQL",value:w.InfluxQL,description:"The InfluxDB SQL-like query language.  Supported in InfluxDB 1.x"},{label:"Flux",value:w.Flux,description:"Advanced data scripting and query language.  Supported in InfluxDB 2.x and 1.8+ (beta)"}];class xt extends F.PureComponent{constructor(e){var t;super(e),this.state={maxSeries:""},this.onResetPassword=()=>{Object(s.updateDatasourcePluginResetOption)(this.props,"password")},this.onResetToken=()=>{Object(s.updateDatasourcePluginResetOption)(this.props,"token")},this.onVersionChanged=e=>{const{options:t,onOptionsChange:a}=this.props,r=ft({},t,{jsonData:ft({},t.jsonData,{version:e.value})});e.value===w.Flux&&(r.access="proxy",r.basicAuth=!0,r.jsonData.httpMode="POST",delete r.user,delete r.database),a(r)},this.state.maxSeries=(null===(t=e.options.jsonData.maxSeries)||void 0===t?void 0:t.toString())||""}renderInflux2x(){const{options:e}=this.props,{secureJsonFields:t}=e,a=e.secureJsonData||{};return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)("div",{className:"gf-form-inline",children:Object(A.jsxs)("div",{className:"gf-form",children:[at||(at=Object(A.jsx)(R.InlineFormLabel,{className:"width-10",children:"Organization"})),Object(A.jsx)("div",{className:"width-10",children:Object(A.jsx)(jt,{className:"width-20",value:e.jsonData.organization||"",onChange:Object(s.onUpdateDatasourceJsonDataOption)(this.props,"organization")})})]})}),Object(A.jsx)("div",{className:"gf-form-inline",children:Object(A.jsx)("div",{className:"gf-form",children:Object(A.jsx)(vt,{isConfigured:t&&t.token,value:a.token||"",label:"Token",labelWidth:10,inputWidth:20,onReset:this.onResetToken,onChange:Object(s.onUpdateDatasourceSecureJsonDataOption)(this.props,"token")})})}),Object(A.jsx)("div",{className:"gf-form-inline",children:Object(A.jsxs)("div",{className:"gf-form",children:[rt||(rt=Object(A.jsx)(R.InlineFormLabel,{className:"width-10",children:"Default Bucket"})),Object(A.jsx)("div",{className:"width-10",children:Object(A.jsx)(jt,{className:"width-20",placeholder:"default bucket",value:e.jsonData.defaultBucket||"",onChange:Object(s.onUpdateDatasourceJsonDataOption)(this.props,"defaultBucket")})})]})}),Object(A.jsx)("div",{className:"gf-form-inline",children:Object(A.jsxs)("div",{className:"gf-form",children:[st||(st=Object(A.jsx)(R.InlineFormLabel,{className:"width-10",tooltip:"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example 1m if your data is written every minute.",children:"Min time interval"})),Object(A.jsx)("div",{className:"width-10",children:Object(A.jsx)(jt,{className:"width-10",placeholder:"10s",value:e.jsonData.timeInterval||"",onChange:Object(s.onUpdateDatasourceJsonDataOption)(this.props,"timeInterval")})})]})})]})}renderInflux1x(){const{options:e}=this.props,{secureJsonFields:t}=e,a=e.secureJsonData||{};return Object(A.jsxs)(A.Fragment,{children:[nt||(nt=Object(A.jsxs)(R.InfoBox,{children:[Object(A.jsx)("h5",{children:"Database Access"}),Object(A.jsxs)("p",{children:["Setting the database for this datasource does not deny access to other databases. The InfluxDB query syntax allows switching the database in the query. For example:",Object(A.jsx)("code",{children:"SHOW MEASUREMENTS ON _internal"})," or",Object(A.jsx)("code",{children:'SELECT * FROM "_internal".."database" LIMIT 10'}),Object(A.jsx)("br",{}),Object(A.jsx)("br",{}),"To support data isolation and security, make sure appropriate permissions are configured in InfluxDB."]})]})),Object(A.jsx)("div",{className:"gf-form-inline",children:Object(A.jsxs)("div",{className:"gf-form",children:[it||(it=Object(A.jsx)(R.InlineFormLabel,{className:"width-10",children:"Database"})),Object(A.jsx)("div",{className:"width-20",children:Object(A.jsx)(jt,{className:"width-20",value:e.database||"",onChange:Object(s.onUpdateDatasourceOption)(this.props,"database")})})]})}),Object(A.jsx)("div",{className:"gf-form-inline",children:Object(A.jsxs)("div",{className:"gf-form",children:[ot||(ot=Object(A.jsx)(R.InlineFormLabel,{className:"width-10",children:"User"})),Object(A.jsx)("div",{className:"width-10",children:Object(A.jsx)(jt,{className:"width-20",value:e.user||"",onChange:Object(s.onUpdateDatasourceOption)(this.props,"user")})})]})}),Object(A.jsx)("div",{className:"gf-form-inline",children:Object(A.jsx)("div",{className:"gf-form",children:Object(A.jsx)(vt,{isConfigured:t&&t.password,value:a.password||"",label:"Password",labelWidth:10,inputWidth:20,onReset:this.onResetPassword,onChange:Object(s.onUpdateDatasourceSecureJsonDataOption)(this.props,"password")})})}),Object(A.jsx)("div",{className:"gf-form-inline",children:Object(A.jsxs)("div",{className:"gf-form",children:[lt||(lt=Object(A.jsx)(R.InlineFormLabel,{className:"width-10",tooltip:"You can use either GET or POST HTTP method to query your InfluxDB database. The POST method allows you to perform heavy requests (with a lots of WHERE clause) while the GET method will restrict you and return an error if the query is too large.",children:"HTTP Method"})),Object(A.jsx)(bt,{className:"width-10",value:yt.find(t=>t.value===e.jsonData.httpMode),options:yt,defaultValue:e.jsonData.httpMode,onChange:Object(s.onUpdateDatasourceJsonDataOptionSelect)(this.props,"httpMode")})]})}),Object(A.jsx)("div",{className:"gf-form-inline",children:Object(A.jsxs)("div",{className:"gf-form",children:[ct||(ct=Object(A.jsx)(R.InlineFormLabel,{className:"width-10",tooltip:"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example 1m if your data is written every minute.",children:"Min time interval"})),Object(A.jsx)("div",{className:"width-10",children:Object(A.jsx)(jt,{className:"width-10",placeholder:"10s",value:e.jsonData.timeInterval||"",onChange:Object(s.onUpdateDatasourceJsonDataOption)(this.props,"timeInterval")})})]})})]})}render(){const{options:e,onOptionsChange:t}=this.props;return Object(A.jsxs)(A.Fragment,{children:[ut||(ut=Object(A.jsx)("h3",{className:"page-heading",children:"Query Language"})),Object(A.jsx)("div",{className:"gf-form-group",children:Object(A.jsx)("div",{className:"gf-form-inline",children:Object(A.jsx)("div",{className:"gf-form",children:Object(A.jsx)(bt,{className:"width-30",value:e.jsonData.version===w.Flux?Ot[1]:Ot[0],options:Ot,defaultValue:Ot[0],onChange:this.onVersionChanged})})})}),e.jsonData.version===w.Flux&&(dt||(dt=Object(A.jsxs)(R.InfoBox,{children:[Object(A.jsx)("h5",{children:"Support for Flux in Grafana is currently in beta"}),Object(A.jsxs)("p",{children:["Please report any issues to: ",Object(A.jsx)("br",{}),Object(A.jsx)("a",{href:"https://github.com/grafana/grafana/issues/new/choose",children:"https://github.com/grafana/grafana/issues"})]})]}))),"direct"===e.access&&(mt||(mt=Object(A.jsx)(R.Alert,{title:"Deprecation Notice",severity:"warning",children:"Browser access mode in the InfluxDB datasource is deprecated and will be removed in a future release."}))),Object(A.jsx)(R.DataSourceHttpSettings,{showAccessOptions:!0,dataSourceConfig:e,defaultUrl:"http://localhost:8086",onChange:t}),Object(A.jsxs)("div",{className:"gf-form-group",children:[pt||(pt=Object(A.jsx)("div",{children:Object(A.jsx)("h3",{className:"page-heading",children:"InfluxDB Details"})})),e.jsonData.version===w.Flux?this.renderInflux2x():this.renderInflux1x(),Object(A.jsx)("div",{className:"gf-form-inline",children:Object(A.jsx)(R.InlineField,{labelWidth:20,label:"Max series",tooltip:"Limit the number of series/tables that Grafana will process. Lower this number to prevent abuse, and increase it if you have lots of small time series and not all are shown. Defaults to 1000.",children:Object(A.jsx)(jt,{placeholder:"1000",type:"number",className:"width-10",value:this.state.maxSeries,onChange:e=>{this.setState({maxSeries:e.currentTarget.value});const t=parseInt(e.currentTarget.value,10);Object(s.updateDatasourcePluginJsonDataOption)(this.props,"maxSeries",Number.isFinite(t)?t:void 0)}})})})]})]})}}var wt,St=xt;class Ct extends F.PureComponent{constructor(...e){super(...e),this.onRefresh=()=>{}}render(){let{query:e,datasource:t,onChange:a}=this.props;return t.isFlux?Object(A.jsx)(M,{datasource:t,query:{refId:"A",query:e},onRunQuery:this.onRefresh,onChange:e=>a(e.query)}):Object(A.jsxs)("div",{className:"gf-form-inline",children:[wt||(wt=Object(A.jsx)(R.InlineFormLabel,{width:10,children:"Query"})),Object(A.jsx)("div",{className:"gf-form-inline gf-form--grow",children:Object(A.jsx)(R.TextArea,{defaultValue:e||"",placeholder:"metric name or tags query",rows:1,className:"gf-form-input",onBlur:e=>a(e.currentTarget.value)})})]})}}a.d(t,"plugin",(function(){return Tt}));class Pt{}Pt.templateUrl="partials/annotations.editor.html";const Tt=new s.DataSourcePlugin(V).setConfigEditor(St).setQueryEditor(({query:e,onChange:t,onRunQuery:a,datasource:r,range:s,data:n})=>{var i;return r.isFlux?Object(A.jsx)("div",{className:"gf-form-query-content",children:Object(A.jsx)(M,{query:e,onChange:t,onRunQuery:a,datasource:r})}):Object(A.jsxs)("div",{className:Object(k.css)({display:"flex"}),children:[Object(A.jsx)("div",{className:Object(k.css)({flexGrow:1}),children:e.rawQuery?Object(A.jsx)(H,{query:e,onChange:t,onRunQuery:a}):Object(A.jsx)(Ye,{query:e,onChange:t,onRunQuery:a,datasource:r})}),Object(A.jsx)(Xe,{isRaw:null!==(i=e.rawQuery)&&void 0!==i&&i,onChange:r=>{t(Ze({},e,{query:ke(e),rawQuery:r})),a()}})]})}).setAnnotationQueryCtrl(Pt).setVariableQueryEditor(Ct).setQueryEditorHelp(gt)},tLXD:function(e,t,a){"use strict";var r=a("q1tI");t.a=function(e){var t=Object(r.useRef)();return Object(r.useEffect)((function(){t.current=e})),t.current}}}]);
//# sourceMappingURL=influxdbPlugin.17511e2bf08b06f121f8.js.map