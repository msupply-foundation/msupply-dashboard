{"version":3,"file":"AlertingRuleForm.e65e3aa10981aa98e7a1.js","mappings":"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","sources":["webpack://grafana/./public/app/core/hooks/useCleanup.ts","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/RuleEditorSection.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/util.ts","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/GroupAndNamespaceFields.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/CloudRulesSourcePicker.tsx","webpack://grafana/./public/app/features/alerting/unified/hooks/useRuleSourcesWithRuler.ts","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/AlertTypeStep.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/DetailsStep.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/ExpressionEditor.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/VizWrapper.tsx","webpack://grafana/./public/app/features/alerting/unified/hooks/useVizHeight.ts","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/QueryWrapper.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/QueryRows.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/QueryEditor.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/QueryStep.tsx","webpack://grafana/./public/app/features/alerting/unified/api/preview.ts","webpack://grafana/./public/app/features/alerting/unified/types/preview.ts","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/PreviewRuleResult.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/PreviewRule.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/CloudConditionsStep.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/ConditionField.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/GrafanaAlertStatePicker.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/GrafanaConditionEvalWarning.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/GrafanaConditionsStep.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/AlertRuleForm.tsx","webpack://grafana/./public/app/features/alerting/unified/RuleEditor.tsx","webpack://grafana/./public/app/features/alerting/unified/components/PanelPluginsButtonGroup.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/AnnotationKeyInput.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/AnnotationsField.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/LabelsField.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-editor/SelectWIthAdd.tsx","webpack://grafana/./public/app/features/alerting/unified/hooks/useFolder.ts","webpack://grafana/./public/app/features/alerting/unified/hooks/useIsRuleEditable.ts","webpack://grafana/./public/app/features/alerting/unified/utils/timeRange.ts","webpack://grafana/./public/app/features/alerting/unified/state/AlertingQueryRunner.ts","webpack://grafana/./public/app/features/expressions/guards.ts"],"sourcesContent":["import { useEffect, useRef } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { cleanUpAction, StateSelector } from '../actions/cleanUp';\n\nexport function useCleanup<T>(stateSelector: StateSelector<T>) {\n  const dispatch = useDispatch();\n  //bit of a hack to unburden user from having to wrap stateSelcetor in a useCallback. Otherwise cleanup would happen on every render\n  const selectorRef = useRef(stateSelector);\n  selectorRef.current = stateSelector;\n  useEffect(() => {\n    return () => {\n      dispatch(cleanUpAction({ stateSelector: selectorRef.current }));\n    };\n  }, [dispatch]);\n}\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { FieldSet, useStyles2 } from '@grafana/ui';\nimport React, { FC } from 'react';\n\nexport interface RuleEditorSectionProps {\n  title: string;\n  stepNo: number;\n  description?: string;\n}\n\nexport const RuleEditorSection: FC<RuleEditorSectionProps> = ({ title, stepNo, children, description }) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.parent}>\n      <div>\n        <span className={styles.stepNo}>{stepNo}</span>\n      </div>\n      <div className={styles.content}>\n        <FieldSet label={title} className={styles.fieldset}>\n          {description && <p className={styles.description}>{description}</p>}\n          {children}\n        </FieldSet>\n      </div>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  fieldset: css`\n    legend {\n      font-size: 16px;\n      padding-top: ${theme.spacing(0.5)};\n    }\n  `,\n  parent: css`\n    display: flex;\n    flex-direction: row;\n    max-width: ${theme.breakpoints.values.xl};\n    & + & {\n      margin-top: ${theme.spacing(4)};\n    }\n  `,\n  description: css`\n    margin-top: -${theme.spacing(2)};\n  `,\n  stepNo: css`\n    display: inline-block;\n    width: ${theme.spacing(4)};\n    height: ${theme.spacing(4)};\n    line-height: ${theme.spacing(4)};\n    border-radius: ${theme.spacing(4)};\n    text-align: center;\n    color: ${theme.colors.text.maxContrast};\n    background-color: ${theme.colors.background.canvas};\n    font-size: ${theme.typography.size.lg};\n    margin-right: ${theme.spacing(2)};\n  `,\n  content: css`\n    flex: 1;\n  `,\n});\n","import { isExpressionQuery } from 'app/features/expressions/guards';\nimport { AlertQuery } from 'app/types/unified-alerting-dto';\nimport { ValidateResult } from 'react-hook-form';\n\nexport function queriesWithUpdatedReferences(\n  queries: AlertQuery[],\n  previousRefId: string,\n  newRefId: string\n): AlertQuery[] {\n  return queries.map((query) => {\n    if (previousRefId === newRefId) {\n      return query;\n    }\n\n    if (!isExpressionQuery(query.model)) {\n      return query;\n    }\n\n    const isMathExpression = query.model.type === 'math';\n    const isReduceExpression = query.model.type === 'reduce';\n    const isResampleExpression = query.model.type === 'resample';\n    const isClassicExpression = query.model.type === 'classic_conditions';\n\n    if (isMathExpression) {\n      return {\n        ...query,\n        model: {\n          ...query.model,\n          expression: updateMathExpressionRefs(query.model.expression ?? '', previousRefId, newRefId),\n        },\n      };\n    }\n\n    if (isResampleExpression || isReduceExpression) {\n      const isReferencing = query.model.expression === previousRefId;\n\n      return {\n        ...query,\n        model: {\n          ...query.model,\n          expression: isReferencing ? newRefId : query.model.expression,\n        },\n      };\n    }\n\n    if (isClassicExpression) {\n      const conditions = query.model.conditions?.map((condition) => ({\n        ...condition,\n        query: {\n          ...condition.query,\n          params: condition.query.params.map((param: string) => (param === previousRefId ? newRefId : param)),\n        },\n      }));\n\n      return { ...query, model: { ...query.model, conditions } };\n    }\n\n    return query;\n  });\n}\n\nexport function updateMathExpressionRefs(expression: string, previousRefId: string, newRefId: string): string {\n  const oldExpression = new RegExp('(\\\\$' + previousRefId + '\\\\b)|(\\\\${' + previousRefId + '})', 'gm');\n  const newExpression = '${' + newRefId + '}';\n\n  return expression.replace(oldExpression, newExpression);\n}\n\n// some gateways (like Istio) will decode \"/\" and \"\\\" characters  this will cause 404 errors for any API call\n// that includes these values in the URL (ie. /my/path%2fto/resource -> /my/path/to/resource)\n//\n// see https://istio.io/latest/docs/ops/best-practices/security/#customize-your-system-on-path-normalization\nexport function checkForPathSeparator(value: string): ValidateResult {\n  const containsPathSeparator = value.includes('/') || value.includes('\\\\');\n  if (containsPathSeparator) {\n    return 'Cannot contain \"/\" or \"\\\\\" characters';\n  }\n\n  return true;\n}\n","import React, { FC, useEffect, useMemo, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useUnifiedAlertingSelector } from '../../hooks/useUnifiedAlertingSelector';\nimport { fetchRulerRulesAction } from '../../state/actions';\nimport { RuleFormValues } from '../../types/rule-form';\nimport { useFormContext } from 'react-hook-form';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { SelectWithAdd } from './SelectWIthAdd';\nimport { Field, InputControl, useStyles2 } from '@grafana/ui';\nimport { css } from '@emotion/css';\nimport { checkForPathSeparator } from './util';\n\ninterface Props {\n  rulesSourceName: string;\n}\n\nexport const GroupAndNamespaceFields: FC<Props> = ({ rulesSourceName }) => {\n  const {\n    control,\n    watch,\n    formState: { errors },\n    setValue,\n  } = useFormContext<RuleFormValues>();\n\n  const style = useStyles2(getStyle);\n\n  const [customGroup, setCustomGroup] = useState(false);\n\n  const rulerRequests = useUnifiedAlertingSelector((state) => state.rulerRules);\n  const dispatch = useDispatch();\n  useEffect(() => {\n    dispatch(fetchRulerRulesAction({ rulesSourceName }));\n  }, [rulesSourceName, dispatch]);\n\n  const rulesConfig = rulerRequests[rulesSourceName]?.result;\n\n  const namespace = watch('namespace');\n\n  const namespaceOptions = useMemo(\n    (): Array<SelectableValue<string>> =>\n      rulesConfig ? Object.keys(rulesConfig).map((namespace) => ({ label: namespace, value: namespace })) : [],\n    [rulesConfig]\n  );\n\n  const groupOptions = useMemo(\n    (): Array<SelectableValue<string>> =>\n      (namespace && rulesConfig?.[namespace]?.map((group) => ({ label: group.name, value: group.name }))) || [],\n    [namespace, rulesConfig]\n  );\n\n  return (\n    <div className={style.flexRow}>\n      <Field\n        data-testid=\"namespace-picker\"\n        label=\"Namespace\"\n        error={errors.namespace?.message}\n        invalid={!!errors.namespace?.message}\n      >\n        <InputControl\n          render={({ field: { onChange, ref, ...field } }) => (\n            <SelectWithAdd\n              {...field}\n              className={style.input}\n              onChange={(value) => {\n                setValue('group', ''); //reset if namespace changes\n                onChange(value);\n              }}\n              onCustomChange={(custom: boolean) => {\n                custom && setCustomGroup(true);\n              }}\n              options={namespaceOptions}\n              width={42}\n            />\n          )}\n          name=\"namespace\"\n          control={control}\n          rules={{\n            required: { value: true, message: 'Required.' },\n            validate: {\n              pathSeparator: checkForPathSeparator,\n            },\n          }}\n        />\n      </Field>\n      <Field data-testid=\"group-picker\" label=\"Group\" error={errors.group?.message} invalid={!!errors.group?.message}>\n        <InputControl\n          render={({ field: { ref, ...field } }) => (\n            <SelectWithAdd {...field} options={groupOptions} width={42} custom={customGroup} className={style.input} />\n          )}\n          name=\"group\"\n          control={control}\n          rules={{\n            required: { value: true, message: 'Required.' },\n            validate: {\n              pathSeparator: checkForPathSeparator,\n            },\n          }}\n        />\n      </Field>\n    </div>\n  );\n};\n\nconst getStyle = (theme: GrafanaTheme2) => ({\n  flexRow: css`\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n\n    & > * + * {\n      margin-left: ${theme.spacing(3)};\n    }\n  `,\n  input: css`\n    width: 330px !important;\n  `,\n});\n","import React, { useCallback } from 'react';\nimport { DataSourceInstanceSettings } from '@grafana/data';\nimport { DataSourcePicker } from '@grafana/runtime';\nimport { useRulesSourcesWithRuler } from '../../hooks/useRuleSourcesWithRuler';\n\ninterface Props {\n  onChange: (ds: DataSourceInstanceSettings) => void;\n  value: string | null;\n  onBlur?: () => void;\n  name?: string;\n}\n\nexport function CloudRulesSourcePicker({ value, ...props }: Props): JSX.Element {\n  const rulesSourcesWithRuler = useRulesSourcesWithRuler();\n\n  const dataSourceFilter = useCallback(\n    (ds: DataSourceInstanceSettings): boolean => {\n      return !!rulesSourcesWithRuler.find(({ id }) => id === ds.id);\n    },\n    [rulesSourcesWithRuler]\n  );\n\n  return <DataSourcePicker noDefault alerting filter={dataSourceFilter} current={value} {...props} />;\n}\n","import { DataSourceInstanceSettings } from '@grafana/data';\nimport { useEffect, useMemo } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { checkIfLotexSupportsEditingRulesAction } from '../state/actions';\nimport { getRulesDataSources } from '../utils/datasource';\nimport { useUnifiedAlertingSelector } from './useUnifiedAlertingSelector';\n\nexport function useRulesSourcesWithRuler(): DataSourceInstanceSettings[] {\n  const checkEditingRequests = useUnifiedAlertingSelector((state) => state.lotexSupportsRuleEditing);\n  const dispatch = useDispatch();\n\n  // try fetching rules for each prometheus to see if it has ruler\n  useEffect(() => {\n    getRulesDataSources()\n      .filter((ds) => checkEditingRequests[ds.name] === undefined)\n      .forEach((ds) => dispatch(checkIfLotexSupportsEditingRulesAction(ds.name)));\n  }, [dispatch, checkEditingRequests]);\n\n  return useMemo(\n    () => getRulesDataSources().filter((ds) => checkEditingRequests[ds.name]?.result),\n    [checkEditingRequests]\n  );\n}\n","import React, { FC, useMemo } from 'react';\nimport { DataSourceInstanceSettings, GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Field, Input, InputControl, Select, useStyles2 } from '@grafana/ui';\nimport { css } from '@emotion/css';\nimport { RuleEditorSection } from './RuleEditorSection';\nimport { useFormContext } from 'react-hook-form';\nimport { RuleFormType, RuleFormValues } from '../../types/rule-form';\nimport { Folder, RuleFolderPicker } from './RuleFolderPicker';\nimport { GroupAndNamespaceFields } from './GroupAndNamespaceFields';\nimport { contextSrv } from 'app/core/services/context_srv';\nimport { CloudRulesSourcePicker } from './CloudRulesSourcePicker';\nimport { checkForPathSeparator } from './util';\n\ninterface Props {\n  editingExistingRule: boolean;\n}\n\nconst recordingRuleNameValidationPattern = {\n  message:\n    'Recording rule name must be valid metric name. It may only contain letters, numbers, and colons. It may not contain whitespace.',\n  value: /^[a-zA-Z_:][a-zA-Z0-9_:]*$/,\n};\n\nexport const AlertTypeStep: FC<Props> = ({ editingExistingRule }) => {\n  const styles = useStyles2(getStyles);\n\n  const {\n    register,\n    control,\n    watch,\n    formState: { errors },\n    setValue,\n  } = useFormContext<RuleFormValues & { location?: string }>();\n\n  const ruleFormType = watch('type');\n  const dataSourceName = watch('dataSourceName');\n\n  const alertTypeOptions = useMemo((): SelectableValue[] => {\n    const result = [\n      {\n        label: 'Grafana managed alert',\n        value: RuleFormType.grafana,\n        description: 'Classic Grafana alerts based on thresholds.',\n      },\n    ];\n\n    if (contextSrv.isEditor) {\n      result.push({\n        label: 'Cortex/Loki managed alert',\n        value: RuleFormType.cloudAlerting,\n        description: 'Alert based on a system or application behavior. Based on Prometheus.',\n      });\n      result.push({\n        label: 'Cortex/Loki managed recording rule',\n        value: RuleFormType.cloudRecording,\n        description: 'Recording rule to pre-compute frequently needed or expensive calculations. Based on Prometheus.',\n      });\n    }\n\n    return result;\n  }, []);\n\n  return (\n    <RuleEditorSection stepNo={1} title=\"Rule type\">\n      <Field\n        className={styles.formInput}\n        label=\"Rule name\"\n        error={errors?.name?.message}\n        invalid={!!errors.name?.message}\n      >\n        <Input\n          id=\"name\"\n          {...register('name', {\n            required: { value: true, message: 'Must enter an alert name' },\n            pattern: ruleFormType === RuleFormType.cloudRecording ? recordingRuleNameValidationPattern : undefined,\n            validate: {\n              pathSeparator: (value: string) => {\n                // we use the alert rule name as the \"groupname\" for Grafana managed alerts, so we can't allow path separators\n                if (ruleFormType === RuleFormType.grafana) {\n                  return checkForPathSeparator(value);\n                }\n\n                return true;\n              },\n            },\n          })}\n          autoFocus={true}\n        />\n      </Field>\n      <div className={styles.flexRow}>\n        <Field\n          disabled={editingExistingRule}\n          label=\"Rule type\"\n          className={styles.formInput}\n          error={errors.type?.message}\n          invalid={!!errors.type?.message}\n          data-testid=\"alert-type-picker\"\n        >\n          <InputControl\n            render={({ field: { onChange, ref, ...field } }) => (\n              <Select\n                menuShouldPortal\n                aria-label=\"Rule type\"\n                {...field}\n                options={alertTypeOptions}\n                onChange={(v: SelectableValue) => onChange(v?.value)}\n              />\n            )}\n            name=\"type\"\n            control={control}\n            rules={{\n              required: { value: true, message: 'Please select alert type' },\n            }}\n          />\n        </Field>\n        {(ruleFormType === RuleFormType.cloudRecording || ruleFormType === RuleFormType.cloudAlerting) && (\n          <Field\n            className={styles.formInput}\n            label=\"Select data source\"\n            error={errors.dataSourceName?.message}\n            invalid={!!errors.dataSourceName?.message}\n            data-testid=\"datasource-picker\"\n          >\n            <InputControl\n              render={({ field: { onChange, ref, ...field } }) => (\n                <CloudRulesSourcePicker\n                  {...field}\n                  onChange={(ds: DataSourceInstanceSettings) => {\n                    // reset location if switching data sources, as different rules source will have different groups and namespaces\n                    setValue('location', undefined);\n                    onChange(ds?.name ?? null);\n                  }}\n                />\n              )}\n              name=\"dataSourceName\"\n              control={control}\n              rules={{\n                required: { value: true, message: 'Please select a data source' },\n              }}\n            />\n          </Field>\n        )}\n      </div>\n      {(ruleFormType === RuleFormType.cloudRecording || ruleFormType === RuleFormType.cloudAlerting) &&\n        dataSourceName && <GroupAndNamespaceFields rulesSourceName={dataSourceName} />}\n\n      {ruleFormType === RuleFormType.grafana && (\n        <Field\n          label=\"Folder\"\n          className={styles.formInput}\n          error={errors.folder?.message}\n          invalid={!!errors.folder?.message}\n          data-testid=\"folder-picker\"\n        >\n          <InputControl\n            render={({ field: { ref, ...field } }) => (\n              <RuleFolderPicker {...field} enableCreateNew={true} enableReset={true} />\n            )}\n            name=\"folder\"\n            rules={{\n              required: { value: true, message: 'Please select a folder' },\n              validate: {\n                pathSeparator: (folder: Folder) => checkForPathSeparator(folder.title),\n              },\n            }}\n          />\n        </Field>\n      )}\n    </RuleEditorSection>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  formInput: css`\n    width: 330px;\n    & + & {\n      margin-left: ${theme.spacing(3)};\n    }\n  `,\n  flexRow: css`\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n  `,\n});\n","import React, { FC } from 'react';\nimport LabelsField from './LabelsField';\nimport AnnotationsField from './AnnotationsField';\nimport { RuleEditorSection } from './RuleEditorSection';\nimport { useFormContext } from 'react-hook-form';\nimport { RuleFormType, RuleFormValues } from '../../types/rule-form';\n\nexport const DetailsStep: FC = () => {\n  const { watch } = useFormContext<RuleFormValues>();\n\n  const type = watch('type');\n\n  return (\n    <RuleEditorSection\n      stepNo={type === RuleFormType.cloudRecording ? 3 : 4}\n      title={\n        type === RuleFormType.cloudRecording ? 'Add details for your recording rule' : 'Add details for your alert'\n      }\n      description={\n        type === RuleFormType.cloudRecording\n          ? 'Add labels to help you better manage your rules'\n          : 'Write a summary and add labels to help you better manage your alerts'\n      }\n    >\n      {type !== RuleFormType.cloudRecording && <AnnotationsField />}\n      <LabelsField />\n    </RuleEditorSection>\n  );\n};\n","import React, { FC, useCallback, useMemo, useState } from 'react';\nimport { noop } from 'lodash';\nimport { CoreApp, DataQuery } from '@grafana/data';\nimport { getDataSourceSrv } from '@grafana/runtime';\nimport { useAsync } from 'react-use';\nimport { PromQuery } from 'app/plugins/datasource/prometheus/types';\nimport { LokiQuery } from 'app/plugins/datasource/loki/types';\n\nexport interface ExpressionEditorProps {\n  value?: string;\n  onChange: (value: string) => void;\n  dataSourceName: string; // will be a prometheus or loki datasource\n}\n\nexport const ExpressionEditor: FC<ExpressionEditorProps> = ({ value, onChange, dataSourceName }) => {\n  const { mapToValue, mapToQuery } = useQueryMappers(dataSourceName);\n  const [query, setQuery] = useState(mapToQuery({ refId: 'A', hide: false }, value));\n  const {\n    error,\n    loading,\n    value: dataSource,\n  } = useAsync(() => {\n    return getDataSourceSrv().get(dataSourceName);\n  }, [dataSourceName]);\n\n  const onChangeQuery = useCallback(\n    (query: DataQuery) => {\n      setQuery(query);\n      onChange(mapToValue(query));\n    },\n    [onChange, mapToValue]\n  );\n\n  if (loading || dataSource?.name !== dataSourceName) {\n    return null;\n  }\n\n  if (error || !dataSource || !dataSource?.components?.QueryEditor) {\n    const errorMessage = error?.message || 'Data source plugin does not export any Query Editor component';\n    return <div>Could not load query editor due to: {errorMessage}</div>;\n  }\n\n  const QueryEditor = dataSource?.components?.QueryEditor;\n\n  return (\n    <QueryEditor\n      query={query}\n      queries={[query]}\n      app={CoreApp.CloudAlerting}\n      onChange={onChangeQuery}\n      onRunQuery={noop}\n      datasource={dataSource}\n    />\n  );\n};\n\ntype QueryMappers<T extends DataQuery = DataQuery> = {\n  mapToValue: (query: T) => string;\n  mapToQuery: (existing: T, value: string | undefined) => T;\n};\n\nfunction useQueryMappers(dataSourceName: string): QueryMappers {\n  return useMemo(() => {\n    const settings = getDataSourceSrv().getInstanceSettings(dataSourceName);\n\n    switch (settings?.type) {\n      case 'loki':\n      case 'prometheus':\n        return {\n          mapToValue: (query: DataQuery) => (query as PromQuery | LokiQuery).expr,\n          mapToQuery: (existing: DataQuery, value: string | undefined) => ({ ...existing, expr: value }),\n        };\n      default:\n        throw new Error(`${dataSourceName} is not supported as an expression editor`);\n    }\n  }, [dataSourceName]);\n}\n","import React, { FC, useEffect, useMemo, useState } from 'react';\nimport AutoSizer from 'react-virtualized-auto-sizer';\nimport { css } from '@emotion/css';\nimport { FieldConfigSource, GrafanaTheme2, PanelData, ThresholdsConfig } from '@grafana/data';\nimport { PanelRenderer } from '@grafana/runtime';\nimport { PanelContext, PanelContextProvider, useStyles2 } from '@grafana/ui';\nimport { GraphFieldConfig, GraphTresholdsStyleMode } from '@grafana/schema';\nimport { PanelOptions } from 'app/plugins/panel/table/models.gen';\nimport { useVizHeight } from '../../hooks/useVizHeight';\nimport { SupportedPanelPlugins, PanelPluginsButtonGroup } from '../PanelPluginsButtonGroup';\nimport appEvents from 'app/core/app_events';\n\ninterface Props {\n  data: PanelData;\n  currentPanel: SupportedPanelPlugins;\n  changePanel: (panel: SupportedPanelPlugins) => void;\n  thresholds: ThresholdsConfig;\n  onThresholdsChange: (thresholds: ThresholdsConfig) => void;\n}\n\ntype PanelFieldConfig = FieldConfigSource<GraphFieldConfig>;\n\nexport const VizWrapper: FC<Props> = ({ data, currentPanel, changePanel, onThresholdsChange, thresholds }) => {\n  const [options, setOptions] = useState<PanelOptions>({\n    frameIndex: 0,\n    showHeader: true,\n  });\n  const vizHeight = useVizHeight(data, currentPanel, options.frameIndex);\n  const styles = useStyles2(getStyles(vizHeight));\n\n  const [fieldConfig, setFieldConfig] = useState<PanelFieldConfig>(defaultFieldConfig(thresholds, data));\n\n  useEffect(() => {\n    setFieldConfig((fieldConfig) => ({\n      ...fieldConfig,\n      defaults: {\n        ...fieldConfig.defaults,\n        thresholds: thresholds,\n        unit: defaultUnit(data),\n        custom: {\n          ...fieldConfig.defaults.custom,\n          thresholdsStyle: {\n            mode: GraphTresholdsStyleMode.Line,\n          },\n        },\n      },\n    }));\n  }, [thresholds, setFieldConfig, data]);\n\n  const context: PanelContext = useMemo(\n    () => ({\n      eventBus: appEvents,\n      canEditThresholds: true,\n      onThresholdsChange: onThresholdsChange,\n    }),\n    [onThresholdsChange]\n  );\n\n  if (!options || !data) {\n    return null;\n  }\n\n  return (\n    <div className={styles.wrapper}>\n      <div className={styles.buttonGroup}>\n        <PanelPluginsButtonGroup onChange={changePanel} value={currentPanel} />\n      </div>\n      <AutoSizer>\n        {({ width }) => {\n          if (width === 0) {\n            return null;\n          }\n          return (\n            <div style={{ height: `${vizHeight}px`, width: `${width}px` }}>\n              <PanelContextProvider value={context}>\n                <PanelRenderer\n                  height={vizHeight}\n                  width={width}\n                  data={data}\n                  pluginId={currentPanel}\n                  title=\"title\"\n                  onOptionsChange={setOptions}\n                  options={options}\n                  fieldConfig={fieldConfig}\n                />\n              </PanelContextProvider>\n            </div>\n          );\n        }}\n      </AutoSizer>\n    </div>\n  );\n};\n\nconst getStyles = (visHeight: number) => (theme: GrafanaTheme2) => ({\n  wrapper: css`\n    padding: 0 ${theme.spacing(2)};\n    height: ${visHeight + theme.spacing.gridSize * 4}px;\n  `,\n  buttonGroup: css`\n    display: flex;\n    justify-content: flex-end;\n  `,\n});\n\nfunction defaultUnit(data: PanelData): string | undefined {\n  return data.series[0]?.fields.find((field) => field.type === 'number')?.config.unit;\n}\n\nfunction defaultFieldConfig(thresholds: ThresholdsConfig, data: PanelData): PanelFieldConfig {\n  if (!thresholds) {\n    return { defaults: {}, overrides: [] };\n  }\n\n  return {\n    defaults: {\n      thresholds: thresholds,\n      unit: defaultUnit(data),\n      custom: {\n        thresholdsStyle: {\n          mode: GraphTresholdsStyleMode.Line,\n        },\n      },\n    },\n    overrides: [],\n  };\n}\n","import { PanelData } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\nimport { STAT, TIMESERIES } from '../utils/constants';\n\nexport function useVizHeight(data: PanelData, pluginId: string, frameIndex: number) {\n  const theme = useTheme2();\n  if (pluginId === TIMESERIES || pluginId === STAT || dataIsEmpty(data)) {\n    return 200;\n  }\n\n  const values = data.series[frameIndex].fields[0].values.length;\n  const rowHeight = theme.spacing.gridSize * 5;\n\n  /*\n   Calculate how if we can make  the table smaller than 200px\n   for when we only have 1-2 values\n   The extra rowHeight is to accommodate the header.\n  */\n  const tableHeight = values * rowHeight + rowHeight;\n\n  return tableHeight >= 200 ? 200 : tableHeight;\n}\n\nfunction dataIsEmpty(data: PanelData) {\n  return !data || !data.series[0] || !data.series[0].fields[0] || !data.series[0].fields[0].values;\n}\n","import React, { FC, ReactNode, useState } from 'react';\nimport { css } from '@emotion/css';\nimport { cloneDeep } from 'lodash';\nimport {\n  CoreApp,\n  DataQuery,\n  DataSourceInstanceSettings,\n  getDefaultRelativeTimeRange,\n  GrafanaTheme2,\n  LoadingState,\n  PanelData,\n  RelativeTimeRange,\n  ThresholdsConfig,\n} from '@grafana/data';\nimport { RelativeTimeRangePicker, useStyles2 } from '@grafana/ui';\nimport { QueryEditorRow } from 'app/features/query/components/QueryEditorRow';\nimport { VizWrapper } from './VizWrapper';\nimport { isExpressionQuery } from 'app/features/expressions/guards';\nimport { TABLE, TIMESERIES } from '../../utils/constants';\nimport { SupportedPanelPlugins } from '../PanelPluginsButtonGroup';\nimport { AlertQuery } from 'app/types/unified-alerting-dto';\n\ninterface Props {\n  data: PanelData;\n  query: AlertQuery;\n  queries: AlertQuery[];\n  dsSettings: DataSourceInstanceSettings;\n  onChangeDataSource: (settings: DataSourceInstanceSettings, index: number) => void;\n  onChangeQuery: (query: DataQuery, index: number) => void;\n  onChangeTimeRange?: (timeRange: RelativeTimeRange, index: number) => void;\n  onRemoveQuery: (query: DataQuery) => void;\n  onDuplicateQuery: (query: AlertQuery) => void;\n  onRunQueries: () => void;\n  index: number;\n  thresholds: ThresholdsConfig;\n  onChangeThreshold: (thresholds: ThresholdsConfig, index: number) => void;\n}\n\nexport const QueryWrapper: FC<Props> = ({\n  data,\n  dsSettings,\n  index,\n  onChangeDataSource,\n  onChangeQuery,\n  onChangeTimeRange,\n  onRunQueries,\n  onRemoveQuery,\n  onDuplicateQuery,\n  query,\n  queries,\n  thresholds,\n  onChangeThreshold,\n}) => {\n  const styles = useStyles2(getStyles);\n  const isExpression = isExpressionQuery(query.model);\n  const [pluginId, changePluginId] = useState<SupportedPanelPlugins>(isExpression ? TABLE : TIMESERIES);\n\n  const renderTimePicker = (query: AlertQuery, index: number): ReactNode => {\n    if (isExpressionQuery(query.model) || !onChangeTimeRange) {\n      return null;\n    }\n\n    return (\n      <RelativeTimeRangePicker\n        timeRange={query.relativeTimeRange ?? getDefaultRelativeTimeRange()}\n        onChange={(range) => onChangeTimeRange(range, index)}\n      />\n    );\n  };\n\n  return (\n    <div className={styles.wrapper}>\n      <QueryEditorRow<DataQuery>\n        alerting\n        dataSource={dsSettings}\n        onChangeDataSource={!isExpression ? (settings) => onChangeDataSource(settings, index) : undefined}\n        id={query.refId}\n        index={index}\n        key={query.refId}\n        data={data}\n        query={cloneDeep(query.model)}\n        onChange={(query) => onChangeQuery(query, index)}\n        onRemoveQuery={onRemoveQuery}\n        onAddQuery={() => onDuplicateQuery(cloneDeep(query))}\n        onRunQuery={onRunQueries}\n        queries={queries}\n        renderHeaderExtras={() => renderTimePicker(query, index)}\n        app={CoreApp.UnifiedAlerting}\n        visualization={\n          data.state !== LoadingState.NotStarted ? (\n            <VizWrapper\n              data={data}\n              changePanel={changePluginId}\n              currentPanel={pluginId}\n              thresholds={thresholds}\n              onThresholdsChange={(thresholds) => onChangeThreshold(thresholds, index)}\n            />\n          ) : null\n        }\n        hideDisableQuery={true}\n      />\n    </div>\n  );\n};\n\nexport const EmptyQueryWrapper: FC<{}> = ({ children }) => {\n  const styles = useStyles2(getStyles);\n  return <div className={styles.wrapper}>{children}</div>;\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  wrapper: css`\n    label: AlertingQueryWrapper;\n    margin-bottom: ${theme.spacing(1)};\n    border: 1px solid ${theme.colors.border.medium};\n    border-radius: ${theme.shape.borderRadius(1)};\n  `,\n});\n","import React, { PureComponent, useState } from 'react';\nimport { DragDropContext, Droppable, DropResult } from 'react-beautiful-dnd';\nimport {\n  DataQuery,\n  DataSourceInstanceSettings,\n  LoadingState,\n  PanelData,\n  RelativeTimeRange,\n  ThresholdsConfig,\n  ThresholdsMode,\n} from '@grafana/data';\nimport { config, getDataSourceSrv } from '@grafana/runtime';\nimport { EmptyQueryWrapper, QueryWrapper } from './QueryWrapper';\nimport { AlertDataQuery, AlertQuery } from 'app/types/unified-alerting-dto';\nimport { isExpressionQuery } from 'app/features/expressions/guards';\nimport { queriesWithUpdatedReferences } from './util';\nimport { Button, Card, Icon } from '@grafana/ui';\nimport { QueryOperationRow } from 'app/core/components/QueryOperationRow/QueryOperationRow';\nimport { getDatasourceSrv } from 'app/features/plugins/datasource_srv';\nimport { omit } from 'lodash';\n\ninterface Props {\n  // The query configuration\n  queries: AlertQuery[];\n  data: Record<string, PanelData>;\n\n  // Query editing\n  onQueriesChange: (queries: AlertQuery[]) => void;\n  onDuplicateQuery: (query: AlertQuery) => void;\n  onRunQueries: () => void;\n}\n\ninterface State {\n  dataPerQuery: Record<string, PanelData>;\n}\n\nexport class QueryRows extends PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    this.state = { dataPerQuery: {} };\n  }\n\n  onRemoveQuery = (query: DataQuery) => {\n    this.props.onQueriesChange(\n      this.props.queries.filter((item) => {\n        return item.model.refId !== query.refId;\n      })\n    );\n  };\n\n  onChangeTimeRange = (timeRange: RelativeTimeRange, index: number) => {\n    const { queries, onQueriesChange } = this.props;\n    onQueriesChange(\n      queries.map((item, itemIndex) => {\n        if (itemIndex !== index) {\n          return item;\n        }\n        return {\n          ...item,\n          relativeTimeRange: timeRange,\n        };\n      })\n    );\n  };\n\n  onChangeThreshold = (thresholds: ThresholdsConfig, index: number) => {\n    const { queries, onQueriesChange } = this.props;\n\n    const referencedRefId = queries[index].refId;\n\n    onQueriesChange(\n      queries.map((query) => {\n        if (!isExpressionQuery(query.model)) {\n          return query;\n        }\n\n        if (query.model.conditions && query.model.conditions[0].query.params[0] === referencedRefId) {\n          return {\n            ...query,\n            model: {\n              ...query.model,\n              conditions: query.model.conditions.map((condition, conditionIndex) => {\n                // Only update the first condition for a given refId.\n                if (condition.query.params[0] === referencedRefId && conditionIndex === 0) {\n                  return {\n                    ...condition,\n                    evaluator: {\n                      ...condition.evaluator,\n                      params: [parseFloat(thresholds.steps[1].value.toPrecision(3))],\n                    },\n                  };\n                }\n                return condition;\n              }),\n            },\n          };\n        }\n        return query;\n      })\n    );\n  };\n\n  onChangeDataSource = (settings: DataSourceInstanceSettings, index: number) => {\n    const { queries, onQueriesChange } = this.props;\n\n    const updatedQueries = queries.map((item, itemIndex) => {\n      if (itemIndex !== index) {\n        return item;\n      }\n\n      return copyModel(item, settings.uid);\n    });\n    onQueriesChange(updatedQueries);\n  };\n\n  onChangeQuery = (query: DataQuery, index: number) => {\n    const { queries, onQueriesChange } = this.props;\n\n    // find what queries still have a reference to the old name\n    const previousRefId = queries[index].refId;\n    const newRefId = query.refId;\n\n    onQueriesChange(\n      queriesWithUpdatedReferences(queries, previousRefId, newRefId).map((item, itemIndex) => {\n        if (itemIndex !== index) {\n          return item;\n        }\n\n        return {\n          ...item,\n          refId: query.refId,\n          queryType: item.model.queryType ?? '',\n          model: {\n            ...item.model,\n            ...query,\n            datasource: query.datasource!,\n          },\n        };\n      })\n    );\n  };\n\n  onDragEnd = (result: DropResult) => {\n    const { queries, onQueriesChange } = this.props;\n\n    if (!result || !result.destination) {\n      return;\n    }\n\n    const startIndex = result.source.index;\n    const endIndex = result.destination.index;\n    if (startIndex === endIndex) {\n      return;\n    }\n\n    const update = Array.from(queries);\n    const [removed] = update.splice(startIndex, 1);\n    update.splice(endIndex, 0, removed);\n    onQueriesChange(update);\n  };\n\n  onDuplicateQuery = (query: DataQuery, source: AlertQuery): void => {\n    this.props.onDuplicateQuery({\n      ...source,\n      model: query,\n    });\n  };\n\n  getDataSourceSettings = (query: AlertQuery): DataSourceInstanceSettings | undefined => {\n    return getDataSourceSrv().getInstanceSettings(query.datasourceUid);\n  };\n\n  getThresholdsForQueries = (queries: AlertQuery[]): Record<string, ThresholdsConfig> => {\n    const record: Record<string, ThresholdsConfig> = {};\n\n    for (const query of queries) {\n      if (!isExpressionQuery(query.model)) {\n        continue;\n      }\n\n      if (!Array.isArray(query.model.conditions)) {\n        continue;\n      }\n\n      query.model.conditions.forEach((condition, index) => {\n        if (index > 0) {\n          return;\n        }\n        const threshold = condition.evaluator.params[0];\n        const refId = condition.query.params[0];\n\n        if (condition.evaluator.type === 'outside_range' || condition.evaluator.type === 'within_range') {\n          return;\n        }\n        if (!record[refId]) {\n          record[refId] = {\n            mode: ThresholdsMode.Absolute,\n            steps: [\n              {\n                value: -Infinity,\n                color: config.theme2.colors.success.main,\n              },\n            ],\n          };\n        }\n\n        record[refId].steps.push({\n          value: threshold,\n          color: config.theme2.colors.error.main,\n        });\n      });\n    }\n\n    return record;\n  };\n\n  render() {\n    const { onDuplicateQuery, onRunQueries, queries } = this.props;\n    const thresholdByRefId = this.getThresholdsForQueries(queries);\n\n    return (\n      <DragDropContext onDragEnd={this.onDragEnd}>\n        <Droppable droppableId=\"alerting-queries\" direction=\"vertical\">\n          {(provided) => {\n            return (\n              <div ref={provided.innerRef} {...provided.droppableProps}>\n                {queries.map((query, index) => {\n                  const data: PanelData = this.props.data?.[query.refId] ?? {\n                    series: [],\n                    state: LoadingState.NotStarted,\n                  };\n                  const dsSettings = this.getDataSourceSettings(query);\n\n                  if (!dsSettings) {\n                    return (\n                      <DatasourceNotFound\n                        key={`${query.refId}-${index}`}\n                        index={index}\n                        model={query.model}\n                        onUpdateDatasource={() => {\n                          const defaultDataSource = getDatasourceSrv().getInstanceSettings(null);\n                          if (defaultDataSource) {\n                            this.onChangeDataSource(defaultDataSource, index);\n                          }\n                        }}\n                        onRemoveQuery={() => {\n                          this.onRemoveQuery(query);\n                        }}\n                      />\n                    );\n                  }\n\n                  return (\n                    <QueryWrapper\n                      index={index}\n                      key={`${query.refId}-${index}`}\n                      dsSettings={dsSettings}\n                      data={data}\n                      query={query}\n                      onChangeQuery={this.onChangeQuery}\n                      onRemoveQuery={this.onRemoveQuery}\n                      queries={queries}\n                      onChangeDataSource={this.onChangeDataSource}\n                      onDuplicateQuery={onDuplicateQuery}\n                      onRunQueries={onRunQueries}\n                      onChangeTimeRange={this.onChangeTimeRange}\n                      thresholds={thresholdByRefId[query.refId]}\n                      onChangeThreshold={this.onChangeThreshold}\n                    />\n                  );\n                })}\n                {provided.placeholder}\n              </div>\n            );\n          }}\n        </Droppable>\n      </DragDropContext>\n    );\n  }\n}\n\nfunction copyModel(item: AlertQuery, uid: string): Omit<AlertQuery, 'datasource'> {\n  return {\n    ...item,\n    model: omit(item.model, 'datasource'),\n    datasourceUid: uid,\n  };\n}\n\ninterface DatasourceNotFoundProps {\n  index: number;\n  model: AlertDataQuery;\n  onUpdateDatasource: () => void;\n  onRemoveQuery: () => void;\n}\n\nconst DatasourceNotFound = ({ index, onUpdateDatasource, onRemoveQuery, model }: DatasourceNotFoundProps) => {\n  const refId = model.refId;\n\n  const [showDetails, setShowDetails] = useState<boolean>(false);\n\n  const toggleDetails = () => {\n    setShowDetails((show) => !show);\n  };\n\n  const handleUpdateDatasource = () => {\n    onUpdateDatasource();\n  };\n\n  return (\n    <EmptyQueryWrapper>\n      <QueryOperationRow title={refId} draggable index={index} id={refId} isOpen>\n        <Card\n          heading=\"This datasource has been removed\"\n          description={\n            'The datasource for this query was not found, it was either removed or is not installed correctly.'\n          }\n        >\n          <Card.Figure>\n            <Icon name=\"question-circle\" />\n          </Card.Figure>\n          <Card.Actions>\n            <Button key=\"update\" variant=\"secondary\" onClick={handleUpdateDatasource}>\n              Update datasource\n            </Button>\n            <Button key=\"remove\" variant=\"destructive\" onClick={onRemoveQuery}>\n              Remove query\n            </Button>\n          </Card.Actions>\n          <Card.SecondaryActions>\n            <Button\n              key=\"details\"\n              onClick={toggleDetails}\n              icon={showDetails ? 'angle-up' : 'angle-down'}\n              fill=\"text\"\n              size=\"sm\"\n            >\n              Show details\n            </Button>\n          </Card.SecondaryActions>\n        </Card>\n        {showDetails && (\n          <div>\n            <pre>\n              <code>{JSON.stringify(model, null, 2)}</code>\n            </pre>\n          </div>\n        )}\n      </QueryOperationRow>\n    </EmptyQueryWrapper>\n  );\n};\n","import React, { PureComponent } from 'react';\nimport { css } from '@emotion/css';\nimport {\n  DataQuery,\n  getDefaultRelativeTimeRange,\n  GrafanaTheme2,\n  LoadingState,\n  PanelData,\n  RelativeTimeRange,\n} from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Button, HorizontalGroup, stylesFactory } from '@grafana/ui';\nimport { config } from '@grafana/runtime';\nimport { QueryRows } from './QueryRows';\nimport {\n  dataSource as expressionDatasource,\n  ExpressionDatasourceUID,\n} from 'app/features/expressions/ExpressionDatasource';\nimport { getNextRefIdChar } from 'app/core/utils/query';\nimport { defaultCondition } from 'app/features/expressions/utils/expressionTypes';\nimport { ExpressionQueryType } from 'app/features/expressions/types';\nimport { AlertQuery } from 'app/types/unified-alerting-dto';\nimport { AlertingQueryRunner } from '../../state/AlertingQueryRunner';\nimport { getDatasourceSrv } from 'app/features/plugins/datasource_srv';\nimport { isExpressionQuery } from 'app/features/expressions/guards';\n\ninterface Props {\n  value?: AlertQuery[];\n  onChange: (queries: AlertQuery[]) => void;\n}\n\ninterface State {\n  panelDataByRefId: Record<string, PanelData>;\n}\nexport class QueryEditor extends PureComponent<Props, State> {\n  private runner: AlertingQueryRunner;\n  private queries: AlertQuery[];\n\n  constructor(props: Props) {\n    super(props);\n    this.state = { panelDataByRefId: {} };\n    this.runner = new AlertingQueryRunner();\n    this.queries = props.value ?? [];\n  }\n\n  componentDidMount() {\n    this.runner.get().subscribe((data) => {\n      this.setState({ panelDataByRefId: data });\n    });\n  }\n\n  componentWillUnmount() {\n    this.runner.destroy();\n  }\n\n  onRunQueries = () => {\n    const { queries } = this;\n    this.runner.run(queries);\n  };\n\n  onCancelQueries = () => {\n    this.runner.cancel();\n  };\n\n  onChangeQueries = (queries: AlertQuery[]) => {\n    this.queries = queries;\n    this.props.onChange(queries);\n  };\n\n  onDuplicateQuery = (query: AlertQuery) => {\n    const { queries } = this;\n    this.onChangeQueries(addQuery(queries, query));\n  };\n\n  onNewAlertingQuery = () => {\n    const { queries } = this;\n    const defaultDataSource = getDatasourceSrv().getInstanceSettings('default');\n\n    if (!defaultDataSource) {\n      return;\n    }\n\n    this.onChangeQueries(\n      addQuery(queries, {\n        datasourceUid: defaultDataSource.uid,\n        model: {\n          refId: '',\n          datasource: {\n            type: defaultDataSource.type,\n            uid: defaultDataSource.uid,\n          },\n        },\n      })\n    );\n  };\n\n  onNewExpressionQuery = () => {\n    const { queries } = this;\n\n    this.onChangeQueries(\n      addQuery(queries, {\n        datasourceUid: ExpressionDatasourceUID,\n        model: expressionDatasource.newQuery({\n          type: ExpressionQueryType.classic,\n          conditions: [defaultCondition],\n        }),\n      })\n    );\n  };\n\n  renderAddQueryRow(styles: ReturnType<typeof getStyles>) {\n    return (\n      <HorizontalGroup spacing=\"md\" align=\"flex-start\">\n        <Button\n          type=\"button\"\n          icon=\"plus\"\n          onClick={this.onNewAlertingQuery}\n          variant=\"secondary\"\n          aria-label={selectors.components.QueryTab.addQuery}\n        >\n          Query\n        </Button>\n        {config.expressionsEnabled && (\n          <Button\n            type=\"button\"\n            icon=\"plus\"\n            onClick={this.onNewExpressionQuery}\n            variant=\"secondary\"\n            className={styles.expressionButton}\n          >\n            <span>Expression&nbsp;</span>\n          </Button>\n        )}\n      </HorizontalGroup>\n    );\n  }\n\n  isRunning() {\n    const data = Object.values(this.state.panelDataByRefId).find((d) => Boolean(d));\n    return data?.state === LoadingState.Loading;\n  }\n\n  renderRunQueryButton() {\n    const isRunning = this.isRunning();\n    const styles = getStyles(config.theme2);\n\n    if (isRunning) {\n      return (\n        <div className={styles.runWrapper}>\n          <Button icon=\"fa fa-spinner\" type=\"button\" variant=\"destructive\" onClick={this.onCancelQueries}>\n            Cancel\n          </Button>\n        </div>\n      );\n    }\n\n    return (\n      <div className={styles.runWrapper}>\n        <Button icon=\"sync\" type=\"button\" onClick={this.onRunQueries}>\n          Run queries\n        </Button>\n      </div>\n    );\n  }\n\n  render() {\n    const { value = [] } = this.props;\n    const { panelDataByRefId } = this.state;\n    const styles = getStyles(config.theme2);\n\n    return (\n      <div className={styles.container}>\n        <QueryRows\n          data={panelDataByRefId}\n          queries={value}\n          onQueriesChange={this.onChangeQueries}\n          onDuplicateQuery={this.onDuplicateQuery}\n          onRunQueries={this.onRunQueries}\n        />\n        {this.renderAddQueryRow(styles)}\n        {this.renderRunQueryButton()}\n      </div>\n    );\n  }\n}\n\nconst addQuery = (queries: AlertQuery[], queryToAdd: Pick<AlertQuery, 'model' | 'datasourceUid'>): AlertQuery[] => {\n  const refId = getNextRefIdChar(queries);\n\n  const query: AlertQuery = {\n    ...queryToAdd,\n    refId,\n    queryType: '',\n    model: {\n      ...queryToAdd.model,\n      hide: false,\n      refId,\n    },\n    relativeTimeRange: defaultTimeRange(queryToAdd.model),\n  };\n\n  return [...queries, query];\n};\n\nconst defaultTimeRange = (model: DataQuery): RelativeTimeRange | undefined => {\n  if (isExpressionQuery(model)) {\n    return;\n  }\n\n  return getDefaultRelativeTimeRange();\n};\n\nconst getStyles = stylesFactory((theme: GrafanaTheme2) => {\n  return {\n    container: css`\n      background-color: ${theme.colors.background.primary};\n      height: 100%;\n      max-width: ${theme.breakpoints.values.xxl}px;\n    `,\n    runWrapper: css`\n      margin-top: ${theme.spacing(1)};\n    `,\n    editorWrapper: css`\n      border: 1px solid ${theme.colors.border.medium};\n      border-radius: ${theme.shape.borderRadius()};\n    `,\n    expressionButton: css`\n      margin-right: ${theme.spacing(0.5)};\n    `,\n  };\n});\n","import React, { FC } from 'react';\nimport { useFormContext } from 'react-hook-form';\nimport { Field, InputControl } from '@grafana/ui';\nimport { ExpressionEditor } from './ExpressionEditor';\nimport { RuleEditorSection } from './RuleEditorSection';\nimport { RuleFormType, RuleFormValues } from '../../types/rule-form';\nimport { QueryEditor } from './QueryEditor';\n\nexport const QueryStep: FC = () => {\n  const {\n    control,\n    watch,\n    formState: { errors },\n  } = useFormContext<RuleFormValues>();\n  const type = watch('type');\n  const dataSourceName = watch('dataSourceName');\n\n  return (\n    <RuleEditorSection\n      stepNo={2}\n      title={type === RuleFormType.cloudRecording ? 'Create a query to be recorded' : 'Create a query to be alerted on'}\n    >\n      {(type === RuleFormType.cloudRecording || type === RuleFormType.cloudAlerting) && dataSourceName && (\n        <Field error={errors.expression?.message} invalid={!!errors.expression?.message}>\n          <InputControl\n            name=\"expression\"\n            render={({ field: { ref, ...field } }) => <ExpressionEditor {...field} dataSourceName={dataSourceName} />}\n            control={control}\n            rules={{\n              required: { value: true, message: 'A valid expression is required' },\n            }}\n          />\n        </Field>\n      )}\n      {type === RuleFormType.grafana && (\n        <Field\n          invalid={!!errors.queries}\n          error={(!!errors.queries && 'Must provide at least one valid query.') || undefined}\n        >\n          <InputControl\n            name=\"queries\"\n            render={({ field: { ref, ...field } }) => <QueryEditor {...field} />}\n            control={control}\n            rules={{\n              validate: (queries) => Array.isArray(queries) && !!queries.length,\n            }}\n          />\n        </Field>\n      )}\n    </RuleEditorSection>\n  );\n};\n","import {\n  dataFrameFromJSON,\n  DataFrameJSON,\n  getDefaultTimeRange,\n  LoadingState,\n  PanelData,\n  withLoadingIndicator,\n} from '@grafana/data';\nimport { getBackendSrv, toDataQueryError } from '@grafana/runtime';\nimport { Observable, of } from 'rxjs';\nimport { catchError, map, share } from 'rxjs/operators';\nimport {\n  CloudPreviewRuleRequest,\n  GrafanaPreviewRuleRequest,\n  isCloudPreviewRequest,\n  isGrafanaPreviewRequest,\n  PreviewRuleRequest,\n  PreviewRuleResponse,\n} from '../types/preview';\nimport { RuleFormType } from '../types/rule-form';\n\nexport function previewAlertRule(request: PreviewRuleRequest): Observable<PreviewRuleResponse> {\n  if (isCloudPreviewRequest(request)) {\n    return previewCloudAlertRule(request);\n  }\n\n  if (isGrafanaPreviewRequest(request)) {\n    return previewGrafanaAlertRule(request);\n  }\n\n  throw new Error('unsupported preview rule request');\n}\n\ntype GrafanaPreviewRuleResponse = {\n  instances: DataFrameJSON[];\n};\n\nfunction previewGrafanaAlertRule(request: GrafanaPreviewRuleRequest): Observable<PreviewRuleResponse> {\n  const type = RuleFormType.grafana;\n\n  return withLoadingIndicator({\n    whileLoading: createResponse(type),\n    source: getBackendSrv()\n      .fetch<GrafanaPreviewRuleResponse>({\n        method: 'POST',\n        url: `/api/v1/rule/test/grafana`,\n        data: request,\n      })\n      .pipe(\n        map(({ data }) => {\n          return createResponse(type, {\n            state: LoadingState.Done,\n            series: data.instances.map(dataFrameFromJSON),\n          });\n        }),\n        catchError((error: Error) => {\n          return of(\n            createResponse(type, {\n              state: LoadingState.Error,\n              error: toDataQueryError(error),\n            })\n          );\n        }),\n        share()\n      ),\n  });\n}\n\nfunction createResponse(ruleType: RuleFormType, data: Partial<PanelData> = {}): PreviewRuleResponse {\n  return {\n    ruleType,\n    data: {\n      state: LoadingState.Loading,\n      series: [],\n      timeRange: getDefaultTimeRange(),\n      ...data,\n    },\n  };\n}\n\nfunction previewCloudAlertRule(request: CloudPreviewRuleRequest): Observable<PreviewRuleResponse> {\n  throw new Error('preview for cloud alerting rules is not implemented');\n}\n","import { PanelData } from '@grafana/data';\nimport { AlertQuery } from 'app/types/unified-alerting-dto';\nimport { RuleFormType } from './rule-form';\n\nexport type PreviewRuleRequest = GrafanaPreviewRuleRequest | CloudPreviewRuleRequest;\n\nexport type GrafanaPreviewRuleRequest = {\n  grafana_condition: {\n    condition: string;\n    data: AlertQuery[];\n    now: string;\n  };\n};\n\nexport type CloudPreviewRuleRequest = {\n  dataSourceName: string;\n  expr: string;\n};\n\nexport type PreviewRuleResponse = {\n  ruleType: RuleFormType;\n  data: PanelData;\n};\n\nexport function isCloudPreviewRequest(request: PreviewRuleRequest): request is CloudPreviewRuleRequest {\n  return 'expr' in request;\n}\n\nexport function isGrafanaPreviewRequest(request: PreviewRuleRequest): request is GrafanaPreviewRuleRequest {\n  return 'grafana_condition' in request;\n}\n","import React from 'react';\nimport { css } from '@emotion/css';\nimport AutoSizer from 'react-virtualized-auto-sizer';\nimport { TableCellDisplayMode, useStyles2 } from '@grafana/ui';\nimport { PanelRenderer } from '@grafana/runtime';\nimport { FieldConfigSource, FieldMatcherID, GrafanaTheme2, LoadingState } from '@grafana/data';\nimport { PreviewRuleResponse } from '../../types/preview';\nimport { RuleFormType } from '../../types/rule-form';\nimport { messageFromError } from '../../utils/redux';\n\ntype Props = {\n  preview: PreviewRuleResponse | undefined;\n};\n\nexport function PreviewRuleResult(props: Props): React.ReactElement | null {\n  const { preview } = props;\n  const styles = useStyles2(getStyles);\n  const fieldConfig: FieldConfigSource = {\n    defaults: {},\n    overrides: [\n      {\n        matcher: { id: FieldMatcherID.byName, options: 'Info' },\n        properties: [{ id: 'custom.displayMode', value: TableCellDisplayMode.JSONView }],\n      },\n    ],\n  };\n\n  if (!preview) {\n    return null;\n  }\n\n  const { data, ruleType } = preview;\n\n  if (data.state === LoadingState.Loading) {\n    return (\n      <div className={styles.container}>\n        <span>Loading preview...</span>\n      </div>\n    );\n  }\n\n  if (data.state === LoadingState.Error) {\n    return (\n      <div className={styles.container}>\n        {data.error ? messageFromError(data.error) : 'Failed to preview alert rule'}\n      </div>\n    );\n  }\n  return (\n    <div className={styles.container}>\n      <span>\n        Preview based on the result of running the query, for this moment.{' '}\n        {ruleType === RuleFormType.grafana ? 'Configuration for `no data` and `error handling` is not applied.' : null}\n      </span>\n      <div className={styles.table}>\n        <AutoSizer>\n          {({ width, height }) => (\n            <div style={{ width: `${width}px`, height: `${height}px` }}>\n              <PanelRenderer\n                title=\"\"\n                width={width}\n                height={height}\n                pluginId=\"table\"\n                data={data}\n                fieldConfig={fieldConfig}\n              />\n            </div>\n          )}\n        </AutoSizer>\n      </div>\n    </div>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css`\n      margin: ${theme.spacing(2)} 0;\n    `,\n    table: css`\n      flex: 1 1 auto;\n      height: 135px;\n      margin-top: ${theme.spacing(2)};\n      border: 1px solid ${theme.colors.border.medium};\n      border-radius: ${theme.shape.borderRadius(1)};\n    `,\n  };\n}\n","import React, { useCallback, useState } from 'react';\nimport { css } from '@emotion/css';\nimport { useFormContext } from 'react-hook-form';\nimport { takeWhile } from 'rxjs/operators';\nimport { useMountedState } from 'react-use';\nimport { Button, HorizontalGroup, useStyles2 } from '@grafana/ui';\nimport { dateTimeFormatISO, GrafanaTheme2, LoadingState } from '@grafana/data';\nimport { RuleFormType } from '../../types/rule-form';\nimport { PreviewRuleRequest, PreviewRuleResponse } from '../../types/preview';\nimport { previewAlertRule } from '../../api/preview';\nimport { PreviewRuleResult } from './PreviewRuleResult';\n\nconst fields: string[] = ['type', 'dataSourceName', 'condition', 'queries', 'expression'];\n\nexport function PreviewRule(): React.ReactElement | null {\n  const styles = useStyles2(getStyles);\n  const [preview, onPreview] = usePreview();\n  const { watch } = useFormContext();\n  const [type, condition] = watch(['type', 'condition']);\n\n  if (type === RuleFormType.cloudRecording || type === RuleFormType.cloudAlerting) {\n    return null;\n  }\n\n  return (\n    <div className={styles.container}>\n      <HorizontalGroup>\n        <Button disabled={!condition} type=\"button\" variant=\"primary\" onClick={onPreview}>\n          Preview alerts\n        </Button>\n      </HorizontalGroup>\n      <PreviewRuleResult preview={preview} />\n    </div>\n  );\n}\n\nfunction usePreview(): [PreviewRuleResponse | undefined, () => void] {\n  const [preview, setPreview] = useState<PreviewRuleResponse | undefined>();\n  const { getValues } = useFormContext();\n  const isMounted = useMountedState();\n\n  const onPreview = useCallback(() => {\n    const values = getValues(fields);\n    const request = createPreviewRequest(values);\n\n    previewAlertRule(request)\n      .pipe(takeWhile((response) => !isCompleted(response), true))\n      .subscribe((response) => {\n        if (!isMounted()) {\n          return;\n        }\n        setPreview(response);\n      });\n  }, [getValues, isMounted]);\n\n  return [preview, onPreview];\n}\n\nfunction createPreviewRequest(values: any[]): PreviewRuleRequest {\n  const [type, dataSourceName, condition, queries, expression] = values;\n\n  switch (type) {\n    case RuleFormType.cloudAlerting:\n      return {\n        dataSourceName,\n        expr: expression,\n      };\n\n    case RuleFormType.grafana:\n      return {\n        grafana_condition: {\n          condition,\n          data: queries,\n          now: dateTimeFormatISO(Date.now()),\n        },\n      };\n\n    default:\n      throw new Error(`Alert type ${type} not supported by preview.`);\n  }\n}\n\nfunction isCompleted(response: PreviewRuleResponse): boolean {\n  switch (response.data.state) {\n    case LoadingState.Done:\n    case LoadingState.Error:\n      return true;\n    default:\n      return false;\n  }\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css`\n      margin-top: ${theme.spacing(2)};\n      max-width: ${theme.breakpoints.values.xxl}px;\n    `,\n  };\n}\n","import React, { FC } from 'react';\nimport { css } from '@emotion/css';\nimport { GrafanaTheme } from '@grafana/data';\nimport { Field, Input, InputControl, Select, useStyles } from '@grafana/ui';\nimport { useFormContext } from 'react-hook-form';\nimport { RuleFormType, RuleFormValues } from '../../types/rule-form';\nimport { timeOptions } from '../../utils/time';\nimport { RuleEditorSection } from './RuleEditorSection';\nimport { PreviewRule } from './PreviewRule';\n\nexport const CloudConditionsStep: FC = () => {\n  const styles = useStyles(getStyles);\n  const {\n    register,\n    control,\n    watch,\n    formState: { errors },\n  } = useFormContext<RuleFormValues>();\n\n  const type = watch('type');\n\n  // cloud recording rules do not have alert conditions\n  if (type === RuleFormType.cloudRecording) {\n    return null;\n  }\n\n  return (\n    <RuleEditorSection stepNo={3} title=\"Define alert conditions\">\n      <Field label=\"For\" description=\"Expression has to be true for this long for the alert to be fired.\">\n        <div className={styles.flexRow}>\n          <Field invalid={!!errors.forTime?.message} error={errors.forTime?.message} className={styles.inlineField}>\n            <Input\n              {...register('forTime', { pattern: { value: /^\\d+$/, message: 'Must be a positive integer.' } })}\n              width={8}\n            />\n          </Field>\n          <InputControl\n            name=\"forTimeUnit\"\n            render={({ field: { onChange, ref, ...field } }) => (\n              <Select\n                menuShouldPortal\n                {...field}\n                options={timeOptions}\n                onChange={(value) => onChange(value?.value)}\n                width={15}\n                className={styles.timeUnit}\n              />\n            )}\n            control={control}\n          />\n        </div>\n      </Field>\n      <PreviewRule />\n    </RuleEditorSection>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme) => ({\n  inlineField: css`\n    margin-bottom: 0;\n  `,\n  flexRow: css`\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: flex-start;\n  `,\n  timeUnit: css`\n    margin-left: ${theme.spacing.xs};\n  `,\n});\n","import { SelectableValue } from '@grafana/data';\nimport { Field, InputControl, Select } from '@grafana/ui';\nimport { ExpressionDatasourceUID } from 'app/features/expressions/ExpressionDatasource';\nimport React, { FC, useEffect, useMemo } from 'react';\nimport { useFormContext } from 'react-hook-form';\nimport { RuleFormValues } from '../../types/rule-form';\n\nexport const ConditionField: FC = () => {\n  const {\n    watch,\n    setValue,\n    formState: { errors },\n  } = useFormContext<RuleFormValues>();\n\n  const queries = watch('queries');\n  const condition = watch('condition');\n\n  const options = useMemo(\n    (): SelectableValue[] =>\n      queries\n        .filter((q) => !!q.refId)\n        .map((q) => ({\n          value: q.refId,\n          label: q.refId,\n        })),\n    [queries]\n  );\n\n  // reset condition if option no longer exists or if it is unset, but there are options available\n  useEffect(() => {\n    const expressions = queries.filter((query) => query.datasourceUid === ExpressionDatasourceUID);\n    if (condition && !options.find(({ value }) => value === condition)) {\n      setValue('condition', expressions.length ? expressions[expressions.length - 1].refId : null);\n    } else if (!condition && expressions.length) {\n      setValue('condition', expressions[expressions.length - 1].refId);\n    }\n  }, [condition, options, queries, setValue]);\n\n  return (\n    <Field\n      label=\"Condition\"\n      description=\"The query or expression that will be alerted on\"\n      error={errors.condition?.message}\n      invalid={!!errors.condition?.message}\n    >\n      <InputControl\n        name=\"condition\"\n        render={({ field: { onChange, ref, ...field } }) => (\n          <Select\n            menuShouldPortal\n            aria-label=\"Condition\"\n            {...field}\n            width={42}\n            options={options}\n            onChange={(v: SelectableValue) => onChange(v?.value ?? null)}\n            noOptionsMessage=\"No queries defined\"\n          />\n        )}\n        rules={{\n          required: {\n            value: true,\n            message: 'Please select the condition to alert on',\n          },\n        }}\n      />\n    </Field>\n  );\n};\n","import { SelectableValue } from '@grafana/data';\nimport { Select } from '@grafana/ui';\nimport { SelectBaseProps } from '@grafana/ui/src/components/Select/types';\nimport { GrafanaAlertStateDecision } from 'app/types/unified-alerting-dto';\nimport React, { FC, useMemo } from 'react';\n\ntype Props = Omit<SelectBaseProps<GrafanaAlertStateDecision>, 'options'> & {\n  includeNoData: boolean;\n  includeError: boolean;\n};\n\nconst options: SelectableValue[] = [\n  { value: GrafanaAlertStateDecision.Alerting, label: 'Alerting' },\n  { value: GrafanaAlertStateDecision.NoData, label: 'No Data' },\n  { value: GrafanaAlertStateDecision.OK, label: 'OK' },\n  { value: GrafanaAlertStateDecision.Error, label: 'Error' },\n];\n\nexport const GrafanaAlertStatePicker: FC<Props> = ({ includeNoData, includeError, ...props }) => {\n  const opts = useMemo(() => {\n    if (!includeNoData) {\n      return options.filter((opt) => opt.value !== GrafanaAlertStateDecision.NoData);\n    }\n    if (!includeError) {\n      return options.filter((opt) => opt.value !== GrafanaAlertStateDecision.Error);\n    }\n    return options;\n  }, [includeNoData, includeError]);\n  return <Select menuShouldPortal options={opts} {...props} />;\n};\n","import { durationToMilliseconds, parseDuration } from '@grafana/data';\nimport { Alert } from '@grafana/ui';\nimport { isEmpty } from 'lodash';\nimport React, { FC } from 'react';\nimport { useFormContext } from 'react-hook-form';\nimport { RuleFormValues } from '../../types/rule-form';\n\n// a warning that will be shown if a problematic yet technically valid combination of \"evaluate every\" and \"evaluate for\" is enetered\nexport const GrafanaConditionEvalWarning: FC = () => {\n  const { watch } = useFormContext<RuleFormValues>();\n  const evaluateFor = watch('evaluateFor');\n  const evaluateEvery = watch('evaluateEvery');\n  if (evaluateFor === '0') {\n    return null;\n  }\n  const durationFor = parseDuration(evaluateFor);\n  const durationEvery = parseDuration(evaluateEvery);\n  if (isEmpty(durationFor) || isEmpty(durationEvery)) {\n    return null;\n  }\n  const millisFor = durationToMilliseconds(durationFor);\n  const millisEvery = durationToMilliseconds(durationEvery);\n  if (millisFor && millisEvery && millisFor <= millisEvery) {\n    return (\n      <Alert severity=\"warning\" title=\"\">\n        Setting a &quot;for&quot; duration that is less than or equal to the evaluation interval will result in the\n        evaluation interval being used to calculate when an alert that has stopped receiving data will be closed.\n      </Alert>\n    );\n  }\n  return null;\n};\n","import React, { FC, useState } from 'react';\nimport { css } from '@emotion/css';\nimport { parseDuration, durationToMilliseconds, GrafanaTheme2 } from '@grafana/data';\nimport { Field, InlineLabel, Input, InputControl, useStyles2 } from '@grafana/ui';\nimport { useFormContext, RegisterOptions } from 'react-hook-form';\nimport { RuleFormValues } from '../../types/rule-form';\nimport { positiveDurationValidationPattern, durationValidationPattern } from '../../utils/time';\nimport { ConditionField } from './ConditionField';\nimport { GrafanaAlertStatePicker } from './GrafanaAlertStatePicker';\nimport { RuleEditorSection } from './RuleEditorSection';\nimport { PreviewRule } from './PreviewRule';\nimport { GrafanaConditionEvalWarning } from './GrafanaConditionEvalWarning';\nimport { CollapseToggle } from '../CollapseToggle';\n\nconst MIN_TIME_RANGE_STEP_S = 10; // 10 seconds\n\nconst forValidationOptions: RegisterOptions = {\n  required: {\n    value: true,\n    message: 'Required.',\n  },\n  pattern: durationValidationPattern,\n};\n\nconst evaluateEveryValidationOptions: RegisterOptions = {\n  required: {\n    value: true,\n    message: 'Required.',\n  },\n  pattern: positiveDurationValidationPattern,\n  validate: (value: string) => {\n    const duration = parseDuration(value);\n    if (Object.keys(duration).length) {\n      const diff = durationToMilliseconds(duration);\n      if (diff < MIN_TIME_RANGE_STEP_S * 1000) {\n        return `Cannot be less than ${MIN_TIME_RANGE_STEP_S} seconds.`;\n      }\n      if (diff % (MIN_TIME_RANGE_STEP_S * 1000) !== 0) {\n        return `Must be a multiple of ${MIN_TIME_RANGE_STEP_S} seconds.`;\n      }\n    }\n    return true;\n  },\n};\n\nexport const GrafanaConditionsStep: FC = () => {\n  const styles = useStyles2(getStyles);\n  const [showErrorHandling, setShowErrorHandling] = useState(false);\n  const {\n    register,\n    formState: { errors },\n  } = useFormContext<RuleFormValues>();\n\n  const evaluateEveryId = 'eval-every-input';\n  const evaluateForId = 'eval-for-input';\n\n  return (\n    <RuleEditorSection stepNo={3} title=\"Define alert conditions\">\n      <ConditionField />\n      <Field label=\"Evaluate\">\n        <div className={styles.flexRow}>\n          <InlineLabel\n            htmlFor={evaluateEveryId}\n            width={16}\n            tooltip=\"How often the alert will be evaluated to see if it fires\"\n          >\n            Evaluate every\n          </InlineLabel>\n          <Field\n            className={styles.inlineField}\n            error={errors.evaluateEvery?.message}\n            invalid={!!errors.evaluateEvery?.message}\n            validationMessageHorizontalOverflow={true}\n          >\n            <Input id={evaluateEveryId} width={8} {...register('evaluateEvery', evaluateEveryValidationOptions)} />\n          </Field>\n          <InlineLabel\n            htmlFor={evaluateForId}\n            width={7}\n            tooltip='Once condition is breached, alert will go into pending state. If it is pending for longer than the \"for\" value, it will become a firing alert.'\n          >\n            for\n          </InlineLabel>\n          <Field\n            className={styles.inlineField}\n            error={errors.evaluateFor?.message}\n            invalid={!!errors.evaluateFor?.message}\n            validationMessageHorizontalOverflow={true}\n          >\n            <Input id={evaluateForId} width={8} {...register('evaluateFor', forValidationOptions)} />\n          </Field>\n        </div>\n      </Field>\n      <GrafanaConditionEvalWarning />\n      <CollapseToggle\n        isCollapsed={!showErrorHandling}\n        onToggle={(collapsed) => setShowErrorHandling(!collapsed)}\n        text=\"Configure no data and error handling\"\n        className={styles.collapseToggle}\n      />\n      {showErrorHandling && (\n        <>\n          <Field htmlFor=\"no-data-state-input\" label=\"Alert state if no data or all values are null\">\n            <InputControl\n              render={({ field: { onChange, ref, ...field } }) => (\n                <GrafanaAlertStatePicker\n                  {...field}\n                  inputId=\"no-data-state-input\"\n                  width={42}\n                  includeNoData={true}\n                  includeError={false}\n                  onChange={(value) => onChange(value?.value)}\n                />\n              )}\n              name=\"noDataState\"\n            />\n          </Field>\n          <Field htmlFor=\"exec-err-state-input\" label=\"Alert state if execution error or timeout\">\n            <InputControl\n              render={({ field: { onChange, ref, ...field } }) => (\n                <GrafanaAlertStatePicker\n                  {...field}\n                  inputId=\"exec-err-state-input\"\n                  width={42}\n                  includeNoData={false}\n                  includeError={true}\n                  onChange={(value) => onChange(value?.value)}\n                />\n              )}\n              name=\"execErrState\"\n            />\n          </Field>\n        </>\n      )}\n      <PreviewRule />\n    </RuleEditorSection>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  inlineField: css`\n    margin-bottom: 0;\n  `,\n  flexRow: css`\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: flex-start;\n  `,\n  collapseToggle: css`\n    margin: ${theme.spacing(2, 0, 2, -1)};\n  `,\n});\n","import React, { FC, useMemo, useState } from 'react';\nimport { GrafanaTheme2, AppEvents } from '@grafana/data';\nimport { PageToolbar, Button, useStyles2, CustomScrollbar, Spinner, ConfirmModal } from '@grafana/ui';\nimport { css } from '@emotion/css';\n\nimport { AlertTypeStep } from './AlertTypeStep';\nimport { DetailsStep } from './DetailsStep';\nimport { QueryStep } from './QueryStep';\nimport { useForm, FormProvider } from 'react-hook-form';\n\nimport { RuleFormType, RuleFormValues } from '../../types/rule-form';\nimport { useUnifiedAlertingSelector } from '../../hooks/useUnifiedAlertingSelector';\nimport { initialAsyncRequestState } from '../../utils/redux';\nimport { deleteRuleAction, saveRuleFormAction } from '../../state/actions';\nimport { RuleWithLocation } from 'app/types/unified-alerting';\nimport { useDispatch } from 'react-redux';\nimport { useCleanup } from 'app/core/hooks/useCleanup';\nimport { rulerRuleToFormValues, getDefaultFormValues, getDefaultQueries } from '../../utils/rule-form';\nimport { Link } from 'react-router-dom';\nimport { useQueryParams } from 'app/core/hooks/useQueryParams';\n\nimport { appEvents } from 'app/core/core';\nimport { CloudConditionsStep } from './CloudConditionsStep';\nimport { GrafanaConditionsStep } from './GrafanaConditionsStep';\nimport * as ruleId from '../../utils/rule-id';\n\ntype Props = {\n  existing?: RuleWithLocation;\n};\n\nexport const AlertRuleForm: FC<Props> = ({ existing }) => {\n  const styles = useStyles2(getStyles);\n  const dispatch = useDispatch();\n  const [queryParams] = useQueryParams();\n\n  const returnTo: string = (queryParams['returnTo'] as string | undefined) ?? '/alerting/list';\n  const [showDeleteModal, setShowDeleteModal] = useState<boolean>(false);\n\n  const defaultValues: RuleFormValues = useMemo(() => {\n    if (existing) {\n      return rulerRuleToFormValues(existing);\n    }\n    return {\n      ...getDefaultFormValues(),\n      queries: getDefaultQueries(),\n      ...(queryParams['defaults'] ? JSON.parse(queryParams['defaults'] as string) : {}),\n    };\n  }, [existing, queryParams]);\n\n  const formAPI = useForm<RuleFormValues>({\n    mode: 'onSubmit',\n    defaultValues,\n    shouldFocusError: true,\n  });\n\n  const { handleSubmit, watch } = formAPI;\n\n  const type = watch('type');\n  const dataSourceName = watch('dataSourceName');\n\n  const showStep2 = Boolean(type && (type === RuleFormType.grafana || !!dataSourceName));\n\n  const submitState = useUnifiedAlertingSelector((state) => state.ruleForm.saveRule) || initialAsyncRequestState;\n  useCleanup((state) => state.unifiedAlerting.ruleForm.saveRule);\n\n  const submit = (values: RuleFormValues, exitOnSave: boolean) => {\n    dispatch(\n      saveRuleFormAction({\n        values: {\n          ...defaultValues,\n          ...values,\n          annotations:\n            values.annotations\n              ?.map(({ key, value }) => ({ key: key.trim(), value: value.trim() }))\n              .filter(({ key, value }) => !!key && !!value) ?? [],\n          labels:\n            values.labels\n              ?.map(({ key, value }) => ({ key: key.trim(), value: value.trim() }))\n              .filter(({ key }) => !!key) ?? [],\n        },\n        existing,\n        redirectOnSave: exitOnSave ? returnTo : undefined,\n      })\n    );\n  };\n\n  const deleteRule = () => {\n    if (existing) {\n      const identifier = ruleId.fromRulerRule(\n        existing.ruleSourceName,\n        existing.namespace,\n        existing.group.name,\n        existing.rule\n      );\n\n      dispatch(deleteRuleAction(identifier, { navigateTo: '/alerting/list' }));\n    }\n  };\n\n  const onInvalid = () => {\n    appEvents.emit(AppEvents.alertError, ['There are errors in the form. Please correct them and try again!']);\n  };\n\n  return (\n    <FormProvider {...formAPI}>\n      <form onSubmit={(e) => e.preventDefault()} className={styles.form}>\n        <PageToolbar title=\"Create alert rule\" pageIcon=\"bell\">\n          <Link to={returnTo}>\n            <Button variant=\"secondary\" disabled={submitState.loading} type=\"button\" fill=\"outline\">\n              Cancel\n            </Button>\n          </Link>\n          {existing ? (\n            <Button variant=\"destructive\" type=\"button\" onClick={() => setShowDeleteModal(true)}>\n              Delete\n            </Button>\n          ) : null}\n          <Button\n            variant=\"primary\"\n            type=\"button\"\n            onClick={handleSubmit((values) => submit(values, false), onInvalid)}\n            disabled={submitState.loading}\n          >\n            {submitState.loading && <Spinner className={styles.buttonSpinner} inline={true} />}\n            Save\n          </Button>\n          <Button\n            variant=\"primary\"\n            type=\"button\"\n            onClick={handleSubmit((values) => submit(values, true), onInvalid)}\n            disabled={submitState.loading}\n          >\n            {submitState.loading && <Spinner className={styles.buttonSpinner} inline={true} />}\n            Save and exit\n          </Button>\n        </PageToolbar>\n        <div className={styles.contentOuter}>\n          <CustomScrollbar autoHeightMin=\"100%\" hideHorizontalTrack={true}>\n            <div className={styles.contentInner}>\n              <AlertTypeStep editingExistingRule={!!existing} />\n              {showStep2 && (\n                <>\n                  <QueryStep />\n                  {type === RuleFormType.grafana ? <GrafanaConditionsStep /> : <CloudConditionsStep />}\n                  <DetailsStep />\n                </>\n              )}\n            </div>\n          </CustomScrollbar>\n        </div>\n      </form>\n      {showDeleteModal ? (\n        <ConfirmModal\n          isOpen={true}\n          title=\"Delete rule\"\n          body=\"Deleting this rule will permanently remove it. Are you sure you want to delete this rule?\"\n          confirmText=\"Yes, delete\"\n          icon=\"exclamation-triangle\"\n          onConfirm={deleteRule}\n          onDismiss={() => setShowDeleteModal(false)}\n        />\n      ) : null}\n    </FormProvider>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    buttonSpinner: css`\n      margin-right: ${theme.spacing(1)};\n    `,\n    form: css`\n      width: 100%;\n      height: 100%;\n      display: flex;\n      flex-direction: column;\n    `,\n    contentInner: css`\n      flex: 1;\n      padding: ${theme.spacing(2)};\n    `,\n    contentOuter: css`\n      background: ${theme.colors.background.primary};\n      border: 1px solid ${theme.colors.border.weak};\n      border-radius: ${theme.shape.borderRadius()};\n      margin: ${theme.spacing(0, 2, 2)};\n      overflow: hidden;\n      flex: 1;\n    `,\n    flexRow: css`\n      display: flex;\n      flex-direction: row;\n      justify-content: flex-start;\n    `,\n  };\n};\n","import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Alert, LinkButton, LoadingPlaceholder, useStyles2, withErrorBoundary } from '@grafana/ui';\nimport Page from 'app/core/components/Page/Page';\nimport { contextSrv } from 'app/core/services/context_srv';\nimport { useCleanup } from 'app/core/hooks/useCleanup';\nimport { GrafanaRouteComponentProps } from 'app/core/navigation/types';\nimport { RuleIdentifier } from 'app/types/unified-alerting';\nimport React, { FC, useEffect } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { AlertRuleForm } from './components/rule-editor/AlertRuleForm';\nimport { useIsRuleEditable } from './hooks/useIsRuleEditable';\nimport { useUnifiedAlertingSelector } from './hooks/useUnifiedAlertingSelector';\nimport { fetchEditableRuleAction } from './state/actions';\nimport * as ruleId from './utils/rule-id';\n\ninterface ExistingRuleEditorProps {\n  identifier: RuleIdentifier;\n}\n\nconst ExistingRuleEditor: FC<ExistingRuleEditorProps> = ({ identifier }) => {\n  useCleanup((state) => state.unifiedAlerting.ruleForm.existingRule);\n  const { loading, result, error, dispatched } = useUnifiedAlertingSelector((state) => state.ruleForm.existingRule);\n  const dispatch = useDispatch();\n  const { isEditable } = useIsRuleEditable(ruleId.ruleIdentifierToRuleSourceName(identifier), result?.rule);\n\n  useEffect(() => {\n    if (!dispatched) {\n      dispatch(fetchEditableRuleAction(identifier));\n    }\n  }, [dispatched, dispatch, identifier]);\n\n  if (loading || isEditable === undefined) {\n    return (\n      <Page.Contents>\n        <LoadingPlaceholder text=\"Loading rule...\" />\n      </Page.Contents>\n    );\n  }\n  if (error) {\n    return (\n      <Page.Contents>\n        <Alert severity=\"error\" title=\"Failed to load rule\">\n          {error.message}\n        </Alert>\n      </Page.Contents>\n    );\n  }\n  if (!result) {\n    return <AlertWarning title=\"Rule not found\">Sorry! This rule does not exist.</AlertWarning>;\n  }\n  if (isEditable === false) {\n    return <AlertWarning title=\"Cannot edit rule\">Sorry! You do not have permission to edit this rule.</AlertWarning>;\n  }\n  return <AlertRuleForm existing={result} />;\n};\n\ntype RuleEditorProps = GrafanaRouteComponentProps<{ id?: string }>;\n\nconst RuleEditor: FC<RuleEditorProps> = ({ match }) => {\n  const { id } = match.params;\n  const identifier = ruleId.tryParse(id, true);\n\n  if (identifier) {\n    return <ExistingRuleEditor key={id} identifier={identifier} />;\n  }\n  if (!(contextSrv.hasEditPermissionInFolders || contextSrv.isEditor)) {\n    return <AlertWarning title=\"Cannot create rules\">Sorry! You are not allowed to create rules.</AlertWarning>;\n  }\n  return <AlertRuleForm />;\n};\n\nconst AlertWarning: FC<{ title: string }> = ({ title, children }) => (\n  <Alert className={useStyles2(warningStyles).warning} severity=\"warning\" title={title}>\n    <p>{children}</p>\n    <LinkButton href=\"alerting/list\">To rule list</LinkButton>\n  </Alert>\n);\n\nconst warningStyles = (theme: GrafanaTheme2) => ({\n  warning: css`\n    margin: ${theme.spacing(4)};\n  `,\n});\n\nexport default withErrorBoundary(RuleEditor, { style: 'page' });\n","import { SelectableValue } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { RadioButtonGroup } from '@grafana/ui';\nimport React, { useMemo } from 'react';\nimport { STAT, TABLE, TIMESERIES } from '../utils/constants';\n\nexport type SupportedPanelPlugins = 'timeseries' | 'table' | 'stat';\n\ntype Props = {\n  value: SupportedPanelPlugins;\n  onChange: (value: SupportedPanelPlugins) => void;\n  size?: 'sm' | 'md';\n};\n\nexport function PanelPluginsButtonGroup(props: Props): JSX.Element | null {\n  const { value, onChange, size = 'md' } = props;\n  const panels = useMemo(() => getSupportedPanels(), []);\n\n  return <RadioButtonGroup options={panels} value={value} onChange={onChange} size={size} />;\n}\n\nfunction getSupportedPanels(): Array<SelectableValue<SupportedPanelPlugins>> {\n  return Object.values(config.panels).reduce((panels: Array<SelectableValue<SupportedPanelPlugins>>, panel) => {\n    if (isSupportedPanelPlugin(panel.id)) {\n      panels.push({\n        value: panel.id,\n        label: panel.name,\n        imgUrl: panel.info.logos.small,\n      });\n    }\n    return panels;\n  }, []);\n}\n\nfunction isSupportedPanelPlugin(id: string): id is SupportedPanelPlugins {\n  switch (id) {\n    case TIMESERIES:\n    case TABLE:\n    case STAT:\n      return true;\n    default:\n      return false;\n  }\n}\n","import { SelectableValue } from '@grafana/data';\nimport React, { FC, useMemo } from 'react';\nimport { SelectWithAdd } from './SelectWIthAdd';\nimport { Annotation, annotationLabels } from '../../utils/constants';\n\ninterface Props {\n  onChange: (value: string) => void;\n  existingKeys: string[];\n\n  value?: string;\n  width?: number;\n  className?: string;\n  'aria-label'?: string;\n}\n\nexport const AnnotationKeyInput: FC<Props> = ({ value, existingKeys, 'aria-label': ariaLabel, ...rest }) => {\n  const annotationOptions = useMemo(\n    (): SelectableValue[] =>\n      Object.values(Annotation)\n        .filter((key) => !existingKeys.includes(key)) // remove keys already taken in other annotations\n        .map((key) => ({ value: key, label: annotationLabels[key] })),\n    [existingKeys]\n  );\n\n  return (\n    <SelectWithAdd\n      aria-label={ariaLabel}\n      value={value}\n      options={annotationOptions}\n      custom={!!value && !(Object.values(Annotation) as string[]).includes(value)}\n      {...rest}\n    />\n  );\n};\n","import React, { FC, useCallback } from 'react';\nimport { Button, Field, FieldArray, Input, InputControl, Label, TextArea, useStyles } from '@grafana/ui';\nimport { GrafanaTheme } from '@grafana/data';\nimport { css, cx } from '@emotion/css';\nimport { useFormContext } from 'react-hook-form';\nimport { RuleFormValues } from '../../types/rule-form';\nimport { AnnotationKeyInput } from './AnnotationKeyInput';\n\nconst AnnotationsField: FC = () => {\n  const styles = useStyles(getStyles);\n  const {\n    control,\n    register,\n    watch,\n    formState: { errors },\n  } = useFormContext();\n  const annotations = watch('annotations') as RuleFormValues['annotations'];\n\n  const existingKeys = useCallback(\n    (index: number): string[] => annotations.filter((_, idx: number) => idx !== index).map(({ key }) => key),\n    [annotations]\n  );\n\n  return (\n    <>\n      <Label>Summary and annotations</Label>\n      <FieldArray name={'annotations'} control={control}>\n        {({ fields, append, remove }) => {\n          return (\n            <div className={styles.flexColumn}>\n              {fields.map((field, index) => {\n                const isUrl = annotations[index]?.key?.toLocaleLowerCase().endsWith('url');\n                const ValueInputComponent = isUrl ? Input : TextArea;\n                return (\n                  <div key={field.id} className={styles.flexRow}>\n                    <Field\n                      className={styles.field}\n                      invalid={!!errors.annotations?.[index]?.key?.message}\n                      error={errors.annotations?.[index]?.key?.message}\n                      data-testid={`annotation-key-${index}`}\n                    >\n                      <InputControl\n                        name={`annotations[${index}].key`}\n                        render={({ field: { ref, ...field } }) => (\n                          <AnnotationKeyInput\n                            {...field}\n                            aria-label={`Annotation detail ${index + 1}`}\n                            existingKeys={existingKeys(index)}\n                            width={18}\n                          />\n                        )}\n                        control={control}\n                        rules={{ required: { value: !!annotations[index]?.value, message: 'Required.' } }}\n                      />\n                    </Field>\n                    <Field\n                      className={cx(styles.flexRowItemMargin, styles.field)}\n                      invalid={!!errors.annotations?.[index]?.value?.message}\n                      error={errors.annotations?.[index]?.value?.message}\n                    >\n                      <ValueInputComponent\n                        data-testid={`annotation-value-${index}`}\n                        className={cx(styles.annotationValueInput, { [styles.textarea]: !isUrl })}\n                        {...register(`annotations[${index}].value`)}\n                        placeholder={isUrl ? 'https://' : `Text`}\n                        defaultValue={field.value}\n                      />\n                    </Field>\n                    <Button\n                      type=\"button\"\n                      className={styles.flexRowItemMargin}\n                      aria-label=\"delete annotation\"\n                      icon=\"trash-alt\"\n                      variant=\"secondary\"\n                      onClick={() => remove(index)}\n                    />\n                  </div>\n                );\n              })}\n              <Button\n                className={styles.addAnnotationsButton}\n                icon=\"plus-circle\"\n                type=\"button\"\n                variant=\"secondary\"\n                onClick={() => {\n                  append({ key: '', value: '' });\n                }}\n              >\n                Add info\n              </Button>\n            </div>\n          );\n        }}\n      </FieldArray>\n    </>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme) => ({\n  annotationValueInput: css`\n    width: 426px;\n  `,\n  textarea: css`\n    height: 76px;\n  `,\n  addAnnotationsButton: css`\n    flex-grow: 0;\n    align-self: flex-start;\n    margin-left: 148px;\n  `,\n  flexColumn: css`\n    display: flex;\n    flex-direction: column;\n  `,\n  field: css`\n    margin-bottom: ${theme.spacing.xs};\n  `,\n  flexRow: css`\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n  `,\n  flexRowItemMargin: css`\n    margin-left: ${theme.spacing.xs};\n  `,\n});\n\nexport default AnnotationsField;\n","import React, { FC } from 'react';\nimport { Button, Field, FieldArray, Input, InlineLabel, Label, useStyles } from '@grafana/ui';\nimport { GrafanaTheme } from '@grafana/data';\nimport { css, cx } from '@emotion/css';\nimport { useFormContext } from 'react-hook-form';\n\ninterface Props {\n  className?: string;\n}\n\nconst LabelsField: FC<Props> = ({ className }) => {\n  const styles = useStyles(getStyles);\n  const {\n    register,\n    control,\n    watch,\n    formState: { errors },\n  } = useFormContext();\n  const labels = watch('labels');\n  return (\n    <div className={cx(className, styles.wrapper)}>\n      <Label>Custom Labels</Label>\n      <FieldArray control={control} name=\"labels\">\n        {({ fields, append, remove }) => {\n          return (\n            <>\n              <div className={styles.flexRow}>\n                <InlineLabel width={18}>Labels</InlineLabel>\n                <div className={styles.flexColumn}>\n                  {fields.map((field, index) => {\n                    return (\n                      <div key={field.id}>\n                        <div className={cx(styles.flexRow, styles.centerAlignRow)}>\n                          <Field\n                            className={styles.labelInput}\n                            invalid={!!errors.labels?.[index]?.key?.message}\n                            error={errors.labels?.[index]?.key?.message}\n                          >\n                            <Input\n                              {...register(`labels[${index}].key`, {\n                                required: { value: !!labels[index]?.value, message: 'Required.' },\n                              })}\n                              placeholder=\"key\"\n                              data-testid={`label-key-${index}`}\n                              defaultValue={field.key}\n                            />\n                          </Field>\n                          <InlineLabel className={styles.equalSign}>=</InlineLabel>\n                          <Field\n                            className={styles.labelInput}\n                            invalid={!!errors.labels?.[index]?.value?.message}\n                            error={errors.labels?.[index]?.value?.message}\n                          >\n                            <Input\n                              {...register(`labels[${index}].value`, {\n                                required: { value: !!labels[index]?.key, message: 'Required.' },\n                              })}\n                              placeholder=\"value\"\n                              data-testid={`label-value-${index}`}\n                              defaultValue={field.value}\n                            />\n                          </Field>\n                          <Button\n                            className={styles.deleteLabelButton}\n                            aria-label=\"delete label\"\n                            icon=\"trash-alt\"\n                            variant=\"secondary\"\n                            onClick={() => {\n                              remove(index);\n                            }}\n                          />\n                        </div>\n                      </div>\n                    );\n                  })}\n                  <Button\n                    className={styles.addLabelButton}\n                    icon=\"plus-circle\"\n                    type=\"button\"\n                    variant=\"secondary\"\n                    onClick={() => {\n                      append({});\n                    }}\n                  >\n                    Add label\n                  </Button>\n                </div>\n              </div>\n            </>\n          );\n        }}\n      </FieldArray>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme) => {\n  return {\n    wrapper: css`\n      margin-top: ${theme.spacing.md};\n    `,\n    flexColumn: css`\n      display: flex;\n      flex-direction: column;\n    `,\n    flexRow: css`\n      display: flex;\n      flex-direction: row;\n      justify-content: flex-start;\n\n      & + button {\n        margin-left: ${theme.spacing.xs};\n      }\n    `,\n    deleteLabelButton: css`\n      margin-left: ${theme.spacing.xs};\n      align-self: flex-start;\n    `,\n    addLabelButton: css`\n      flex-grow: 0;\n      align-self: flex-start;\n    `,\n    centerAlignRow: css`\n      align-items: baseline;\n    `,\n    equalSign: css`\n      align-self: flex-start;\n      width: 28px;\n      justify-content: center;\n      margin-left: ${theme.spacing.xs};\n    `,\n    labelInput: css`\n      width: 183px;\n      margin-bottom: ${theme.spacing.sm};\n      & + & {\n        margin-left: ${theme.spacing.sm};\n      }\n    `,\n  };\n};\n\nexport default LabelsField;\n","import { SelectableValue } from '@grafana/data';\nimport { Input, Select } from '@grafana/ui';\nimport React, { FC, useEffect, useMemo, useState } from 'react';\n\ninterface Props {\n  onChange: (value: string) => void;\n  options: Array<SelectableValue<string>>;\n  value?: string;\n  addLabel?: string;\n  className?: string;\n  placeholder?: string;\n  custom?: boolean;\n  onCustomChange?: (custom: boolean) => void;\n  width?: number;\n  disabled?: boolean;\n  'aria-label'?: string;\n}\n\nexport const SelectWithAdd: FC<Props> = ({\n  value,\n  onChange,\n  options,\n  className,\n  placeholder,\n  width,\n  custom,\n  onCustomChange,\n  disabled = false,\n  addLabel = '+ Add new',\n  'aria-label': ariaLabel,\n}) => {\n  const [isCustom, setIsCustom] = useState(custom);\n\n  useEffect(() => {\n    if (custom) {\n      setIsCustom(custom);\n    }\n  }, [custom]);\n\n  const _options = useMemo(\n    (): Array<SelectableValue<string>> => [...options, { value: '__add__', label: addLabel }],\n    [options, addLabel]\n  );\n\n  if (isCustom) {\n    return (\n      <Input\n        aria-label={ariaLabel}\n        width={width}\n        autoFocus={!custom}\n        value={value || ''}\n        placeholder={placeholder}\n        className={className}\n        disabled={disabled}\n        onChange={(e) => onChange((e.target as HTMLInputElement).value)}\n      />\n    );\n  } else {\n    return (\n      <Select\n        menuShouldPortal\n        aria-label={ariaLabel}\n        width={width}\n        options={_options}\n        value={value}\n        className={className}\n        placeholder={placeholder}\n        disabled={disabled}\n        onChange={(val: SelectableValue) => {\n          const value = val?.value;\n          if (value === '__add__') {\n            setIsCustom(true);\n            if (onCustomChange) {\n              onCustomChange(true);\n            }\n            onChange('');\n          } else {\n            onChange(value);\n          }\n        }}\n      />\n    );\n  }\n};\n","import { FolderDTO } from 'app/types';\nimport { useDispatch } from 'react-redux';\nimport { useUnifiedAlertingSelector } from './useUnifiedAlertingSelector';\nimport { useEffect } from 'react';\nimport { fetchFolderIfNotFetchedAction } from '../state/actions';\nimport { initialAsyncRequestState } from '../utils/redux';\n\ninterface ReturnBag {\n  folder?: FolderDTO;\n  loading: boolean;\n}\n\nexport function useFolder(uid?: string): ReturnBag {\n  const dispatch = useDispatch();\n  const folderRequests = useUnifiedAlertingSelector((state) => state.folders);\n  useEffect(() => {\n    if (uid) {\n      dispatch(fetchFolderIfNotFetchedAction(uid));\n    }\n  }, [dispatch, uid]);\n\n  if (uid) {\n    const request = folderRequests[uid] || initialAsyncRequestState;\n    return {\n      folder: request.result,\n      loading: request.loading,\n    };\n  }\n  return {\n    loading: false,\n  };\n}\n","import { contextSrv } from 'app/core/services/context_srv';\nimport { isGrafanaRulerRule } from '../utils/rules';\nimport { RulerRuleDTO } from 'app/types/unified-alerting-dto';\nimport { useFolder } from './useFolder';\nimport { useUnifiedAlertingSelector } from './useUnifiedAlertingSelector';\nimport { useDispatch } from 'react-redux';\nimport { useEffect } from 'react';\nimport { checkIfLotexSupportsEditingRulesAction } from '../state/actions';\nimport { GRAFANA_RULES_SOURCE_NAME } from '../utils/datasource';\n\ninterface ResultBag {\n  isEditable?: boolean;\n  loading: boolean;\n}\n\nexport function useIsRuleEditable(rulesSourceName: string, rule?: RulerRuleDTO): ResultBag {\n  const checkEditingRequests = useUnifiedAlertingSelector((state) => state.lotexSupportsRuleEditing);\n  const dispatch = useDispatch();\n  const folderUID = rule && isGrafanaRulerRule(rule) ? rule.grafana_alert.namespace_uid : undefined;\n\n  const { folder, loading } = useFolder(folderUID);\n\n  useEffect(() => {\n    if (checkEditingRequests[rulesSourceName] === undefined && rulesSourceName !== GRAFANA_RULES_SOURCE_NAME) {\n      dispatch(checkIfLotexSupportsEditingRulesAction(rulesSourceName));\n    }\n  }, [rulesSourceName, checkEditingRequests, dispatch]);\n\n  if (!rule) {\n    return { isEditable: false, loading: false };\n  }\n\n  // grafana rules can be edited if user can edit the folder they're in\n  if (isGrafanaRulerRule(rule)) {\n    if (!folderUID) {\n      throw new Error(\n        `Rule ${rule.grafana_alert.title} does not have a folder uid, cannot determine if it is editable.`\n      );\n    }\n    return {\n      isEditable: folder?.canSave,\n      loading,\n    };\n  }\n\n  // prom rules are only editable by users with Editor role and only if rules source supports editing\n  return {\n    isEditable: contextSrv.isEditor && !!checkEditingRequests[rulesSourceName]?.result,\n    loading: !!checkEditingRequests[rulesSourceName]?.loading,\n  };\n}\n","import { RelativeTimeRange } from '@grafana/data';\nimport { AlertQuery } from 'app/types/unified-alerting-dto';\nimport { ExpressionQuery, ExpressionQueryType } from '../../../expressions/types';\n\nconst FALL_BACK_TIME_RANGE = { from: 21600, to: 0 };\n\nexport const getTimeRangeForExpression = (query: ExpressionQuery, queries: AlertQuery[]): RelativeTimeRange => {\n  const referencedRefIds: string[] | undefined = getReferencedIds(query, queries);\n\n  if (!referencedRefIds) {\n    return FALL_BACK_TIME_RANGE;\n  }\n\n  const { from, to } = getTimeRanges(referencedRefIds, queries);\n\n  if (!from.length && !to.length) {\n    return FALL_BACK_TIME_RANGE;\n  }\n\n  return {\n    from: Math.max(...from),\n    to: Math.min(...to),\n  };\n};\n\nconst getReferencedIds = (model: ExpressionQuery, queries: AlertQuery[]): string[] | undefined => {\n  switch (model.type) {\n    case ExpressionQueryType.classic:\n      return getReferencedIdsForClassicCondition(model);\n    case ExpressionQueryType.math:\n      return getReferencedIdsForMath(model, queries);\n    case ExpressionQueryType.resample:\n    case ExpressionQueryType.reduce:\n      return getReferencedIdsForReduce(model);\n  }\n};\n\nconst getReferencedIdsForClassicCondition = (model: ExpressionQuery) => {\n  return model.conditions?.map((condition) => {\n    return condition.query.params[0];\n  });\n};\n\nconst getTimeRanges = (referencedRefIds: string[], queries: AlertQuery[]) => {\n  let from: number[] = [];\n  let to = [FALL_BACK_TIME_RANGE.to];\n  for (const referencedRefIdsKey of referencedRefIds) {\n    const query = queries.find((query) => query.refId === referencedRefIdsKey);\n\n    if (!query || !query.relativeTimeRange) {\n      continue;\n    }\n    from.push(query.relativeTimeRange.from);\n    to.push(query.relativeTimeRange.to);\n  }\n\n  return {\n    from,\n    to,\n  };\n};\n\nconst getReferencedIdsForMath = (model: ExpressionQuery, queries: AlertQuery[]) => {\n  return (\n    queries\n      // filter queries of type query and filter expression on if it includes any refIds\n      .filter((q) => q.queryType === 'query' && model.expression?.includes(q.refId))\n      .map((q) => {\n        return q.refId;\n      })\n  );\n};\n\nconst getReferencedIdsForReduce = (model: ExpressionQuery) => {\n  return model.expression ? [model.expression] : undefined;\n};\n","import { Observable, of, OperatorFunction, ReplaySubject, Unsubscribable } from 'rxjs';\nimport { catchError, map, share } from 'rxjs/operators';\nimport { v4 as uuidv4 } from 'uuid';\nimport {\n  dataFrameFromJSON,\n  DataFrameJSON,\n  getDefaultTimeRange,\n  LoadingState,\n  PanelData,\n  rangeUtil,\n  TimeRange,\n  withLoadingIndicator,\n} from '@grafana/data';\nimport { FetchResponse, getDataSourceSrv, toDataQueryError } from '@grafana/runtime';\nimport { BackendSrv, getBackendSrv } from 'app/core/services/backend_srv';\nimport { preProcessPanelData } from 'app/features/query/state/runRequest';\nimport { AlertQuery } from 'app/types/unified-alerting-dto';\nimport { getTimeRangeForExpression } from '../utils/timeRange';\nimport { isExpressionQuery } from 'app/features/expressions/guards';\nimport { setStructureRevision } from 'app/features/query/state/processing/revision';\nimport { cancelNetworkRequestsOnUnsubscribe } from 'app/features/query/state/processing/canceler';\n\nexport interface AlertingQueryResult {\n  frames: DataFrameJSON[];\n}\n\nexport interface AlertingQueryResponse {\n  results: Record<string, AlertingQueryResult>;\n}\nexport class AlertingQueryRunner {\n  private subject: ReplaySubject<Record<string, PanelData>>;\n  private subscription?: Unsubscribable;\n  private lastResult: Record<string, PanelData>;\n\n  constructor(private backendSrv = getBackendSrv(), private dataSourceSrv = getDataSourceSrv()) {\n    this.subject = new ReplaySubject(1);\n    this.lastResult = {};\n  }\n\n  get(): Observable<Record<string, PanelData>> {\n    return this.subject.asObservable();\n  }\n\n  async run(queries: AlertQuery[]) {\n    if (queries.length === 0) {\n      const empty = initialState(queries, LoadingState.Done);\n      return this.subject.next(empty);\n    }\n\n    // do not execute if one more of the queries are not runnable,\n    // for example not completely configured\n    for (const query of queries) {\n      if (!isExpressionQuery(query.model)) {\n        const ds = await this.dataSourceSrv.get(query.datasourceUid);\n        if (ds.filterQuery && !ds.filterQuery(query.model)) {\n          const empty = initialState(queries, LoadingState.Done);\n          return this.subject.next(empty);\n        }\n      }\n    }\n\n    this.subscription = runRequest(this.backendSrv, queries).subscribe({\n      next: (dataPerQuery) => {\n        const nextResult = applyChange(dataPerQuery, (refId, data) => {\n          const previous = this.lastResult[refId];\n          const preProcessed = preProcessPanelData(data, previous);\n          return setStructureRevision(preProcessed, previous);\n        });\n\n        this.lastResult = nextResult;\n        this.subject.next(this.lastResult);\n      },\n\n      error: (error: Error) => {\n        this.lastResult = mapErrorToPanelData(this.lastResult, error);\n        this.subject.next(this.lastResult);\n      },\n    });\n  }\n\n  cancel() {\n    if (!this.subscription) {\n      return;\n    }\n    this.subscription.unsubscribe();\n\n    let requestIsRunning = false;\n\n    const nextResult = applyChange(this.lastResult, (refId, data) => {\n      if (data.state === LoadingState.Loading) {\n        requestIsRunning = true;\n      }\n\n      return {\n        ...data,\n        state: LoadingState.Done,\n      };\n    });\n\n    if (requestIsRunning) {\n      this.subject.next(nextResult);\n    }\n  }\n\n  destroy() {\n    if (this.subject) {\n      this.subject.complete();\n    }\n\n    this.cancel();\n  }\n}\n\nconst runRequest = (backendSrv: BackendSrv, queries: AlertQuery[]): Observable<Record<string, PanelData>> => {\n  const initial = initialState(queries, LoadingState.Loading);\n  const request = {\n    data: { data: queries },\n    url: '/api/v1/eval',\n    method: 'POST',\n    requestId: uuidv4(),\n  };\n\n  return withLoadingIndicator({\n    whileLoading: initial,\n    source: backendSrv.fetch<AlertingQueryResponse>(request).pipe(\n      mapToPanelData(initial),\n      catchError((error) => of(mapErrorToPanelData(initial, error))),\n      cancelNetworkRequestsOnUnsubscribe(backendSrv, request.requestId),\n      share()\n    ),\n  });\n};\n\nconst initialState = (queries: AlertQuery[], state: LoadingState): Record<string, PanelData> => {\n  return queries.reduce((dataByQuery: Record<string, PanelData>, query) => {\n    dataByQuery[query.refId] = {\n      state,\n      series: [],\n      timeRange: getTimeRange(query, queries),\n    };\n\n    return dataByQuery;\n  }, {});\n};\n\nconst getTimeRange = (query: AlertQuery, queries: AlertQuery[]): TimeRange => {\n  if (isExpressionQuery(query.model)) {\n    const relative = getTimeRangeForExpression(query.model, queries);\n    return rangeUtil.relativeToTimeRange(relative);\n  }\n\n  if (!query.relativeTimeRange) {\n    console.warn(`Query with refId: ${query.refId} did not have any relative time range, using default.`);\n    return getDefaultTimeRange();\n  }\n\n  return rangeUtil.relativeToTimeRange(query.relativeTimeRange);\n};\n\nconst mapToPanelData = (\n  dataByQuery: Record<string, PanelData>\n): OperatorFunction<FetchResponse<AlertingQueryResponse>, Record<string, PanelData>> => {\n  return map((response) => {\n    const { data } = response;\n    const results: Record<string, PanelData> = {};\n\n    for (const [refId, result] of Object.entries(data.results)) {\n      results[refId] = {\n        timeRange: dataByQuery[refId].timeRange,\n        state: LoadingState.Done,\n        series: result.frames.map(dataFrameFromJSON),\n      };\n    }\n\n    return results;\n  });\n};\n\nconst mapErrorToPanelData = (lastResult: Record<string, PanelData>, error: Error): Record<string, PanelData> => {\n  const queryError = toDataQueryError(error);\n\n  return applyChange(lastResult, (refId, data) => {\n    return {\n      ...data,\n      state: LoadingState.Error,\n      error: queryError,\n    };\n  });\n};\n\nconst applyChange = (\n  initial: Record<string, PanelData>,\n  change: (refId: string, data: PanelData) => PanelData\n): Record<string, PanelData> => {\n  const nextResult: Record<string, PanelData> = {};\n\n  for (const [refId, data] of Object.entries(initial)) {\n    nextResult[refId] = change(refId, data);\n  }\n\n  return nextResult;\n};\n","import { DataQuery } from '@grafana/data';\nimport { isExpressionReference } from '@grafana/runtime/src/utils/DataSourceWithBackend';\nimport { ExpressionQuery, ExpressionQueryType } from './types';\n\nexport const isExpressionQuery = (dataQuery?: DataQuery): dataQuery is ExpressionQuery => {\n  if (!dataQuery) {\n    return false;\n  }\n\n  if (isExpressionReference(dataQuery.datasource)) {\n    return true;\n  }\n\n  const expression = dataQuery as ExpressionQuery;\n\n  if (typeof expression.type !== 'string') {\n    return false;\n  }\n  return Object.values(ExpressionQueryType).includes(expression.type);\n};\n"],"names":["useCleanup","stateSelector","dispatch","useDispatch","selectorRef","useRef","current","useEffect","cleanUpAction","RuleEditorSection","title","stepNo","children","description","styles","useStyles2","getStyles","className","parent","content","FieldSet","label","fieldset","theme","css","spacing","breakpoints","values","xl","colors","text","maxContrast","background","canvas","typography","size","lg","updateMathExpressionRefs","expression","previousRefId","newRefId","oldExpression","RegExp","newExpression","replace","checkForPathSeparator","value","includes","GroupAndNamespaceFields","rulesSourceName","control","watch","formState","errors","setValue","useFormContext","style","getStyle","customGroup","setCustomGroup","useState","rulerRequests","useUnifiedAlertingSelector","state","rulerRules","fetchRulerRulesAction","rulesConfig","result","namespace","namespaceOptions","useMemo","Object","keys","map","groupOptions","group","name","flexRow","Field","error","message","invalid","InputControl","render","field","onChange","input","onCustomChange","custom","options","width","rules","required","validate","pathSeparator","CloudRulesSourcePicker","props","rulesSourcesWithRuler","checkEditingRequests","lotexSupportsRuleEditing","getRulesDataSources","filter","ds","undefined","forEach","checkIfLotexSupportsEditingRulesAction","useRulesSourcesWithRuler","dataSourceFilter","useCallback","find","id","DataSourcePicker","noDefault","alerting","recordingRuleNameValidationPattern","AlertTypeStep","editingExistingRule","register","ruleFormType","dataSourceName","alertTypeOptions","RuleFormType","contextSrv","push","formInput","Input","pattern","autoFocus","disabled","type","Select","menuShouldPortal","v","folder","RuleFolderPicker","enableCreateNew","enableReset","DetailsStep","AnnotationsField","LabelsField","ExpressionEditor","mapToValue","mapToQuery","settings","getDataSourceSrv","getInstanceSettings","query","expr","existing","Error","useQueryMappers","setQuery","refId","hide","loading","dataSource","useAsync","get","onChangeQuery","components","QueryEditor","errorMessage","queries","app","CoreApp","onRunQuery","noop","datasource","VizWrapper","data","currentPanel","changePanel","onThresholdsChange","thresholds","setOptions","frameIndex","showHeader","vizHeight","pluginId","useTheme2","TIMESERIES","STAT","series","fields","dataIsEmpty","length","rowHeight","gridSize","tableHeight","useVizHeight","fieldConfig","setFieldConfig","defaults","overrides","unit","defaultUnit","thresholdsStyle","mode","GraphTresholdsStyleMode","defaultFieldConfig","context","eventBus","appEvents","canEditThresholds","wrapper","buttonGroup","PanelPluginsButtonGroup","height","PanelContextProvider","PanelRenderer","onOptionsChange","visHeight","config","QueryWrapper","dsSettings","index","onChangeDataSource","onChangeTimeRange","onRunQueries","onRemoveQuery","onDuplicateQuery","onChangeThreshold","isExpression","isExpressionQuery","model","changePluginId","TABLE","QueryEditorRow","cloneDeep","onAddQuery","renderHeaderExtras","RelativeTimeRangePicker","timeRange","relativeTimeRange","getDefaultRelativeTimeRange","range","renderTimePicker","visualization","LoadingState","hideDisableQuery","EmptyQueryWrapper","border","medium","shape","borderRadius","QueryRows","PureComponent","constructor","super","this","onQueriesChange","item","itemIndex","referencedRefId","conditions","params","condition","conditionIndex","evaluator","parseFloat","steps","toPrecision","uid","omit","datasourceUid","copyModel","isMathExpression","isReduceExpression","isResampleExpression","isClassicExpression","isReferencing","param","queriesWithUpdatedReferences","queryType","destination","startIndex","source","endIndex","update","Array","from","removed","splice","record","isArray","threshold","ThresholdsMode","Infinity","color","dataPerQuery","thresholdByRefId","getThresholdsForQueries","onDragEnd","droppableId","direction","provided","ref","innerRef","droppableProps","getDataSourceSettings","DatasourceNotFound","onUpdateDatasource","defaultDataSource","getDatasourceSrv","placeholder","showDetails","setShowDetails","QueryOperationRow","draggable","isOpen","Card","heading","Icon","Button","variant","onClick","show","icon","fill","JSON","stringify","runner","run","cancel","onChangeQueries","addQuery","ExpressionDatasourceUID","expressionDatasource","ExpressionQueryType","defaultCondition","panelDataByRefId","AlertingQueryRunner","componentDidMount","subscribe","setState","componentWillUnmount","destroy","renderAddQueryRow","HorizontalGroup","align","onNewAlertingQuery","selectors","onNewExpressionQuery","expressionButton","isRunning","d","Boolean","renderRunQueryButton","runWrapper","onCancelQueries","container","queryToAdd","getNextRefIdChar","defaultTimeRange","stylesFactory","primary","xxl","editorWrapper","QueryStep","previewAlertRule","request","isCloudPreviewRequest","previewCloudAlertRule","isGrafanaPreviewRequest","withLoadingIndicator","whileLoading","createResponse","getBackendSrv","fetch","method","url","pipe","instances","dataFrameFromJSON","catchError","of","toDataQueryError","share","previewGrafanaAlertRule","ruleType","getDefaultTimeRange","PreviewRuleResult","preview","matcher","FieldMatcherID","properties","TableCellDisplayMode","messageFromError","table","PreviewRule","onPreview","setPreview","getValues","isMounted","useMountedState","grafana_condition","now","dateTimeFormatISO","Date","createPreviewRequest","takeWhile","response","isCompleted","usePreview","CloudConditionsStep","useStyles","forTime","inlineField","timeOptions","timeUnit","xs","ConditionField","q","expressions","noOptionsMessage","GrafanaAlertStateDecision","GrafanaAlertStatePicker","includeNoData","includeError","opts","opt","GrafanaConditionEvalWarning","evaluateFor","evaluateEvery","durationFor","parseDuration","durationEvery","isEmpty","millisFor","durationToMilliseconds","millisEvery","Alert","severity","forValidationOptions","durationValidationPattern","evaluateEveryValidationOptions","positiveDurationValidationPattern","duration","diff","MIN_TIME_RANGE_STEP_S","GrafanaConditionsStep","showErrorHandling","setShowErrorHandling","evaluateEveryId","evaluateForId","InlineLabel","htmlFor","tooltip","validationMessageHorizontalOverflow","CollapseToggle","isCollapsed","onToggle","collapsed","collapseToggle","inputId","AlertRuleForm","queryParams","useQueryParams","returnTo","showDeleteModal","setShowDeleteModal","defaultValues","rulerRuleToFormValues","getDefaultFormValues","getDefaultQueries","parse","formAPI","useForm","shouldFocusError","handleSubmit","showStep2","submitState","ruleForm","saveRule","initialAsyncRequestState","unifiedAlerting","submit","exitOnSave","saveRuleFormAction","annotations","key","trim","labels","redirectOnSave","onInvalid","AppEvents","onSubmit","e","preventDefault","form","PageToolbar","pageIcon","Link","to","Spinner","buttonSpinner","inline","contentOuter","CustomScrollbar","autoHeightMin","hideHorizontalTrack","contentInner","ConfirmModal","body","confirmText","onConfirm","identifier","ruleId","ruleSourceName","rule","deleteRuleAction","navigateTo","onDismiss","weak","ExistingRuleEditor","existingRule","dispatched","isEditable","useIsRuleEditable","fetchEditableRuleAction","Page","LoadingPlaceholder","AlertWarning","warningStyles","warning","LinkButton","href","withErrorBoundary","match","panels","reduce","panel","isSupportedPanelPlugin","imgUrl","info","logos","small","RadioButtonGroup","AnnotationKeyInput","existingKeys","ariaLabel","rest","annotationOptions","Annotation","annotationLabels","annotationValueInput","textarea","addAnnotationsButton","flexColumn","flexRowItemMargin","_","idx","Label","FieldArray","append","remove","isUrl","toLocaleLowerCase","endsWith","ValueInputComponent","TextArea","cx","defaultValue","md","deleteLabelButton","addLabelButton","centerAlignRow","equalSign","labelInput","sm","SelectWithAdd","addLabel","isCustom","setIsCustom","_options","target","val","useFolder","folderRequests","folders","fetchFolderIfNotFetchedAction","folderUID","isGrafanaRulerRule","grafana_alert","namespace_uid","GRAFANA_RULES_SOURCE_NAME","canSave","FALL_BACK_TIME_RANGE","getReferencedIds","getReferencedIdsForClassicCondition","getReferencedIdsForMath","getReferencedIdsForReduce","getTimeRanges","referencedRefIds","referencedRefIdsKey","backendSrv","dataSourceSrv","subject","ReplaySubject","lastResult","asObservable","empty","initialState","next","filterQuery","subscription","runRequest","nextResult","applyChange","previous","preProcessed","preProcessPanelData","setStructureRevision","mapErrorToPanelData","unsubscribe","requestIsRunning","complete","initial","requestId","uuidv4","mapToPanelData","cancelNetworkRequestsOnUnsubscribe","dataByQuery","getTimeRange","relative","Math","max","min","getTimeRangeForExpression","rangeUtil","console","warn","results","entries","frames","queryError","change","dataQuery","isExpressionReference"],"sourceRoot":""}