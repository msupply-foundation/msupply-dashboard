"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4286],{"./public/app/features/alerting/AlertRuleList.tsx":(e,t,a)=>{a.r(t),a.d(t,{AlertRuleListUnconnected:()=>P,default:()=>R});var s=a("./node_modules/react/index.js"),n=a("./node_modules/react-redux/es/index.js"),r=a("./public/app/core/components/Page/Page.tsx"),i=a("./node_modules/react-highlight-words/dist/main.js"),l=a.n(i),o=a("./packages/grafana-ui/src/index.ts"),c=a("./node_modules/react/jsx-runtime.js");const u=({rule:e,search:t,onTogglePause:a})=>{const n=`${e.url}?editPanel=${e.panelId}&tab=alert`,r=(0,s.useCallback)((e=>(0,c.jsx)(l(),{highlightClassName:"highlight-search-match",textToHighlight:e,searchWords:[t]},e)),[t]);return(0,c.jsxs)(o.Card,{heading:(0,c.jsx)("a",{href:n,children:r(e.name)}),children:[(0,c.jsx)(o.Card.Figure,{children:(0,c.jsx)(o.Icon,{size:"xl",name:e.stateIcon,className:`alert-rule-item__icon ${e.stateClass}`})}),(0,c.jsxs)(o.Card.Meta,{children:[(0,c.jsxs)("span",{children:[(0,c.jsxs)("span",{className:`${e.stateClass}`,children:[r(e.stateText)," "]},"text"),"for ",e.stateAge]},"state"),e.info?r(e.info):null]}),(0,c.jsxs)(o.Card.Actions,{children:[(0,c.jsx)(o.Button,{variant:"secondary",icon:"paused"===e.state?"play":"pause",onClick:a,children:"paused"===e.state?"Resume":"Pause"},"play"),(0,c.jsx)(o.LinkButton,{variant:"secondary",href:n,icon:"cog",children:"Edit alert"},"edit")]})]})};var d=a("./public/app/core/app_events.ts"),p=a("./public/app/core/selectors/navModel.ts"),h=a("./public/app/features/alerting/state/actions.ts");const g=e=>e.searchQuery,f=e=>{const t=new RegExp(e.alertRules.searchQuery,"i");return e.alertRules.items.filter((e=>t.test(e.name)||t.test(e.stateText)||t.test(e.info)))};var m,v,x,b,j=a("./packages/grafana-runtime/src/index.ts"),y=a("./public/app/features/alerting/state/reducers.ts"),S=a("./public/app/types/events.ts");function k({onDismiss:e}){return(0,c.jsx)(o.Modal,{title:"Adding an Alert",isOpen:!0,onDismiss:e,onClickBackdrop:e,children:m||(m=(0,c.jsxs)(o.VerticalGroup,{spacing:"sm",children:[(0,c.jsx)("img",{src:"public/img/alert_howto_new.png",alt:"link to how to alert image"}),(0,c.jsx)("p",{children:"Alerts are added and configured in the Alert tab of any dashboard graph panel, letting you build and visualize an alert using existing queries."}),(0,c.jsx)("p",{children:"Remember to save the dashboard to persist your alert rule changes."})]}))})}function A(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const w={getAlertRulesAsync:h.Au,setSearchQuery:y.ql,togglePauseAlertRule:h.en},C=(0,n.connect)((function(e){return{navModel:(0,p.h)(e.navIndex,"alert-list"),alertRules:f(e),search:g(e.alertRules),isLoading:e.alertRules.isLoading}}),w);class P extends s.PureComponent{constructor(...e){super(...e),A(this,"stateFilters",[{label:"All",value:"all"},{label:"OK",value:"ok"},{label:"Not OK",value:"not_ok"},{label:"Alerting",value:"alerting"},{label:"No data",value:"no_data"},{label:"Paused",value:"paused"},{label:"Pending",value:"pending"}]),A(this,"onStateFilterChanged",(e=>{j.locationService.partial({state:e.value})})),A(this,"onOpenHowTo",(()=>{d.Z.publish(new S.Dn({component:k}))})),A(this,"onSearchQueryChange",(e=>{this.props.setSearchQuery(e)})),A(this,"onTogglePause",(e=>{this.props.togglePauseAlertRule(e.id,{paused:"paused"!==e.state})})),A(this,"alertStateFilterOption",(({text:e,value:t})=>(0,c.jsx)("option",{value:t,children:e},t)))}componentDidMount(){this.fetchRules()}componentDidUpdate(e){e.queryParams.state!==this.props.queryParams.state&&this.fetchRules()}async fetchRules(){await this.props.getAlertRulesAsync({state:this.getStateFilter()})}getStateFilter(){var e;return null!==(e=this.props.queryParams.state)&&void 0!==e?e:"all"}render(){const{navModel:e,alertRules:t,search:a,isLoading:s}=this.props;return(0,c.jsx)(r.Z,{navModel:e,children:(0,c.jsxs)(r.Z.Contents,{isLoading:s,children:[(0,c.jsxs)("div",{className:"page-action-bar",children:[(0,c.jsx)("div",{className:"gf-form gf-form--grow",children:(0,c.jsx)(o.FilterInput,{placeholder:"Search alerts",value:a,onChange:this.onSearchQueryChange})}),(0,c.jsxs)("div",{className:"gf-form",children:[v||(v=(0,c.jsx)("label",{className:"gf-form-label",children:"States"})),(0,c.jsx)("div",{className:"width-13",children:(0,c.jsx)(o.Select,{menuShouldPortal:!0,options:this.stateFilters,onChange:this.onStateFilterChanged,value:this.getStateFilter()})})]}),x||(x=(0,c.jsx)("div",{className:"page-action-bar__spacer"})),j.config.unifiedAlertingEnabled&&(b||(b=(0,c.jsx)(o.LinkButton,{variant:"primary",href:"alerting/ng/new",children:"Add NG Alert"}))),(0,c.jsx)(o.Button,{variant:"secondary",onClick:this.onOpenHowTo,children:"How to add an alert"})]}),(0,c.jsx)(o.VerticalGroup,{spacing:"none",children:t.map((e=>(0,c.jsx)(u,{rule:e,search:a,onTogglePause:()=>this.onTogglePause(e)},e.id)))})]})})}}const R=C(P)},"./public/app/features/alerting/state/actions.ts":(e,t,a)=>{a.d(t,{Au:()=>l,en:()=>o,C2:()=>c,fg:()=>u,c1:()=>d,fA:()=>p,tk:()=>h});var s=a("./packages/grafana-data/src/index.ts"),n=a("./packages/grafana-runtime/src/index.ts"),r=a("./public/app/core/core.ts"),i=a("./public/app/features/alerting/state/reducers.ts");function l(e){return async t=>{t((0,i.gz)());const a=await(0,n.getBackendSrv)().get("/api/alerts",e);t((0,i.Oc)(a))}}function o(e,t){return async a=>{await(0,n.getBackendSrv)().post(`/api/alerts/${e}/pause`,t);a(l({state:(n.locationService.getSearchObject().state||"all").toString()}))}}function c(e){return async t=>{try{await(0,n.getBackendSrv)().post("/api/alert-notifications",e),r.h$.emit(s.AppEvents.alertSuccess,["Notification created"]),n.locationService.push("/alerting/notifications")}catch(e){r.h$.emit(s.AppEvents.alertError,[e.data.error])}}}function u(e){return async t=>{try{await(0,n.getBackendSrv)().put(`/api/alert-notifications/${e.id}`,e),r.h$.emit(s.AppEvents.alertSuccess,["Notification updated"])}catch(e){r.h$.emit(s.AppEvents.alertError,[e.data.error])}}}function d(e){return async(t,a)=>{const s=a().notificationChannel.notificationChannel;await(0,n.getBackendSrv)().post("/api/alert-notifications/test",Object.assign({id:s.id},e))}}function p(){return async e=>{const t=(await(0,n.getBackendSrv)().get("/api/alert-notifiers")).sort(((e,t)=>e.name>t.name?1:-1));e((0,i.T2)(t))}}function h(e){return async t=>{await t(p());const a=await(0,n.getBackendSrv)().get(`/api/alert-notifications/${e}`);t((0,i.K)(a))}}}}]);
//# sourceMappingURL=AlertRuleList.0e7ce18a6cf0f8775a65.js.map