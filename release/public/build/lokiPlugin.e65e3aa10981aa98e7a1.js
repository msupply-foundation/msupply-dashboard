"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1598],{"./public/app/plugins/datasource/loki/module.ts":(e,t,a)=>{a.r(t),a.d(t,{plugin:()=>ia});var r=a("./packages/grafana-data/src/index.ts"),s=a("./.yarn/cache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),n=a("./.yarn/cache/rxjs-npm-7.5.1-ce59cbb6a3-78e3eecb16.zip/node_modules/rxjs/dist/esm5/internal/observable/throwError.js"),i=a("./.yarn/cache/rxjs-npm-7.5.1-ce59cbb6a3-78e3eecb16.zip/node_modules/rxjs/dist/esm5/internal/lastValueFrom.js"),o=a("./.yarn/cache/rxjs-npm-7.5.1-ce59cbb6a3-78e3eecb16.zip/node_modules/rxjs/dist/esm5/internal/observable/of.js"),l=a("./.yarn/cache/rxjs-npm-7.5.1-ce59cbb6a3-78e3eecb16.zip/node_modules/rxjs/dist/esm5/internal/observable/merge.js"),c=a("./.yarn/cache/rxjs-npm-7.5.1-ce59cbb6a3-78e3eecb16.zip/node_modules/rxjs/dist/esm5/internal/operators/map.js"),u=a("./.yarn/cache/rxjs-npm-7.5.1-ce59cbb6a3-78e3eecb16.zip/node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),d=a("./.yarn/cache/rxjs-npm-7.5.1-ce59cbb6a3-78e3eecb16.zip/node_modules/rxjs/dist/esm5/internal/operators/switchMap.js"),p=a("./.yarn/cache/prismjs-npm-1.26.0-15be1ab06b-6de058930c.zip/node_modules/prismjs/prism.js"),m=a.n(p),h=a("./packages/grafana-runtime/src/index.ts"),g=a("./public/app/features/templating/template_srv.ts"),f=a("./public/app/plugins/datasource/loki/syntax.ts"),b=a("./public/app/plugins/datasource/prometheus/promql.ts");const y=[...b.YO,...b.fP,...b.Os,...f.zy],v=/([A-Za-z:][\w:]*)\b(?![\]{=!",])/g;function x(e,t,a,r,s){if(!t||!a)throw new Error("Need label to add to query.");const n=a===1/0?"+Inf":a.toString();let i;e=e.replace(v,((t,a,r)=>{const n=function(e,t,a,r,s){const n=function(e,t,a,r){const s=e.slice(t).indexOf(a),n=e.slice(t).indexOf(r);return n>-1&&(-1===s||s>n)}(e,a,"{","}"),i=r&&b.fP.indexOf(r)>-1,o=t.endsWith(":"),l='"'===e[a-1],c="$"===e[a-1],u=["s","m","h","d","w"].includes(t)&&Boolean(Number(e[a-1]));if(!(s||n||o||i||l||c||u||-1!==y.indexOf(t)))return!0;return!1}(e,a,r,i,s);return i=a,n?`${a}{}`:a}));const o=/(\$)?{([^{]*)}/g,l=[];let c=0,u="",d=o.exec(e);for(;d;){const a=e.slice(c,d.index);if(c=d.index+d[2].length+2,u=e.slice(d.index+d[0].length),d[0].startsWith("{.")||d[1])l.push(a),l.push(d[0]);else{const e=_(d[2],t,n,r);l.push(a,e)}d=o.exec(e)}return l.push(u),l.join("")}const j=/(\w+)\s*(=|!=|=~|!~)\s*("[^"]*")/g;function _(e,t,a,r){const n=[];if(e){let t=j.exec(e);for(;t;)n.push({key:t[1],operator:t[2],value:t[3]}),t=j.exec(e)}const i=r||"=";n.push({key:t,operator:i,value:`"${a}"`});return`{${(0,s.chain)(n).uniqWith(s.isEqual).compact().sortBy("key").map((e=>{let{key:t,operator:a,value:r}=e;return`${t}${a}${r}`})).value().join(",")}}`}var L=a("./public/app/features/dashboard/services/TimeSrv.ts"),w=a("./public/app/core/utils/explore.ts"),F=a("./.yarn/cache/uuid-npm-8.3.2-eca0baba53-5575a8a75c.zip/node_modules/uuid/dist/esm-browser/stringify.js"),k=a("./.yarn/cache/uuid-npm-8.3.2-eca0baba53-5575a8a75c.zip/node_modules/uuid/dist/esm-browser/validate.js");const S=function(e){if(!(0,k.Z)(e))throw TypeError("Invalid UUID");var t,a=new Uint8Array(16);return a[0]=(t=parseInt(e.slice(0,8),16))>>>24,a[1]=t>>>16&255,a[2]=t>>>8&255,a[3]=255&t,a[4]=(t=parseInt(e.slice(9,13),16))>>>8,a[5]=255&t,a[6]=(t=parseInt(e.slice(14,18),16))>>>8,a[7]=255&t,a[8]=(t=parseInt(e.slice(19,23),16))>>>8,a[9]=255&t,a[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,a[11]=t/4294967296&255,a[12]=t>>>24&255,a[13]=t>>>16&255,a[14]=t>>>8&255,a[15]=255&t,a};function T(e,t,a,r){switch(e){case 0:return t&a^~t&r;case 1:case 3:return t^a^r;case 2:return t&a^t&r^a&r}}function $(e,t){return e<<t|e>>>32-t}var C=function(e,t,a){function r(e,r,s,n){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],a=0;a<e.length;++a)t.push(e.charCodeAt(a));return t}(e)),"string"==typeof r&&(r=S(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var i=new Uint8Array(16+e.length);if(i.set(r),i.set(e,r.length),(i=a(i))[6]=15&i[6]|t,i[8]=63&i[8]|128,s){n=n||0;for(var o=0;o<16;++o)s[n+o]=i[o];return s}return(0,F.Z)(i)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],a=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var s=0;s<r.length;++s)e.push(r.charCodeAt(s))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var n=e.length/4+2,i=Math.ceil(n/16),o=new Array(i),l=0;l<i;++l){for(var c=new Uint32Array(16),u=0;u<16;++u)c[u]=e[64*l+4*u]<<24|e[64*l+4*u+1]<<16|e[64*l+4*u+2]<<8|e[64*l+4*u+3];o[l]=c}o[i-1][14]=8*(e.length-1)/Math.pow(2,32),o[i-1][14]=Math.floor(o[i-1][14]),o[i-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<i;++d){for(var p=new Uint32Array(80),m=0;m<16;++m)p[m]=o[d][m];for(var h=16;h<80;++h)p[h]=$(p[h-3]^p[h-8]^p[h-14]^p[h-16],1);for(var g=a[0],f=a[1],b=a[2],y=a[3],v=a[4],x=0;x<80;++x){var j=Math.floor(x/20),_=$(g,5)+T(j,f,b,y)+v+t[j]+p[x]>>>0;v=y,y=b,b=$(f,30)>>>0,f=g,g=_}a[0]=a[0]+g>>>0,a[1]=a[1]+f>>>0,a[2]=a[2]+b>>>0,a[3]=a[3]+y>>>0,a[4]=a[4]+v>>>0}return[a[0]>>24&255,a[0]>>16&255,a[0]>>8&255,255&a[0],a[1]>>24&255,a[1]>>16&255,a[1]>>8&255,255&a[1],a[2]>>24&255,a[2]>>16&255,a[2]>>8&255,255&a[2],a[3]>>24&255,a[3]>>16&255,a[3]>>8&255,255&a[3],a[4]>>24&255,a[4]>>16&255,a[4]>>8&255,255&a[4]]}));const O=C;var R=a("./public/app/core/table_model.ts");function q(e){return`${e||""}`.trim()}function Q(e){let t=e;const a=[];for(;t;){const e=t.search(/\|=|\|~|!=|!~/);if(-1===e)break;const r=t.substr(e,2),n=0===t.substr(e).search(/!=|!~/);if(t=t.substr(e+2),n)continue;const i=t.search(/\|=|\|~|!=|!~/);let o;-1===i?o=t.trim():(o=t.substr(0,i).trim(),t=t.substr(i));const l=o.match(/"(.*?)"/),c=o.match(/`(.*?)`/),u=l||c;if(!u)return a;{const e=u[1];"|~"===r?a.push(c?e:e.replace(/\\\\/g,"\\")):a.push((0,s.escapeRegExp)(e))}}return a}var I=a("./public/app/plugins/datasource/loki/types.ts"),E=a("./public/app/plugins/datasource/prometheus/legend.ts");function N(e,t,a){const s=e.stream,n=Object.entries(s).map((e=>{let[t,a]=e;return`${t}="${a}"`})).sort().join(""),i=new r.ArrayVector([]),o=new r.ArrayVector([]),l=new r.ArrayVector([]),c=new r.ArrayVector([]),u={};for(const[t,r]of e.values)i.add(new Date(parseInt(t.substr(0,t.length-6),10)).toISOString()),o.add(t),l.add(r),c.add(A(t,n,r,u,a));return function(e,t,a,s,n,i,o){const l={refId:o,fields:[{name:"ts",type:r.FieldType.time,config:{displayName:"Time"},values:e},{name:"line",type:r.FieldType.string,config:{},values:a,labels:n},{name:"id",type:r.FieldType.string,config:{},values:s},{name:"tsNs",type:r.FieldType.time,config:{displayName:"Time ns"},values:t}],length:e.length};if(i){const e=new r.MutableDataFrame(l);return e.reverse(),e}return l}(i,o,l,c,s,t,a)}function A(e,t,a,r,s){let n=O(`${e}_${t}_${a}`,"6ec946da-0f49-47a8-983a-1d76d17e7c92");if(n in r){const e=r[n]+1;r[n]=e,n=`${n}_${e}`}else r[n]=0;return s?`${n}_${s}`:n}function D(e,t){const a=function(e,t){var a;let r=void 0===t||(0,s.isEmpty)(t.legendFormat)?function(e){const t=e.__name__||"";delete e.__name__;const a=Object.entries(e).map((e=>`${e[0]}="${e[1]}"`)).join(",");return`${t}{${a}}`}(e):(0,E.W)((0,h.getTemplateSrv)().replace(null!==(a=t.legendFormat)&&void 0!==a?a:"",t.scopedVars),e);!r&&t&&(r=t.query);return r}(e.metric,t);return{target:a,title:a,datapoints:P(e.values),tags:e.metric,meta:t.meta,refId:t.refId}}function P(e){const t=[];for(const[a,r]of e){let e=parseFloat(r);isNaN(e)&&(e=null);const s=1e3*a;t.push([e,s])}return t}function V(e,t,a,s,n){if(!e||0===e.length)return new R.Z;const i=[...new Set(e.reduce(((e,t)=>e.concat(Object.keys(t.metric))),[])).values()].sort(),o=new R.Z;return o.refId=a,o.meta=s,o.columns=[{text:"Time",type:r.FieldType.time},...i.map((e=>({text:e,filterable:!0,type:r.FieldType.string}))),{text:t>1||n?`Value #${a}`:"Value",type:r.FieldType.number}],e.forEach((e=>{const t={metric:e.metric,values:e.value?[e.value]:e.values};t.values&&(t.metric?o.rows.push(...t.values.map((e=>{let[a,r]=e;return[1e3*a,...i.map((e=>t.metric[e]||"")),parseFloat(r)]}))):o.rows.concat(t.values.map((e=>{let[t,a]=e;return[1e3*t,parseFloat(a)]}))))})),o}function M(e){const t=[];if(!e)return t;for(const r in e){const n=e[r];for(const e in n){const i=n[e];let o;/time/i.test(e)&&i?o="s":/bytes.*persecond/i.test(e)?o="Bps":/bytes/i.test(e)&&(o="decbytes");const l=`${(0,s.capitalize)(r)}: ${a=e,a.replace(/[A-Z]/g,(e=>` ${e.toLowerCase()}`))}`;t.push({displayName:l,value:i,unit:o})}}var a;return t}function z(e,t,a,r){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const n=a>0?e.data.result:[],i=M(e.data.stats),o={lokiQueryStatKey:"Summary: total bytes processed"},l={searchWords:Q(q(t.expr)),limit:a,stats:i,custom:o,preferredVisualisationType:"logs"},c=n.map((e=>{const a=N(e,s,t.refId);return U(a,r),l.custom&&a.fields.some((e=>e.labels&&Object.keys(e.labels).some((e=>"__error__"===e))))&&(l.custom.error="Error when parsing some of the logs"),Object.assign({},a,{refId:t.refId,meta:l})}));return i.length&&!n.length?[{fields:[],length:0,refId:t.refId,meta:l}]:c}const U=(e,t)=>{var a;if(!t)return;const n=null!==(a=t.derivedFields)&&void 0!==a?a:[];if(!n.length)return;const i=(0,s.groupBy)(n,"name"),o=Object.values(i).map(B);new r.DataFrameView(e).forEach((e=>{for(const t of o){const a=e.line.match(i[t.name][0].matcherRegex);t.values.add(a&&a[1])}})),e.fields=[...e.fields,...o]};function B(e){const t=(0,h.getDataSourceSrv)(),a=e.reduce(((e,a)=>{if(a.datasourceUid){var r;const s=t.getInstanceSettings(a.datasourceUid);e.push({title:a.urlDisplayLabel||"",url:"",internal:{query:{query:a.url},datasourceUid:a.datasourceUid,datasourceName:null!==(r=null==s?void 0:s.name)&&void 0!==r?r:"Data source not found"}})}else a.url&&e.push({title:a.urlDisplayLabel||"",url:a.url});return e}),[]);return{name:e[0].name,type:r.FieldType.string,config:{links:a},values:new r.ArrayVector([])}}function K(e,t,a,s,n){const i=function(e,t,a,r,s){var n;const i={format:a.format,legendFormat:null!==(n=a.legendFormat)&&void 0!==n?n:"",start:t.start,end:t.end,step:t.step,query:t.query,responseListLength:r,refId:a.refId,meta:{preferredVisualisationType:"graph"},valueWithRefId:a.valueWithRefId,scopedVars:s};switch(e.data.resultType){case I.o.Vector:return e.data.result.map((e=>D({metric:e.metric,values:[e.value]},i)));case I.o.Matrix:return e.data.result.map((e=>D(e,i)));default:return[]}}(e,t,a,s,n),o=i.map((e=>(0,r.toDataFrame)(e))),{step:l}=t;if(null!=l){const e=1e3*l;o.forEach((t=>{t.fields.forEach((t=>{t.type===r.FieldType.time&&(t.config.interval=e)}))}))}return o}function W(e,t,a,r,s,n,i){let l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];switch(e.data.resultType){case I.o.Stream:return(0,o.of)({data:z(e,t,s,n,l),key:`${t.refId}_log`});case I.o.Vector:case I.o.Matrix:return(0,o.of)({data:K(e,a,Object.assign({},t,{format:"time_series"}),r,i),key:t.refId});default:throw new Error(`Unknown result type "${e.data.resultType}".`)}}var H=a("./.yarn/cache/rxjs-npm-7.5.1-ce59cbb6a3-78e3eecb16.zip/node_modules/rxjs/dist/esm5/internal/observable/timer.js"),Z=a("./.yarn/cache/tslib-npm-2.3.1-0e21e18015-de17a98d46.zip/node_modules/tslib/tslib.es6.js"),J=a("./.yarn/cache/rxjs-npm-7.5.1-ce59cbb6a3-78e3eecb16.zip/node_modules/rxjs/dist/esm5/internal/Subject.js"),Y=a("./.yarn/cache/rxjs-npm-7.5.1-ce59cbb6a3-78e3eecb16.zip/node_modules/rxjs/dist/esm5/internal/Subscriber.js"),G=a("./.yarn/cache/rxjs-npm-7.5.1-ce59cbb6a3-78e3eecb16.zip/node_modules/rxjs/dist/esm5/internal/Observable.js"),X=a("./.yarn/cache/rxjs-npm-7.5.1-ce59cbb6a3-78e3eecb16.zip/node_modules/rxjs/dist/esm5/internal/Subscription.js"),ee=a("./.yarn/cache/rxjs-npm-7.5.1-ce59cbb6a3-78e3eecb16.zip/node_modules/rxjs/dist/esm5/internal/ReplaySubject.js"),te={url:"",deserializer:function(e){return JSON.parse(e.data)},serializer:function(e){return JSON.stringify(e)}},ae=function(e){function t(t,a){var r=e.call(this)||this;if(r._socket=null,t instanceof G.y)r.destination=a,r.source=t;else{var s=r._config=(0,Z.__assign)({},te);if(r._output=new J.x,"string"==typeof t)s.url=t;else for(var n in t)t.hasOwnProperty(n)&&(s[n]=t[n]);if(!s.WebSocketCtor&&WebSocket)s.WebSocketCtor=WebSocket;else if(!s.WebSocketCtor)throw new Error("no WebSocket constructor can be found");r.destination=new ee.t}return r}return(0,Z.__extends)(t,e),t.prototype.lift=function(e){var a=new t(this._config,this.destination);return a.operator=e,a.source=this,a},t.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new ee.t),this._output=new J.x},t.prototype.multiplex=function(e,t,a){var r=this;return new G.y((function(s){try{r.next(e())}catch(e){s.error(e)}var n=r.subscribe((function(e){try{a(e)&&s.next(e)}catch(e){s.error(e)}}),(function(e){return s.error(e)}),(function(){return s.complete()}));return function(){try{r.next(t())}catch(e){s.error(e)}n.unsubscribe()}}))},t.prototype._connectSocket=function(){var e=this,t=this._config,a=t.WebSocketCtor,r=t.protocol,s=t.url,n=t.binaryType,i=this._output,o=null;try{o=r?new a(s,r):new a(s),this._socket=o,n&&(this._socket.binaryType=n)}catch(e){return void i.error(e)}var l=new X.w0((function(){e._socket=null,o&&1===o.readyState&&o.close()}));o.onopen=function(t){if(!e._socket)return o.close(),void e._resetState();var a=e._config.openObserver;a&&a.next(t);var r=e.destination;e.destination=Y.Lv.create((function(t){if(1===o.readyState)try{var a=e._config.serializer;o.send(a(t))}catch(t){e.destination.error(t)}}),(function(t){var a=e._config.closingObserver;a&&a.next(void 0),t&&t.code?o.close(t.code,t.reason):i.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),e._resetState()}),(function(){var t=e._config.closingObserver;t&&t.next(void 0),o.close(),e._resetState()})),r&&r instanceof ee.t&&l.add(r.subscribe(e.destination))},o.onerror=function(t){e._resetState(),i.error(t)},o.onclose=function(t){o===e._socket&&e._resetState();var a=e._config.closeObserver;a&&a.next(t),t.wasClean?i.complete():i.error(t)},o.onmessage=function(t){try{var a=e._config.deserializer;i.next(a(t))}catch(e){i.error(e)}}},t.prototype._subscribe=function(e){var t=this,a=this.source;return a?a.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add((function(){var e=t._socket;0===t._output.observers.length&&(!e||1!==e.readyState&&0!==e.readyState||e.close(),t._resetState())})),e)},t.prototype.unsubscribe=function(){var t=this._socket;!t||1!==t.readyState&&0!==t.readyState||t.close(),this._resetState(),e.prototype.unsubscribe.call(this)},t}(J.u);var re=a("./.yarn/cache/rxjs-npm-7.5.1-ce59cbb6a3-78e3eecb16.zip/node_modules/rxjs/dist/esm5/internal/operators/retryWhen.js"),se=a("./.yarn/cache/rxjs-npm-7.5.1-ce59cbb6a3-78e3eecb16.zip/node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js"),ne=a("./.yarn/cache/rxjs-npm-7.5.1-ce59cbb6a3-78e3eecb16.zip/node_modules/rxjs/dist/esm5/internal/operators/finalize.js");class ie{constructor(){var e,t,a;a={},(t="streams")in(e=this)?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a}getStream(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,a=this.streams[e.url];if(a)return a;const s=new r.CircularDataFrame({capacity:e.size});var i;return s.addField({name:"ts",type:r.FieldType.time,config:{displayName:"Time"}}),s.addField({name:"tsNs",type:r.FieldType.time,config:{displayName:"Time ns"}}),s.addField({name:"line",type:r.FieldType.string}).labels=(0,r.parseLabels)(e.query),s.addField({name:"labels",type:r.FieldType.other}),s.addField({name:"id",type:r.FieldType.string}),s.meta=Object.assign({},s.meta,{preferredVisualisationType:"logs"}),s.refId=e.refId,a=(i=e.url,new ae(i)).pipe((0,c.U)((e=>(function(e,t){const a=e.streams;if(!a||!a.length)return;let s={};for(const e of t.fields)if(e.type===r.FieldType.string){e.labels&&(s=e.labels);break}const n=t.fields[0],i=t.fields[1],o=t.fields[2],l=t.fields[3],c=t.fields[4],u={};for(const e of a){const a=(0,r.findUniqueLabels)(e.stream,s),d=Object.entries(e.stream).map((e=>{let[t,a]=e;return`${t}="${a}"`})).sort().join("");for(const[r,s]of e.values)n.values.add(new Date(parseInt(r.substr(0,r.length-6),10)).toISOString()),i.values.add(r),o.values.add(s),l.values.add(a),c.values.add(A(r,d,s,u,t.refId))}}(e,s),[s]))),(0,re.a)((e=>e.pipe((0,se.z)(((e,a)=>{const r=a+1;return 1006===e.code&&r<30?(r>10&&console.warn(`Websocket connection is being disrupted. We keep reconnecting but consider starting new live tailing again. Error: ${e.reason}`),(0,H.H)(t)):(0,n._)(e)}))))),(0,ne.x)((()=>{delete this.streams[e.url]}))),this.streams[e.url]=a,a}}var oe=a("./.yarn/cache/lru-cache-npm-6.0.0-b4c8668fe1-f97f499f89.zip/node_modules/lru-cache/index.js"),le=a.n(oe),ce=a("./public/app/plugins/datasource/prometheus/language_utils.ts");function ue(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const de=["job","namespace"],pe="{}",me=[{label:"$__interval",sortValue:"$__interval"},{label:"$__range",sortValue:"$__range"},{label:"1m",sortValue:"00:01:00"},{label:"5m",sortValue:"00:05:00"},{label:"10m",sortValue:"00:10:00"},{label:"30m",sortValue:"00:30:00"},{label:"1h",sortValue:"01:00:00"},{label:"1d",sortValue:"24:00:00"}],he=e=>({label:e,filterText:`"${e}"`});class ge extends r.LanguageProvider{constructor(e,t){super(),ue(this,"labelKeys",void 0),ue(this,"labelFetchTs",void 0),ue(this,"started",!1),ue(this,"datasource",void 0),ue(this,"lookupsDisabled",!1),ue(this,"seriesCache",new(le())(10)),ue(this,"labelsCache",new(le())(10)),ue(this,"cleanText",(e=>e.replace(/[{}[\]="(),!~+\-*/^%\|]/g,"").trim())),ue(this,"request",(async(e,t)=>{try{return await this.datasource.metadataRequest(e,t)}catch(e){console.error(e)}})),ue(this,"start",(()=>(this.startTask||(this.startTask=this.fetchLabels().then((()=>(this.started=!0,[])))),this.startTask))),ue(this,"getBeginningCompletionItems",(e=>({suggestions:[...this.getEmptyCompletionItems(e).suggestions,...this.getTermCompletionItems().suggestions]}))),ue(this,"getTermCompletionItems",(()=>{const e=[];return e.push({prefixMatch:!0,label:"Functions",items:f.r8.map((e=>Object.assign({},e,{kind:"function"})))}),{suggestions:e}})),ue(this,"getPipeCompletionItem",(()=>{const e=[];return e.push({label:"Operators",items:f.Rd.map((e=>Object.assign({},e,{kind:"operators"})))}),e.push({label:"Parsers",items:f.uR.map((e=>Object.assign({},e,{kind:"parsers"})))}),{suggestions:e}})),ue(this,"fetchSeriesLabels",(async e=>{const t="/loki/api/v1/series",{start:a,end:r}=this.datasource.getTimeRangeParams(),s=this.generateCacheKey(t,a,r,e);let n=this.seriesCache.get(s);if(!n){this.seriesCache.set(s,{});const i={"match[]":e,start:a,end:r},o=await this.request(t,i),{values:l}=(0,ce.DY)(o);n=l,this.seriesCache.set(s,n)}return n})),ue(this,"fetchSeries",(async e=>{const{start:t,end:a}=this.datasource.getTimeRangeParams(),r={"match[]":e,start:t,end:a};return await this.request("/loki/api/v1/series",r)})),this.datasource=e,this.labelKeys=[],this.labelFetchTs=0,Object.assign(this,t)}getSyntax(){return f.ZP}getLabelKeys(){return this.labelKeys}async provideCompletionItems(e,t){const{wrapperClasses:a,value:r,prefix:s,text:n}=e,i={suggestions:[]};if(!r)return i;const o=0===(null==r?void 0:r.document.text.length),l=r.document.getTextsAtRange(r.selection),c=1===l.size?l.first().getText():null,u=c?c[r.selection.anchor.offset]:null,d=a.length>3,p=s&&!d,m=!u||")"===u,h=s&&!n.match(/^['"~=\]})\s]+$/)&&m,g=n.match(/[+\-*/^%]/);return a.includes("context-range")?this.getRangeCompletionItems():a.includes("context-labels")?await this.getLabelCompletionItems(e):a.includes("context-pipe")?this.getPipeCompletionItem():o?this.getEmptyCompletionItems(t):p&&m&&!g?this.getBeginningCompletionItems(t):p&&h?this.getTermCompletionItems():i}getEmptyCompletionItems(e){const t=null==e?void 0:e.history,a=[];if(null!=t&&t.length){const e=(0,s.chain)(t).map((e=>e.query.expr)).filter().uniq().take(10).map(he).map((e=>function(e,t){const a=Date.now()-864e5,s=t.filter((t=>t.ts>a&&t.query.expr===e.label));let n=`Queried ${s.length} times in the last 24h.`;const i=s[0];i&&(n=`${n} Last queried ${(0,r.dateTime)(i.ts).fromNow()}.`);return Object.assign({},e,{documentation:n})}(e,t))).value();a.push({prefixMatch:!0,skipSort:!0,label:"History",items:e})}return{suggestions:a}}getRangeCompletionItems(){return{context:"context-range",suggestions:[{label:"Range vector",items:[...me]}]}}async getLabelCompletionItems(e){let{text:t,wrapperClasses:a,labelKey:r,value:n}=e,i="context-labels";const o=[];if(!n)return{context:i,suggestions:[]};const l=n.anchorBlock.getText(),c=n.selection.anchor.offset,u=t.match(/^(=|=~|!=|!~)/);let d,p;try{p=(0,ce.rV)(l,c),d=p.selector}catch{d=pe}if(!r&&d===pe){await this.start();return{context:i,suggestions:[{label:"Labels",items:this.getLabelKeys().map(he)}]}}const m=p?p.labelKeys:[];let h;if(d)if(d===pe&&r){h={[r]:await this.getLabelValues(r)}}else h=await this.getSeriesLabels(d);if(!h)return console.warn(`Server did not return any values for selector = ${d}`),{context:i,suggestions:o};if(t&&u||a.includes("attr-value"))r&&h[r]&&(i="context-label-values",o.push({label:`Label values for "${r}"`,items:h[r].map(he).filter((e=>{let{filterText:a}=e;return a!==t}))}));else{const e=h?Object.keys(h):de;if(e){const t=(0,s.difference)(e,m);if(t.length){const e={label:"Labels",items:t.map((e=>({label:e})))};o.push(e)}}}return{context:i,suggestions:o}}importFromAbstractQuery(e){return{refId:e.refId,expr:(0,ce.PL)(e),queryType:I.E.Range}}exportToAbstractQuery(e){const t=e.expr;if(!t||0===t.length)return{refId:e.refId,labelMatchers:[]};const a=m().tokenize(t,f.ZP);return{refId:e.refId,labelMatchers:(0,ce.UO)(a)}}async getSeriesLabels(e){if(!this.lookupsDisabled)try{return await this.fetchSeriesLabels(e)}catch(e){return void console.error(e)}}async fetchLabels(){const e=this.datasource.getTimeRangeParams();this.labelFetchTs=Date.now().valueOf();const t=await this.request("/loki/api/v1/label",e);if(Array.isArray(t)){const e=t.slice().sort().filter((e=>"__name__"!==e));this.labelKeys=e}return[]}async refreshLogLabels(e){(this.labelKeys&&Date.now().valueOf()-this.labelFetchTs>3e4||e)&&await this.fetchLabels()}generateCacheKey(e,t,a,r){return[e,this.roundTime(t),this.roundTime(a),r].join()}roundTime(e){return e?Math.floor(e/1e6/1e3/60/5):0}async getLabelValues(e){return await this.fetchLabelValues(e)}async fetchLabelValues(e){var t;const a=`/loki/api/v1/label/${e}/values`,r=this.datasource.getTimeRangeParams(),{start:s,end:n}=r,i=this.generateCacheKey(a,s,n,e),o={start:s,end:n};let l=this.labelsCache.get(i);if(!l){this.labelsCache.set(i,[]);const e=await this.request(a,o);Array.isArray(e)&&(l=e.slice().sort(),this.labelsCache.set(i,l))}return null!==(t=l)&&void 0!==t?t:[]}}var fe=a("./public/app/core/utils/fetch.ts"),be=a("./public/app/plugins/datasource/loki/components/LokiOptionFields.tsx"),ye=a("./public/app/core/logs_model.ts"),ve=a("./public/app/core/config.ts");function xe(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const je=1e6,_e="/loki/api/v1/query_range",Le="/loki/api/v1/query",we={direction:"BACKWARD",limit:1e3,query:""};class Fe extends r.DataSourceApi{constructor(e){var t,a;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,g.J)(),l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,L.$t)();super(e),t=this,xe(this,"streams",new ie),xe(this,"languageProvider",void 0),xe(this,"maxLines",void 0),xe(this,"runInstantQuery",(function(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const s=t.getTime(a.range.to,!0),i=Te(e.expr)?a.maxDataPoints:e.maxLines,o={query:e.expr,time:`${s+(1e9-s%1e9)}`,limit:Math.min(i||1/0,t.maxLines)},l={preferredVisualisationType:"table"};return t._request(Le,o).pipe((0,c.U)((a=>a.data.data.resultType===I.o.Stream?{data:a.data?z(a.data,e,o.limit,t.instanceSettings.jsonData):[],key:`${e.refId}_instant`}:{data:[V(a.data.data.result,r,e.refId,l,!0)],key:`${e.refId}_instant`})),(0,u.K)((a=>(0,n._)((()=>t.processError(a,e))))))})),xe(this,"runRangeQuery",(function(e,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=Te(e.expr)?a.maxDataPoints||t.maxLines:e.maxLines||t.maxLines;if(a.liveStreaming)return t.runLiveQuery(e,s);const i=t.createRangeQuery(e,a,s),o=e.volumeQuery?{"X-Query-Tags":"Source=logvolhist"}:void 0;return t._request(_e,i,{headers:o}).pipe((0,u.K)((a=>(0,n._)((()=>t.processError(a,e))))),(0,d.w)((n=>W(n.data,e,i,r,s,t.instanceSettings.jsonData,a.scopedVars,a.reverse))))})),xe(this,"runLiveQuery",((e,t)=>{const a=this.createLiveTarget(e,t);return this.streams.getStream(a).pipe((0,c.U)((e=>({data:e||[],key:`loki-${a.refId}`,state:r.LoadingState.Streaming}))),(0,u.K)((e=>(0,n._)((()=>`Live tailing was stopped due to following error: ${e.reason}`)))))})),xe(this,"getLogRowContext",((e,t)=>{const a=this.prepareLogRowContextQueryTarget(e,t&&t.limit||10,t&&t.direction||"BACKWARD"),r=t&&"FORWARD"===t.direction;return(0,i.n)(this._request(_e,a).pipe((0,u.K)((e=>{throw{message:"Error during context query. Please check JS console logs.",status:e.status,statusText:e.statusText}})),(0,d.w)((e=>(0,o.of)({data:e.data?e.data.data.result.map((e=>N(e,r))):[]})))))})),xe(this,"prepareLogRowContextQueryTarget",((e,t,a)=>{const s=this.languageProvider.getLabelKeys(),n=Object.keys(e.labels).map((t=>s.includes(t)?`${t}="${e.labels[t].replace(/\\/g,"\\\\")}"`:"")).filter((e=>!!e)).join(","),i=72e5,o={limit:t,query:`{${n}}`,expr:`{${n}}`,direction:a},l=new r.FieldCache(e.dataFrame).getFieldByName("tsNs").values.get(e.rowIndex);return"BACKWARD"===a?Object.assign({},o,{start:e.timeEpochMs-i+"000000",end:l,direction:a}):Object.assign({},o,{start:l,end:e.timeEpochMs+i+"000000"})})),this.instanceSettings=e,this.templateSrv=s,this.timeSrv=l,this.languageProvider=new ge(this);const p=e.jsonData||{};this.maxLines=parseInt(null!==(a=p.maxLines)&&void 0!==a?a:"0",10)||1e3}_request(e,t,a){const r=this.instanceSettings.url,s=t?(0,fe.tW)(t):"",n=`${r}${e}${s.length?`?${s}`:""}`;(this.instanceSettings.withCredentials||this.instanceSettings.basicAuth)&&(a=Object.assign({},a,{withCredentials:!0}),this.instanceSettings.basicAuth&&(a.headers=Object.assign({},a.headers,{Authorization:this.instanceSettings.basicAuth})));const i=Object.assign({},a,{url:n});return(0,h.getBackendSrv)().fetch(i)}getLogsVolumeDataProvider(e){if(!ve.ZP.featureToggles.fullRangeLogsVolume)return;if(!e.targets.some((e=>e.expr&&!Te(e.expr))))return;const t=(0,s.cloneDeep)(e);return t.targets=t.targets.filter((e=>e.expr&&!Te(e.expr))).map((e=>Object.assign({},e,{instant:!1,volumeQuery:!0,expr:`sum by (level) (count_over_time(${e.expr}[$__interval]))`}))),(0,ye.Bz)(this,t,{extractLevel:$e,range:e.range,targets:e.targets})}query(e){const t=[],a=Object.assign({},e.scopedVars,this.getRangeScopedVars(e.range)),n=e.targets.filter((e=>e.expr&&!e.hide)).map((e=>{const t=this.addAdHocFilters(e.expr);return Object.assign({},e,{expr:this.templateSrv.replace(t,a,this.interpolateQueryExpr)})}));for(const a of n)a.instant||a.queryType===I.E.Instant?t.push(this.runInstantQuery(a,e,n.length)):t.push(this.runRangeQuery(a,e,n.length));return(0,s.isEmpty)(t)?(0,o.of)({data:[],state:r.LoadingState.Done}):(0,l.T)(...t)}createRangeQuery(e,t,a){const r=e.expr;let s={};if(t.range){const a=this.getTime(t.range.from,!1),r=this.getTime(t.range.to,!0),n=Math.ceil((r-a)/1e6),i=e.resolution||be.TQ.value,o=this.adjustInterval(t.intervalMs||1e3,i,n)/1e3;s={start:a,end:r,step:Math.ceil(1e3*o)/1e3}}return Object.assign({},we,s,{query:r,limit:a})}createLiveTarget(e,t){const a=e.expr,r=this.instanceSettings.url,s=(0,fe.tW)({query:a});return{query:a,url:(0,w.F3)(`${r}/loki/api/v1/tail?${s}`),refId:e.refId,size:t}}getRangeScopedVars(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeSrv.timeRange();const t=e.to.diff(e.from),a=Math.round(t/1e3);return{__range_ms:{text:t,value:t},__range_s:{text:a,value:a},__range:{text:a+"s",value:a+"s"}}}interpolateVariablesInQueries(e,t){let a=e;return e&&e.length&&(a=e.map((e=>Object.assign({},e,{datasource:this.getRef(),expr:this.templateSrv.replace(e.expr,t,this.interpolateQueryExpr)})))),a}getQueryDisplayText(e){return e.expr}getTimeRangeParams(){const e=this.timeSrv.timeRange();return{start:e.from.valueOf()*je,end:e.to.valueOf()*je}}async importFromAbstractQueries(e){await this.languageProvider.start();const t=this.languageProvider.labelKeys;return t&&t.length&&(e=e.map((e=>(e.labelMatchers=e.labelMatchers.filter((e=>t.includes(e.name))),e)))),e.map((e=>this.languageProvider.importFromAbstractQuery(e)))}async exportToAbstractQueries(e){return e.map((e=>this.languageProvider.exportToAbstractQuery(e)))}async metadataRequest(e,t){const a=await(0,i.n)(this._request(e,t,{hideFromInspector:!0}));return a.data.data||a.data.values||[]}async metricFindQuery(e){if(!e)return Promise.resolve([]);const t=this.templateSrv.replace(e,{},this.interpolateQueryExpr);return await this.processMetricFindQuery(t)}async processMetricFindQuery(e){if(e.match(/^label_names\(\)\s*$/))return await this.labelNamesQuery();const t=e.match(/^label_values\((?:(.+),\s*)?([a-zA-Z_][a-zA-Z0-9_]*)\)\s*$/);return t?t[1]?await this.labelValuesSeriesQuery(t[1],t[2]):await this.labelValuesQuery(t[2]):Promise.resolve([])}async labelNamesQuery(){const e=this.getTimeRangeParams();return(await this.metadataRequest("/loki/api/v1/label",e)).map((e=>({text:e})))}async labelValuesQuery(e){const t=this.getTimeRangeParams(),a=`/loki/api/v1/label/${e}/values`;return(await this.metadataRequest(a,t)).map((e=>({text:e})))}async labelValuesSeriesQuery(e,t){const a=this.getTimeRangeParams(),r=Object.assign({},a,{"match[]":e}),s=new Set;return(await this.metadataRequest("/loki/api/v1/series",r)).forEach((e=>{e[t]&&s.add({text:e[t]})})),Array.from(s)}async getTagKeys(){return await this.labelNamesQuery()}async getTagValues(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return await this.labelValuesQuery(e.key)}interpolateQueryExpr(e,t){if(!t.multi&&!t.includeAll)return ke(e);if("string"==typeof e)return Se(e);return(0,s.map)(e,Se).join("|")}modifyQuery(e,t){var a;let r=null!==(a=e.expr)&&void 0!==a?a:"";switch(t.type){case"ADD_FILTER":r=this.addLabelToQuery(r,t.key,t.value,"=");break;case"ADD_FILTER_OUT":r=this.addLabelToQuery(r,t.key,t.value,"!=")}return Object.assign({},e,{expr:r})}getTime(e,t){return"string"==typeof e&&(e=r.dateMath.parse(e,t)),Math.ceil(1e6*e.valueOf())}testDatasource(){const e=`${Date.now()-6e5}000000`;return(0,i.n)(this._request("/loki/api/v1/label",{start:e}).pipe((0,c.U)((e=>{var t,a;return((null==e||null===(t=e.data)||void 0===t?void 0:t.data)||(null==e||null===(a=e.data)||void 0===a?void 0:a.values)||[]).length>0?{status:"success",message:"Data source connected and labels found."}:{status:"error",message:"Data source connected, but no labels received. Verify that Loki and Promtail is configured properly."}})),(0,u.K)((e=>{let t="Loki: ";return e.statusText?t+=e.statusText:t+="Cannot connect to Loki",e.status&&(t+=`. ${e.status}`),e.data&&e.data.message?t+=`. ${e.data.message}`:e.data&&(t+=`. ${e.data}`),(0,o.of)({status:"error",message:t})}))))}async annotationQuery(e){const{expr:t,maxLines:a,instant:s,stepInterval:n,tagKeys:o="",titleFormat:l="",textFormat:c=""}=e.annotation;if(!t)return[];const u=this.templateSrv.replace(t,{},this.interpolateQueryExpr),d={refId:`annotation-${e.annotation.name}`,expr:u,maxLines:a,instant:s,stepInterval:n,queryType:s?I.E.Instant:I.E.Range},{data:p}=s?await(0,i.n)(this.runInstantQuery(d,e)):await(0,i.n)(this.runRangeQuery(d,e)),m=[],h=o.split(",").filter((e=>""!==e));for(const e of p){const t={};for(const a of e.fields)if(a.labels)for(const[e,r]of Object.entries(a.labels))t[e]=String(r).trim();const a=[...new Set(Object.entries(t).reduce(((e,t)=>{let[a,r]=t;return""===r||h.length&&!h.includes(a)||e.push.apply(e,[r]),e}),[]))];new r.DataFrameView(e).forEach((e=>{m.push({time:new Date(e.ts).valueOf(),title:(0,E.W)(l,t),text:(0,E.W)(c,t)||e.line,tags:a})}))}return m}showContextToggle(e){return!0===(e&&e.searchWords&&e.searchWords.length>0)}processError(e,t){let a=(0,s.cloneDeep)(e);return e.data.message.includes("escape")&&t.expr.includes("\\")&&(a.data.message=`Error: ${e.data.message}. Make sure that all special characters are escaped with \\. For more information on escaping of special characters visit LogQL documentation at https://grafana.com/docs/loki/latest/logql/.`),a}adjustInterval(e,t,a){let r=a/11e3;return r>1&&(r=Math.ceil(r)),Math.max(t*e,r)}addAdHocFilters(e){let t=e;return t=this.templateSrv.getAdhocFilters(this.name).reduce(((e,t)=>{const{key:a,operator:r}=t;let{value:s}=t;return"=~"!==r&&"!~"!==r||(s=ke(s)),this.addLabelToQuery(e,a,s,r,!0)}),t),t}addLabelToQuery(e,t,a,r,s){return!function(e){const t=f.uR.map((e=>`${e.label}`)).join("|");return new RegExp(`\\|\\s?(${t})`).test(e)}(e)||Te(e)||s?x(e,t,a,r,!0):function(e,t,a,r){return e+` | ${t}${r}"${a.toString()}"`}(e,t,a,r)}}function ke(e){return"string"==typeof e?e.replace(/'/g,"\\\\'"):e}function Se(e){return"string"==typeof e?ke(e.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]+?.()|]/g,"\\\\$&")):e}function Te(e){return m().tokenize(e,f.ZP).some((e=>"string"!=typeof e&&"function"===e.type))}function $e(e){var t;let a;try{a=new r.FieldCache(e).getFirstFieldOfType(r.FieldType.number)}catch{}return null!==(t=a)&&void 0!==t&&t.labels?function(e){const t=["level","lvl","loglevel"];let a;for(let r of t)if(r in e){a=r;break}return a?(0,r.getLogLevelFromKey)(e[a]):r.LogLevel.unknown}(a.labels):r.LogLevel.unknown}const Ce=Fe;var Oe,Re,qe,Qe,Ie,Ee,Ne,Ae,De,Pe=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),Ve=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");function Me(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const ze=['{job="default/prometheus"}'],Ue=["job","app","k8s_app"],Be=[{title:"Log pipeline",expression:'{job="mysql"} |= "metrics" | logfmt | duration > 10s',label:'This query targets the MySQL job, filters out logs that don’t contain the word "metrics" and parses each log line to extract more labels and filters with them.'},{title:"Count over time",expression:'count_over_time({job="mysql"}[5m])',label:"This query counts all the log lines within the last five minutes for the MySQL job."},{title:"Rate",expression:'rate(({job="mysql"} |= "error" != "timeout")[10s])',label:"This query gets the per-second rate of all non-timeout errors within the last ten seconds for the MySQL job."},{title:"Aggregate, count, and group",expression:'sum(count_over_time({job="mysql"}[5m])) by (level)',label:"Get the count of logs during the last five minutes, grouping by level."}];class Ke extends Pe.PureComponent{constructor(){super(...arguments),Me(this,"state",{userExamples:[]}),Me(this,"checkUserLabels",(async()=>{var e;const t=null===(e=this.props.datasource)||void 0===e?void 0:e.languageProvider;if(t.started){const e=t.getLabelKeys()||[],a=Ue.find((t=>e.includes(t)));if(a){const e=await t.getLabelValues(a),r=(0,s.shuffle)(e).slice(0,5).map((e=>`{${a}="${e}"}`));this.setState({userExamples:r})}}else this.scheduleUserLabelChecking()}))}componentDidMount(){this.scheduleUserLabelChecking()}componentWillUnmount(){clearTimeout(this.userLabelTimer)}scheduleUserLabelChecking(){this.userLabelTimer=setTimeout(this.checkUserLabels,1e3)}renderExpression(e){const{onClickExample:t}=this.props;return(0,Ve.jsx)("div",{className:"cheat-sheet-item__example",onClick:a=>t({refId:"A",expr:e}),children:(0,Ve.jsx)("code",{children:e})},e)}render(){const{userExamples:e}=this.state,t=e.length>0;return(0,Ve.jsxs)("div",{children:[Oe||(Oe=(0,Ve.jsx)("h2",{children:"Loki Cheat Sheet"})),(0,Ve.jsxs)("div",{className:"cheat-sheet-item",children:[Re||(Re=(0,Ve.jsx)("div",{className:"cheat-sheet-item__title",children:"See your logs"})),qe||(qe=(0,Ve.jsx)("div",{className:"cheat-sheet-item__label",children:"Start by selecting a log stream from the Log browser, or alternatively you can write a stream selector into the query field."})),t?(0,Ve.jsxs)("div",{children:[Qe||(Qe=(0,Ve.jsx)("div",{className:"cheat-sheet-item__label",children:"Here are some example streams from your logs:"})),e.map((e=>this.renderExpression(e)))]}):(0,Ve.jsxs)("div",{children:[Ie||(Ie=(0,Ve.jsx)("div",{className:"cheat-sheet-item__label",children:"Here is an example of a log stream:"})),this.renderExpression(ze[0])]})]}),(0,Ve.jsxs)("div",{className:"cheat-sheet-item",children:[Ee||(Ee=(0,Ve.jsx)("div",{className:"cheat-sheet-item__title",children:"Combine stream selectors"})),this.renderExpression('{app="cassandra",namespace="prod"}'),Ne||(Ne=(0,Ve.jsx)("div",{className:"cheat-sheet-item__label",children:"Returns all log lines from streams that have both labels."}))]}),(0,Ve.jsxs)("div",{className:"cheat-sheet-item",children:[Ae||(Ae=(0,Ve.jsx)("div",{className:"cheat-sheet-item__title",children:"Filtering for search terms."})),this.renderExpression('{app="cassandra"} |~ "(duration|latency)s*(=|is|of)s*[d.]+"'),this.renderExpression('{app="cassandra"} |= "exact match"'),this.renderExpression('{app="cassandra"} != "do not match"'),De||(De=(0,Ve.jsxs)("div",{className:"cheat-sheet-item__label",children:[(0,Ve.jsx)("a",{href:"https://grafana.com/docs/loki/latest/logql/#log-pipeline",target:"logql",children:"LogQL"})," ","supports exact and regular expression filters."]}))]}),Be.map((e=>(0,Ve.jsxs)("div",{className:"cheat-sheet-item",children:[(0,Ve.jsx)("div",{className:"cheat-sheet-item__title",children:e.title}),this.renderExpression(e.expression),(0,Ve.jsx)("div",{className:"cheat-sheet-item__label",children:e.label})]},e.expression)))]})}}var We,He=a("./packages/grafana-ui/src/index.ts"),Ze=a("./public/app/plugins/datasource/loki/components/LokiQueryField.tsx");function Je(e){var t;const{query:a,data:r,datasource:s,onChange:n,onRunQuery:i,range:o}=e,l=(0,Ve.jsx)("div",{className:"gf-form-inline",children:(0,Ve.jsxs)("div",{className:"gf-form",children:[We||(We=(0,Ve.jsx)(He.InlineFormLabel,{width:6,tooltip:"Controls the name of the time series, using name or pattern. For example {{hostname}} will be replaced with label value for the label hostname. The legend only applies to metric queries.",children:"Legend"})),(0,Ve.jsx)("input",{type:"text",className:"gf-form-input",placeholder:"legend format",value:a.legendFormat||"",onChange:e=>{const t=Object.assign({},a,{legendFormat:e.currentTarget.value});n(t)},onBlur:i})]})});return(0,Ve.jsx)(Ze.n,{datasource:s,query:a,onChange:n,onRunQuery:i,onBlur:i,history:[],data:r,"data-testid":Ye.editor,range:o,ExtraFieldElement:(0,Ve.jsxs)(Ve.Fragment,{children:[(0,Ve.jsx)(be.JX,{lineLimitValue:(null==a||null===(t=a.maxLines)||void 0===t?void 0:t.toString())||"",resolution:(null==a?void 0:a.resolution)||1,query:a,onRunQuery:i,onChange:n,runOnBlur:!0}),l]})})}const Ye={editor:"loki-editor"};function Ge(e){const{query:t,data:a,datasource:r,onChange:s,onRunQuery:n}=e;return(0,Ve.jsx)(Ze.n,{datasource:r,query:t,onChange:s,onRunQuery:n,onBlur:n,history:[],data:a,placeholder:"Enter a Loki query","data-testid":Xe.editor})}const Xe={editor:"loki-editor-cloud-alerting"},et=(0,Pe.memo)((e=>{var t;const{query:a,data:r,datasource:s,history:n,onChange:i,onRunQuery:o,range:l}=e;return(0,Ve.jsx)(Ze.n,{datasource:s,query:a,onChange:i,onBlur:()=>{},onRunQuery:o,history:n,data:r,range:l,"data-testid":tt.editor,ExtraFieldElement:(0,Ve.jsx)(be.JX,{lineLimitValue:(null==a||null===(t=a.maxLines)||void 0===t?void 0:t.toString())||"",resolution:a.resolution||1,query:a,onRunQuery:o,onChange:i})})}));et.displayName="LokiExploreQueryEditor";const tt={editor:"loki-editor-explore"};var at=a("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),rt=a("./.yarn/__virtual__/@grafana-experimental-virtual-044b968173/0/cache/@grafana-experimental-npm-0.0.2-canary.11-3ed391aeb7-6e8fa4bbdf.zip/node_modules/@grafana/experimental/index.js"),st=a("./public/app/plugins/datasource/prometheus/querybuilder/shared/QueryEditorModeToggle.tsx"),nt=a("./public/app/plugins/datasource/prometheus/querybuilder/shared/QueryHeaderSwitch.tsx"),it=a("./public/app/plugins/datasource/prometheus/querybuilder/shared/types.ts"),ot=a("./public/app/plugins/datasource/prometheus/querybuilder/shared/LokiAndPromQueryModellerBase.ts"),lt=a("./public/app/plugins/datasource/prometheus/querybuilder/shared/operationUtils.ts");let ct,ut;function dt(){return[pt(ut.Rate),pt(ut.CountOverTime),pt(ut.SumOverTime),pt(ut.BytesRate),pt(ut.BytesOverTime),pt(ut.AbsentOverTime),mt(ut.Sum),mt(ut.Avg),mt(ut.Min),mt(ut.Max),{id:ut.Json,name:"Json",params:[],defaultParams:[],alternativesKey:"format",category:ct.Formats,renderer:bt,addOperationHandler:vt},{id:ut.Logfmt,name:"Logfmt",params:[],defaultParams:[],alternativesKey:"format",category:ct.Formats,renderer:bt,addOperationHandler:vt,explainHandler:()=>"This will extract all keys and values from a [logfmt](https://grafana.com/docs/loki/latest/logql/log_queries/#logfmt) formatted log line as labels. The extracted lables can be used in label filter expressions and used as values for a range aggregation via the unwrap operation. "},{id:ut.LineContains,name:"Line contains",params:[{name:"String",type:"string"}],defaultParams:[""],alternativesKey:"line filter",category:ct.LineFilters,renderer:gt("|="),addOperationHandler:vt,explainHandler:e=>`Return log lines that contain string \`${e.params[0]}\`.`},{id:ut.LineContainsNot,name:"Line does not contain",params:[{name:"String",type:"string"}],defaultParams:[""],alternativesKey:"line filter",category:ct.LineFilters,renderer:gt("!="),addOperationHandler:vt,explainHandler:e=>`Return log lines that does not contain string \`${e.params[0]}\`.`},{id:ut.LineMatchesRegex,name:"Line contains regex match",params:[{name:"Regex",type:"string"}],defaultParams:[""],alternativesKey:"line filter",category:ct.LineFilters,renderer:gt("|~"),addOperationHandler:vt,explainHandler:e=>`Return log lines that match regex \`${e.params[0]}\`.`},{id:ut.LineMatchesRegexNot,name:"Line does not match regex",params:[{name:"Regex",type:"string"}],defaultParams:[""],alternativesKey:"line filter",category:ct.LineFilters,renderer:gt("!~"),addOperationHandler:vt,explainHandler:e=>`Return log lines that does not match regex \`${e.params[0]}\`.`},{id:ut.LabelFilter,name:"Label filter expression",params:[{name:"Label",type:"string"},{name:"Operator",type:"string",options:["=","!=",">","<",">=","<="]},{name:"Value",type:"string"}],defaultParams:["","=",""],category:ct.LabelFilters,renderer:ft,addOperationHandler:vt,explainHandler:()=>"Label expression filter allows filtering using original and extracted labels."},{id:ut.LabelFilterNoErrors,name:"No pipeline errors",params:[],defaultParams:[],category:ct.LabelFilters,renderer:(e,t,a)=>`${a} | __error__=""`,addOperationHandler:vt,explainHandler:()=>"Filter out all formatting and parsing errors."},{id:ut.Unwrap,name:"Unwrap",params:[{name:"Identifier",type:"string"}],defaultParams:[""],category:ct.Formats,renderer:(e,t,a)=>`${a} | unwrap ${e.params[0]}`,addOperationHandler:vt,explainHandler:e=>`Use the extracted label \`${e.params[0]}\` as sample values instead of log lines for the subsequent range aggregation.`}]}function pt(e){return{id:e,name:(0,lt.t7)(e),params:[{name:"Range vector",type:"string",options:["auto","$__interval","$__range","1m","5m","10m","1h","24h"]}],defaultParams:["auto"],alternativesKey:"range function",category:ct.RangeFunctions,renderer:ht,addOperationHandler:vt,explainHandler:(e,t)=>{var a,r;let s=null!==(a=null===(r=f.r8.find((t=>t.insertText===e.id)))||void 0===r?void 0:r.documentation)&&void 0!==a?a:"";return"auto"===e.params[0]||"$__interval"===e.params[0]?`${s} \`$__interval\` is variable that will be replaced with a calculated interval based on **Max data points**,  **Min interval** and query time range. You find these options you find under **Query options** at the right of the data source select dropdown.`:`${s} The [range vector](https://grafana.com/docs/loki/latest/logql/metric_queries/#range-vector-aggregation) is set to \`${e.params[0]}\`.`}}}function mt(e){return{id:e,name:(0,lt.t7)(e),params:[],defaultParams:[],alternativesKey:"plain aggregation",category:ct.Aggregations,renderer:lt.pS,addOperationHandler:vt,explainHandler:(e,t)=>{const a=f.r8.find((t=>t.insertText===e.id));return`${null==a?void 0:a.documentation}.`}}}function ht(e,t,a){var r,s;let n=null!==(r=(null!==(s=e.params)&&void 0!==s?s:[])[0])&&void 0!==r?r:"auto";return"auto"===n&&(n="$__interval"),`${t.id}(${a} [${n}])`}function gt(e){return function(t,a,r){return""===t.params[0]?r:`${r} ${e} \`${t.params[0]}\``}}function ft(e,t,a){return""===e.params[0]?a:"<"===e.params[1]||">"===e.params[1]?`${a} | ${e.params[0]} ${e.params[1]} ${e.params[2]}`:`${a} | ${e.params[0]}${e.params[1]}"${e.params[2]}"`}function bt(e,t,a){return`${a} | ${e.id}`}function yt(e,t,a){const r=e.findIndex((e=>a(t.getOperationDef(e.id))));return-1===r?e.length:r}function vt(e,t,a){const r={id:e.id,params:e.defaultParams},s=[...t.operations];switch(e.category){case ct.Aggregations:case ct.Functions:{const e=s.find((e=>function(e){return e.category===ct.RangeFunctions}(a.getOperationDef(e.id))));if(!e){const e=yt(s,a,(e=>e.category===ct.Functions));s.splice(e,0,{id:"rate",params:["auto"]})}s.push(r);break}case ct.RangeFunctions:const e=yt(s,a,(e=>e.category!==ct.Formats&&e.category!==ct.LineFilters&&e.category!==ct.LabelFilters));s.splice(e,0,r);break;case ct.Formats:case ct.LineFilters:{const e=yt(s,a,(e=>e.category!==ct.LineFilters));s.splice(e,0,r);break}case ct.LabelFilters:{const e=yt(s,a,(e=>e.category!==ct.LineFilters&&e.category!==ct.Formats));s.splice(e,0,r)}}return Object.assign({},t,{operations:s})}!function(e){e.Aggregations="Aggregations",e.RangeFunctions="Range functions",e.Functions="Functions",e.Formats="Formats",e.LineFilters="Line filters",e.LabelFilters="Label filters"}(ct||(ct={})),function(e){e.Json="json",e.Logfmt="logfmt",e.Rate="rate",e.CountOverTime="count_over_time",e.SumOverTime="sum_over_time",e.BytesRate="bytes_rate",e.BytesOverTime="bytes_over_time",e.AbsentOverTime="absent_over_time",e.Sum="sum",e.Avg="avg",e.Min="min",e.Max="max",e.LineContains="__line_contains",e.LineContainsNot="__line_contains_not",e.LineMatchesRegex="__line_matches_regex",e.LineMatchesRegexNot="__line_matches_regex_not",e.LabelFilter="__label_filter",e.LabelFilterNoErrors="__label_filter_no_errors",e.Unwrap="unwrap"}(ut||(ut={}));class xt extends ot.x{constructor(){super(dt),this.setOperationCategories([ct.Aggregations,ct.RangeFunctions,ct.Formats,ct.LabelFilters,ct.LineFilters])}renderLabels(e){return 0===e.length?"{}":super.renderLabels(e)}renderQuery(e){let t=`${this.renderLabels(e.labels)}`;return t=this.renderOperations(t,e.operations),t=this.renderBinaryQueries(t,e.binaryQueries),t}getQueryPatterns(){return[{name:"Log query and label filter",operations:[{id:ut.LineMatchesRegex,params:[""]},{id:ut.Logfmt,params:[]},{id:ut.LabelFilterNoErrors,params:[]},{id:ut.LabelFilter,params:["","=",""]}]},{name:"Time series query on value inside log line",operations:[{id:ut.LineMatchesRegex,params:[""]},{id:ut.Logfmt,params:[]},{id:ut.LabelFilterNoErrors,params:[]},{id:ut.Unwrap,params:[""]},{id:ut.SumOverTime,params:["auto"]},{id:ut.Sum,params:[]}]}]}}const jt=new xt;var _t=a("./public/app/plugins/datasource/prometheus/querybuilder/shared/LabelFilters.tsx"),Lt=a("./public/app/plugins/datasource/prometheus/querybuilder/shared/OperationList.tsx");function wt(e){let{query:t}=e;const a=(0,He.useTheme2)(),r=Ft(a),s=m().highlight(jt.renderQuery(t),f.xY,"lokiql");return(0,Ve.jsx)(rt.EditorFieldGroup,{children:(0,Ve.jsx)(rt.EditorField,{label:"Query text",children:(0,Ve.jsx)("div",{className:(0,at.cx)(r.editorField,"prism-syntax-highlight"),"aria-label":"selector",dangerouslySetInnerHTML:{__html:s}})})})}const Ft=e=>({editorField:(0,at.css)({padding:e.spacing(.25,1),fontFamily:e.typography.fontFamilyMonospace,fontSize:e.typography.bodySmall.fontSize})}),kt=Pe.memo((e=>{let{datasource:t,query:a,nested:r,onChange:s,onRunQuery:n}=e;return(0,Ve.jsxs)(rt.EditorRows,{children:[(0,Ve.jsx)(rt.EditorRow,{children:(0,Ve.jsx)(_t.P,{onGetLabelNames:async e=>{const r=a.labels.filter((t=>t!==e));if(0===r.length)return await t.languageProvider.refreshLogLabels(),t.languageProvider.getLabelKeys();const s=jt.renderLabels(r);return await t.languageProvider.fetchSeriesLabels(s)},onGetLabelValues:async e=>{var r;if(!e.label)return[];const s=a.labels.filter((t=>t!==e));if(0===s.length)return await t.languageProvider.fetchLabelValues(e.label);const n=jt.renderLabels(s);return null!==(r=(await t.languageProvider.fetchSeriesLabels(n))[e.label])&&void 0!==r?r:[]},labelsFilters:a.labels,onChange:e=>{s(Object.assign({},a,{labels:e}))}})}),(0,Ve.jsx)(rt.EditorRow,{children:(0,Ve.jsx)(Lt.P,{queryModeller:jt,query:a,onChange:s,onRunQuery:n,datasource:t})}),!r&&(0,Ve.jsx)(rt.EditorRow,{children:(0,Ve.jsx)(wt,{query:a})})]})}));kt.displayName="LokiQueryBuilder";var St=a("./public/app/plugins/datasource/prometheus/querybuilder/shared/OperationListExplained.tsx"),Tt=a("./public/app/plugins/datasource/prometheus/querybuilder/shared/OperationExplainedBox.tsx");const $t=Pe.memo((e=>{let{query:t,nested:a}=e;return(0,Ve.jsxs)(rt.Stack,{gap:0,direction:"column",children:[(0,Ve.jsx)(Tt.B,{stepNumber:1,title:`${jt.renderLabels(t.labels)}`,children:"Fetch all log lines matching label filters."}),(0,Ve.jsx)(St.V,{stepNumber:2,queryModeller:jt,query:t})]})}));var Ct,Ot;$t.displayName="LokiQueryBuilderExplained";const Rt=Pe.memo((e=>{var t,a;const{query:s,onChange:n,onRunQuery:i,data:o}=e,l=(0,He.useStyles2)(qt),[c,u]=(0,Pe.useState)(null!==(t=s.visualQuery)&&void 0!==t?t:{labels:[],operations:[{id:"__line_contains",params:[""]}]}),d=(0,Pe.useCallback)((e=>{n(Object.assign({},s,{editorMode:e}))}),[n,s]),p=e=>{u(e),n(Object.assign({},s,{expr:jt.renderQuery(e),visualQuery:e,editorMode:it.c.Builder}))},m=null!==(a=s.editorMode)&&void 0!==a?a:s.expr?it.c.Code:it.c.Builder;return(0,Ve.jsxs)(Ve.Fragment,{children:[(0,Ve.jsxs)(rt.EditorHeader,{children:[Ct||(Ct=(0,Ve.jsx)(rt.FlexItem,{grow:1})),(0,Ve.jsx)(He.Button,{className:l.runQuery,variant:"secondary",size:"sm",fill:"outline",onClick:i,icon:(null==o?void 0:o.state)===r.LoadingState.Loading?"fa fa-spinner":void 0,disabled:(null==o?void 0:o.state)===r.LoadingState.Loading,children:"Run query"}),(0,Ve.jsx)(nt.n,{label:"Instant",value:s.queryType===I.E.Instant,onChange:e=>{n(Object.assign({},s,{queryType:e.currentTarget.checked?I.E.Instant:I.E.Range})),i()}}),(0,Ve.jsx)(rt.InlineSelect,{value:null,placeholder:"Query patterns",allowCustomValue:!0,onChange:e=>{let{value:t}=e;p(Object.assign({},c,{operations:null==t?void 0:t.operations}))},options:jt.getQueryPatterns().map((e=>({label:e.name,value:e})))}),(0,Ve.jsx)(st.k,{mode:m,onChange:d})]}),Ot||(Ot=(0,Ve.jsx)(rt.Space,{v:.5})),m===it.c.Code&&(0,Ve.jsx)(Je,Object.assign({},e)),m===it.c.Builder&&(0,Ve.jsx)(kt,{datasource:e.datasource,query:c,onChange:p,onRunQuery:e.onRunQuery}),m===it.c.Explain&&(0,Ve.jsx)($t,{query:c})]})}));Rt.displayName="LokiQueryEditorSelector";const qt=e=>({runQuery:(0,at.css)({color:e.colors.text.secondary}),switchLabel:(0,at.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize})});function Qt(e){const{app:t}=e;switch(t){case r.CoreApp.CloudAlerting:return(0,Ve.jsx)(Ge,Object.assign({},e));case r.CoreApp.Explore:return h.config.featureToggles.lokiQueryBuilder?(0,Ve.jsx)(Rt,Object.assign({},e)):(0,Ve.jsx)(et,Object.assign({},e));default:return h.config.featureToggles.lokiQueryBuilder?(0,Ve.jsx)(Rt,Object.assign({},e)):(0,Ve.jsx)(Je,Object.assign({},e))}}const It=(0,Pe.memo)(Qt);class Et{constructor(e){this.annotation=e.ctrl.annotation,this.annotation.target=this.annotation.target||{},this.onQueryChange=this.onQueryChange.bind(this)}onQueryChange(e){this.annotation.expr=e.expr,this.annotation.maxLines=e.maxLines,this.annotation.instant=e.instant}}var Nt,At,Dt;Et.$inject=["$scope"],Dt="partials/annotations.editor.html",(At="templateUrl")in(Nt=Et)?Object.defineProperty(Nt,At,{value:Dt,enumerable:!0,configurable:!0,writable:!0}):Nt[At]=Dt;const{FormField:Pt}=He.LegacyForms,Vt=e=>{const{value:t,onChange:a}=e;return(0,Ve.jsx)(Pt,{label:"Maximum lines",labelWidth:11,inputWidth:20,inputEl:(0,Ve.jsx)("input",{type:"number",className:"gf-form-input width-8 gf-form-input--has-help-icon",value:t,onChange:e=>a(e.currentTarget.value),spellCheck:!1,placeholder:"1000"}),tooltip:(0,Ve.jsx)(Ve.Fragment,{children:"Loki queries must contain a limit of the maximum number of lines returned (default: 1000). Increase this limit to have a bigger result set for ad-hoc analysis. Decrease this limit if your browser becomes sluggish when displaying the log results."})})};var Mt=a("./.yarn/__virtual__/react-use-virtual-00326e70ba/0/cache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/usePrevious.js");const{Switch:zt,FormField:Ut}=He.LegacyForms,Bt=(0,He.stylesFactory)((()=>({row:at.css`
    display: flex;
    align-items: baseline;
  `,nameField:at.css`
    flex: 2;
  `,regexField:at.css`
    flex: 3;
  `,urlField:at.css`
    flex: 1;
  `,urlDisplayLabelField:at.css`
    flex: 1;
  `}))),Kt=e=>{const{value:t,onChange:a,onDelete:r,suggestions:s,className:n}=e,i=Bt(),[o,l]=(0,Pe.useState)(!!t.datasourceUid),c=(0,Mt.Z)(t.datasourceUid);(0,Pe.useEffect)((()=>{c||!t.datasourceUid||o||l(!0),c&&!t.datasourceUid&&o&&l(!1)}),[c,t.datasourceUid,o]);const u=e=>r=>{a(Object.assign({},t,{[e]:r.currentTarget.value}))};return(0,Ve.jsxs)("div",{className:n,children:[(0,Ve.jsxs)("div",{className:i.row,children:[(0,Ve.jsx)(Ut,{className:i.nameField,labelWidth:5,inputWidth:null,label:"Name",type:"text",value:t.name,onChange:u("name")}),(0,Ve.jsx)(Ut,{className:i.regexField,inputWidth:null,label:"Regex",type:"text",value:t.matcherRegex,onChange:u("matcherRegex"),tooltip:"Use to parse and capture some part of the log message. You can use the captured groups in the template."}),(0,Ve.jsx)(He.Button,{variant:"destructive",title:"Remove field",icon:"times",onClick:e=>{e.preventDefault(),r()},className:at.css`
            margin-left: 8px;
          `})]}),(0,Ve.jsxs)("div",{className:i.row,children:[(0,Ve.jsx)(Ut,{label:o?"Query":"URL",inputEl:(0,Ve.jsx)(He.DataLinkInput,{placeholder:o?"${__value.raw}":"http://example.com/${__value.raw}",value:t.url||"",onChange:e=>a(Object.assign({},t,{url:e})),suggestions:s}),className:i.urlField}),(0,Ve.jsx)(Ut,{className:i.urlDisplayLabelField,inputWidth:null,label:"URL Label",type:"text",value:t.urlDisplayLabel,onChange:u("urlDisplayLabel"),tooltip:"Use to override the button label when this derived field is found in a log."})]}),(0,Ve.jsxs)("div",{className:i.row,children:[(0,Ve.jsx)(zt,{label:"Internal link",checked:o,onChange:()=>{o&&a(Object.assign({},t,{datasourceUid:void 0})),l(!o)}}),o&&(0,Ve.jsx)(h.DataSourcePicker,{tracing:!0,onChange:e=>a(Object.assign({},t,{datasourceUid:e.uid})),current:t.datasourceUid})]})]})};var Wt,Ht=a("./.yarn/cache/classnames-npm-2.3.1-f2ae0a8d3c-14db8889d5.zip/node_modules/classnames/index.js"),Zt=a.n(Ht),Jt=a("./public/app/features/explore/utils/links.ts");const{FormField:Yt}=He.LegacyForms,Gt=e=>{const{derivedFields:t,className:a}=e,[s,n]=(0,Pe.useState)("");let i=[];return s&&t&&(i=function(e,t){return e.filter((e=>e.name&&e.matcherRegex)).map((e=>{try{const a=t.match(e.matcherRegex),s=a&&a[1];let n=null;return e.url&&s&&(n=(0,Jt.a)({field:{name:"",type:r.FieldType.string,values:new r.ArrayVector([s]),config:{links:[{title:"",url:e.url}]}},rowIndex:0,range:{}})[0]),{name:e.name,value:s||"<no match>",href:n&&n.href}}catch(t){return{name:e.name,error:t}}}))}(t,s)),(0,Ve.jsxs)("div",{className:a,children:[(0,Ve.jsx)(Yt,{labelWidth:12,label:"Debug log message",inputEl:(0,Ve.jsx)("textarea",{placeholder:"Paste an example log line here to test the regular expressions of your derived fields",className:Zt()("gf-form-input gf-form-textarea",at.css`
                width: 100%;
              `),value:s,onChange:e=>n(e.currentTarget.value)})}),!!i.length&&(0,Ve.jsx)(Xt,{fields:i})]})},Xt=e=>{let{fields:t}=e;return(0,Ve.jsxs)("table",{className:"filter-table",children:[Wt||(Wt=(0,Ve.jsx)("thead",{children:(0,Ve.jsxs)("tr",{children:[(0,Ve.jsx)("th",{children:"Name"}),(0,Ve.jsx)("th",{children:"Value"}),(0,Ve.jsx)("th",{children:"Url"})]})})),(0,Ve.jsx)("tbody",{children:t.map((e=>{let t=e.value;return e.error?t=e.error.message:e.href&&(t=(0,Ve.jsx)("a",{href:e.href,children:t})),(0,Ve.jsxs)("tr",{children:[(0,Ve.jsx)("td",{children:e.name}),(0,Ve.jsx)("td",{children:t}),(0,Ve.jsx)("td",{children:e.href?(0,Ve.jsx)("a",{href:e.href,children:e.href}):""})]},`${e.name}=${e.value}`)}))})]})};var ea;const ta=e=>{const{value:t,onChange:a}=e,s=(e=>({infoText:at.css`
    padding-bottom: ${e.spacing(2)};
    color: ${e.colors.text.secondary};
  `,derivedField:at.css`
    margin-bottom: ${e.spacing(1)};
  `}))((0,He.useTheme2)()),[n,i]=(0,Pe.useState)(!1);return(0,Ve.jsxs)(Ve.Fragment,{children:[ea||(ea=(0,Ve.jsx)("h3",{className:"page-heading",children:"Derived fields"})),(0,Ve.jsx)("div",{className:s.infoText,children:"Derived fields can be used to extract new fields from a log message and create a link from its value."}),(0,Ve.jsxs)("div",{className:"gf-form-group",children:[t&&t.map(((e,n)=>(0,Ve.jsx)(Kt,{className:s.derivedField,value:e,onChange:e=>{const r=[...t];r.splice(n,1,e),a(r)},onDelete:()=>{const e=[...t];e.splice(n,1),a(e)},suggestions:[{value:r.DataLinkBuiltInVars.valueRaw,label:"Raw value",documentation:"Exact string captured by the regular expression",origin:r.VariableOrigin.Value}]},n))),(0,Ve.jsxs)("div",{children:[(0,Ve.jsx)(He.Button,{variant:"secondary",className:at.css`
              margin-right: 10px;
            `,icon:"plus",onClick:e=>{e.preventDefault();const r=[...t||[],{name:"",matcherRegex:""}];a(r)},children:"Add"}),t&&t.length>0&&(0,Ve.jsx)(He.Button,{variant:"secondary",type:"button",onClick:()=>i(!n),children:n?"Hide example log message":"Show example log message"})]})]}),n&&(0,Ve.jsx)("div",{className:"gf-form-group",children:(0,Ve.jsx)(Gt,{className:at.css`
              margin-bottom: 10px;
            `,derivedFields:t})})]})};var aa=a("./public/app/features/alerting/unified/utils/alertmanager.ts");const ra=e=>(t,a)=>Object.assign({},t,{jsonData:Object.assign({},t.jsonData,{[e]:a})}),sa=ra("maxLines"),na=ra("derivedFields"),ia=new r.DataSourcePlugin(Ce).setQueryEditor(It).setConfigEditor((e=>{const{options:t,onOptionsChange:a}=e,r=(0,aa.Tc)();return(0,Ve.jsxs)(Ve.Fragment,{children:[(0,Ve.jsx)(He.DataSourceHttpSettings,{defaultUrl:"http://localhost:3100",dataSourceConfig:t,showAccessOptions:!1,onChange:a}),(0,Ve.jsx)(He.AlertingSettings,{alertmanagerDataSources:r,options:t,onOptionsChange:a}),(0,Ve.jsx)("div",{className:"gf-form-group",children:(0,Ve.jsx)("div",{className:"gf-form-inline",children:(0,Ve.jsx)("div",{className:"gf-form",children:(0,Ve.jsx)(Vt,{value:t.jsonData.maxLines||"",onChange:e=>a(sa(t,e))})})})}),(0,Ve.jsx)(ta,{value:t.jsonData.derivedFields,onChange:e=>a(na(t,e))})]})})).setQueryEditorHelp(Ke).setAnnotationQueryCtrl(Et)}}]);
//# sourceMappingURL=lokiPlugin.e65e3aa10981aa98e7a1.js.map