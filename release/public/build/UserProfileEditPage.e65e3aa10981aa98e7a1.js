"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7323],{"./public/app/core/components/SharedPreferences/SharedPreferences.tsx":(e,s,a)=>{a.d(s,{v:()=>b,Z:()=>j});var r,i,n,t,o=a("./.yarn/__virtual__/@lingui-react-virtual-edf7967b4d/0/cache/@lingui-react-npm-3.13.0-279ef69307-ca97bd3e80.zip/node_modules/@lingui/react/esm/index.js"),d=a("./.yarn/cache/@lingui-core-npm-3.13.0-aa863e2651-6108eb43fa.zip/node_modules/@lingui/core/esm/index.js"),l=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),c=a("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/0/cache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),u=a("./packages/grafana-ui/src/index.ts"),h=a("./packages/grafana-e2e-selectors/src/index.ts"),m=a("./public/app/core/services/backend_srv.ts"),p=a("./public/app/core/services/PreferencesService.ts"),g=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");function f(e,s,a){return s in e?Object.defineProperty(e,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[s]=a,e}const x=[{value:"",label:d.ag._({id:"shared-preferences.theme.default-label",message:"Default"})},{value:"dark",label:d.ag._({id:"shared-preferences.theme.dark-label",message:"Dark"})},{value:"light",label:d.ag._({id:"shared-preferences.theme.light-label",message:"Light"})}];class b extends l.PureComponent{constructor(e){super(e),f(this,"service",void 0),f(this,"onSubmitForm",(async()=>{const{homeDashboardId:e,theme:s,timezone:a,weekStart:r}=this.state;await this.service.update({homeDashboardId:e,theme:s,timezone:a,weekStart:r}),window.location.reload()})),f(this,"onThemeChanged",(e=>{this.setState({theme:e})})),f(this,"onTimeZoneChanged",(e=>{e&&this.setState({timezone:e})})),f(this,"onWeekStartChanged",(e=>{this.setState({weekStart:e})})),f(this,"onHomeDashboardChanged",(e=>{this.setState({homeDashboardId:e})})),f(this,"getFullDashName",(e=>void 0===e.folderTitle||""===e.folderTitle?e.title:e.folderTitle+" / "+e.title)),this.service=new p.y(e.resourceUri),this.state={homeDashboardId:0,theme:"",timezone:"",weekStart:"",dashboards:[]}}async componentDidMount(){const e=await this.service.load(),s=await m.ae.search({starred:!0});if(e.homeDashboardId>0&&!s.find((s=>s.id===e.homeDashboardId))){const a=await m.ae.search({dashboardIds:[e.homeDashboardId]});a&&a.length>0&&s.push(a[0])}this.setState({homeDashboardId:e.homeDashboardId,theme:e.theme,timezone:e.timezone,weekStart:e.weekStart,dashboards:[{id:0,title:"Default",tags:[],type:"",uid:"",uri:"",url:"",folderId:0,folderTitle:"",folderUid:"",folderUrl:"",isStarred:!1,slug:"",items:[]},...s]})}render(){const{theme:e,timezone:s,weekStart:a,homeDashboardId:l,dashboards:c}=this.state,{disabled:m}=this.props,p=v(),f=r||(r=(0,g.jsx)(u.Tooltip,{content:(0,g.jsx)(o.cC,{id:"shared-preferences.fields.home-dashboard-tooltip"}),children:(0,g.jsx)(u.Icon,{name:"info-circle"})}));return(0,g.jsx)(u.Form,{onSubmit:this.onSubmitForm,children:()=>{var r;return(0,g.jsxs)(u.FieldSet,{label:i||(i=(0,g.jsx)(o.cC,{id:"shared-preferences.title"})),disabled:m,children:[(0,g.jsx)(u.Field,{label:d.ag._({id:"shared-preferences.fields.theme-label",message:"UI Theme"}),children:(0,g.jsx)(u.RadioButtonGroup,{options:x,value:null===(r=x.find((s=>s.value===e)))||void 0===r?void 0:r.value,onChange:this.onThemeChanged})}),(0,g.jsx)(u.Field,{label:(0,g.jsxs)(u.Label,{htmlFor:"home-dashboard-select",children:[(0,g.jsx)("span",{className:p.labelText,children:n||(n=(0,g.jsx)(o.cC,{id:"shared-preferences.fields.home-dashboard-label"}))}),f]}),"data-testid":"User preferences home dashboard drop down",children:(0,g.jsx)(u.Select,{menuShouldPortal:!0,value:c.find((e=>e.id===l)),getOptionValue:e=>e.id,getOptionLabel:this.getFullDashName,onChange:e=>this.onHomeDashboardChanged(e.id),options:c,placeholder:d.ag._({id:"shared-preferences.fields.home-dashboard-placeholder",message:"Choose default dashboard"}),inputId:"home-dashboard-select"})}),(0,g.jsx)(u.Field,{label:d.ag._({id:"shared-dashboard.fields.timezone-label",message:"Timezone"}),"data-testid":h.wl.components.TimeZonePicker.containerV2,children:(0,g.jsx)(u.TimeZonePicker,{includeInternal:!0,value:s,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})}),(0,g.jsx)(u.Field,{label:d.ag._({id:"shared-preferences.fields.week-start-label",message:"Week start"}),"data-testid":h.wl.components.WeekStartPicker.containerV2,children:(0,g.jsx)(u.WeekStartPicker,{value:a,onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})}),(0,g.jsx)("div",{className:"gf-form-button-row",children:(0,g.jsx)(u.Button,{variant:"primary","data-testid":h.wl.components.UserProfile.preferencesSaveButton,children:t||(t=(0,g.jsx)(o.cC,{id:"common.save"}))})})]})}})}}const j=b,v=(0,u.stylesFactory)((()=>({labelText:c.css`
      margin-right: 6px;
    `})))},"./public/app/features/profile/UserProfileEditPage.tsx":(e,s,a)=>{a.r(s),a.d(s,{UserProfileEditPage:()=>R,default:()=>$});var r,i,n,t,o,d,l,c,u=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),h=a("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/0/cache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),m=a("./.yarn/__virtual__/react-use-virtual-00326e70ba/0/cache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useMount.js"),p=a("./packages/grafana-ui/src/index.ts"),g=a("./public/app/core/selectors/navModel.ts"),f=a("./public/app/core/components/Page/Page.tsx"),x=a("./public/app/features/profile/state/actions.ts"),b=a("./.yarn/__virtual__/@lingui-react-virtual-edf7967b4d/0/cache/@lingui-react-npm-3.13.0-279ef69307-ca97bd3e80.zip/node_modules/@lingui/react/esm/index.js"),j=a("./.yarn/cache/@lingui-core-npm-3.13.0-aa863e2651-6108eb43fa.zip/node_modules/@lingui/core/esm/index.js"),v=a("./packages/grafana-e2e-selectors/src/index.ts"),k=a("./public/app/core/config.ts"),_=a("./.yarn/cache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const{disableLoginForm:S}=k.ZP,w=e=>{let{user:s,isSavingUser:a,updateProfile:c}=e;return(0,_.jsx)(p.Form,{onSubmit:e=>{c(e)},validateOn:"onBlur",children:e=>{var c,u,h;let{register:m,errors:g}=e;return(0,_.jsxs)(p.FieldSet,{label:r||(r=(0,_.jsx)(b.cC,{id:"user-profile.title"})),children:[(0,_.jsx)(p.Field,{label:j.ag._({id:"user-profile.fields.name-label",message:"Name"}),invalid:!!g.name,error:i||(i=(0,_.jsx)(b.cC,{id:"user-profile.fields.name-error"})),disabled:S,children:(0,_.jsx)(p.Input,Object.assign({},m("name",{required:!0}),{id:"edit-user-profile-name",placeholder:j.ag._({id:"user-profile.fields.name-label",message:"Name"}),defaultValue:null!==(c=null==s?void 0:s.name)&&void 0!==c?c:"",suffix:n||(n=(0,_.jsx)(y,{}))}))}),(0,_.jsx)(p.Field,{label:j.ag._({id:"user-profile.fields.email-label",message:"Email"}),invalid:!!g.email,error:t||(t=(0,_.jsx)(b.cC,{id:"user-profile.fields.email-error"})),disabled:S,children:(0,_.jsx)(p.Input,Object.assign({},m("email",{required:!0}),{id:"edit-user-profile-email",placeholder:j.ag._({id:"user-profile.fields.email-label",message:"Email"}),defaultValue:null!==(u=null==s?void 0:s.email)&&void 0!==u?u:"",suffix:o||(o=(0,_.jsx)(y,{}))}))}),(0,_.jsx)(p.Field,{label:j.ag._({id:"user-profile.fields.username-label",message:"Username"}),disabled:S,children:(0,_.jsx)(p.Input,Object.assign({},m("login"),{id:"edit-user-profile-username",defaultValue:null!==(h=null==s?void 0:s.login)&&void 0!==h?h:"",placeholder:j.ag._({id:"user-profile.fields.username-label",message:"Username"}),suffix:d||(d=(0,_.jsx)(y,{}))}))}),(0,_.jsx)("div",{className:"gf-form-button-row",children:(0,_.jsx)(p.Button,{variant:"primary",disabled:a,"data-testid":v.wl.components.UserProfile.profileSaveButton,children:l||(l=(0,_.jsx)(b.cC,{id:"common.save"}))})})]})}})},y=()=>S?c||(c=(0,_.jsx)(p.Tooltip,{content:"Login details locked because they are managed in another system.",children:(0,_.jsx)(p.Icon,{name:"lock"})})):null;var P,U,C,z=a("./public/app/core/components/SharedPreferences/SharedPreferences.tsx");class I extends u.PureComponent{render(){const{isLoading:e,teams:s}=this.props;return e?P||(P=(0,_.jsx)(p.LoadingPlaceholder,{text:"Loading teams..."})):0===s.length?null:(0,_.jsxs)("div",{children:[U||(U=(0,_.jsx)("h3",{className:"page-sub-heading",children:"Teams"})),(0,_.jsx)("div",{className:"gf-form-group",children:(0,_.jsxs)("table",{className:"filter-table form-inline","aria-label":"User teams table",children:[C||(C=(0,_.jsx)("thead",{children:(0,_.jsxs)("tr",{children:[(0,_.jsx)("th",{}),(0,_.jsx)("th",{children:"Name"}),(0,_.jsx)("th",{children:"Email"}),(0,_.jsx)("th",{children:"Members"})]})})),(0,_.jsx)("tbody",{children:s.map(((e,s)=>(0,_.jsxs)("tr",{children:[(0,_.jsx)("td",{className:"width-4 text-center",children:(0,_.jsx)("img",{className:"filter-table__avatar",src:e.avatarUrl,alt:""})}),(0,_.jsx)("td",{children:e.name}),(0,_.jsx)("td",{children:e.email}),(0,_.jsx)("td",{children:e.memberCount})]},s)))})]})})]})}}var L,N,T,D,F;class B extends u.PureComponent{render(){const{isLoading:e,orgs:s,user:a}=this.props;return e?L||(L=(0,_.jsx)(p.LoadingPlaceholder,{text:"Loading organizations..."})):0===s.length?null:(0,_.jsxs)("div",{children:[N||(N=(0,_.jsx)("h3",{className:"page-sub-heading",children:(0,_.jsx)(b.cC,{id:"user-orgs.title"})})),(0,_.jsx)("div",{className:"gf-form-group",children:(0,_.jsxs)("table",{className:"filter-table form-inline","data-testid":v.wl.components.UserProfile.orgsTable,children:[T||(T=(0,_.jsx)("thead",{children:(0,_.jsxs)("tr",{children:[(0,_.jsx)("th",{children:(0,_.jsx)(b.cC,{id:"user-orgs.name-column"})}),(0,_.jsx)("th",{children:(0,_.jsx)(b.cC,{id:"user-orgs.role-column"})}),(0,_.jsx)("th",{})]})})),(0,_.jsx)("tbody",{children:s.map(((e,s)=>(0,_.jsxs)("tr",{children:[(0,_.jsx)("td",{children:e.name}),(0,_.jsx)("td",{children:e.role}),(0,_.jsx)("td",{className:"text-right",children:e.orgId===(null==a?void 0:a.orgId)?D||(D=(0,_.jsx)(p.Button,{variant:"secondary",size:"sm",disabled:!0,children:(0,_.jsx)(b.cC,{id:"user-orgs.current-org-button"})})):(0,_.jsx)(p.Button,{variant:"secondary",size:"sm",onClick:()=>{this.props.setUserOrg(e)},children:F||(F=(0,_.jsx)(b.cC,{id:"user-orgs.select-org-button"}))})})]},s)))})]})})]})}}const O=B;var A,Z,V,M,E;class W extends u.PureComponent{render(){const{isLoading:e,sessions:s,revokeUserSession:a,i18n:r}=this.props;return e?A||(A=(0,_.jsx)(p.LoadingPlaceholder,{text:(0,_.jsx)(b.cC,{id:"user-sessions.loading"})})):(0,_.jsx)("div",{children:s.length>0&&(0,_.jsxs)(_.Fragment,{children:[Z||(Z=(0,_.jsx)("h3",{className:"page-sub-heading",children:"Sessions"})),(0,_.jsx)("div",{className:"gf-form-group",children:(0,_.jsxs)("table",{className:"filter-table form-inline","data-testid":v.wl.components.UserProfile.sessionsTable,children:[V||(V=(0,_.jsx)("thead",{children:(0,_.jsxs)("tr",{children:[(0,_.jsx)("th",{children:(0,_.jsx)(b.cC,{id:"user-session.seen-at-column"})}),(0,_.jsx)("th",{children:(0,_.jsx)(b.cC,{id:"user-session.created-at-column"})}),(0,_.jsx)("th",{children:(0,_.jsx)(b.cC,{id:"user-session.ip-column"})}),(0,_.jsx)("th",{children:(0,_.jsx)(b.cC,{id:"user-session.browser-column"})}),(0,_.jsx)("th",{})]})})),(0,_.jsx)("tbody",{children:s.map(((e,s)=>(0,_.jsxs)("tr",{children:[e.isActive?M||(M=(0,_.jsx)("td",{children:"Now"})):(0,_.jsx)("td",{children:e.seenAt}),(0,_.jsx)("td",{children:r.date(e.createdAt,{dateStyle:"long"})}),(0,_.jsx)("td",{children:e.clientIp}),(0,_.jsxs)("td",{children:[e.browser," on ",e.os," ",e.osVersion]}),(0,_.jsx)("td",{children:(0,_.jsx)(p.Button,{size:"sm",variant:"destructive",onClick:()=>a(e.id),"aria-label":r._({id:"user-session.revoke",message:"Revoke user session"}),children:E||(E=(0,_.jsx)(p.Icon,{name:"power"}))})})]},s)))})]})})]})})}}const q=(0,b.GV)()(W);var G;const H={initUserProfilePage:x.PA,revokeUserSession:x.cc,changeUserOrg:x.hz,updateUserProfile:x.Lj};function R(e){let{navModel:s,orgsAreLoading:a,sessionsAreLoading:r,teamsAreLoading:i,initUserProfilePage:n,orgs:t,sessions:o,teams:d,isUpdating:l,user:c,revokeUserSession:u,changeUserOrg:h,updateUserProfile:g}=e;return(0,m.Z)((()=>n())),(0,_.jsx)(f.Z,{navModel:s,children:(0,_.jsx)(f.Z.Contents,{isLoading:!c,children:(0,_.jsxs)(p.VerticalGroup,{spacing:"md",children:[(0,_.jsx)(w,{updateProfile:g,isSavingUser:l,user:c}),G||(G=(0,_.jsx)(z.Z,{resourceUri:"user"})),(0,_.jsx)(I,{isLoading:i,teams:d}),(0,_.jsx)(O,{isLoading:a,setUserOrg:h,orgs:t,user:c}),(0,_.jsx)(q,{isLoading:r,revokeUserSession:u,sessions:o})]})})})}const $=(0,h.connect)((function(e){const s=e.user,{user:a,teams:r,orgs:i,sessions:n,teamsAreLoading:t,orgsAreLoading:o,sessionsAreLoading:d,isUpdating:l}=s;return{navModel:(0,g.h)(e.navIndex,"profile-settings"),orgsAreLoading:o,sessionsAreLoading:d,teamsAreLoading:t,orgs:i,sessions:n,teams:r,isUpdating:l,user:a}}),H)(R)},"./public/app/features/profile/state/actions.ts":(e,s,a)=>{a.d(s,{Cp:()=>t,hz:()=>c,PA:()=>o,II:()=>d,cc:()=>l,Lj:()=>u});var r=a("./packages/grafana-runtime/src/index.ts"),i=a("./public/app/features/profile/state/reducers.ts");const n={changePassword:async function(e){try{await(0,r.getBackendSrv)().put("/api/user/password",e)}catch(e){console.error(e)}},revokeUserSession:async function(e){await(0,r.getBackendSrv)().post("/api/user/revoke-auth-token",{authTokenId:e})},loadUser:function(){return(0,r.getBackendSrv)().get("/api/user")},loadSessions:function(){return(0,r.getBackendSrv)().get("/api/user/auth-tokens")},loadOrgs:function(){return(0,r.getBackendSrv)().get("/api/user/orgs")},loadTeams:function(){return(0,r.getBackendSrv)().get("/api/user/teams")},setUserOrg:async function(e){await(0,r.getBackendSrv)().post("/api/user/using/"+e.orgId,{})},updateUserProfile:async function(e){try{await(0,r.getBackendSrv)().put("/api/user",e)}catch(e){console.error(e)}}};function t(e){return async function(s){s((0,i.zc)({updating:!0})),await n.changePassword(e),s((0,i.zc)({updating:!1}))}}function o(){return async function(e){await e(d()),e((async function(e){e((0,i.qD)());const s=await n.loadTeams();e((0,i.PL)({teams:s}))})),e((async function(e){e((0,i.$S)());const s=await n.loadOrgs();e((0,i.Ns)({orgs:s}))})),e((async function(e){e((0,i.Uk)());const s=await n.loadSessions();e((0,i.z0)({sessions:s}))}))}}function d(){return async function(e){const s=await n.loadUser();e((0,i.aw)({user:s}))}}function l(e){return async function(s){s((0,i.zc)({updating:!0})),await n.revokeUserSession(e),s((0,i.p$)({tokenId:e}))}}function c(e){return async function(s){s((0,i.zc)({updating:!0})),await n.setUserOrg(e),window.location.href=r.config.appSubUrl+"/profile"}}function u(e){return async function(s){s((0,i.zc)({updating:!0})),await n.updateUserProfile(e),await s(d()),s((0,i.zc)({updating:!1}))}}},"./.yarn/__virtual__/react-use-virtual-00326e70ba/0/cache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useMount.js":(e,s,a)=>{a.d(s,{Z:()=>i});var r=a("./.yarn/__virtual__/react-use-virtual-00326e70ba/0/cache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useEffectOnce.js");const i=function(e){(0,r.Z)((function(){e()}))}}}]);
//# sourceMappingURL=UserProfileEditPage.e65e3aa10981aa98e7a1.js.map