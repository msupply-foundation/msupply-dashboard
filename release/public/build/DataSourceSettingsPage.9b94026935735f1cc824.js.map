{"version":3,"sources":["webpack:///./public/app/features/datasources/state/buildCategories.ts","webpack:///./public/app/features/datasources/state/actions.ts","webpack:///./public/app/features/plugins/PluginStateInfo.tsx","webpack:///./public/app/features/datasources/state/navModel.ts","webpack:///./public/app/features/datasources/settings/PluginSettings.tsx","webpack:///./public/app/features/datasources/settings/BasicSettings.tsx","webpack:///./public/app/features/datasources/settings/ButtonRow.tsx","webpack:///./public/app/features/datasources/settings/CloudInfoBox.tsx","webpack:///./public/app/features/datasources/settings/DataSourceSettingsPage.tsx","webpack:///./public/app/features/datasources/state/selectors.ts"],"names":["buildCategories","plugins","categories","id","title","filter","item","categoryIndex","pluginIndex","enterprisePlugins","getPhantomPlugin","name","description","imgUrl","category","edition","hasValidLicense","config","licenseInfo","plugin","enterprisePlugin","find","enterprise","unlicensed","info","links","link","push","type","PluginType","datasource","module","baseUrl","logos","small","large","author","url","screenshots","updated","version","sortPlugins","c","length","sortingRules","prometheus","graphite","loki","mysql","jaeger","postgres","gcloud","sort","a","b","aSort","bSort","options","pluginCatalogURL","initDataSourceSettings","pageId","dependencies","loadDataSource","getDataSource","getDataSourceMeta","importDataSourcePlugin","async","dispatch","getState","dataSourceSettings","dataSource","dataSources","dataSourceMeta","importedPlugin","initDataSourceSettingsSucceeded","err","console","error","initDataSourceSettingsFailed","Error","testDataSource","dataSourceName","getDatasourceSrv","getBackendSrv","dsApi","get","testDatasource","testDataSourceStarting","withNoBackendCache","result","testDataSourceSucceeded","statusText","message","errMessage","details","data","testDataSourceFailed","loadDataSources","response","dataSourcesLoaded","uid","byUid","fetch","method","showErrorAlert","toPromise","ok","log","parseInt","Number","isNaN","toString","window","location","href","locationUtil","assureBaseUrl","getDataSourceUsingUidOrId","pluginInfo","getPluginSettings","meta","isBackend","DataSourceClass","prototype","DataSourceWithBackend","dataSourceLoaded","dataSourceMetaLoaded","updateNavIndex","buildNavModel","addDataSource","getStore","newInstance","access","isDefault","nameExits","nameHasSuffix","getNewName","digit","getLastDigit","findNewName","post","locationService","loadDataSourcePlugins","dataSourcePluginsLoad","enabled","dataSourcePluginsLoaded","updateDataSource","put","updateFrontendSettings","deleteDataSource","delete","toLowerCase","then","settings","datasources","defaultDatasource","init","endsWith","slice","PluginStateInfo","props","display","state","PluginState","deprecated","text","color","tooltip","alpha","beta","getFeatureStateInfo","icon","pluginMeta","navModel","img","subTitle","breadcrumbs","children","active","configPages","page","includes","undefined","include","hasLicense","hideFromTabs","caching","getDataSourceNav","main","pageName","node","child","indexOf","getDataSourceLoadingNav","basicAuth","basicAuthUser","basicAuthPassword","withCredentials","database","jsonData","authType","defaultRegion","orgId","password","readOnly","typeName","typeLogoUrl","user","secureJsonFields","PluginSettings","PureComponent","constructor","super","this","onModelChange","scopeProps","ctrl","datasourceMeta","current","cloneDeep","onModelChanged","bind","componentDidMount","element","components","ConfigEditor","loader","getAngularLoader","template","component","load","componentDidUpdate","prevProps","digest","componentWillUnmount","destroy","render","ref","React","createElement","onOptionsChange","Input","Switch","LegacyForms","BasicSettings","onDefaultChange","onNameChange","className","aria-label","style","marginRight","value","placeholder","onChange","event","target","required","selectors","pages","DataSource","label","checked","ButtonRow","isReadOnly","onDelete","onSubmit","onTest","variant","fill","appSubUrl","disabled","onClick","saveAndTest","CloudInfoBox","mainDS","extraDS","buildInfo","GrafanaEdition","OpenSource","LocalStorageValueProvider","storageKey","defaultValue","isDismissed","onDismiss","severity","bottomSpacing","onRemove","rel","mapDispatchToProps","setDataSourceName","setIsDefault","cleanUpAction","connector","connect","dataSourceId","match","params","URLSearchParams","search","loadError","testingStatus","nav","getNavModel","navIndex","DataSourceSettingsPage","evt","preventDefault","appEvents","publish","ShowConfirmModalEvent","yesText","onConfirm","confirmDelete","stateSelector","renderIsReadOnlyMessage","renderLoadError","showDelete","msg","isString","Page","Contents","renderConfigPageBody","p","body","query","renderAlertDetails","verboseMessage","whiteSpace","renderSettings","status","alert","isLoading","hasDataSource","getDataSources","regex","RegExp","searchQuery","test","getDataSourcePlugins","dataSourceTypeSearchQuery","getDataSourcesSearchQuery","getDataSourcesLayoutMode","layoutMode","getDataSourcesCount","dataSourcesCount"],"mappings":"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","file":"DataSourceSettingsPage.9b94026935735f1cc824.js","sourcesContent":["import { DataSourcePluginMeta, PluginType } from '@grafana/data';\nimport { DataSourcePluginCategory } from 'app/types';\nimport { config } from '../../../core/config';\n\nexport function buildCategories(plugins: DataSourcePluginMeta[]): DataSourcePluginCategory[] {\n  const categories: DataSourcePluginCategory[] = [\n    { id: 'tsdb', title: 'Time series databases', plugins: [] },\n    { id: 'logging', title: 'Logging & document databases', plugins: [] },\n    { id: 'tracing', title: 'Distributed tracing', plugins: [] },\n    { id: 'sql', title: 'SQL', plugins: [] },\n    { id: 'cloud', title: 'Cloud', plugins: [] },\n    { id: 'enterprise', title: 'Enterprise plugins', plugins: [] },\n    { id: 'iot', title: 'Industrial & IoT', plugins: [] },\n    { id: 'other', title: 'Others', plugins: [] },\n  ].filter((item) => item);\n\n  const categoryIndex: Record<string, DataSourcePluginCategory> = {};\n  const pluginIndex: Record<string, DataSourcePluginMeta> = {};\n  const enterprisePlugins = getEnterprisePhantomPlugins();\n\n  // build indices\n  for (const category of categories) {\n    categoryIndex[category.id] = category;\n  }\n\n  const { edition, hasValidLicense } = config.licenseInfo;\n\n  for (const plugin of plugins) {\n    const enterprisePlugin = enterprisePlugins.find((item) => item.id === plugin.id);\n    // Force category for enterprise plugins\n    if (plugin.enterprise || enterprisePlugin) {\n      plugin.category = 'enterprise';\n      plugin.unlicensed = edition !== 'Open Source' && !hasValidLicense;\n      plugin.info.links = enterprisePlugin?.info?.links || plugin.info.links;\n    }\n\n    // Fix link name\n    if (plugin.info.links) {\n      for (const link of plugin.info.links) {\n        link.name = 'Learn more';\n      }\n    }\n\n    const category = categories.find((item) => item.id === plugin.category) || categoryIndex['other'];\n    category.plugins.push(plugin);\n    // add to plugin index\n    pluginIndex[plugin.id] = plugin;\n  }\n\n  for (const category of categories) {\n    // add phantom plugin\n    if (category.id === 'cloud') {\n      category.plugins.push(getGrafanaCloudPhantomPlugin());\n    }\n\n    // add phantom plugins\n    if (category.id === 'enterprise') {\n      for (const plugin of enterprisePlugins) {\n        if (!pluginIndex[plugin.id]) {\n          category.plugins.push(plugin);\n        }\n      }\n    }\n\n    sortPlugins(category.plugins);\n  }\n\n  // Only show categories with plugins\n  return categories.filter((c) => c.plugins.length > 0);\n}\n\nfunction sortPlugins(plugins: DataSourcePluginMeta[]) {\n  const sortingRules: { [id: string]: number } = {\n    prometheus: 100,\n    graphite: 95,\n    loki: 90,\n    mysql: 80,\n    jaeger: 100,\n    postgres: 79,\n    gcloud: -1,\n  };\n\n  plugins.sort((a, b) => {\n    const aSort = sortingRules[a.id] || 0;\n    const bSort = sortingRules[b.id] || 0;\n    if (aSort > bSort) {\n      return -1;\n    }\n    if (aSort < bSort) {\n      return 1;\n    }\n\n    return a.name > b.name ? -1 : 1;\n  });\n}\n\nfunction getEnterprisePhantomPlugins(): DataSourcePluginMeta[] {\n  return [\n    getPhantomPlugin({\n      id: 'grafana-splunk-datasource',\n      name: 'Splunk',\n      description: 'Visualize and explore Splunk logs',\n      imgUrl: 'public/img/plugins/splunk_logo_128.png',\n    }),\n    getPhantomPlugin({\n      id: 'grafana-oracle-datasource',\n      name: 'Oracle',\n      description: 'Visualize and explore Oracle SQL',\n      imgUrl: 'public/img/plugins/oracle.png',\n    }),\n    getPhantomPlugin({\n      id: 'grafana-dynatrace-datasource',\n      name: 'Dynatrace',\n      description: 'Visualize and explore Dynatrace data',\n      imgUrl: 'public/img/plugins/dynatrace.png',\n    }),\n    getPhantomPlugin({\n      id: 'grafana-servicenow-datasource',\n      description: 'ServiceNow integration and data source',\n      name: 'ServiceNow',\n      imgUrl: 'public/img/plugins/servicenow.svg',\n    }),\n    getPhantomPlugin({\n      id: 'grafana-datadog-datasource',\n      description: 'DataDog integration and data source',\n      name: 'DataDog',\n      imgUrl: 'public/img/plugins/datadog.png',\n    }),\n    getPhantomPlugin({\n      id: 'grafana-newrelic-datasource',\n      description: 'New Relic integration and data source',\n      name: 'New Relic',\n      imgUrl: 'public/img/plugins/newrelic.svg',\n    }),\n    getPhantomPlugin({\n      id: 'grafana-mongodb-datasource',\n      description: 'MongoDB integration and data source',\n      name: 'MongoDB',\n      imgUrl: 'public/img/plugins/mongodb.svg',\n    }),\n    getPhantomPlugin({\n      id: 'grafana-snowflake-datasource',\n      description: 'Snowflake integration and data source',\n      name: 'Snowflake',\n      imgUrl: 'public/img/plugins/snowflake.svg',\n    }),\n    getPhantomPlugin({\n      id: 'grafana-wavefront-datasource',\n      description: 'Wavefront integration and data source',\n      name: 'Wavefront',\n      imgUrl: 'public/img/plugins/wavefront.svg',\n    }),\n    getPhantomPlugin({\n      id: 'dlopes7-appdynamics-datasource',\n      description: 'AppDynamics integration and data source',\n      name: 'AppDynamics',\n      imgUrl: 'public/img/plugins/appdynamics.svg',\n    }),\n    getPhantomPlugin({\n      id: 'grafana-saphana-datasource',\n      description: 'SAP HANA® integration and data source',\n      name: 'SAP HANA®',\n      imgUrl: 'public/img/plugins/sap_hana.png',\n    }),\n    getPhantomPlugin({\n      id: 'grafana-honeycomb-datasource',\n      description: 'Honeycomb integration ad datasource',\n      name: 'Honeycomb',\n      imgUrl: 'public/img/plugins/honeycomb.png',\n    }),\n  ];\n}\n\nfunction getGrafanaCloudPhantomPlugin(): DataSourcePluginMeta {\n  return {\n    id: 'gcloud',\n    name: 'Grafana Cloud',\n    type: PluginType.datasource,\n    module: 'phantom',\n    baseUrl: '',\n    info: {\n      description: 'Hosted Graphite, Prometheus, and Loki',\n      logos: { small: 'public/img/grafana_icon.svg', large: 'asd' },\n      author: { name: 'Grafana Labs' },\n      links: [\n        {\n          url: 'https://grafana.com/products/cloud/',\n          name: 'Learn more',\n        },\n      ],\n      screenshots: [],\n      updated: '2019-05-10',\n      version: '1.0.0',\n    },\n  };\n}\n\ninterface GetPhantomPluginOptions {\n  id: string;\n  name: string;\n  description: string;\n  imgUrl: string;\n}\n\nfunction getPhantomPlugin(options: GetPhantomPluginOptions): DataSourcePluginMeta {\n  return {\n    id: options.id,\n    name: options.name,\n    type: PluginType.datasource,\n    module: 'phantom',\n    baseUrl: '',\n    info: {\n      description: options.description,\n      logos: { small: options.imgUrl, large: options.imgUrl },\n      author: { name: 'Grafana Labs' },\n      links: [\n        {\n          url: config.pluginCatalogURL + options.id,\n          name: 'Install now',\n        },\n      ],\n      screenshots: [],\n      updated: '2019-05-10',\n      version: '1.0.0',\n    },\n  };\n}\n","import { DataSourcePluginMeta, DataSourceSettings, locationUtil } from '@grafana/data';\nimport { DataSourceWithBackend, getDataSourceSrv, locationService } from '@grafana/runtime';\nimport { updateNavIndex } from 'app/core/actions';\nimport { getBackendSrv } from 'app/core/services/backend_srv';\nimport { getDatasourceSrv } from 'app/features/plugins/datasource_srv';\nimport { importDataSourcePlugin } from 'app/features/plugins/plugin_loader';\nimport { getPluginSettings } from 'app/features/plugins/PluginSettingsCache';\nimport { DataSourcePluginCategory, ThunkDispatch, ThunkResult } from 'app/types';\n\nimport config from '../../../core/config';\n\nimport { buildCategories } from './buildCategories';\nimport { buildNavModel } from './navModel';\nimport {\n  dataSourceLoaded,\n  dataSourceMetaLoaded,\n  dataSourcePluginsLoad,\n  dataSourcePluginsLoaded,\n  dataSourcesLoaded,\n  initDataSourceSettingsFailed,\n  initDataSourceSettingsSucceeded,\n  testDataSourceFailed,\n  testDataSourceStarting,\n  testDataSourceSucceeded,\n} from './reducers';\nimport { getDataSource, getDataSourceMeta } from './selectors';\n\nexport interface DataSourceTypesLoadedPayload {\n  plugins: DataSourcePluginMeta[];\n  categories: DataSourcePluginCategory[];\n}\n\nexport interface InitDataSourceSettingDependencies {\n  loadDataSource: typeof loadDataSource;\n  getDataSource: typeof getDataSource;\n  getDataSourceMeta: typeof getDataSourceMeta;\n  importDataSourcePlugin: typeof importDataSourcePlugin;\n}\n\nexport interface TestDataSourceDependencies {\n  getDatasourceSrv: typeof getDataSourceSrv;\n  getBackendSrv: typeof getBackendSrv;\n}\n\nexport const initDataSourceSettings = (\n  pageId: string,\n  dependencies: InitDataSourceSettingDependencies = {\n    loadDataSource,\n    getDataSource,\n    getDataSourceMeta,\n    importDataSourcePlugin,\n  }\n): ThunkResult<void> => {\n  return async (dispatch, getState) => {\n    if (!pageId) {\n      dispatch(initDataSourceSettingsFailed(new Error('Invalid ID')));\n      return;\n    }\n\n    try {\n      await dispatch(dependencies.loadDataSource(pageId));\n\n      // have we already loaded the plugin then we can skip the steps below?\n      if (getState().dataSourceSettings.plugin) {\n        return;\n      }\n\n      const dataSource = dependencies.getDataSource(getState().dataSources, pageId);\n      const dataSourceMeta = dependencies.getDataSourceMeta(getState().dataSources, dataSource!.type);\n      const importedPlugin = await dependencies.importDataSourcePlugin(dataSourceMeta);\n\n      dispatch(initDataSourceSettingsSucceeded(importedPlugin));\n    } catch (err) {\n      console.error('Failed to import plugin module', err);\n      dispatch(initDataSourceSettingsFailed(err));\n    }\n  };\n};\n\nexport const testDataSource = (\n  dataSourceName: string,\n  dependencies: TestDataSourceDependencies = {\n    getDatasourceSrv,\n    getBackendSrv,\n  }\n): ThunkResult<void> => {\n  return async (dispatch: ThunkDispatch, getState) => {\n    const dsApi = await dependencies.getDatasourceSrv().get(dataSourceName);\n\n    if (!dsApi.testDatasource) {\n      return;\n    }\n\n    dispatch(testDataSourceStarting());\n\n    dependencies.getBackendSrv().withNoBackendCache(async () => {\n      try {\n        const result = await dsApi.testDatasource();\n\n        dispatch(testDataSourceSucceeded(result));\n      } catch (err) {\n        const { statusText, message: errMessage, details, data } = err;\n\n        const message = errMessage || data?.message || 'HTTP error ' + statusText;\n\n        dispatch(testDataSourceFailed({ message, details }));\n      }\n    });\n  };\n};\n\nexport function loadDataSources(): ThunkResult<void> {\n  return async (dispatch) => {\n    const response = await getBackendSrv().get('/api/datasources');\n    dispatch(dataSourcesLoaded(response));\n  };\n}\n\nexport function loadDataSource(uid: string): ThunkResult<void> {\n  return async (dispatch) => {\n    const dataSource = await getDataSourceUsingUidOrId(uid);\n    const pluginInfo = (await getPluginSettings(dataSource.type)) as DataSourcePluginMeta;\n    const plugin = await importDataSourcePlugin(pluginInfo);\n    const isBackend = plugin.DataSourceClass.prototype instanceof DataSourceWithBackend;\n    const meta = {\n      ...pluginInfo,\n      isBackend: isBackend,\n    };\n    dispatch(dataSourceLoaded(dataSource));\n    dispatch(dataSourceMetaLoaded(meta));\n\n    plugin.meta = meta;\n    dispatch(updateNavIndex(buildNavModel(dataSource, plugin)));\n  };\n}\n\n/**\n * Get data source by uid or id, if old id detected handles redirect\n */\nasync function getDataSourceUsingUidOrId(uid: string): Promise<DataSourceSettings> {\n  // Try first with uid api\n  try {\n    const byUid = await getBackendSrv()\n      .fetch<DataSourceSettings>({\n        method: 'GET',\n        url: `/api/datasources/uid/${uid}`,\n        showErrorAlert: false,\n      })\n      .toPromise();\n\n    if (byUid.ok) {\n      return byUid.data;\n    }\n  } catch (err) {\n    console.log('Failed to lookup data source by uid', err);\n  }\n\n  // try lookup by old db id\n  const id = parseInt(uid, 10);\n  if (!Number.isNaN(id)) {\n    const response = await getBackendSrv()\n      .fetch<DataSourceSettings>({\n        method: 'GET',\n        url: `/api/datasources/${id}`,\n        showErrorAlert: false,\n      })\n      .toPromise();\n\n    // Not ideal to do a full page reload here but so tricky to handle this\n    // otherwise We can update the location using react router, but need to\n    // fully reload the route as the nav model page index is not matching with\n    // the url in that case. And react router has no way to unmount remount a\n    // route\n    if (response.ok && response.data.id.toString() === uid) {\n      window.location.href = locationUtil.assureBaseUrl(`/datasources/edit/${response.data.uid}`);\n      return {} as DataSourceSettings; // avoids flashing an error\n    }\n  }\n\n  throw Error('Could not find data source');\n}\n\nexport function addDataSource(plugin: DataSourcePluginMeta): ThunkResult<void> {\n  return async (dispatch, getStore) => {\n    await dispatch(loadDataSources());\n\n    const dataSources = getStore().dataSources.dataSources;\n\n    const newInstance = {\n      name: plugin.name,\n      type: plugin.id,\n      access: 'proxy',\n      isDefault: dataSources.length === 0,\n    };\n\n    if (nameExits(dataSources, newInstance.name)) {\n      newInstance.name = findNewName(dataSources, newInstance.name);\n    }\n\n    const result = await getBackendSrv().post('/api/datasources', newInstance);\n    locationService.push(`/datasources/edit/${result.datasource.uid}`);\n  };\n}\n\nexport function loadDataSourcePlugins(): ThunkResult<void> {\n  return async (dispatch) => {\n    dispatch(dataSourcePluginsLoad());\n    const plugins = await getBackendSrv().get('/api/plugins', { enabled: 1, type: 'datasource' });\n    const categories = buildCategories(plugins);\n    dispatch(dataSourcePluginsLoaded({ plugins, categories }));\n  };\n}\n\nexport function updateDataSource(dataSource: DataSourceSettings): ThunkResult<void> {\n  return async (dispatch) => {\n    await getBackendSrv().put(`/api/datasources/${dataSource.id}`, dataSource); // by UID not yet supported\n    await updateFrontendSettings();\n    return dispatch(loadDataSource(dataSource.uid));\n  };\n}\n\nexport function deleteDataSource(): ThunkResult<void> {\n  return async (dispatch, getStore) => {\n    const dataSource = getStore().dataSources.dataSource;\n\n    await getBackendSrv().delete(`/api/datasources/${dataSource.id}`);\n    await updateFrontendSettings();\n\n    locationService.push('/datasources');\n  };\n}\n\ninterface ItemWithName {\n  name: string;\n}\n\nexport function nameExits(dataSources: ItemWithName[], name: string) {\n  return (\n    dataSources.filter((dataSource) => {\n      return dataSource.name.toLowerCase() === name.toLowerCase();\n    }).length > 0\n  );\n}\n\nexport function findNewName(dataSources: ItemWithName[], name: string) {\n  // Need to loop through current data sources to make sure\n  // the name doesn't exist\n  while (nameExits(dataSources, name)) {\n    // If there's a duplicate name that doesn't end with '-x'\n    // we can add -1 to the name and be done.\n    if (!nameHasSuffix(name)) {\n      name = `${name}-1`;\n    } else {\n      // if there's a duplicate name that ends with '-x'\n      // we can try to increment the last digit until the name is unique\n\n      // remove the 'x' part and replace it with the new number\n      name = `${getNewName(name)}${incrementLastDigit(getLastDigit(name))}`;\n    }\n  }\n\n  return name;\n}\n\nfunction updateFrontendSettings() {\n  return getBackendSrv()\n    .get('/api/frontend/settings')\n    .then((settings: any) => {\n      config.datasources = settings.datasources;\n      config.defaultDatasource = settings.defaultDatasource;\n      getDatasourceSrv().init(config.datasources, settings.defaultDatasource);\n    });\n}\n\nfunction nameHasSuffix(name: string) {\n  return name.endsWith('-', name.length - 1);\n}\n\nfunction getLastDigit(name: string) {\n  return parseInt(name.slice(-1), 10);\n}\n\nfunction incrementLastDigit(digit: number) {\n  return isNaN(digit) ? 1 : digit + 1;\n}\n\nfunction getNewName(name: string) {\n  return name.slice(0, name.length - 1);\n}\n","import React, { FC } from 'react';\nimport { Badge, BadgeProps } from '@grafana/ui';\nimport { PluginState } from '@grafana/data';\n\ninterface Props {\n  state?: PluginState;\n}\n\nexport const PluginStateInfo: FC<Props> = (props) => {\n  const display = getFeatureStateInfo(props.state);\n\n  if (!display) {\n    return null;\n  }\n\n  return <Badge color={display.color} title={display.tooltip} text={display.text} icon={display.icon} />;\n};\n\nfunction getFeatureStateInfo(state?: PluginState): BadgeProps | null {\n  switch (state) {\n    case PluginState.deprecated:\n      return {\n        text: 'Deprecated',\n        color: 'red',\n        tooltip: `This feature is deprecated and will be removed in a future release`,\n      };\n    case PluginState.alpha:\n      return {\n        text: 'Alpha',\n        color: 'blue',\n        tooltip: `This feature is experimental and future updates might not be backward compatible`,\n      };\n    case PluginState.beta:\n      return {\n        text: 'Beta',\n        color: 'blue',\n        tooltip: `This feature is close to complete but not fully tested`,\n      };\n    default:\n      return null;\n  }\n}\n","import { DataSourceSettings, PluginType, PluginInclude, NavModel, NavModelItem } from '@grafana/data';\nimport config from 'app/core/config';\nimport { GenericDataSourcePlugin } from '../settings/PluginSettings';\n\nexport function buildNavModel(dataSource: DataSourceSettings, plugin: GenericDataSourcePlugin): NavModelItem {\n  const pluginMeta = plugin.meta;\n\n  const navModel: NavModelItem = {\n    img: pluginMeta.info.logos.large,\n    id: 'datasource-' + dataSource.uid,\n    subTitle: `Type: ${pluginMeta.name}`,\n    url: '',\n    text: dataSource.name,\n    breadcrumbs: [{ title: 'Data Sources', url: 'datasources' }],\n    children: [\n      {\n        active: false,\n        icon: 'sliders-v-alt',\n        id: `datasource-settings-${dataSource.uid}`,\n        text: 'Settings',\n        url: `datasources/edit/${dataSource.uid}/`,\n      },\n    ],\n  };\n\n  if (plugin.configPages) {\n    for (const page of plugin.configPages) {\n      navModel.children!.push({\n        active: false,\n        text: page.title,\n        icon: page.icon,\n        url: `datasources/edit/${dataSource.uid}/?page=${page.id}`,\n        id: `datasource-page-${page.id}`,\n      });\n    }\n  }\n\n  if (pluginMeta.includes && hasDashboards(pluginMeta.includes)) {\n    navModel.children!.push({\n      active: false,\n      icon: 'apps',\n      id: `datasource-dashboards-${dataSource.uid}`,\n      text: 'Dashboards',\n      url: `datasources/edit/${dataSource.uid}/dashboards`,\n    });\n  }\n\n  if (config.licenseInfo.hasLicense) {\n    navModel.children!.push({\n      active: false,\n      icon: 'lock',\n      id: `datasource-permissions-${dataSource.id}`,\n      text: 'Permissions',\n      url: `datasources/edit/${dataSource.id}/permissions`,\n    });\n\n    navModel.children!.push({\n      active: false,\n      icon: 'info-circle',\n      id: `datasource-insights-${dataSource.id}`,\n      text: 'Insights',\n      url: `datasources/edit/${dataSource.id}/insights`,\n    });\n\n    navModel.children!.push({\n      active: false,\n      icon: 'database',\n      id: `datasource-cache-${dataSource.id}`,\n      text: 'Cache',\n      url: `datasources/edit/${dataSource.id}/cache`,\n      hideFromTabs: !pluginMeta.isBackend || !config.caching.enabled,\n    });\n  }\n\n  return navModel;\n}\n\nexport function getDataSourceNav(main: NavModelItem, pageName: string): NavModel {\n  let node: NavModelItem;\n\n  // find active page\n  for (const child of main.children!) {\n    if (child.id!.indexOf(pageName) > 0) {\n      child.active = true;\n      node = child;\n      break;\n    }\n  }\n\n  return {\n    main: main,\n    node: node!,\n  };\n}\nexport function getDataSourceLoadingNav(pageName: string): NavModel {\n  const main = buildNavModel(\n    {\n      access: '',\n      basicAuth: false,\n      basicAuthUser: '',\n      basicAuthPassword: '',\n      withCredentials: false,\n      database: '',\n      id: 1,\n      uid: 'x',\n      isDefault: false,\n      jsonData: { authType: 'credentials', defaultRegion: 'eu-west-2' },\n      name: 'Loading',\n      orgId: 1,\n      password: '',\n      readOnly: false,\n      type: 'Loading',\n      typeName: 'Loading',\n      typeLogoUrl: 'public/img/icn-datasource.svg',\n      url: '',\n      user: '',\n      secureJsonFields: {},\n    },\n    {\n      meta: {\n        id: '1',\n        type: PluginType.datasource,\n        name: '',\n        info: {\n          author: {\n            name: '',\n            url: '',\n          },\n          description: '',\n          links: [{ name: '', url: '' }],\n          logos: {\n            large: '',\n            small: '',\n          },\n          screenshots: [],\n          updated: '',\n          version: '',\n        },\n        includes: [],\n        module: '',\n        baseUrl: '',\n      },\n    } as any\n  );\n\n  return getDataSourceNav(main, pageName);\n}\n\nfunction hasDashboards(includes: PluginInclude[]): boolean {\n  return (\n    includes.find((include) => {\n      return include.type === 'dashboard';\n    }) !== undefined\n  );\n}\n","import React, { PureComponent } from 'react';\nimport { cloneDeep } from 'lodash';\nimport {\n  DataQuery,\n  DataSourceApi,\n  DataSourceJsonData,\n  DataSourcePlugin,\n  DataSourcePluginMeta,\n  DataSourceSettings,\n} from '@grafana/data';\nimport { AngularComponent, getAngularLoader } from '@grafana/runtime';\n\nexport type GenericDataSourcePlugin = DataSourcePlugin<DataSourceApi<DataQuery, DataSourceJsonData>>;\n\nexport interface Props {\n  plugin: GenericDataSourcePlugin;\n  dataSource: DataSourceSettings;\n  dataSourceMeta: DataSourcePluginMeta;\n  onModelChange: (dataSource: DataSourceSettings) => void;\n}\n\nexport class PluginSettings extends PureComponent<Props> {\n  element: HTMLDivElement | null = null;\n  component?: AngularComponent;\n  scopeProps: {\n    ctrl: { datasourceMeta: DataSourcePluginMeta; current: DataSourceSettings };\n    onModelChanged: (dataSource: DataSourceSettings) => void;\n  };\n\n  constructor(props: Props) {\n    super(props);\n\n    this.scopeProps = {\n      ctrl: { datasourceMeta: props.dataSourceMeta, current: cloneDeep(props.dataSource) },\n      onModelChanged: this.onModelChanged,\n    };\n    this.onModelChanged = this.onModelChanged.bind(this);\n  }\n\n  componentDidMount() {\n    const { plugin } = this.props;\n\n    if (!this.element) {\n      return;\n    }\n\n    if (!plugin.components.ConfigEditor) {\n      // React editor is not specified, let's render angular editor\n      // How to approach this better? Introduce ReactDataSourcePlugin interface and typeguard it here?\n      const loader = getAngularLoader();\n      const template = '<plugin-component type=\"datasource-config-ctrl\" />';\n\n      this.component = loader.load(this.element, this.scopeProps, template);\n    }\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    const { plugin } = this.props;\n    if (!plugin.components.ConfigEditor && this.props.dataSource !== prevProps.dataSource) {\n      this.scopeProps.ctrl.current = cloneDeep(this.props.dataSource);\n\n      this.component?.digest();\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.component) {\n      this.component.destroy();\n    }\n  }\n\n  onModelChanged = (dataSource: DataSourceSettings) => {\n    this.props.onModelChange(dataSource);\n  };\n\n  render() {\n    const { plugin, dataSource } = this.props;\n\n    if (!plugin) {\n      return null;\n    }\n\n    return (\n      <div ref={(element) => (this.element = element)}>\n        {plugin.components.ConfigEditor &&\n          React.createElement(plugin.components.ConfigEditor, {\n            options: dataSource,\n            onOptionsChange: this.onModelChanged,\n          })}\n      </div>\n    );\n  }\n}\n\nexport default PluginSettings;\n","import React, { FC } from 'react';\nimport { InlineFormLabel, LegacyForms } from '@grafana/ui';\nimport { selectors } from '@grafana/e2e-selectors';\n\nconst { Input, Switch } = LegacyForms;\n\nexport interface Props {\n  dataSourceName: string;\n  isDefault: boolean;\n  onNameChange: (name: string) => void;\n  onDefaultChange: (value: boolean) => void;\n}\n\nconst BasicSettings: FC<Props> = ({ dataSourceName, isDefault, onDefaultChange, onNameChange }) => {\n  return (\n    <div className=\"gf-form-group\" aria-label=\"Datasource settings page basic settings\">\n      <div className=\"gf-form-inline\">\n        <div className=\"gf-form max-width-30\" style={{ marginRight: '3px' }}>\n          <InlineFormLabel\n            tooltip={\n              'The name is used when you select the data source in panels. The default data source is ' +\n              'preselected in new panels.'\n            }\n          >\n            Name\n          </InlineFormLabel>\n          <Input\n            className=\"gf-form-input max-width-23\"\n            type=\"text\"\n            value={dataSourceName}\n            placeholder=\"Name\"\n            onChange={(event) => onNameChange(event.target.value)}\n            required\n            aria-label={selectors.pages.DataSource.name}\n          />\n        </div>\n        <Switch\n          label=\"Default\"\n          checked={isDefault}\n          onChange={(event) => {\n            // @ts-ignore\n            onDefaultChange(event.target.checked);\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default BasicSettings;\n","import React, { FC } from 'react';\nimport { selectors } from '@grafana/e2e-selectors';\n\nimport config from 'app/core/config';\nimport { Button, LinkButton } from '@grafana/ui';\n\nexport interface Props {\n  isReadOnly: boolean;\n  onDelete: () => void;\n  onSubmit: (event: any) => void;\n  onTest: (event: any) => void;\n}\n\nconst ButtonRow: FC<Props> = ({ isReadOnly, onDelete, onSubmit, onTest }) => {\n  return (\n    <div className=\"gf-form-button-row\">\n      <LinkButton variant=\"secondary\" fill=\"outline\" href={`${config.appSubUrl}/datasources`}>\n        Back\n      </LinkButton>\n      <Button\n        type=\"button\"\n        variant=\"destructive\"\n        disabled={isReadOnly}\n        onClick={onDelete}\n        aria-label={selectors.pages.DataSource.delete}\n      >\n        Delete\n      </Button>\n      {!isReadOnly && (\n        <Button\n          type=\"submit\"\n          variant=\"primary\"\n          disabled={isReadOnly}\n          onClick={(event) => onSubmit(event)}\n          aria-label={selectors.pages.DataSource.saveAndTest}\n        >\n          Save &amp; test\n        </Button>\n      )}\n      {isReadOnly && (\n        <Button type=\"submit\" variant=\"primary\" onClick={onTest}>\n          Test\n        </Button>\n      )}\n    </div>\n  );\n};\n\nexport default ButtonRow;\n","import { DataSourceSettings } from '@grafana/data';\nimport { Alert } from '@grafana/ui';\nimport React, { FC } from 'react';\nimport { config } from 'app/core/config';\nimport { GrafanaEdition } from '@grafana/data/src/types/config';\nimport { LocalStorageValueProvider } from 'app/core/components/LocalStorageValueProvider';\n\nconst LOCAL_STORAGE_KEY = 'datasources.settings.cloudInfoBox.isDismissed';\n\nexport interface Props {\n  dataSource: DataSourceSettings;\n}\n\nexport const CloudInfoBox: FC<Props> = ({ dataSource }) => {\n  let mainDS = '';\n  let extraDS = '';\n\n  // don't show for already configured data sources or provisioned data sources\n  if (dataSource.readOnly || (dataSource.version ?? 0) > 2) {\n    return null;\n  }\n\n  // Skip showing this info box in some editions\n  if (config.buildInfo.edition !== GrafanaEdition.OpenSource) {\n    return null;\n  }\n\n  switch (dataSource.type) {\n    case 'prometheus':\n      mainDS = 'Prometheus';\n      extraDS = 'Loki';\n      break;\n    case 'loki':\n      mainDS = 'Loki';\n      extraDS = 'Prometheus';\n      break;\n    default:\n      return null;\n  }\n\n  return (\n    <LocalStorageValueProvider<boolean> storageKey={LOCAL_STORAGE_KEY} defaultValue={false}>\n      {(isDismissed, onDismiss) => {\n        if (isDismissed) {\n          return null;\n        }\n        return (\n          <Alert\n            title={`Configure your ${mainDS} data source below`}\n            severity=\"info\"\n            bottomSpacing={4}\n            onRemove={() => {\n              onDismiss(true);\n            }}\n          >\n            Or skip the effort and get {mainDS} (and {extraDS}) as fully-managed, scalable, and hosted data sources from\n            Grafana Labs with the{' '}\n            <a\n              className=\"external-link\"\n              href={`https://grafana.com/signup/cloud/connect-account?src=grafana-oss&cnt=${dataSource.type}-settings`}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              title=\"The free plan includes 10k active metrics and 50gb storage.\"\n            >\n              free-forever Grafana Cloud plan\n            </a>\n            .\n          </Alert>\n        );\n      }}\n    </LocalStorageValueProvider>\n  );\n};\n","import React, { PureComponent } from 'react';\nimport { isString } from 'lodash';\n// Components\nimport Page from 'app/core/components/Page/Page';\nimport { PluginSettings } from './PluginSettings';\nimport BasicSettings from './BasicSettings';\nimport ButtonRow from './ButtonRow';\n// Services & Utils\nimport appEvents from 'app/core/app_events';\n// Actions & selectors\nimport { getDataSource, getDataSourceMeta } from '../state/selectors';\nimport {\n  deleteDataSource,\n  initDataSourceSettings,\n  loadDataSource,\n  testDataSource,\n  updateDataSource,\n} from '../state/actions';\nimport { getNavModel } from 'app/core/selectors/navModel';\n\n// Types\nimport { StoreState } from 'app/types/';\nimport { DataSourceSettings } from '@grafana/data';\nimport { Alert, Button, LinkButton } from '@grafana/ui';\nimport { getDataSourceLoadingNav, buildNavModel, getDataSourceNav } from '../state/navModel';\nimport { PluginStateInfo } from 'app/features/plugins/PluginStateInfo';\nimport { dataSourceLoaded, setDataSourceName, setIsDefault } from '../state/reducers';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { CloudInfoBox } from './CloudInfoBox';\nimport { GrafanaRouteComponentProps } from 'app/core/navigation/types';\nimport { connect, ConnectedProps } from 'react-redux';\nimport { cleanUpAction } from 'app/core/actions/cleanUp';\nimport { ShowConfirmModalEvent } from '../../../types/events';\n\nexport interface OwnProps extends GrafanaRouteComponentProps<{ uid: string }> {}\n\nfunction mapStateToProps(state: StoreState, props: OwnProps) {\n  const dataSourceId = props.match.params.uid;\n  const params = new URLSearchParams(props.location.search);\n  const dataSource = getDataSource(state.dataSources, dataSourceId);\n  const { plugin, loadError, testingStatus } = state.dataSourceSettings;\n  const page = params.get('page');\n\n  const nav = plugin\n    ? getDataSourceNav(buildNavModel(dataSource, plugin), page || 'settings')\n    : getDataSourceLoadingNav('settings');\n\n  const navModel = getNavModel(\n    state.navIndex,\n    page ? `datasource-page-${page}` : `datasource-settings-${dataSourceId}`,\n    nav\n  );\n\n  return {\n    dataSource: getDataSource(state.dataSources, dataSourceId),\n    dataSourceMeta: getDataSourceMeta(state.dataSources, dataSource.type),\n    dataSourceId: dataSourceId,\n    page,\n    plugin,\n    loadError,\n    testingStatus,\n    navModel,\n  };\n}\n\nconst mapDispatchToProps = {\n  deleteDataSource,\n  loadDataSource,\n  setDataSourceName,\n  updateDataSource,\n  setIsDefault,\n  dataSourceLoaded,\n  initDataSourceSettings,\n  testDataSource,\n  cleanUpAction,\n};\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\nexport type Props = OwnProps & ConnectedProps<typeof connector>;\n\nexport class DataSourceSettingsPage extends PureComponent<Props> {\n  componentDidMount() {\n    const { initDataSourceSettings, dataSourceId } = this.props;\n    initDataSourceSettings(dataSourceId);\n  }\n\n  componentWillUnmount() {\n    this.props.cleanUpAction({\n      stateSelector: (state) => state.dataSourceSettings,\n    });\n  }\n\n  onSubmit = async (evt: React.FormEvent<HTMLFormElement>) => {\n    evt.preventDefault();\n\n    await this.props.updateDataSource({ ...this.props.dataSource });\n\n    this.testDataSource();\n  };\n\n  onTest = async (evt: React.FormEvent<HTMLFormElement>) => {\n    evt.preventDefault();\n\n    this.testDataSource();\n  };\n\n  onDelete = () => {\n    appEvents.publish(\n      new ShowConfirmModalEvent({\n        title: 'Delete',\n        text: 'Are you sure you want to delete this data source?',\n        yesText: 'Delete',\n        icon: 'trash-alt',\n        onConfirm: () => {\n          this.confirmDelete();\n        },\n      })\n    );\n  };\n\n  confirmDelete = () => {\n    this.props.deleteDataSource();\n  };\n\n  onModelChange = (dataSource: DataSourceSettings) => {\n    this.props.dataSourceLoaded(dataSource);\n  };\n\n  isReadOnly() {\n    return this.props.dataSource.readOnly === true;\n  }\n\n  renderIsReadOnlyMessage() {\n    return (\n      <Alert aria-label={selectors.pages.DataSource.readOnly} severity=\"info\" title=\"Provisioned data source\">\n        This data source was added by config and cannot be modified using the UI. Please contact your server admin to\n        update this data source.\n      </Alert>\n    );\n  }\n\n  testDataSource() {\n    const { dataSource, testDataSource } = this.props;\n    testDataSource(dataSource.name);\n  }\n\n  get hasDataSource() {\n    return this.props.dataSource.id > 0;\n  }\n\n  renderLoadError(loadError: any) {\n    let showDelete = false;\n    let msg = loadError.toString();\n    if (loadError.data) {\n      if (loadError.data.message) {\n        msg = loadError.data.message;\n      }\n    } else if (isString(loadError)) {\n      showDelete = true;\n    }\n\n    const node = {\n      text: msg,\n      subTitle: 'Data Source Error',\n      icon: 'exclamation-triangle',\n    };\n    const nav = {\n      node: node,\n      main: node,\n    };\n\n    return (\n      <Page navModel={nav}>\n        <Page.Contents>\n          <div>\n            <div className=\"gf-form-button-row\">\n              {showDelete && (\n                <Button type=\"submit\" variant=\"destructive\" onClick={this.onDelete}>\n                  Delete\n                </Button>\n              )}\n              <LinkButton variant=\"secondary\" href=\"datasources\" fill=\"outline\">\n                Back\n              </LinkButton>\n            </div>\n          </div>\n        </Page.Contents>\n      </Page>\n    );\n  }\n\n  renderConfigPageBody(page: string) {\n    const { plugin } = this.props;\n    if (!plugin || !plugin.configPages) {\n      return null; // still loading\n    }\n\n    for (const p of plugin.configPages) {\n      if (p.id === page) {\n        // Investigate is any plugins using this? We should change this interface\n        return <p.body plugin={plugin} query={{}} />;\n      }\n    }\n\n    return <div>Page not found: {page}</div>;\n  }\n\n  renderAlertDetails() {\n    const { testingStatus } = this.props;\n\n    return (\n      <>\n        {testingStatus?.details?.message}\n        {testingStatus?.details?.verboseMessage ? (\n          <details style={{ whiteSpace: 'pre-wrap' }}>{testingStatus?.details?.verboseMessage}</details>\n        ) : null}\n      </>\n    );\n  }\n\n  renderSettings() {\n    const { dataSourceMeta, setDataSourceName, setIsDefault, dataSource, plugin, testingStatus } = this.props;\n\n    return (\n      <form onSubmit={this.onSubmit}>\n        {this.isReadOnly() && this.renderIsReadOnlyMessage()}\n        {dataSourceMeta.state && (\n          <div className=\"gf-form\">\n            <label className=\"gf-form-label width-10\">Plugin state</label>\n            <label className=\"gf-form-label gf-form-label--transparent\">\n              <PluginStateInfo state={dataSourceMeta.state} />\n            </label>\n          </div>\n        )}\n\n        <CloudInfoBox dataSource={dataSource} />\n\n        <BasicSettings\n          dataSourceName={dataSource.name}\n          isDefault={dataSource.isDefault}\n          onDefaultChange={(state) => setIsDefault(state)}\n          onNameChange={(name) => setDataSourceName(name)}\n        />\n\n        {plugin && (\n          <PluginSettings\n            plugin={plugin}\n            dataSource={dataSource}\n            dataSourceMeta={dataSourceMeta}\n            onModelChange={this.onModelChange}\n          />\n        )}\n\n        {testingStatus?.message && (\n          <div className=\"gf-form-group p-t-2\">\n            <Alert\n              severity={testingStatus.status === 'error' ? 'error' : 'success'}\n              title={testingStatus.message}\n              aria-label={selectors.pages.DataSource.alert}\n            >\n              {testingStatus.details && this.renderAlertDetails()}\n            </Alert>\n          </div>\n        )}\n\n        <ButtonRow\n          onSubmit={(event) => this.onSubmit(event)}\n          isReadOnly={this.isReadOnly()}\n          onDelete={this.onDelete}\n          onTest={(event) => this.onTest(event)}\n        />\n      </form>\n    );\n  }\n\n  render() {\n    const { navModel, page, loadError } = this.props;\n\n    if (loadError) {\n      return this.renderLoadError(loadError);\n    }\n\n    return (\n      <Page navModel={navModel}>\n        <Page.Contents isLoading={!this.hasDataSource}>\n          {this.hasDataSource ? <div>{page ? this.renderConfigPageBody(page) : this.renderSettings()}</div> : null}\n        </Page.Contents>\n      </Page>\n    );\n  }\n}\n\nexport default connector(DataSourceSettingsPage);\n","import { DataSourcePluginMeta, DataSourceSettings, UrlQueryValue } from '@grafana/data';\nimport { DataSourcesState } from '../../../types/datasources';\n\nexport const getDataSources = (state: DataSourcesState) => {\n  const regex = new RegExp(state.searchQuery, 'i');\n\n  return state.dataSources.filter((dataSource: DataSourceSettings) => {\n    return regex.test(dataSource.name) || regex.test(dataSource.database) || regex.test(dataSource.type);\n  });\n};\n\nexport const getDataSourcePlugins = (state: DataSourcesState) => {\n  const regex = new RegExp(state.dataSourceTypeSearchQuery, 'i');\n\n  return state.plugins.filter((type: DataSourcePluginMeta) => {\n    return regex.test(type.name);\n  });\n};\n\nexport const getDataSource = (state: DataSourcesState, dataSourceId: UrlQueryValue): DataSourceSettings => {\n  if (state.dataSource.uid === dataSourceId) {\n    return state.dataSource;\n  }\n  return {} as DataSourceSettings;\n};\n\nexport const getDataSourceMeta = (state: DataSourcesState, type: string): DataSourcePluginMeta => {\n  if (state.dataSourceMeta.id === type) {\n    return state.dataSourceMeta;\n  }\n\n  return {} as DataSourcePluginMeta;\n};\n\nexport const getDataSourcesSearchQuery = (state: DataSourcesState) => state.searchQuery;\nexport const getDataSourcesLayoutMode = (state: DataSourcesState) => state.layoutMode;\nexport const getDataSourcesCount = (state: DataSourcesState) => state.dataSourcesCount;\n"],"sourceRoot":""}