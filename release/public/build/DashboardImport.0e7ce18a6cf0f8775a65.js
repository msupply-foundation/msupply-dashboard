"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8808],{"./public/app/core/components/connectWithCleanUp.tsx":(e,a,t)=>{t.d(a,{$:()=>l});var s=t("./node_modules/react-redux/es/index.js"),r=t("./public/app/core/actions/cleanUp.ts"),o=t("./node_modules/react/index.js"),n=t("./node_modules/hoist-non-react-statics/dist/hoist-non-react-statics.cjs.js"),d=t.n(n),i=t("./node_modules/react/jsx-runtime.js");const l=(e,a,t)=>n=>{const l=(0,s.connect)(e,a)(n),c=e=>{const a=(0,s.useDispatch)();return(0,o.useEffect)((()=>function(){a((0,r.e)({stateSelector:t}))}),[a]),(0,i.jsx)(l,Object.assign({},e))};return c.displayName=`ConnectWithCleanUp(${l.displayName})`,d()(c,n),c}},"./public/app/features/manage-dashboards/DashboardImportPage.tsx":(e,a,t)=>{t.r(a),t.d(a,{DashboardImportPage:()=>V,default:()=>B});var s=t("./node_modules/react/index.js"),r=t("./node_modules/@emotion/css/dist/emotion-css.esm.js"),o=t("./packages/grafana-data/src/index.ts"),n=t("./packages/grafana-e2e-selectors/src/index.ts"),d=t("./packages/grafana-ui/src/index.ts"),i=t("./public/app/core/components/Page/Page.tsx"),l=t("./public/app/core/components/connectWithCleanUp.tsx"),c=t("./node_modules/react-redux/es/index.js"),u=t("./packages/grafana-runtime/src/index.ts"),h=t("./public/app/core/components/Select/FolderPicker.tsx"),p=t("./public/app/features/manage-dashboards/services/ValidationSrv.ts");const m=e=>{try{return JSON.parse(e),!0}catch(e){return"Not valid JSON"}},b=e=>{const a=/(^\d+$)|dashboards\/(\d+)/.exec(e);return!(!a||!a[1]&&!a[2])||"Could not find a valid Grafana.com ID"},g=e=>(0,u.getBackendSrv)().get(`/api/dashboards/uid/${e}`).then((e=>`Dashboard named '${null==e?void 0:e.dashboard.title}' in folder '${null==e?void 0:e.meta.folderTitle}' has the same UID`)).catch((e=>(e.isHandled=!0,!0)));var x=t("./node_modules/react/jsx-runtime.js");const j=["ref"],f=["ref"];var v;function D(e,a){if(null==e)return{};var t,s,r={},o=Object.keys(e);for(s=0;s<o.length;s++)t=o[s],a.indexOf(t)>=0||(r[t]=e[t]);return r}const I=({register:e,errors:a,control:t,getValues:r,uidReset:o,inputs:i,initialFolderId:l,onUidReset:c,onCancel:m,onSubmit:b,watch:I})=>{const[y,O]=(0,s.useState)(!1),N=I("dataSources");return(0,s.useEffect)((()=>{y&&(a.title||a.uid)&&b(r(),{})}),[a,r,y,b]),(0,x.jsxs)(x.Fragment,{children:[v||(v=(0,x.jsx)(d.Legend,{children:"Options"})),(0,x.jsx)(d.Field,{label:"Name",invalid:!!a.title,error:a.title&&a.title.message,children:(0,x.jsx)(d.Input,Object.assign({},e("title",{required:"Name is required",validate:async e=>{return await(a=e,t=r().folder.id,p.Z.validateNewDashboardName(t,a).then((()=>!0)).catch((e=>{if("EXISTING"===e.type)return e.message})));var a,t}}),{type:"text","data-testid":n.wl.components.ImportDashboardForm.name}))}),(0,x.jsx)(d.Field,{label:"Folder",children:(0,x.jsx)(d.InputControl,{render:e=>{let{}=e,a=D(e.field,j);return(0,x.jsx)(h.E,Object.assign({},a,{enableCreateNew:!0,initialFolderId:l}))},name:"folder",control:t})}),(0,x.jsx)(d.Field,{label:"Unique identifier (UID)",description:"The unique identifier (UID) of a dashboard can be used for uniquely identify a dashboard between multiple Grafana installs. The UID allows having consistent URLs for accessing dashboards so changing the title of a dashboard will not break any bookmarked links to that dashboard.",invalid:!!a.uid,error:a.uid&&a.uid.message,children:(0,x.jsx)(x.Fragment,{children:o?(0,x.jsx)(d.Input,Object.assign({},e("uid",{required:!0,validate:async e=>await g(e)}))):(0,x.jsx)(d.Input,Object.assign({disabled:!0},e("uid",{validate:async e=>await g(e)}),{addonAfter:!o&&(0,x.jsx)(d.Button,{onClick:c,children:"Change uid"})}))})}),i.dataSources&&i.dataSources.map(((e,s)=>{const r=`dataSources[${s}]`,o=null!=N?N:[];return(0,x.jsx)(d.Field,{label:e.label,invalid:a.dataSources&&!!a.dataSources[s],error:a.dataSources&&a.dataSources[s]&&"A data source is required",children:(0,x.jsx)(d.InputControl,{name:r,render:a=>{var t;let{}=a,r=D(a.field,f);return(0,x.jsx)(u.DataSourcePicker,Object.assign({},r,{noDefault:!0,placeholder:e.info,pluginId:e.pluginId,current:null===(t=o[s])||void 0===t?void 0:t.name}))},control:t,rules:{required:!0}})},r)})),i.constants&&i.constants.map(((t,s)=>{const r=`constants[${s}]`;return(0,x.jsx)(d.Field,{label:t.label,error:a.constants&&a.constants[s]&&`${t.label} needs a value`,invalid:a.constants&&!!a.constants[s],children:(0,x.jsx)(d.Input,Object.assign({},e(r,{required:!0}),{defaultValue:t.value}))},r)})),(0,x.jsxs)(d.HorizontalGroup,{children:[(0,x.jsx)(d.Button,{type:"submit","data-testid":n.wl.components.ImportDashboardForm.submit,variant:S(a),onClick:()=>{O(!0)},children:F(a)}),(0,x.jsx)(d.Button,{type:"reset",variant:"secondary",onClick:m,children:"Cancel"})]})]})};function S(e){return e&&(e.title||e.uid)?"destructive":"primary"}function F(e){return e&&(e.title||e.uid)?"Import (Overwrite)":"Import"}var y,O,N=t("./public/app/features/manage-dashboards/state/actions.ts"),w=t("./public/app/features/manage-dashboards/state/reducers.ts");function C(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const U={clearLoadedDashboard:N.ys,importDashboard:N.$j},k=(0,c.connect)((e=>{const a=u.locationService.getSearchObject();return{dashboard:e.importDashboard.dashboard,meta:e.importDashboard.meta,source:e.importDashboard.source,inputs:e.importDashboard.inputs,folder:a.folderId?{id:Number(a.folderId)}:{id:0}}}),U);class J extends s.PureComponent{constructor(...e){super(...e),C(this,"state",{uidReset:!1}),C(this,"onSubmit",(e=>{this.props.importDashboard(e)})),C(this,"onCancel",(()=>{this.props.clearLoadedDashboard()})),C(this,"onUidReset",(()=>{this.setState({uidReset:!0})}))}render(){const{dashboard:e,inputs:a,meta:t,source:s,folder:r}=this.props,{uidReset:n}=this.state;return(0,x.jsxs)(x.Fragment,{children:[s===w.G7.Gcom&&(0,x.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,x.jsx)("div",{children:(0,x.jsxs)(d.Legend,{children:["Importing dashboard from"," ",(0,x.jsx)("a",{href:`https://grafana.com/dashboards/${e.gnetId}`,className:"external-link",target:"_blank",rel:"noreferrer",children:"Grafana.com"})]})}),(0,x.jsx)("table",{className:"filter-table form-inline",children:(0,x.jsxs)("tbody",{children:[(0,x.jsxs)("tr",{children:[y||(y=(0,x.jsx)("td",{children:"Published by"})),(0,x.jsx)("td",{children:t.orgName})]}),(0,x.jsxs)("tr",{children:[O||(O=(0,x.jsx)("td",{children:"Updated on"})),(0,x.jsx)("td",{children:(0,o.dateTimeFormat)(t.updatedAt)})]})]})})]}),(0,x.jsx)(d.Form,{onSubmit:this.onSubmit,defaultValues:Object.assign({},e,{constants:[],dataSources:[],folder:r}),validateOnMount:!0,validateFieldsOnMount:["title","uid"],validateOn:"onChange",children:({register:e,errors:t,control:s,watch:o,getValues:d})=>(0,x.jsx)(I,{register:e,errors:t,control:s,getValues:d,uidReset:n,inputs:a,onCancel:this.onCancel,onUidReset:this.onUidReset,onSubmit:this.onSubmit,watch:o,initialFolderId:r.id})})]})}}const $=k(J);$.displayName="ImportDashboardOverview";var q,G,P=t("./public/app/core/app_events.ts"),R=t("./public/app/core/selectors/navModel.ts");function L(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}class T extends s.PureComponent{constructor(...e){super(...e),L(this,"onFileUpload",(e=>{const{importDashboardJson:a}=this.props,t=e.currentTarget.files&&e.currentTarget.files.length>0&&e.currentTarget.files[0];if(t){const e=new FileReader,s=()=>e=>{let t;try{t=JSON.parse(e.target.result)}catch(e){return void P.Z.emit(o.AppEvents.alertError,["Import failed","JSON -> JS Serialization failed: "+e.message])}a(t)};e.onload=s(),e.readAsText(t)}})),L(this,"getDashboardFromJson",(e=>{this.props.importDashboardJson(JSON.parse(e.dashboardJson))})),L(this,"getGcomDashboard",(e=>{let a;const t=/(^\d+$)|dashboards\/(\d+)/.exec(e.gcomDashboard);t&&t[1]?a=t[1]:t&&t[2]&&(a=t[2]),a&&this.props.fetchGcomDashboard(a)}))}renderImportForm(){const e=E(this.props.theme);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("div",{className:e.option,children:(0,x.jsx)(d.FileUpload,{accept:"application/json",onFileUpload:this.onFileUpload,children:"Upload JSON file"})}),(0,x.jsx)("div",{className:e.option,children:(0,x.jsx)(d.Form,{onSubmit:this.getGcomDashboard,defaultValues:{gcomDashboard:""},children:({register:e,errors:a})=>(0,x.jsx)(d.Field,{label:"Import via grafana.com",invalid:!!a.gcomDashboard,error:a.gcomDashboard&&a.gcomDashboard.message,children:(0,x.jsx)(d.Input,Object.assign({id:"url-input",placeholder:"Grafana.com dashboard URL or ID",type:"text"},e("gcomDashboard",{required:"A Grafana dashboard URL or ID is required",validate:b}),{addonAfter:q||(q=(0,x.jsx)(d.Button,{type:"submit",children:"Load"}))}))})})}),(0,x.jsx)("div",{className:e.option,children:(0,x.jsx)(d.Form,{onSubmit:this.getDashboardFromJson,defaultValues:{dashboardJson:""},children:({register:e,errors:a})=>(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(d.Field,{label:"Import via panel json",invalid:!!a.dashboardJson,error:a.dashboardJson&&a.dashboardJson.message,children:(0,x.jsx)(d.TextArea,Object.assign({},e("dashboardJson",{required:"Need a dashboard JSON model",validate:m}),{"data-testid":n.wl.components.DashboardImportPage.textarea,id:"dashboard-json-textarea",rows:10}))}),(0,x.jsx)(d.Button,{type:"submit","data-testid":n.wl.components.DashboardImportPage.submit,children:"Load"})]})})})]})}render(){const{isLoaded:e,navModel:a}=this.props;return(0,x.jsx)(i.Z,{navModel:a,children:(0,x.jsx)(i.Z.Contents,{children:e?G||(G=(0,x.jsx)($,{})):this.renderImportForm()})})}}const _=(0,d.withTheme2)(T),A={fetchGcomDashboard:N.q_,importDashboardJson:N.nQ},V=(0,l.$)((e=>({navModel:(0,R.h)(e.navIndex,"import",void 0,!0),isLoaded:e.importDashboard.isLoaded})),A,(e=>e.importDashboard))(_),B=V;V.displayName="DashboardImport";const E=(0,d.stylesFactory)((e=>({option:r.css`
      margin-bottom: ${e.spacing(4)};
    `})))}}]);
//# sourceMappingURL=DashboardImport.0e7ce18a6cf0f8775a65.js.map